# Comparing `tmp/tan-22.8.0.tar.gz` & `tmp/tan-23.3.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "tan-22.8.0.tar", last modified: Mon Sep 26 00:36:01 2022, max compression
+gzip compressed data, last modified: Sun Feb  2 00:00:00 2020, max compression
```

## Comparing `tan-22.8.0.tar` & `tan-23.3.0.tar`

### file list

```diff
@@ -1,359 +1,337 @@
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      106 2022-09-22 14:52:09.000000 tan-22.8.0/.coveragerc
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      294 2022-09-22 14:52:09.000000 tan-22.8.0/.flake8
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.109496 tan-22.8.0/.github/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      554 2022-09-22 14:52:09.000000 tan-22.8.0/.github/CODE_OF_CONDUCT.md
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.109496 tan-22.8.0/.github/ISSUE_TEMPLATE/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1554 2022-09-22 14:52:09.000000 tan-22.8.0/.github/ISSUE_TEMPLATE/bug_report.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      545 2022-09-22 14:52:09.000000 tan-22.8.0/.github/ISSUE_TEMPLATE/config.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      692 2022-09-22 14:52:09.000000 tan-22.8.0/.github/ISSUE_TEMPLATE/docs-issue.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      649 2022-09-22 14:52:09.000000 tan-22.8.0/.github/ISSUE_TEMPLATE/feature_request.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      637 2022-09-22 14:52:09.000000 tan-22.8.0/.github/ISSUE_TEMPLATE/style_issue.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1529 2022-09-22 14:52:09.000000 tan-22.8.0/.github/PULL_REQUEST_TEMPLATE.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      325 2022-09-22 15:11:35.000000 tan-22.8.0/.github/mypyc-requirements.txt
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.109496 tan-22.8.0/.github/workflows/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      684 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/changelog.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     5497 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/diff_shades.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1534 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/diff_shades_comment.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1058 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/doc.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1447 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/docker.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1126 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/fuzz.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      922 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/lint.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2470 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/pypi_upload.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1421 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/test-311.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2993 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/test.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1910 2022-09-22 15:11:35.000000 tan-22.8.0/.github/workflows/upload_binary.yml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      272 2022-09-22 14:52:09.000000 tan-22.8.0/.gitignore
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1957 2022-09-22 15:11:35.000000 tan-22.8.0/.pre-commit-config.yaml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      521 2022-09-22 15:11:46.000000 tan-22.8.0/.pre-commit-hooks.yaml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       49 2022-09-22 14:52:09.000000 tan-22.8.0/.prettierrc.yaml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      220 2022-09-22 15:11:35.000000 tan-22.8.0/.readthedocs.yaml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     7925 2022-09-22 15:11:35.000000 tan-22.8.0/AUTHORS.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    38007 2022-09-22 15:11:35.000000 tan-22.8.0/CHANGES.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      422 2022-09-22 14:52:09.000000 tan-22.8.0/CONTRIBUTING.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      587 2022-09-22 15:11:35.000000 tan-22.8.0/Dockerfile
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1080 2022-09-22 14:52:09.000000 tan-22.8.0/LICENSE
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       16 2022-09-22 14:52:09.000000 tan-22.8.0/MANIFEST.in
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    49032 2022-09-26 00:36:01.139496 tan-22.8.0/PKG-INFO
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     9711 2022-09-26 00:35:47.000000 tan-22.8.0/README.md
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.109496 tan-22.8.0/action/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1160 2022-09-22 15:11:35.000000 tan-22.8.0/action/main.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1344 2022-09-22 15:11:35.000000 tan-22.8.0/action.yml
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.109496 tan-22.8.0/autoload/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     6784 2022-09-22 15:11:35.000000 tan-22.8.0/autoload/black.vim
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      603 2022-09-22 14:52:09.000000 tan-22.8.0/docs/Makefile
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/_static/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      950 2022-09-22 14:52:09.000000 tan-22.8.0/docs/_static/license.svg
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    99591 2022-09-22 14:52:09.000000 tan-22.8.0/docs/_static/logo2-readme.png
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)   128768 2022-09-22 14:52:09.000000 tan-22.8.0/docs/_static/logo2.png
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      954 2022-09-22 14:52:09.000000 tan-22.8.0/docs/_static/pypi_template.svg
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       32 2022-09-22 14:52:09.000000 tan-22.8.0/docs/authors.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       32 2022-09-22 14:52:09.000000 tan-22.8.0/docs/change_log.md
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.109496 tan-22.8.0/docs/compatible_configs/
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/compatible_configs/flake8/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       51 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/flake8/.flake8
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       51 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/flake8/setup.cfg
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       51 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/flake8/tox.ini
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/compatible_configs/isort/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       23 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/isort/.editorconfig
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       27 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/isort/.isort.cfg
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       31 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/isort/pyproject.toml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       24 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/isort/setup.cfg
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/compatible_configs/pylint/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       30 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/pylint/pylintrc
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       44 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/pylint/pyproject.toml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       30 2022-09-22 14:52:09.000000 tan-22.8.0/docs/compatible_configs/pylint/setup.cfg
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     6671 2022-09-22 15:11:46.000000 tan-22.8.0/docs/conf.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/contributing/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2758 2022-09-22 14:52:09.000000 tan-22.8.0/docs/contributing/gauging_changes.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1528 2022-09-22 15:11:33.000000 tan-22.8.0/docs/contributing/index.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     9266 2022-09-22 14:52:09.000000 tan-22.8.0/docs/contributing/issue_triage.md
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/contributing/reference/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1175 2022-09-22 14:52:09.000000 tan-22.8.0/docs/contributing/reference/reference_classes.rst
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      225 2022-09-22 14:52:09.000000 tan-22.8.0/docs/contributing/reference/reference_exceptions.rst
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     4015 2022-09-22 15:11:35.000000 tan-22.8.0/docs/contributing/reference/reference_functions.rst
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      338 2022-09-22 14:52:09.000000 tan-22.8.0/docs/contributing/reference/reference_summary.rst
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     8585 2022-09-22 15:11:35.000000 tan-22.8.0/docs/contributing/release_process.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2549 2022-09-22 14:52:09.000000 tan-22.8.0/docs/contributing/the_basics.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     5787 2022-09-22 15:11:35.000000 tan-22.8.0/docs/faq.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1615 2022-09-22 15:11:33.000000 tan-22.8.0/docs/getting_started.md
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/guides/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      310 2022-09-22 15:11:33.000000 tan-22.8.0/docs/guides/index.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2309 2022-09-22 14:52:09.000000 tan-22.8.0/docs/guides/introducing_black_to_your_project.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     6514 2022-09-22 14:52:09.000000 tan-22.8.0/docs/guides/using_black_with_other_tools.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3662 2022-09-22 15:11:33.000000 tan-22.8.0/docs/index.md
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/integrations/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     9628 2022-09-22 15:11:35.000000 tan-22.8.0/docs/integrations/editors.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1446 2022-09-22 14:52:09.000000 tan-22.8.0/docs/integrations/github_actions.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      969 2022-09-22 15:11:33.000000 tan-22.8.0/docs/integrations/index.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1198 2022-09-22 15:11:35.000000 tan-22.8.0/docs/integrations/source_version_control.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       62 2022-09-22 15:11:33.000000 tan-22.8.0/docs/license.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      773 2022-09-22 14:52:09.000000 tan-22.8.0/docs/make.bat
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      261 2022-09-22 15:11:35.000000 tan-22.8.0/docs/requirements.txt
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/the_black_code_style/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    20683 2022-09-22 15:11:35.000000 tan-22.8.0/docs/the_black_code_style/current_style.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3310 2022-09-22 15:11:35.000000 tan-22.8.0/docs/the_black_code_style/future_style.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2199 2022-09-22 15:11:35.000000 tan-22.8.0/docs/the_black_code_style/index.md
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/docs/usage_and_configuration/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     4057 2022-09-22 15:11:46.000000 tan-22.8.0/docs/usage_and_configuration/black_as_a_server.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1779 2022-09-22 15:11:33.000000 tan-22.8.0/docs/usage_and_configuration/black_docker_image.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1870 2022-09-22 14:52:09.000000 tan-22.8.0/docs/usage_and_configuration/file_collection_and_discovery.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      969 2022-09-22 15:11:33.000000 tan-22.8.0/docs/usage_and_configuration/index.md
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    10124 2022-09-22 15:11:46.000000 tan-22.8.0/docs/usage_and_configuration/the_basics.md
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/gallery/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      342 2022-09-22 14:52:09.000000 tan-22.8.0/gallery/Dockerfile
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1595 2022-09-22 14:52:09.000000 tan-22.8.0/gallery/README.md
--rwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)     9119 2022-09-22 15:11:35.000000 tan-22.8.0/gallery/gallery.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      924 2022-09-22 15:11:35.000000 tan-22.8.0/mypy.ini
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/plugin/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2038 2022-09-22 14:52:09.000000 tan-22.8.0/plugin/black.vim
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     4083 2022-09-22 15:11:35.000000 tan-22.8.0/pyproject.toml
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/scripts/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/scripts/__init__.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1831 2022-09-22 14:52:09.000000 tan-22.8.0/scripts/check_pre_commit_rev_in_example.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1510 2022-09-22 14:52:09.000000 tan-22.8.0/scripts/check_version_in_basics_example.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     8647 2022-09-22 14:52:09.000000 tan-22.8.0/scripts/diff_shades_gha_helper.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3519 2022-09-22 15:11:35.000000 tan-22.8.0/scripts/fuzz.py
--rwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)     2959 2022-09-22 15:11:35.000000 tan-22.8.0/scripts/migrate-black.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       96 2022-09-26 00:36:01.149496 tan-22.8.0/setup.cfg
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     4722 2022-09-22 15:11:46.000000 tan-22.8.0/setup.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/src/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       19 2022-09-26 00:36:01.000000 tan-22.8.0/src/_black_version.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/src/black/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    44593 2022-09-22 15:36:58.000000 tan-22.8.0/src/black/__init__.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       47 2022-09-22 14:52:09.000000 tan-22.8.0/src/black/__main__.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    10759 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/brackets.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2944 2022-09-22 15:11:46.000000 tan-22.8.0/src/black/cache.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    12725 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/comments.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     6747 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/concurrency.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      264 2022-09-22 14:52:09.000000 tan-22.8.0/src/black/const.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1594 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/debug.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     9333 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/files.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    13499 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/handle_ipynb_magics.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    51943 2022-09-22 15:36:58.000000 tan-22.8.0/src/black/linegen.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    29034 2022-09-22 15:36:58.000000 tan-22.8.0/src/black/lines.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     6658 2022-09-22 15:36:58.000000 tan-22.8.0/src/black/mode.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    24043 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/nodes.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1653 2022-09-22 14:52:09.000000 tan-22.8.0/src/black/numerics.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3486 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/output.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     9886 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/parsing.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/src/black/py.typed
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3451 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/report.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      556 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/rusty.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     8080 2022-09-22 15:36:58.000000 tan-22.8.0/src/black/strings.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    82323 2022-09-22 15:11:35.000000 tan-22.8.0/src/black/trans.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/src/blackd/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     7149 2022-09-22 15:11:35.000000 tan-22.8.0/src/blackd/__init__.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       37 2022-09-22 14:52:09.000000 tan-22.8.0/src/blackd/__main__.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1245 2022-09-22 15:11:35.000000 tan-22.8.0/src/blackd/middlewares.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.119496 tan-22.8.0/src/blib2to3/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    11267 2022-09-22 15:11:35.000000 tan-22.8.0/src/blib2to3/Grammar.txt
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    12762 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/LICENSE
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      793 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/PatternGrammar.txt
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1071 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/README
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        8 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/__init__.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/src/blib2to3/pgen2/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      143 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/pgen2/__init__.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     9607 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/pgen2/conv.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    10670 2022-09-22 15:11:35.000000 tan-22.8.0/src/blib2to3/pgen2/driver.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     6873 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/pgen2/grammar.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1628 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/pgen2/literals.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    14853 2022-09-22 15:11:35.000000 tan-22.8.0/src/blib2to3/pgen2/parse.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    15491 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/pgen2/pgen.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1919 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/pgen2/token.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    22842 2022-09-22 14:52:09.000000 tan-22.8.0/src/blib2to3/pgen2/tokenize.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     5732 2022-09-22 15:11:35.000000 tan-22.8.0/src/blib2to3/pygram.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    32234 2022-09-22 15:11:35.000000 tan-22.8.0/src/blib2to3/pytree.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/src/tan.egg-info/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    49032 2022-09-26 00:36:01.000000 tan-22.8.0/src/tan.egg-info/PKG-INFO
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    10580 2022-09-26 00:36:01.000000 tan-22.8.0/src/tan.egg-info/SOURCES.txt
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        1 2022-09-26 00:36:01.000000 tan-22.8.0/src/tan.egg-info/dependency_links.txt
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       74 2022-09-26 00:36:01.000000 tan-22.8.0/src/tan.egg-info/entry_points.txt
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        1 2022-09-22 15:25:11.000000 tan-22.8.0/src/tan.egg-info/not-zip-safe
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      417 2022-09-26 00:36:01.000000 tan-22.8.0/src/tan.egg-info/requires.txt
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       37 2022-09-26 00:36:01.000000 tan-22.8.0/src/tan.egg-info/top_level.txt
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       90 2022-09-22 14:52:09.000000 tan-22.8.0/test_requirements.txt
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/__init__.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       36 2022-09-22 14:52:09.000000 tan-22.8.0/tests/conftest.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       99 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/empty_pyproject.toml
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/fast/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      460 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/fast/pep_572_do_not_remove_parens.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/include_exclude_tests/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       14 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/.gitignore
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.109496 tan-22.8.0/tests/data/include_exclude_tests/b/
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/include_exclude_tests/b/.definitely_exclude/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/include_exclude_tests/b/dont_exclude/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/b/dont_exclude/a.pie
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/b/dont_exclude/a.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/include_exclude_tests/b/exclude/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/b/exclude/a.pie
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/b/exclude/a.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/b/exclude/a.pyi
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      114 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/include_exclude_tests/pyproject.toml
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/invalid_gitignore_tests/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        2 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/invalid_gitignore_tests/.gitignore
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/invalid_gitignore_tests/a.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       89 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/invalid_gitignore_tests/pyproject.toml
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/invalid_nested_gitignore_tests/
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/invalid_nested_gitignore_tests/a/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        2 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/invalid_nested_gitignore_tests/a/.gitignore
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/invalid_nested_gitignore_tests/a/a.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/invalid_nested_gitignore_tests/a.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       89 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/invalid_nested_gitignore_tests/pyproject.toml
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/jupyter/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      436 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/jupyter/non_python_notebook.ipynb
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      369 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/jupyter/notebook_empty_metadata.ipynb
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      638 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      639 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/jupyter/notebook_trailing_newline.ipynb
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        4 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      762 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/jupyter/notebook_without_changes.ipynb
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/miscellaneous/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      495 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/async_as_identifier.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      255 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/blackd_diff.diff
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       98 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/blackd_diff.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    15604 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/debug_visitor.out
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1193 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/debug_visitor.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1774 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/decorators.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3601 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/docstring_no_string_normalization.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      357 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/docstring_preview_no_string_normalization.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    15671 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      598 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/force_py36.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      793 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/force_pyi.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    11578 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/long_strings_flag_disabled.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      293 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/missing_final_newline.diff
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      145 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/missing_final_newline.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      279 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/pattern_matching_invalid.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       69 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/power_op_newline.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      758 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/python2_detection.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2361 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/string_quotes.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2266 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/miscellaneous/stub.pyi
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/nested_gitignore_tests/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      114 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/pyproject.toml
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/nested_gitignore_tests/root/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        5 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/root/.gitignore
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       39 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/root/a.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       21 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/root/b.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       21 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/root/c.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.129496 tan-22.8.0/tests/data/nested_gitignore_tests/root/child/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        5 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/root/child/.gitignore
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       39 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/root/child/a.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       40 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/root/child/b.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       21 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/root/child/c.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-22 14:52:09.000000 tan-22.8.0/tests/data/nested_gitignore_tests/x.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/preview/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     4107 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/cantfit.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     8290 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/comments7.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      298 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/comments8.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3523 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/docstring_preview.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    31006 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/long_strings.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     6536 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/long_strings__edge_case.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    43282 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/long_strings__regression.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      674 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/one_element_subscript.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      481 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/percent_precedence.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3129 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/remove_await_parens.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2025 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/remove_except_parens.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1460 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/remove_for_brackets.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3351 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/remove_newline_after_code_block_open.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     5371 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/return_annotation_brackets.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      790 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview/skip_magic_trailing_comma.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/preview_310/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      509 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview_310/remove_newline_after_match.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/preview_39/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2575 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/preview_39/remove_with_brackets.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/py_310/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      382 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_310/parenthesized_context_managers.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2668 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_310/pattern_matching_complex.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1965 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_310/pattern_matching_extras.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3066 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_310/pattern_matching_generic.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2641 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_310/pattern_matching_simple.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1061 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_310/pattern_matching_style.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      106 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_310/pep_572_py310.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      380 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_310/starred_for_target.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/py_311/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2114 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_311/pep_646.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      972 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_311/pep_654.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2035 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_311/pep_654_style.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/py_36/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      597 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_36/numeric_literals.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      267 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_36/numeric_literals_skip_underscores.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/py_37/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1199 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_37/python37.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/py_38/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      680 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_38/pep_570.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      970 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_38/pep_572.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1261 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_38/pep_572_remove_parens.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      834 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_38/python38.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/py_39/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      251 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_39/pep_572_py39.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      696 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/py_39/python39.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/simple_cases/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      907 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/attribute_access_on_number_literals.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       63 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/beginning_backslash.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      333 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/bracketmatch.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1091 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/class_blank_parentheses.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     4318 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/class_methods_new_line.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3294 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/collections.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      212 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/comment_after_escaped_newline.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1909 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/comments.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     7638 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/comments2.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1570 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/comments3.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3531 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/comments4.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1194 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/comments5.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2479 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/comments6.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      994 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/comments_non_breaking_space.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     5596 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/composition.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    11196 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/composition_no_trailing_comma.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     7406 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/docstring.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     4597 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/empty_lines.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    15801 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/expression.diff
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    18624 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/expression.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     9645 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtonoff.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      604 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtonoff2.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      251 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtonoff3.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      278 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtonoff4.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      663 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtonoff5.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       40 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtskip.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      555 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtskip2.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      362 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtskip3.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       92 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtskip4.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      301 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtskip5.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      235 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtskip6.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      356 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtskip7.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1705 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fmtskip8.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      815 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/fstring.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     6414 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/function.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2419 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/function2.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3022 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/function_trailing_comma.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2542 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/import_spacing.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3359 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/power_op_spacing.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     3493 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/remove_parens.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      787 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/slices.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      845 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/string_prefixes.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2279 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/torture.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1615 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/trailing_comma_optional_parens1.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      248 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/trailing_comma_optional_parens2.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      967 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/trailing_comma_optional_parens3.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       80 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/tricky_unicode_symbols.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      510 2022-09-22 15:11:35.000000 tan-22.8.0/tests/data/simple_cases/tupleassign.py
-drwxr-xr-x   0 sciyoshi  (1000) sciyoshi  (1000)        0 2022-09-26 00:36:01.139496 tan-22.8.0/tests/data/tabs/
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     4058 2022-09-22 15:36:58.000000 tan-22.8.0/tests/data/tabs/docstring_tabs.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      206 2022-09-22 15:36:58.000000 tan-22.8.0/tests/data/tabs/line_length_tabs.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      170 2022-09-22 15:36:58.000000 tan-22.8.0/tests/data/tabs/long_first_line.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)       89 2022-09-22 14:52:09.000000 tan-22.8.0/tests/empty.toml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     4133 2022-09-22 15:11:35.000000 tan-22.8.0/tests/optional.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)      388 2022-09-22 14:52:09.000000 tan-22.8.0/tests/test.toml
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    88689 2022-09-22 15:11:35.000000 tan-22.8.0/tests/test_black.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     8486 2022-09-22 15:11:35.000000 tan-22.8.0/tests/test_blackd.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     6656 2022-09-22 15:36:58.000000 tan-22.8.0/tests/test_format.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)    16267 2022-09-22 15:11:35.000000 tan-22.8.0/tests/test_ipynb.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     1285 2022-09-22 15:11:35.000000 tan-22.8.0/tests/test_no_ipynb.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2237 2022-09-22 15:11:35.000000 tan-22.8.0/tests/test_trans.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     5280 2022-09-22 15:11:35.000000 tan-22.8.0/tests/util.py
--rw-r--r--   0 sciyoshi  (1000) sciyoshi  (1000)     2833 2022-09-22 15:36:58.000000 tan-22.8.0/tox.ini
+-rw-r--r--   0        0        0      106 2020-02-02 00:00:00.000000 tan-23.3.0/.coveragerc
+-rw-r--r--   0        0        0      360 2020-02-02 00:00:00.000000 tan-23.3.0/.flake8
+-rw-r--r--   0        0        0      125 2020-02-02 00:00:00.000000 tan-23.3.0/.git_archival.txt
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 tan-23.3.0/.gitattributes
+-rw-r--r--   0        0        0     1987 2020-02-02 00:00:00.000000 tan-23.3.0/.pre-commit-config.yaml
+-rw-r--r--   0        0        0      521 2020-02-02 00:00:00.000000 tan-23.3.0/.pre-commit-hooks.yaml
+-rw-r--r--   0        0        0       49 2020-02-02 00:00:00.000000 tan-23.3.0/.prettierrc.yaml
+-rw-r--r--   0        0        0      220 2020-02-02 00:00:00.000000 tan-23.3.0/.readthedocs.yaml
+-rw-r--r--   0        0        0    49375 2020-02-02 00:00:00.000000 tan-23.3.0/CHANGES.md
+-rw-r--r--   0        0        0      422 2020-02-02 00:00:00.000000 tan-23.3.0/CONTRIBUTING.md
+-rw-r--r--   0        0        0      587 2020-02-02 00:00:00.000000 tan-23.3.0/Dockerfile
+-rw-r--r--   0        0        0     9766 2020-02-02 00:00:00.000000 tan-23.3.0/README.md
+-rw-r--r--   0        0        0      289 2020-02-02 00:00:00.000000 tan-23.3.0/SECURITY.md
+-rw-r--r--   0        0        0     1538 2020-02-02 00:00:00.000000 tan-23.3.0/action.yml
+-rw-r--r--   0        0        0      795 2020-02-02 00:00:00.000000 tan-23.3.0/mypy.ini
+-rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 tan-23.3.0/test_requirements.txt
+-rw-r--r--   0        0        0     2969 2020-02-02 00:00:00.000000 tan-23.3.0/tox.ini
+-rw-r--r--   0        0        0      554 2020-02-02 00:00:00.000000 tan-23.3.0/.github/CODE_OF_CONDUCT.md
+-rw-r--r--   0        0        0     1536 2020-02-02 00:00:00.000000 tan-23.3.0/.github/PULL_REQUEST_TEMPLATE.md
+-rw-r--r--   0        0        0     1554 2020-02-02 00:00:00.000000 tan-23.3.0/.github/ISSUE_TEMPLATE/bug_report.md
+-rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 tan-23.3.0/.github/ISSUE_TEMPLATE/config.yml
+-rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 tan-23.3.0/.github/ISSUE_TEMPLATE/docs-issue.md
+-rw-r--r--   0        0        0      649 2020-02-02 00:00:00.000000 tan-23.3.0/.github/ISSUE_TEMPLATE/feature_request.md
+-rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 tan-23.3.0/.github/ISSUE_TEMPLATE/style_issue.md
+-rw-r--r--   0        0        0      684 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/changelog.yml
+-rw-r--r--   0        0        0     5301 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/diff_shades.yml
+-rw-r--r--   0        0        0     1534 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/diff_shades_comment.yml
+-rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/doc.yml
+-rw-r--r--   0        0        0     1889 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/docker.yml
+-rw-r--r--   0        0        0     1127 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/fuzz.yml
+-rw-r--r--   0        0        0     1231 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/lint.yml
+-rw-r--r--   0        0        0     2333 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/pypi_upload.yml
+-rw-r--r--   0        0        0     2994 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/test.yml
+-rw-r--r--   0        0        0     1910 2020-02-02 00:00:00.000000 tan-23.3.0/.github/workflows/upload_binary.yml
+-rw-r--r--   0        0        0     2241 2020-02-02 00:00:00.000000 tan-23.3.0/action/main.py
+-rw-r--r--   0        0        0     7597 2020-02-02 00:00:00.000000 tan-23.3.0/autoload/black.vim
+-rw-r--r--   0        0        0      603 2020-02-02 00:00:00.000000 tan-23.3.0/docs/Makefile
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 tan-23.3.0/docs/authors.md
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 tan-23.3.0/docs/change_log.md
+-rw-r--r--   0        0        0     6671 2020-02-02 00:00:00.000000 tan-23.3.0/docs/conf.py
+-rw-r--r--   0        0        0     5843 2020-02-02 00:00:00.000000 tan-23.3.0/docs/faq.md
+-rw-r--r--   0        0        0     1613 2020-02-02 00:00:00.000000 tan-23.3.0/docs/getting_started.md
+-rw-r--r--   0        0        0     3662 2020-02-02 00:00:00.000000 tan-23.3.0/docs/index.md
+-rw-r--r--   0        0        0       62 2020-02-02 00:00:00.000000 tan-23.3.0/docs/license.md
+-rw-r--r--   0        0        0      773 2020-02-02 00:00:00.000000 tan-23.3.0/docs/make.bat
+-rw-r--r--   0        0        0      258 2020-02-02 00:00:00.000000 tan-23.3.0/docs/requirements.txt
+-rw-r--r--   0        0        0      950 2020-02-02 00:00:00.000000 tan-23.3.0/docs/_static/license.svg
+-rw-r--r--   0        0        0    99591 2020-02-02 00:00:00.000000 tan-23.3.0/docs/_static/logo2-readme.png
+-rw-r--r--   0        0        0   128768 2020-02-02 00:00:00.000000 tan-23.3.0/docs/_static/logo2.png
+-rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 tan-23.3.0/docs/_static/pypi_template.svg
+-rw-r--r--   0        0        0       51 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/flake8/.flake8
+-rw-r--r--   0        0        0       51 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/flake8/setup.cfg
+-rw-r--r--   0        0        0       51 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/flake8/tox.ini
+-rw-r--r--   0        0        0       23 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/isort/.editorconfig
+-rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/isort/.isort.cfg
+-rw-r--r--   0        0        0       31 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/isort/pyproject.toml
+-rw-r--r--   0        0        0       24 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/isort/setup.cfg
+-rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/pylint/pylintrc
+-rw-r--r--   0        0        0       44 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/pylint/pyproject.toml
+-rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 tan-23.3.0/docs/compatible_configs/pylint/setup.cfg
+-rw-r--r--   0        0        0     2758 2020-02-02 00:00:00.000000 tan-23.3.0/docs/contributing/gauging_changes.md
+-rw-r--r--   0        0        0     1528 2020-02-02 00:00:00.000000 tan-23.3.0/docs/contributing/index.md
+-rw-r--r--   0        0        0     9266 2020-02-02 00:00:00.000000 tan-23.3.0/docs/contributing/issue_triage.md
+-rw-r--r--   0        0        0     8585 2020-02-02 00:00:00.000000 tan-23.3.0/docs/contributing/release_process.md
+-rw-r--r--   0        0        0     2520 2020-02-02 00:00:00.000000 tan-23.3.0/docs/contributing/the_basics.md
+-rw-r--r--   0        0        0     1302 2020-02-02 00:00:00.000000 tan-23.3.0/docs/contributing/reference/reference_classes.rst
+-rw-r--r--   0        0        0      225 2020-02-02 00:00:00.000000 tan-23.3.0/docs/contributing/reference/reference_exceptions.rst
+-rw-r--r--   0        0        0     4010 2020-02-02 00:00:00.000000 tan-23.3.0/docs/contributing/reference/reference_functions.rst
+-rw-r--r--   0        0        0      338 2020-02-02 00:00:00.000000 tan-23.3.0/docs/contributing/reference/reference_summary.rst
+-rw-r--r--   0        0        0      310 2020-02-02 00:00:00.000000 tan-23.3.0/docs/guides/index.md
+-rw-r--r--   0        0        0     2309 2020-02-02 00:00:00.000000 tan-23.3.0/docs/guides/introducing_black_to_your_project.md
+-rw-r--r--   0        0        0     7023 2020-02-02 00:00:00.000000 tan-23.3.0/docs/guides/using_black_with_other_tools.md
+-rw-r--r--   0        0        0    14185 2020-02-02 00:00:00.000000 tan-23.3.0/docs/integrations/editors.md
+-rw-r--r--   0        0        0     2255 2020-02-02 00:00:00.000000 tan-23.3.0/docs/integrations/github_actions.md
+-rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 tan-23.3.0/docs/integrations/index.md
+-rw-r--r--   0        0        0     1198 2020-02-02 00:00:00.000000 tan-23.3.0/docs/integrations/source_version_control.md
+-rw-r--r--   0        0        0    21411 2020-02-02 00:00:00.000000 tan-23.3.0/docs/the_black_code_style/current_style.md
+-rw-r--r--   0        0        0     4527 2020-02-02 00:00:00.000000 tan-23.3.0/docs/the_black_code_style/future_style.md
+-rw-r--r--   0        0        0     2197 2020-02-02 00:00:00.000000 tan-23.3.0/docs/the_black_code_style/index.md
+-rw-r--r--   0        0        0     4256 2020-02-02 00:00:00.000000 tan-23.3.0/docs/usage_and_configuration/black_as_a_server.md
+-rw-r--r--   0        0        0     2092 2020-02-02 00:00:00.000000 tan-23.3.0/docs/usage_and_configuration/black_docker_image.md
+-rw-r--r--   0        0        0     1870 2020-02-02 00:00:00.000000 tan-23.3.0/docs/usage_and_configuration/file_collection_and_discovery.md
+-rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 tan-23.3.0/docs/usage_and_configuration/index.md
+-rw-r--r--   0        0        0    10158 2020-02-02 00:00:00.000000 tan-23.3.0/docs/usage_and_configuration/the_basics.md
+-rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 tan-23.3.0/gallery/Dockerfile
+-rw-r--r--   0        0        0     1595 2020-02-02 00:00:00.000000 tan-23.3.0/gallery/README.md
+-rwxr-xr-x   0        0        0     9119 2020-02-02 00:00:00.000000 tan-23.3.0/gallery/gallery.py
+-rw-r--r--   0        0        0     2176 2020-02-02 00:00:00.000000 tan-23.3.0/plugin/black.vim
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/scripts/__init__.py
+-rw-r--r--   0        0        0     1831 2020-02-02 00:00:00.000000 tan-23.3.0/scripts/check_pre_commit_rev_in_example.py
+-rw-r--r--   0        0        0     1510 2020-02-02 00:00:00.000000 tan-23.3.0/scripts/check_version_in_basics_example.py
+-rw-r--r--   0        0        0     8647 2020-02-02 00:00:00.000000 tan-23.3.0/scripts/diff_shades_gha_helper.py
+-rw-r--r--   0        0        0     3519 2020-02-02 00:00:00.000000 tan-23.3.0/scripts/fuzz.py
+-rw-r--r--   0        0        0     2455 2020-02-02 00:00:00.000000 tan-23.3.0/scripts/make_width_table.py
+-rwxr-xr-x   0        0        0     2987 2020-02-02 00:00:00.000000 tan-23.3.0/scripts/migrate-black.py
+-rw-r--r--   0        0        0       19 2020-02-02 00:00:00.000000 tan-23.3.0/src/_black_version.py
+-rw-r--r--   0        0        0    46889 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/__init__.py
+-rw-r--r--   0        0        0       47 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/__main__.py
+-rw-r--r--   0        0        0    10871 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/_width_table.py
+-rw-r--r--   0        0        0    12273 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/brackets.py
+-rw-r--r--   0        0        0     2944 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/cache.py
+-rw-r--r--   0        0        0    12792 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/comments.py
+-rw-r--r--   0        0        0     6286 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/concurrency.py
+-rw-r--r--   0        0        0      284 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/const.py
+-rw-r--r--   0        0        0     1594 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/debug.py
+-rw-r--r--   0        0        0    13448 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/files.py
+-rw-r--r--   0        0        0    13501 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/handle_ipynb_magics.py
+-rw-r--r--   0        0        0    60363 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/linegen.py
+-rw-r--r--   0        0        0    36815 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/lines.py
+-rw-r--r--   0        0        0     7293 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/mode.py
+-rw-r--r--   0        0        0    25698 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/nodes.py
+-rw-r--r--   0        0        0     1653 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/numerics.py
+-rw-r--r--   0        0        0     3486 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/output.py
+-rw-r--r--   0        0        0    10198 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/parsing.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/py.typed
+-rw-r--r--   0        0        0     3451 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/report.py
+-rw-r--r--   0        0        0      556 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/rusty.py
+-rw-r--r--   0        0        0    11306 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/strings.py
+-rw-r--r--   0        0        0    90830 2020-02-02 00:00:00.000000 tan-23.3.0/src/black/trans.py
+-rw-r--r--   0        0        0     8068 2020-02-02 00:00:00.000000 tan-23.3.0/src/blackd/__init__.py
+-rw-r--r--   0        0        0       37 2020-02-02 00:00:00.000000 tan-23.3.0/src/blackd/__main__.py
+-rw-r--r--   0        0        0     1585 2020-02-02 00:00:00.000000 tan-23.3.0/src/blackd/middlewares.py
+-rw-r--r--   0        0        0    11278 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/Grammar.txt
+-rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/LICENSE
+-rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/PatternGrammar.txt
+-rw-r--r--   0        0        0     1071 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/README
+-rw-r--r--   0        0        0        8 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/__init__.py
+-rw-r--r--   0        0        0     5732 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pygram.py
+-rw-r--r--   0        0        0    32612 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pytree.py
+-rw-r--r--   0        0        0      143 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pgen2/__init__.py
+-rw-r--r--   0        0        0     9607 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pgen2/conv.py
+-rw-r--r--   0        0        0    10671 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pgen2/driver.py
+-rw-r--r--   0        0        0     6873 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pgen2/grammar.py
+-rw-r--r--   0        0        0     1628 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pgen2/literals.py
+-rw-r--r--   0        0        0    14859 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pgen2/parse.py
+-rw-r--r--   0        0        0    15491 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pgen2/pgen.py
+-rw-r--r--   0        0        0     1919 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pgen2/token.py
+-rw-r--r--   0        0        0    22842 2020-02-02 00:00:00.000000 tan-23.3.0/src/blib2to3/pgen2/tokenize.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/__init__.py
+-rw-r--r--   0        0        0       36 2020-02-02 00:00:00.000000 tan-23.3.0/tests/conftest.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 tan-23.3.0/tests/empty.toml
+-rw-r--r--   0        0        0     4133 2020-02-02 00:00:00.000000 tan-23.3.0/tests/optional.py
+-rw-r--r--   0        0        0      388 2020-02-02 00:00:00.000000 tan-23.3.0/tests/test.toml
+-rw-r--r--   0        0        0   100992 2020-02-02 00:00:00.000000 tan-23.3.0/tests/test_black.py
+-rw-r--r--   0        0        0     9172 2020-02-02 00:00:00.000000 tan-23.3.0/tests/test_blackd.py
+-rw-r--r--   0        0        0     7901 2020-02-02 00:00:00.000000 tan-23.3.0/tests/test_format.py
+-rw-r--r--   0        0        0    16267 2020-02-02 00:00:00.000000 tan-23.3.0/tests/test_ipynb.py
+-rw-r--r--   0        0        0     1289 2020-02-02 00:00:00.000000 tan-23.3.0/tests/test_no_ipynb.py
+-rw-r--r--   0        0        0     2237 2020-02-02 00:00:00.000000 tan-23.3.0/tests/test_trans.py
+-rw-r--r--   0        0        0     6893 2020-02-02 00:00:00.000000 tan-23.3.0/tests/util.py
+-rw-r--r--   0        0        0     4160 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/conditional_expression.py
+-rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/empty_pyproject.toml
+-rw-r--r--   0        0        0      498 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/fast/pep_572_do_not_remove_parens.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/gitignore_used_on_multiple_sources/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/gitignore_used_on_multiple_sources/dir1/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/gitignore_used_on_multiple_sources/dir1/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/gitignore_used_on_multiple_sources/dir2/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/gitignore_used_on_multiple_sources/dir2/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/ignore_subfolders_gitignore_tests/a.py
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/ignore_subfolders_gitignore_tests/subdir/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/ignore_subfolders_gitignore_tests/subdir/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/ignore_subfolders_gitignore_tests/subdir/subdir/c.py
+-rw-r--r--   0        0        0       14 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/.gitignore
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/b/dont_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/b/dont_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/b/exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/b/exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/include_exclude_tests/b/exclude/a.pyi
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/invalid_gitignore_tests/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/invalid_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/invalid_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/invalid_nested_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/invalid_nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/invalid_nested_gitignore_tests/a/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/invalid_nested_gitignore_tests/a/a.py
+-rw-r--r--   0        0        0      436 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/jupyter/non_python_notebook.ipynb
+-rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/jupyter/notebook_empty_metadata.ipynb
+-rw-r--r--   0        0        0      638 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb
+-rw-r--r--   0        0        0      639 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/jupyter/notebook_trailing_newline.ipynb
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
+-rw-r--r--   0        0        0      762 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/jupyter/notebook_without_changes.ipynb
+-rw-r--r--   0        0        0      495 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/async_as_identifier.py
+-rw-r--r--   0        0        0      255 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/blackd_diff.diff
+-rw-r--r--   0        0        0       98 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/blackd_diff.py
+-rw-r--r--   0        0        0    15604 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/debug_visitor.out
+-rw-r--r--   0        0        0     1193 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/debug_visitor.py
+-rw-r--r--   0        0        0     1774 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/decorators.py
+-rw-r--r--   0        0        0     3601 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/docstring_no_string_normalization.py
+-rw-r--r--   0        0        0      357 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/docstring_preview_no_string_normalization.py
+-rw-r--r--   0        0        0    15711 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
+-rw-r--r--   0        0        0      598 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/force_py36.py
+-rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/force_pyi.py
+-rw-r--r--   0        0        0       59 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/invalid_header.py
+-rw-r--r--   0        0        0      101 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/linelength6.py
+-rw-r--r--   0        0        0    11578 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/long_strings_flag_disabled.py
+-rw-r--r--   0        0        0      293 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/missing_final_newline.diff
+-rw-r--r--   0        0        0      145 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/missing_final_newline.py
+-rw-r--r--   0        0        0      284 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/nested_class_stub.pyi
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/pattern_matching_invalid.py
+-rw-r--r--   0        0        0       69 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/power_op_newline.py
+-rw-r--r--   0        0        0      758 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/python2_detection.py
+-rw-r--r--   0        0        0     2361 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/string_quotes.py
+-rw-r--r--   0        0        0     2266 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/miscellaneous/stub.pyi
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/x.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/root/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/root/a.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/root/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/root/c.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/root/child/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/root/child/a.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/root/child/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/nested_gitignore_tests/root/child/c.py
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/async_stmts.py
+-rw-r--r--   0        0        0     4147 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/cantfit.py
+-rw-r--r--   0        0        0     8290 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/comments7.py
+-rw-r--r--   0        0        0      613 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/format_unicode_escape_seq.py
+-rw-r--r--   0        0        0     2784 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/long_dict_values.py
+-rw-r--r--   0        0        0    33380 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/long_strings.py
+-rw-r--r--   0        0        0     1418 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/long_strings__east_asian_width.py
+-rw-r--r--   0        0        0     6536 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/long_strings__edge_case.py
+-rw-r--r--   0        0        0    45997 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/long_strings__regression.py
+-rw-r--r--   0        0        0     1077 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/long_strings__type_annotations.py
+-rw-r--r--   0        0        0     7199 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/multiline_strings.py
+-rw-r--r--   0        0        0      481 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/percent_precedence.py
+-rw-r--r--   0        0        0     2525 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/prefer_rhs_split.py
+-rw-r--r--   0        0        0      334 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/return_annotation_brackets_string.py
+-rw-r--r--   0        0        0      655 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview/trailing_comma.py
+-rw-r--r--   0        0        0     1140 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview_context_managers/targeting_py38.py
+-rw-r--r--   0        0        0     3361 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview_context_managers/targeting_py39.py
+-rw-r--r--   0        0        0      595 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_10.py
+-rw-r--r--   0        0        0      553 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_11.py
+-rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_8.py
+-rw-r--r--   0        0        0      623 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/preview_context_managers/auto_detect/features_3_9.py
+-rw-r--r--   0        0        0      132 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/project_metadata/both_pyproject.toml
+-rw-r--r--   0        0        0       73 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/project_metadata/neither_pyproject.toml
+-rw-r--r--   0        0        0      100 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/project_metadata/only_black_pyproject.toml
+-rw-r--r--   0        0        0      105 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/project_metadata/only_metadata_pyproject.toml
+-rw-r--r--   0        0        0      765 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_310/parenthesized_context_managers.py
+-rw-r--r--   0        0        0     2668 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_310/pattern_matching_complex.py
+-rw-r--r--   0        0        0     1965 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_310/pattern_matching_extras.py
+-rw-r--r--   0        0        0     3066 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_310/pattern_matching_generic.py
+-rw-r--r--   0        0        0     2641 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_310/pattern_matching_simple.py
+-rw-r--r--   0        0        0     1061 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_310/pattern_matching_style.py
+-rw-r--r--   0        0        0      491 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_310/pep_572_py310.py
+-rw-r--r--   0        0        0      509 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_310/remove_newline_after_match.py
+-rw-r--r--   0        0        0      380 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_310/starred_for_target.py
+-rw-r--r--   0        0        0     2114 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_311/pep_646.py
+-rw-r--r--   0        0        0      972 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_311/pep_654.py
+-rw-r--r--   0        0        0     2033 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_311/pep_654_style.py
+-rw-r--r--   0        0        0      597 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_36/numeric_literals.py
+-rw-r--r--   0        0        0      267 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_36/numeric_literals_skip_underscores.py
+-rw-r--r--   0        0        0     1199 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_37/python37.py
+-rw-r--r--   0        0        0      680 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_38/pep_570.py
+-rw-r--r--   0        0        0      970 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_38/pep_572.py
+-rw-r--r--   0        0        0     1895 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_38/pep_572_remove_parens.py
+-rw-r--r--   0        0        0      834 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_38/python38.py
+-rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_39/pep_572_py39.py
+-rw-r--r--   0        0        0      696 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_39/python39.py
+-rw-r--r--   0        0        0     2575 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/py_39/remove_with_brackets.py
+-rw-r--r--   0        0        0      907 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/attribute_access_on_number_literals.py
+-rw-r--r--   0        0        0       63 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/beginning_backslash.py
+-rw-r--r--   0        0        0      333 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/bracketmatch.py
+-rw-r--r--   0        0        0     1091 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/class_blank_parentheses.py
+-rw-r--r--   0        0        0     4318 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/class_methods_new_line.py
+-rw-r--r--   0        0        0     3294 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/collections.py
+-rw-r--r--   0        0        0      212 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comment_after_escaped_newline.py
+-rw-r--r--   0        0        0     1909 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comments.py
+-rw-r--r--   0        0        0     7639 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comments2.py
+-rw-r--r--   0        0        0     1573 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comments3.py
+-rw-r--r--   0        0        0     3532 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comments4.py
+-rw-r--r--   0        0        0     1196 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comments5.py
+-rw-r--r--   0        0        0     2479 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comments6.py
+-rw-r--r--   0        0        0      298 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comments8.py
+-rw-r--r--   0        0        0     5279 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comments9.py
+-rw-r--r--   0        0        0      994 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/comments_non_breaking_space.py
+-rw-r--r--   0        0        0     5596 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/composition.py
+-rw-r--r--   0        0        0    11196 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/composition_no_trailing_comma.py
+-rw-r--r--   0        0        0     7763 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/docstring.py
+-rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/docstring_no_extra_empty_line_before_eof.py
+-rw-r--r--   0        0        0     3513 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/docstring_preview.py
+-rw-r--r--   0        0        0     4596 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/empty_lines.py
+-rw-r--r--   0        0        0    15801 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/expression.diff
+-rw-r--r--   0        0        0    18624 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/expression.py
+-rw-r--r--   0        0        0     9645 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtonoff.py
+-rw-r--r--   0        0        0      604 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtonoff2.py
+-rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtonoff3.py
+-rw-r--r--   0        0        0      278 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtonoff4.py
+-rw-r--r--   0        0        0     3627 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtonoff5.py
+-rw-r--r--   0        0        0      277 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtpass_imports.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtskip.py
+-rw-r--r--   0        0        0      555 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtskip2.py
+-rw-r--r--   0        0        0      362 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtskip3.py
+-rw-r--r--   0        0        0       92 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtskip4.py
+-rw-r--r--   0        0        0      301 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtskip5.py
+-rw-r--r--   0        0        0      235 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtskip6.py
+-rw-r--r--   0        0        0      356 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtskip7.py
+-rw-r--r--   0        0        0     1705 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fmtskip8.py
+-rw-r--r--   0        0        0      815 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/fstring.py
+-rw-r--r--   0        0        0     6414 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/function.py
+-rw-r--r--   0        0        0     2419 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/function2.py
+-rw-r--r--   0        0        0     3605 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/function_trailing_comma.py
+-rw-r--r--   0        0        0     2542 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/import_spacing.py
+-rw-r--r--   0        0        0      674 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/one_element_subscript.py
+-rw-r--r--   0        0        0     3359 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/power_op_spacing.py
+-rw-r--r--   0        0        0     1106 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/prefer_rhs_split_reformatted.py
+-rw-r--r--   0        0        0     3205 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/remove_await_parens.py
+-rw-r--r--   0        0        0     2025 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/remove_except_parens.py
+-rw-r--r--   0        0        0     1460 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/remove_for_brackets.py
+-rw-r--r--   0        0        0     3351 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/remove_newline_after_code_block_open.py
+-rw-r--r--   0        0        0     3493 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/remove_parens.py
+-rw-r--r--   0        0        0     5045 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/return_annotation_brackets.py
+-rw-r--r--   0        0        0     1398 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/skip_magic_trailing_comma.py
+-rw-r--r--   0        0        0      787 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/slices.py
+-rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/string_prefixes.py
+-rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/torture.py
+-rw-r--r--   0        0        0     1615 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens1.py
+-rw-r--r--   0        0        0      248 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens2.py
+-rw-r--r--   0        0        0      967 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens3.py
+-rw-r--r--   0        0        0     2123 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/trailing_commas_in_leading_parts.py
+-rw-r--r--   0        0        0       80 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/tricky_unicode_symbols.py
+-rw-r--r--   0        0        0      510 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/tupleassign.py
+-rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/simple_cases/whitespace.py
+-rw-r--r--   0        0        0     4058 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/tabs/docstring_tabs.py
+-rw-r--r--   0        0        0      206 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/tabs/line_length_tabs.py
+-rw-r--r--   0        0        0      170 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/tabs/long_first_line.py
+-rw-r--r--   0        0        0       93 2020-02-02 00:00:00.000000 tan-23.3.0/tests/data/type_comments/type_comment_syntax_error.py
+-rw-r--r--   0        0        0      272 2020-02-02 00:00:00.000000 tan-23.3.0/.gitignore
+-rw-r--r--   0        0        0     8043 2020-02-02 00:00:00.000000 tan-23.3.0/AUTHORS.md
+-rw-r--r--   0        0        0     1080 2020-02-02 00:00:00.000000 tan-23.3.0/LICENSE
+-rw-r--r--   0        0        0     6817 2020-02-02 00:00:00.000000 tan-23.3.0/pyproject.toml
+-rw-r--r--   0        0        0    61034 2020-02-02 00:00:00.000000 tan-23.3.0/PKG-INFO
```

### Comparing `tan-22.8.0/.github/CODE_OF_CONDUCT.md` & `tan-23.3.0/.github/CODE_OF_CONDUCT.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/.github/ISSUE_TEMPLATE/bug_report.md` & `tan-23.3.0/.github/ISSUE_TEMPLATE/bug_report.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/.github/ISSUE_TEMPLATE/config.yml` & `tan-23.3.0/.github/ISSUE_TEMPLATE/config.yml`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/.github/ISSUE_TEMPLATE/docs-issue.md` & `tan-23.3.0/.github/ISSUE_TEMPLATE/docs-issue.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/.github/ISSUE_TEMPLATE/feature_request.md` & `tan-23.3.0/.github/ISSUE_TEMPLATE/feature_request.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/.github/ISSUE_TEMPLATE/style_issue.md` & `tan-23.3.0/.github/ISSUE_TEMPLATE/style_issue.md`

 * *Files 18% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 ---
-name: Style issue
-about: Help us improve the Black style
+name: Code style issue
+about: Help us improve the Black code style
 title: ""
-labels: "T: design"
+labels: "T: style"
 assignees: ""
 ---
 
 **Describe the style change**
 
 <!-- A clear and concise description of how the style can be
 improved. -->
```

### Comparing `tan-22.8.0/.github/PULL_REQUEST_TEMPLATE.md` & `tan-23.3.0/.github/PULL_REQUEST_TEMPLATE.md`

 * *Files 4% similar despite different names*

```diff
@@ -14,15 +14,15 @@
      please still tick them so we know you've gone through the checklist.
 
     All user-facing changes should get an entry. Otherwise, signal to us
     this should get the magical label to silence the CHANGELOG entry check.
     Tests are required for bugfixes and new features. Documentation changes
     are necessary for formatting and most enhancement changes. -->
 
-- [ ] Add a CHANGELOG entry if necessary?
+- [ ] Add an entry in `CHANGES.md` if necessary?
 - [ ] Add / update tests if necessary?
 - [ ] Add new / update outdated documentation?
 
 <!-- Just as a reminder, everyone in all psf/black spaces including PRs
      must follow the PSF Code of Conduct (link below).
 
      Finally, once again thanks for your time and effort. If you have any
```

### Comparing `tan-22.8.0/.github/workflows/changelog.yml` & `tan-23.3.0/.github/workflows/changelog.yml`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/.github/workflows/diff_shades.yml` & `tan-23.3.0/.github/workflows/diff_shades.yml`

 * *Files 7% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 name: diff-shades
 
 on:
   push:
     branches: [main]
-    paths: ["src/**", "setup.*", "pyproject.toml", ".github/workflows/*"]
+    paths: ["src/**", "pyproject.toml", ".github/workflows/*"]
 
   pull_request:
-    paths: ["src/**", "setup.*", "pyproject.toml", ".github/workflows/*"]
+    paths: ["src/**", "pyproject.toml", ".github/workflows/*"]
 
 concurrency:
   group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.run_id }}
   cancel-in-progress: true
 
 jobs:
   configure:
@@ -37,14 +37,15 @@
           python scripts/diff_shades_gha_helper.py config ${{ github.event_name }} ${{ matrix.mode }}
 
   analysis:
     name: analysis / ${{ matrix.mode }}
     needs: configure
     runs-on: ubuntu-latest
     env:
+      HATCH_BUILD_HOOKS_ENABLE: "1"
       # Clang is less picky with the C code it's given than gcc (and may
       # generate faster binaries too).
       CC: clang-12
     strategy:
       fail-fast: false
       matrix:
         include: ${{ fromJson(needs.configure.outputs.matrix )}}
@@ -60,15 +61,14 @@
         with:
           python-version: "*"
 
       - name: Install diff-shades and support dependencies
         run: |
           python -m pip install https://github.com/ichard26/diff-shades/archive/stable.zip
           python -m pip install click packaging urllib3
-          python -m pip install -r .github/mypyc-requirements.txt
           # After checking out old revisions, this might not exist so we'll use a copy.
           cat scripts/diff_shades_gha_helper.py > helper.py
           git config user.name "diff-shades-gha"
           git config user.email "diff-shades-gha@example.com"
 
       - name: Attempt to use cached baseline analysis
         id: baseline-cache
@@ -79,30 +79,28 @@
 
       - name: Build and install baseline revision
         if: steps.baseline-cache.outputs.cache-hit != 'true'
         env:
           GITHUB_TOKEN: ${{ github.token }}
         run: >
           ${{ matrix.baseline-setup-cmd }}
-          && python setup.py --use-mypyc bdist_wheel
-          && python -m pip install dist/*.whl && rm build dist -r
+          && python -m pip install .
 
       - name: Analyze baseline revision
         if: steps.baseline-cache.outputs.cache-hit != 'true'
         run: >
           diff-shades analyze -v --work-dir projects-cache/
           ${{ matrix.baseline-analysis }} ${{ matrix.force-flag }}
 
       - name: Build and install target revision
         env:
           GITHUB_TOKEN: ${{ github.token }}
         run: >
           ${{ matrix.target-setup-cmd }}
-          && python setup.py --use-mypyc bdist_wheel
-          && python -m pip install dist/*.whl
+          && python -m pip install .
 
       - name: Analyze target revision
         run: >
           diff-shades analyze -v --work-dir projects-cache/
           ${{ matrix.target-analysis }} --repeat-projects-from
           ${{ matrix.baseline-analysis }} ${{ matrix.force-flag }}
```

### Comparing `tan-22.8.0/.github/workflows/diff_shades_comment.yml` & `tan-23.3.0/.github/workflows/diff_shades_comment.yml`

 * *Files 4% similar despite different names*

```diff
@@ -29,21 +29,21 @@
         run: >
           python scripts/diff_shades_gha_helper.py comment-details
           ${{github.event.workflow_run.id }}
 
       - name: Try to find pre-existing PR comment
         if: steps.metadata.outputs.needs-comment == 'true'
         id: find-comment
-        uses: peter-evans/find-comment@1769778a0c5bd330272d749d12c036d65e70d39d
+        uses: peter-evans/find-comment@034abe94d3191f9c89d870519735beae326f2bdb
         with:
           issue-number: ${{ steps.metadata.outputs.pr-number }}
           comment-author: "github-actions[bot]"
           body-includes: "diff-shades"
 
       - name: Create or update PR comment
         if: steps.metadata.outputs.needs-comment == 'true'
-        uses: peter-evans/create-or-update-comment@c9fcb64660bc90ec1cc535646af190c992007c32
+        uses: peter-evans/create-or-update-comment@67dcc547d311b736a8e6c5c236542148a47adc3d
         with:
           comment-id: ${{ steps.find-comment.outputs.comment-id }}
           issue-number: ${{ steps.metadata.outputs.pr-number }}
           body: ${{ steps.metadata.outputs.comment-body }}
           edit-mode: replace
```

### Comparing `tan-22.8.0/.github/workflows/doc.yml` & `tan-23.3.0/.github/workflows/doc.yml`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/.github/workflows/docker.yml` & `tan-23.3.0/.github/workflows/docker.yml`

 * *Files 9% similar despite different names*

```diff
@@ -32,25 +32,38 @@
 
       - name: Check + set version tag
         run:
           echo "GIT_TAG=$(git describe --candidates=0 --tags 2> /dev/null || echo
           latest_non_release)" >> $GITHUB_ENV
 
       - name: Build and push
-        uses: docker/build-push-action@v3
+        uses: docker/build-push-action@v4
         with:
           context: .
           platforms: linux/amd64,linux/arm64
           push: true
           tags: pyfound/black:latest,pyfound/black:${{ env.GIT_TAG }}
 
       - name: Build and push latest_release tag
-        if: ${{ github.event_name == 'release' && github.event.action == 'published' }}
-        uses: docker/build-push-action@v3
+        if:
+          ${{ github.event_name == 'release' && github.event.action == 'published' &&
+          !github.event.release.prerelease }}
+        uses: docker/build-push-action@v4
         with:
           context: .
           platforms: linux/amd64,linux/arm64
           push: true
           tags: pyfound/black:latest_release
 
+      - name: Build and push latest_prerelease tag
+        if:
+          ${{ github.event_name == 'release' && github.event.action == 'published' &&
+          github.event.release.prerelease }}
+        uses: docker/build-push-action@v4
+        with:
+          context: .
+          platforms: linux/amd64,linux/arm64
+          push: true
+          tags: pyfound/black:latest_prerelease
+
       - name: Image digest
         run: echo ${{ steps.docker_build.outputs.digest }}
```

### Comparing `tan-22.8.0/.github/workflows/fuzz.yml` & `tan-23.3.0/.github/workflows/fuzz.yml`

 * *Files 12% similar despite different names*

```diff
@@ -18,15 +18,15 @@
       github.event_name == 'push' || github.event.pull_request.head.repo.full_name !=
       github.repository
 
     runs-on: ubuntu-latest
     strategy:
       fail-fast: false
       matrix:
-        python-version: ["3.6", "3.7", "3.8", "3.9", "3.10"]
+        python-version: ["3.7", "3.8", "3.9", "3.10", "3.11"]
 
     steps:
       - uses: actions/checkout@v3
 
       - name: Set up Python ${{ matrix.python-version }}
         uses: actions/setup-python@v4
         with:
```

### Comparing `tan-22.8.0/.github/workflows/lint.yml` & `tan-23.3.0/.github/workflows/lint.yml`

 * *Files 21% similar despite different names*

```diff
@@ -12,14 +12,21 @@
       github.repository
 
     runs-on: ubuntu-latest
 
     steps:
       - uses: actions/checkout@v3
 
+      - name: Assert PR target is main
+        if: github.event_name == 'pull_request' && github.repository == 'psf/black'
+        run: |
+          if [ "$GITHUB_BASE_REF" != "main" ]; then
+              echo "::error::PR targeting '$GITHUB_BASE_REF', please refile targeting 'main'." && exit 1
+          fi
+
       - name: Set up latest Python
         uses: actions/setup-python@v4
         with:
           python-version: "*"
 
       - name: Install dependencies
         run: |
```

### Comparing `tan-22.8.0/.github/workflows/pypi_upload.yml` & `tan-23.3.0/.github/workflows/pypi_upload.yml`

 * *Files 11% similar despite different names*

```diff
@@ -54,22 +54,20 @@
             name: macos-universal2
             macos_arch: "universal2"
 
     steps:
       - uses: actions/checkout@v3
 
       - name: Build wheels via cibuildwheel
-        uses: pypa/cibuildwheel@v2.8.1
+        uses: pypa/cibuildwheel@v2.12.1
         env:
           CIBW_ARCHS_MACOS: "${{ matrix.macos_arch }}"
-          # This isn't supported in pyproject.toml which makes sense (but is annoying).
-          CIBW_PROJECT_REQUIRES_PYTHON: ">=3.6.2"
 
       - name: Upload wheels as workflow artifacts
-        uses: actions/upload-artifact@v2
+        uses: actions/upload-artifact@v3
         with:
           name: ${{ matrix.name }}-mypyc-wheels
           path: ./wheelhouse/*.whl
 
       - name: Upload wheels to PyPI via Twine
         env:
           TWINE_PASSWORD: ${{ secrets.PYPI_TOKEN }}
```

### Comparing `tan-22.8.0/.github/workflows/test.yml` & `tan-23.3.0/.github/workflows/test.yml`

 * *Files 0% similar despite different names*

```diff
@@ -27,15 +27,15 @@
       github.event_name == 'push' || github.event.pull_request.head.repo.full_name !=
       github.repository
 
     runs-on: ${{ matrix.os }}
     strategy:
       fail-fast: false
       matrix:
-        python-version: ["3.6", "3.7", "3.8", "3.9", "3.10", "pypy-3.7", "pypy-3.8"]
+        python-version: ["3.7", "3.8", "3.9", "3.10", "3.11", "pypy-3.7", "pypy-3.8"]
         os: [ubuntu-latest, macOS-latest, windows-latest]
 
     steps:
       - uses: actions/checkout@v3
 
       - name: Set up Python ${{ matrix.python-version }}
         uses: actions/setup-python@v4
```

### Comparing `tan-22.8.0/.github/workflows/upload_binary.yml` & `tan-23.3.0/.github/workflows/upload_binary.yml`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/.pre-commit-config.yaml` & `tan-23.3.0/.pre-commit-config.yaml`

 * *Files 3% similar despite different names*

```diff
@@ -20,38 +20,39 @@
         name: Check black version in the basics example
         language: python
         entry: python -m scripts.check_version_in_basics_example
         files: '(CHANGES\.md|the_basics\.md)$'
         additional_dependencies: *version_check_dependencies
 
   - repo: https://github.com/pycqa/isort
-    rev: 5.10.1
+    rev: 5.12.0
     hooks:
       - id: isort
 
   - repo: https://github.com/pycqa/flake8
     rev: 4.0.1
     hooks:
       - id: flake8
         additional_dependencies:
           - flake8-bugbear
           - flake8-comprehensions
           - flake8-simplify
 
   - repo: https://github.com/pre-commit/mirrors-mypy
-    rev: v0.971
+    rev: v0.991
     hooks:
       - id: mypy
         exclude: ^docs/conf.py
         additional_dependencies:
           - types-dataclasses >= 0.1.3
           - types-PyYAML
           - tomli >= 0.2.6, < 2.0.0
           - types-typed-ast >= 1.4.1
           - click >= 8.1.0
+          - packaging >= 22.0
           - platformdirs >= 2.1.0
           - pytest
           - hypothesis
 
   - repo: https://github.com/pre-commit/mirrors-prettier
     rev: v2.7.1
     hooks:
```

### Comparing `tan-22.8.0/.pre-commit-hooks.yaml` & `tan-23.3.0/.pre-commit-hooks.yaml`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/AUTHORS.md` & `tan-23.3.0/AUTHORS.md`

 * *Files 2% similar despite different names*

```diff
@@ -6,33 +6,35 @@
 
 - [Carol Willing](mailto:carolcode@willingconsulting.com)
 - [Carl Meyer](mailto:carl@oddbird.net)
 - [Jelle Zijlstra](mailto:jelle.zijlstra@gmail.com)
 - [Mika Naylor](mailto:mail@autophagy.io)
 - [Zsolt Dollenstein](mailto:zsol.zsol@gmail.com)
 - [Cooper Lees](mailto:me@cooperlees.com)
-- Richard Si
+- [Richard Si](mailto:sichard26@gmail.com)
 - [Felix Hildén](mailto:felix.hilden@gmail.com)
 - [Batuhan Taskaya](mailto:batuhan@python.org)
 
 Multiple contributions by:
 
 - [Abdur-Rahmaan Janhangeer](mailto:arj.python@gmail.com)
 - [Adam Johnson](mailto:me@adamj.eu)
 - [Adam Williamson](mailto:adamw@happyassassin.net)
 - [Alexander Huynh](mailto:ahrex-gh-psf-black@e.sc)
 - [Alexandr Artemyev](mailto:mogost@gmail.com)
 - [Alex Vandiver](mailto:github@chmrr.net)
 - [Allan Simon](mailto:allan.simon@supinfo.com)
 - Anders-Petter Ljungquist
+- [Amethyst Reese](mailto:amy@n7.gg)
 - [Andrew Thorp](mailto:andrew.thorp.dev@gmail.com)
 - [Andrew Zhou](mailto:andrewfzhou@gmail.com)
 - [Andrey](mailto:dyuuus@yandex.ru)
 - [Andy Freeland](mailto:andy@andyfreeland.net)
 - [Anthony Sottile](mailto:asottile@umich.edu)
+- [Antonio Ossa Guerra](mailto:aaossa+black@uc.cl)
 - [Arjaan Buijk](mailto:arjaan.buijk@gmail.com)
 - [Arnav Borbornah](mailto:arnavborborah11@gmail.com)
 - [Artem Malyshev](mailto:proofit404@gmail.com)
 - [Asger Hautop Drewsen](mailto:asgerdrewsen@gmail.com)
 - [Augie Fackler](mailto:raf@durin42.com)
 - [Aviskar KC](mailto:aviskarkc10@gmail.com)
 - Batuhan Taşkaya
```

### Comparing `tan-22.8.0/CHANGES.md` & `tan-23.3.0/CHANGES.md`

 * *Files 11% similar despite different names*

```diff
@@ -43,14 +43,280 @@
 <!-- For example, Docker, GitHub Actions, pre-commit, editors -->
 
 ### Documentation
 
 <!-- Major changes to documentation and policies. Small docs changes
      don't need a changelog entry. -->
 
+## 23.3.0
+
+### Highlights
+
+This release fixes a longstanding confusing behavior in Black's GitHub action, where the
+version of the action did not determine the version of Black being run (issue #3382). In
+addition, there is a small bug fix around imports and a number of improvements to the
+preview style.
+
+Please try out the
+[preview style](https://black.readthedocs.io/en/stable/the_black_code_style/future_style.html#preview-style)
+with `black --preview` and tell us your feedback. All changes in the preview style are
+expected to become part of Black's stable style in January 2024.
+
+### Stable style
+
+- Import lines with `# fmt: skip` and `# fmt: off` no longer have an extra blank line
+  added when they are right after another import line (#3610)
+
+### Preview style
+
+- Add trailing commas to collection literals even if there's a comment after the last
+  entry (#3393)
+- `async def`, `async for`, and `async with` statements are now formatted consistently
+  compared to their non-async version. (#3609)
+- `with` statements that contain two context managers will be consistently wrapped in
+  parentheses (#3589)
+- Let string splitters respect [East Asian Width](https://www.unicode.org/reports/tr11/)
+  (#3445)
+- Now long string literals can be split after East Asian commas and periods (`、` U+3001
+  IDEOGRAPHIC COMMA, `。` U+3002 IDEOGRAPHIC FULL STOP, & `，` U+FF0C FULLWIDTH COMMA)
+  besides before spaces (#3445)
+- For stubs, enforce one blank line after a nested class with a body other than just
+  `...` (#3564)
+- Improve handling of multiline strings by changing line split behavior (#1879)
+
+### Parser
+
+- Added support for formatting files with invalid type comments (#3594)
+
+### Integrations
+
+- Update GitHub Action to use the version of Black equivalent to action's version if
+  version input is not specified (#3543)
+- Fix missing Python binary path in autoload script for vim (#3508)
+
+### Documentation
+
+- Document that only the most recent release is supported for security issues;
+  vulnerabilities should be reported through Tidelift (#3612)
+
+## 23.1.0
+
+### Highlights
+
+This is the first release of 2023, and following our
+[stability policy](https://black.readthedocs.io/en/stable/the_black_code_style/index.html#stability-policy),
+it comes with a number of improvements to our stable style, including improvements to
+empty line handling, removal of redundant parentheses in several contexts, and output
+that highlights implicitly concatenated strings better.
+
+There are also many changes to the preview style; try out `black --preview` and give us
+feedback to help us set the stable style for next year.
+
+In addition to style changes, Black now automatically infers the supported Python
+versions from your `pyproject.toml` file, removing the need to set Black's target
+versions separately.
+
+### Stable style
+
+<!-- Changes that affect Black's stable style -->
+
+- Introduce the 2023 stable style, which incorporates most aspects of last year's
+  preview style (#3418). Specific changes:
+  - Enforce empty lines before classes and functions with sticky leading comments
+    (#3302) (22.12.0)
+  - Reformat empty and whitespace-only files as either an empty file (if no newline is
+    present) or as a single newline character (if a newline is present) (#3348)
+    (22.12.0)
+  - Implicitly concatenated strings used as function args are now wrapped inside
+    parentheses (#3307) (22.12.0)
+  - Correctly handle trailing commas that are inside a line's leading non-nested parens
+    (#3370) (22.12.0)
+  - `--skip-string-normalization` / `-S` now prevents docstring prefixes from being
+    normalized as expected (#3168) (since 22.8.0)
+  - When using `--skip-magic-trailing-comma` or `-C`, trailing commas are stripped from
+    subscript expressions with more than 1 element (#3209) (22.8.0)
+  - Implicitly concatenated strings inside a list, set, or tuple are now wrapped inside
+    parentheses (#3162) (22.8.0)
+  - Fix a string merging/split issue when a comment is present in the middle of
+    implicitly concatenated strings on its own line (#3227) (22.8.0)
+  - Docstring quotes are no longer moved if it would violate the line length limit
+    (#3044, #3430) (22.6.0)
+  - Parentheses around return annotations are now managed (#2990) (22.6.0)
+  - Remove unnecessary parentheses around awaited objects (#2991) (22.6.0)
+  - Remove unnecessary parentheses in `with` statements (#2926) (22.6.0)
+  - Remove trailing newlines after code block open (#3035) (22.6.0)
+  - Code cell separators `#%%` are now standardised to `# %%` (#2919) (22.3.0)
+  - Remove unnecessary parentheses from `except` statements (#2939) (22.3.0)
+  - Remove unnecessary parentheses from tuple unpacking in `for` loops (#2945) (22.3.0)
+  - Avoid magic-trailing-comma in single-element subscripts (#2942) (22.3.0)
+- Fix a crash when a colon line is marked between `# fmt: off` and `# fmt: on` (#3439)
+
+### Preview style
+
+<!-- Changes that affect Black's preview style -->
+
+- Format hex codes in unicode escape sequences in string literals (#2916)
+- Add parentheses around `if`-`else` expressions (#2278)
+- Improve performance on large expressions that contain many strings (#3467)
+- Fix a crash in preview style with assert + parenthesized string (#3415)
+- Fix crashes in preview style with walrus operators used in function return annotations
+  and except clauses (#3423)
+- Fix a crash in preview advanced string processing where mixed implicitly concatenated
+  regular and f-strings start with an empty span (#3463)
+- Fix a crash in preview advanced string processing where a standalone comment is placed
+  before a dict's value (#3469)
+- Fix an issue where extra empty lines are added when a decorator has `# fmt: skip`
+  applied or there is a standalone comment between decorators (#3470)
+- Do not put the closing quotes in a docstring on a separate line, even if the line is
+  too long (#3430)
+- Long values in dict literals are now wrapped in parentheses; correspondingly
+  unnecessary parentheses around short values in dict literals are now removed; long
+  string lambda values are now wrapped in parentheses (#3440)
+- Fix two crashes in preview style involving edge cases with docstrings (#3451)
+- Exclude string type annotations from improved string processing; fix crash when the
+  return type annotation is stringified and spans across multiple lines (#3462)
+- Wrap multiple context managers in parentheses when targeting Python 3.9+ (#3489)
+- Fix several crashes in preview style with walrus operators used in `with` statements
+  or tuples (#3473)
+- Fix an invalid quote escaping bug in f-string expressions where it produced invalid
+  code. Implicitly concatenated f-strings with different quotes can now be merged or
+  quote-normalized by changing the quotes used in expressions. (#3509)
+- Fix crash on `await (yield)` when Black is compiled with mypyc (#3533)
+
+### Configuration
+
+<!-- Changes to how Black can be configured -->
+
+- Black now tries to infer its `--target-version` from the project metadata specified in
+  `pyproject.toml` (#3219)
+
+### Packaging
+
+<!-- Changes to how Black is packaged, such as dependency requirements -->
+
+- Upgrade mypyc from `0.971` to `0.991` so mypycified _Black_ can be built on armv7
+  (#3380)
+  - This also fixes some crashes while using compiled Black with a debug build of
+    CPython
+- Drop specific support for the `tomli` requirement on 3.11 alpha releases, working
+  around a bug that would cause the requirement not to be installed on any non-final
+  Python releases (#3448)
+- Black now depends on `packaging` version `22.0` or later. This is required for new
+  functionality that needs to parse part of the project metadata (#3219)
+
+### Output
+
+<!-- Changes to Black's terminal output and error messages -->
+
+- Calling `black --help` multiple times will return the same help contents each time
+  (#3516)
+- Verbose logging now shows the values of `pyproject.toml` configuration variables
+  (#3392)
+- Fix false symlink detection messages in verbose output due to using an incorrect
+  relative path to the project root (#3385)
+
+### Integrations
+
+<!-- For example, Docker, GitHub Actions, pre-commit, editors -->
+
+- Move 3.11 CI to normal flow now that all dependencies support 3.11 (#3446)
+- Docker: Add new `latest_prerelease` tag automation to follow latest black alpha
+  release on docker images (#3465)
+
+### Documentation
+
+<!-- Major changes to documentation and policies. Small docs changes
+     don't need a changelog entry. -->
+
+- Expand `vim-plug` installation instructions to offer more explicit options (#3468)
+
+## 22.12.0
+
+### Preview style
+
+<!-- Changes that affect Black's preview style -->
+
+- Enforce empty lines before classes and functions with sticky leading comments (#3302)
+- Reformat empty and whitespace-only files as either an empty file (if no newline is
+  present) or as a single newline character (if a newline is present) (#3348)
+- Implicitly concatenated strings used as function args are now wrapped inside
+  parentheses (#3307)
+- For assignment statements, prefer splitting the right hand side if the left hand side
+  fits on a single line (#3368)
+- Correctly handle trailing commas that are inside a line's leading non-nested parens
+  (#3370)
+
+### Configuration
+
+<!-- Changes to how Black can be configured -->
+
+- Fix incorrectly applied `.gitignore` rules by considering the `.gitignore` location
+  and the relative path to the target file (#3338)
+- Fix incorrectly ignoring `.gitignore` presence when more than one source directory is
+  specified (#3336)
+
+### Parser
+
+<!-- Changes to the parser or to version autodetection -->
+
+- Parsing support has been added for walruses inside generator expression that are
+  passed as function args (for example,
+  `any(match := my_re.match(text) for text in texts)`) (#3327).
+
+### Integrations
+
+<!-- For example, Docker, GitHub Actions, pre-commit, editors -->
+
+- Vim plugin: Optionally allow using the system installation of Black via
+  `let g:black_use_virtualenv = 0`(#3309)
+
+## 22.10.0
+
+### Highlights
+
+- Runtime support for Python 3.6 has been removed. Formatting 3.6 code will still be
+  supported until further notice.
+
+### Stable style
+
+- Fix a crash when `# fmt: on` is used on a different block level than `# fmt: off`
+  (#3281)
+
+### Preview style
+
+- Fix a crash when formatting some dicts with parenthesis-wrapped long string keys
+  (#3262)
+
+### Configuration
+
+- `.ipynb_checkpoints` directories are now excluded by default (#3293)
+- Add `--skip-source-first-line` / `-x` option to ignore the first line of source code
+  while formatting (#3299)
+
+### Packaging
+
+- Executables made with PyInstaller will no longer crash when formatting several files
+  at once on macOS. Native x86-64 executables for macOS are available once again.
+  (#3275)
+- Hatchling is now used as the build backend. This will not have any effect for users
+  who install Black with its wheels from PyPI. (#3233)
+- Faster compiled wheels are now available for CPython 3.11 (#3276)
+
+### _Blackd_
+
+- Windows style (CRLF) newlines will be preserved (#3257).
+
+### Integrations
+
+- Vim plugin: add flag (`g:black_preview`) to enable/disable the preview style (#3246)
+- Update GitHub Action to support formatting of Jupyter Notebook files via a `jupyter`
+  option (#3282)
+- Update GitHub Action to support use of version specifiers (e.g. `<23`) for Black
+  version (#3265)
+
 ## 22.8.0
 
 ### Highlights
 
 - Python 3.11 is now supported, except for _blackd_ as aiohttp does not support 3.11 as
   of publishing (#3234)
 - This is the last release that supports running _Black_ on Python 3.6 (formatting 3.6
```

### Comparing `tan-22.8.0/Dockerfile` & `tan-23.3.0/Dockerfile`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/LICENSE` & `tan-23.3.0/LICENSE`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/PKG-INFO` & `tan-23.3.0/PKG-INFO`

 * *Files 14% similar despite different names*

```diff
@@ -1,42 +1,53 @@
 Metadata-Version: 2.1
 Name: tan
-Version: 22.8.0
+Version: 23.3.0
 Summary: The compromising code formatter.
-Home-page: https://github.com/jleclanche/tan
-Author: Łukasz Langa
-Author-email: lukasz@langa.pl
+Project-URL: Changelog, https://github.com/jleclanche/tan/blob/main/CHANGES.md
+Project-URL: Homepage, https://github.com/jleclanche/tan
+Author-email: Łukasz Langa <lukasz@langa.pl>
 License: MIT
-Project-URL: Changelog, https://github.com/psf/black/blob/main/CHANGES.md
-Keywords: automation formatter yapf autopep8 pyfmt gofmt rustfmt
+License-File: AUTHORS.md
+License-File: LICENSE
+Keywords: automation,autopep8,formatter,gofmt,pyfmt,rustfmt,yapf
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: OS Independent
 Classifier: Programming Language :: Python
-Classifier: Programming Language :: Python :: 3.6
+Classifier: Programming Language :: Python :: 3 :: Only
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
-Classifier: Programming Language :: Python :: 3 :: Only
 Classifier: Topic :: Software Development :: Libraries :: Python Modules
 Classifier: Topic :: Software Development :: Quality Assurance
-Requires-Python: >=3.6.2
-Description-Content-Type: text/markdown
-Provides-Extra: d
+Requires-Python: >=3.7
+Requires-Dist: click>=8.0.0
+Requires-Dist: mypy-extensions>=0.4.3
+Requires-Dist: packaging>=22.0
+Requires-Dist: pathspec>=0.9.0
+Requires-Dist: platformdirs>=2
+Requires-Dist: tomli>=1.1.0; python_version < '3.11'
+Requires-Dist: typed-ast>=1.4.2; python_version < '3.8' and implementation_name == 'cpython'
+Requires-Dist: typing-extensions>=3.10.0.0; python_version < '3.10'
 Provides-Extra: colorama
-Provides-Extra: uvloop
+Requires-Dist: colorama>=0.4.3; extra == 'colorama'
+Provides-Extra: d
+Requires-Dist: aiohttp>=3.7.4; extra == 'd'
 Provides-Extra: jupyter
-License-File: LICENSE
-License-File: AUTHORS.md
+Requires-Dist: ipython>=7.8.0; extra == 'jupyter'
+Requires-Dist: tokenize-rt>=3.2.0; extra == 'jupyter'
+Provides-Extra: uvloop
+Requires-Dist: uvloop>=0.15.2; extra == 'uvloop'
+Description-Content-Type: text/markdown
 
-![Black Logo](https://raw.githubusercontent.com/psf/black/main/docs/_static/logo2-readme.png)
+[![Black Logo](https://raw.githubusercontent.com/psf/black/main/docs/_static/logo2-readme.png)](https://black.readthedocs.io/en/stable/)
 
 <h2 align="center">The Uncompromising Code Formatter</h2>
 
 <p align="center">
 <a href="https://github.com/psf/black/actions"><img alt="Actions Status" src="https://github.com/psf/black/workflows/Test/badge.svg"></a>
 <a href="https://black.readthedocs.io/en/stable/?badge=stable"><img alt="Documentation Status" src="https://readthedocs.org/projects/black/badge/?version=stable"></a>
 <a href="https://coveralls.io/github/psf/black?branch=main"><img alt="Coverage Status" src="https://coveralls.io/repos/github/psf/black/badge.svg?branch=main"></a>
@@ -68,17 +79,16 @@
 
 ---
 
 ## Installation and usage
 
 ### Installation
 
-_Black_ can be installed by running `pip install black`. It requires Python 3.6.2+ to
-run. If you want to format Jupyter Notebooks, install with
-`pip install 'black[jupyter]'`.
+_Black_ can be installed by running `pip install black`. It requires Python 3.7+ to run.
+If you want to format Jupyter Notebooks, install with `pip install "black[jupyter]"`.
 
 If you can't wait for the latest _hotness_ and want to install from GitHub, use:
 
 `pip install git+https://github.com/psf/black`
 
 ### Usage
 
@@ -97,15 +107,15 @@
 Further information can be found in our docs:
 
 - [Usage and Configuration](https://black.readthedocs.io/en/stable/usage_and_configuration/index.html)
 
 _Black_ is already [successfully used](https://github.com/psf/black#used-by) by many
 projects, small and big. _Black_ has a comprehensive test suite, with efficient parallel
 tests, and our own auto formatting and parallel Continuous Integration runner. Now that
-we have become stable, you should not expect large formatting to changes in the future.
+we have become stable, you should not expect large formatting changes in the future.
 Stylistic changes will mostly be responses to bug reports and support for new Python
 syntax. For more information please refer to the
 [The Black Code Style](https://black.readthedocs.io/en/stable/the_black_code_style/index.html).
 
 Also, as a safety measure which slows down processing, _Black_ will check that the
 reformatted code still produces a valid AST that is effectively equivalent to the
 original (see the
@@ -169,15 +179,15 @@
 The following notable open-source projects trust _Black_ with enforcing a consistent
 code style: pytest, tox, Pyramid, Django, Django Channels, Hypothesis, attrs,
 SQLAlchemy, Poetry, PyPA applications (Warehouse, Bandersnatch, Pipenv, virtualenv),
 pandas, Pillow, Twisted, LocalStack, every Datadog Agent Integration, Home Assistant,
 Zulip, Kedro, OpenOA, FLORIS, ORBIT, WOMBAT, and many more.
 
 The following organizations use _Black_: Facebook, Dropbox, KeepTruckin, Mozilla, Quora,
-Duolingo, QuantumBlack, Tesla.
+Duolingo, QuantumBlack, Tesla, Archer Aviation.
 
 Are we missing anyone? Let us know.
 
 ## Testimonials
 
 **Mike Bayer**, [author of `SQLAlchemy`](https://www.sqlalchemy.org/):
 
@@ -259,16 +269,14 @@
 and more generally to follow the guidelines articulated in the
 [Python Community Code of Conduct](https://www.python.org/psf/codeofconduct/).
 
 At the same time, humor is encouraged. In fact, basic familiarity with Monty Python's
 Flying Circus is expected. We are not savages.
 
 And if you _really_ need to slap somebody, do it with a fish while dancing.
-
-
 # Change Log
 
 ## Unreleased
 
 ### Highlights
 
 <!-- Include any especially major or disruptive changes here -->
@@ -310,14 +318,280 @@
 <!-- For example, Docker, GitHub Actions, pre-commit, editors -->
 
 ### Documentation
 
 <!-- Major changes to documentation and policies. Small docs changes
      don't need a changelog entry. -->
 
+## 23.3.0
+
+### Highlights
+
+This release fixes a longstanding confusing behavior in Black's GitHub action, where the
+version of the action did not determine the version of Black being run (issue #3382). In
+addition, there is a small bug fix around imports and a number of improvements to the
+preview style.
+
+Please try out the
+[preview style](https://black.readthedocs.io/en/stable/the_black_code_style/future_style.html#preview-style)
+with `black --preview` and tell us your feedback. All changes in the preview style are
+expected to become part of Black's stable style in January 2024.
+
+### Stable style
+
+- Import lines with `# fmt: skip` and `# fmt: off` no longer have an extra blank line
+  added when they are right after another import line (#3610)
+
+### Preview style
+
+- Add trailing commas to collection literals even if there's a comment after the last
+  entry (#3393)
+- `async def`, `async for`, and `async with` statements are now formatted consistently
+  compared to their non-async version. (#3609)
+- `with` statements that contain two context managers will be consistently wrapped in
+  parentheses (#3589)
+- Let string splitters respect [East Asian Width](https://www.unicode.org/reports/tr11/)
+  (#3445)
+- Now long string literals can be split after East Asian commas and periods (`、` U+3001
+  IDEOGRAPHIC COMMA, `。` U+3002 IDEOGRAPHIC FULL STOP, & `，` U+FF0C FULLWIDTH COMMA)
+  besides before spaces (#3445)
+- For stubs, enforce one blank line after a nested class with a body other than just
+  `...` (#3564)
+- Improve handling of multiline strings by changing line split behavior (#1879)
+
+### Parser
+
+- Added support for formatting files with invalid type comments (#3594)
+
+### Integrations
+
+- Update GitHub Action to use the version of Black equivalent to action's version if
+  version input is not specified (#3543)
+- Fix missing Python binary path in autoload script for vim (#3508)
+
+### Documentation
+
+- Document that only the most recent release is supported for security issues;
+  vulnerabilities should be reported through Tidelift (#3612)
+
+## 23.1.0
+
+### Highlights
+
+This is the first release of 2023, and following our
+[stability policy](https://black.readthedocs.io/en/stable/the_black_code_style/index.html#stability-policy),
+it comes with a number of improvements to our stable style, including improvements to
+empty line handling, removal of redundant parentheses in several contexts, and output
+that highlights implicitly concatenated strings better.
+
+There are also many changes to the preview style; try out `black --preview` and give us
+feedback to help us set the stable style for next year.
+
+In addition to style changes, Black now automatically infers the supported Python
+versions from your `pyproject.toml` file, removing the need to set Black's target
+versions separately.
+
+### Stable style
+
+<!-- Changes that affect Black's stable style -->
+
+- Introduce the 2023 stable style, which incorporates most aspects of last year's
+  preview style (#3418). Specific changes:
+  - Enforce empty lines before classes and functions with sticky leading comments
+    (#3302) (22.12.0)
+  - Reformat empty and whitespace-only files as either an empty file (if no newline is
+    present) or as a single newline character (if a newline is present) (#3348)
+    (22.12.0)
+  - Implicitly concatenated strings used as function args are now wrapped inside
+    parentheses (#3307) (22.12.0)
+  - Correctly handle trailing commas that are inside a line's leading non-nested parens
+    (#3370) (22.12.0)
+  - `--skip-string-normalization` / `-S` now prevents docstring prefixes from being
+    normalized as expected (#3168) (since 22.8.0)
+  - When using `--skip-magic-trailing-comma` or `-C`, trailing commas are stripped from
+    subscript expressions with more than 1 element (#3209) (22.8.0)
+  - Implicitly concatenated strings inside a list, set, or tuple are now wrapped inside
+    parentheses (#3162) (22.8.0)
+  - Fix a string merging/split issue when a comment is present in the middle of
+    implicitly concatenated strings on its own line (#3227) (22.8.0)
+  - Docstring quotes are no longer moved if it would violate the line length limit
+    (#3044, #3430) (22.6.0)
+  - Parentheses around return annotations are now managed (#2990) (22.6.0)
+  - Remove unnecessary parentheses around awaited objects (#2991) (22.6.0)
+  - Remove unnecessary parentheses in `with` statements (#2926) (22.6.0)
+  - Remove trailing newlines after code block open (#3035) (22.6.0)
+  - Code cell separators `#%%` are now standardised to `# %%` (#2919) (22.3.0)
+  - Remove unnecessary parentheses from `except` statements (#2939) (22.3.0)
+  - Remove unnecessary parentheses from tuple unpacking in `for` loops (#2945) (22.3.0)
+  - Avoid magic-trailing-comma in single-element subscripts (#2942) (22.3.0)
+- Fix a crash when a colon line is marked between `# fmt: off` and `# fmt: on` (#3439)
+
+### Preview style
+
+<!-- Changes that affect Black's preview style -->
+
+- Format hex codes in unicode escape sequences in string literals (#2916)
+- Add parentheses around `if`-`else` expressions (#2278)
+- Improve performance on large expressions that contain many strings (#3467)
+- Fix a crash in preview style with assert + parenthesized string (#3415)
+- Fix crashes in preview style with walrus operators used in function return annotations
+  and except clauses (#3423)
+- Fix a crash in preview advanced string processing where mixed implicitly concatenated
+  regular and f-strings start with an empty span (#3463)
+- Fix a crash in preview advanced string processing where a standalone comment is placed
+  before a dict's value (#3469)
+- Fix an issue where extra empty lines are added when a decorator has `# fmt: skip`
+  applied or there is a standalone comment between decorators (#3470)
+- Do not put the closing quotes in a docstring on a separate line, even if the line is
+  too long (#3430)
+- Long values in dict literals are now wrapped in parentheses; correspondingly
+  unnecessary parentheses around short values in dict literals are now removed; long
+  string lambda values are now wrapped in parentheses (#3440)
+- Fix two crashes in preview style involving edge cases with docstrings (#3451)
+- Exclude string type annotations from improved string processing; fix crash when the
+  return type annotation is stringified and spans across multiple lines (#3462)
+- Wrap multiple context managers in parentheses when targeting Python 3.9+ (#3489)
+- Fix several crashes in preview style with walrus operators used in `with` statements
+  or tuples (#3473)
+- Fix an invalid quote escaping bug in f-string expressions where it produced invalid
+  code. Implicitly concatenated f-strings with different quotes can now be merged or
+  quote-normalized by changing the quotes used in expressions. (#3509)
+- Fix crash on `await (yield)` when Black is compiled with mypyc (#3533)
+
+### Configuration
+
+<!-- Changes to how Black can be configured -->
+
+- Black now tries to infer its `--target-version` from the project metadata specified in
+  `pyproject.toml` (#3219)
+
+### Packaging
+
+<!-- Changes to how Black is packaged, such as dependency requirements -->
+
+- Upgrade mypyc from `0.971` to `0.991` so mypycified _Black_ can be built on armv7
+  (#3380)
+  - This also fixes some crashes while using compiled Black with a debug build of
+    CPython
+- Drop specific support for the `tomli` requirement on 3.11 alpha releases, working
+  around a bug that would cause the requirement not to be installed on any non-final
+  Python releases (#3448)
+- Black now depends on `packaging` version `22.0` or later. This is required for new
+  functionality that needs to parse part of the project metadata (#3219)
+
+### Output
+
+<!-- Changes to Black's terminal output and error messages -->
+
+- Calling `black --help` multiple times will return the same help contents each time
+  (#3516)
+- Verbose logging now shows the values of `pyproject.toml` configuration variables
+  (#3392)
+- Fix false symlink detection messages in verbose output due to using an incorrect
+  relative path to the project root (#3385)
+
+### Integrations
+
+<!-- For example, Docker, GitHub Actions, pre-commit, editors -->
+
+- Move 3.11 CI to normal flow now that all dependencies support 3.11 (#3446)
+- Docker: Add new `latest_prerelease` tag automation to follow latest black alpha
+  release on docker images (#3465)
+
+### Documentation
+
+<!-- Major changes to documentation and policies. Small docs changes
+     don't need a changelog entry. -->
+
+- Expand `vim-plug` installation instructions to offer more explicit options (#3468)
+
+## 22.12.0
+
+### Preview style
+
+<!-- Changes that affect Black's preview style -->
+
+- Enforce empty lines before classes and functions with sticky leading comments (#3302)
+- Reformat empty and whitespace-only files as either an empty file (if no newline is
+  present) or as a single newline character (if a newline is present) (#3348)
+- Implicitly concatenated strings used as function args are now wrapped inside
+  parentheses (#3307)
+- For assignment statements, prefer splitting the right hand side if the left hand side
+  fits on a single line (#3368)
+- Correctly handle trailing commas that are inside a line's leading non-nested parens
+  (#3370)
+
+### Configuration
+
+<!-- Changes to how Black can be configured -->
+
+- Fix incorrectly applied `.gitignore` rules by considering the `.gitignore` location
+  and the relative path to the target file (#3338)
+- Fix incorrectly ignoring `.gitignore` presence when more than one source directory is
+  specified (#3336)
+
+### Parser
+
+<!-- Changes to the parser or to version autodetection -->
+
+- Parsing support has been added for walruses inside generator expression that are
+  passed as function args (for example,
+  `any(match := my_re.match(text) for text in texts)`) (#3327).
+
+### Integrations
+
+<!-- For example, Docker, GitHub Actions, pre-commit, editors -->
+
+- Vim plugin: Optionally allow using the system installation of Black via
+  `let g:black_use_virtualenv = 0`(#3309)
+
+## 22.10.0
+
+### Highlights
+
+- Runtime support for Python 3.6 has been removed. Formatting 3.6 code will still be
+  supported until further notice.
+
+### Stable style
+
+- Fix a crash when `# fmt: on` is used on a different block level than `# fmt: off`
+  (#3281)
+
+### Preview style
+
+- Fix a crash when formatting some dicts with parenthesis-wrapped long string keys
+  (#3262)
+
+### Configuration
+
+- `.ipynb_checkpoints` directories are now excluded by default (#3293)
+- Add `--skip-source-first-line` / `-x` option to ignore the first line of source code
+  while formatting (#3299)
+
+### Packaging
+
+- Executables made with PyInstaller will no longer crash when formatting several files
+  at once on macOS. Native x86-64 executables for macOS are available once again.
+  (#3275)
+- Hatchling is now used as the build backend. This will not have any effect for users
+  who install Black with its wheels from PyPI. (#3233)
+- Faster compiled wheels are now available for CPython 3.11 (#3276)
+
+### _Blackd_
+
+- Windows style (CRLF) newlines will be preserved (#3257).
+
+### Integrations
+
+- Vim plugin: add flag (`g:black_preview`) to enable/disable the preview style (#3246)
+- Update GitHub Action to support formatting of Jupyter Notebook files via a `jupyter`
+  option (#3282)
+- Update GitHub Action to support use of version specifiers (e.g. `<23`) for Black
+  version (#3265)
+
 ## 22.8.0
 
 ### Highlights
 
 - Python 3.11 is now supported, except for _blackd_ as aiohttp does not support 3.11 as
   of publishing (#3234)
 - This is the last release that supports running _Black_ on Python 3.6 (formatting 3.6
```

#### html2text {}

```diff
@@ -1,26 +1,35 @@
-Metadata-Version: 2.1 Name: tan Version: 22.8.0 Summary: The compromising code
-formatter. Home-page: https://github.com/jleclanche/tan Author: Åukasz Langa
-Author-email: lukasz@langa.pl License: MIT Project-URL: Changelog, https://
-github.com/psf/black/blob/main/CHANGES.md Keywords: automation formatter yapf
-autopep8 pyfmt gofmt rustfmt Classifier: Development Status :: 5 - Production/
-Stable Classifier: Environment :: Console Classifier: Intended Audience ::
-Developers Classifier: License :: OSI Approved :: MIT License Classifier:
-Operating System :: OS Independent Classifier: Programming Language :: Python
-Classifier: Programming Language :: Python :: 3.6 Classifier: Programming
-Language :: Python :: 3.7 Classifier: Programming Language :: Python :: 3.8
-Classifier: Programming Language :: Python :: 3.9 Classifier: Programming
-Language :: Python :: 3.10 Classifier: Programming Language :: Python :: 3.11
-Classifier: Programming Language :: Python :: 3 :: Only Classifier: Topic ::
-Software Development :: Libraries :: Python Modules Classifier: Topic ::
-Software Development :: Quality Assurance Requires-Python: >=3.6.2 Description-
-Content-Type: text/markdown Provides-Extra: d Provides-Extra: colorama
-Provides-Extra: uvloop Provides-Extra: jupyter License-File: LICENSE License-
-File: AUTHORS.md ![Black Logo](https://raw.githubusercontent.com/psf/black/
-main/docs/_static/logo2-readme.png)
+Metadata-Version: 2.1 Name: tan Version: 23.3.0 Summary: The compromising code
+formatter. Project-URL: Changelog, https://github.com/jleclanche/tan/blob/main/
+CHANGES.md Project-URL: Homepage, https://github.com/jleclanche/tan Author-
+email: Åukasz Langa
+langa.pl> License: MIT License-File: AUTHORS.md License-File: LICENSE Keywords:
+automation,autopep8,formatter,gofmt,pyfmt,rustfmt,yapf Classifier: Development
+Status :: 5 - Production/Stable Classifier: Environment :: Console Classifier:
+Intended Audience :: Developers Classifier: License :: OSI Approved :: MIT
+License Classifier: Operating System :: OS Independent Classifier: Programming
+Language :: Python Classifier: Programming Language :: Python :: 3 :: Only
+Classifier: Programming Language :: Python :: 3.7 Classifier: Programming
+Language :: Python :: 3.8 Classifier: Programming Language :: Python :: 3.9
+Classifier: Programming Language :: Python :: 3.10 Classifier: Programming
+Language :: Python :: 3.11 Classifier: Topic :: Software Development ::
+Libraries :: Python Modules Classifier: Topic :: Software Development ::
+Quality Assurance Requires-Python: >=3.7 Requires-Dist: click>=8.0.0 Requires-
+Dist: mypy-extensions>=0.4.3 Requires-Dist: packaging>=22.0 Requires-Dist:
+pathspec>=0.9.0 Requires-Dist: platformdirs>=2 Requires-Dist: tomli>=1.1.0;
+python_version < '3.11' Requires-Dist: typed-ast>=1.4.2; python_version < '3.8'
+and implementation_name == 'cpython' Requires-Dist: typing-
+extensions>=3.10.0.0; python_version < '3.10' Provides-Extra: colorama
+Requires-Dist: colorama>=0.4.3; extra == 'colorama' Provides-Extra: d Requires-
+Dist: aiohttp>=3.7.4; extra == 'd' Provides-Extra: jupyter Requires-Dist:
+ipython>=7.8.0; extra == 'jupyter' Requires-Dist: tokenize-rt>=3.2.0; extra ==
+'jupyter' Provides-Extra: uvloop Requires-Dist: uvloop>=0.15.2; extra ==
+'uvloop' Description-Content-Type: text/markdown [![Black Logo](https://
+raw.githubusercontent.com/psf/black/main/docs/_static/logo2-readme.png)](https:
+//black.readthedocs.io/en/stable/)
                  ***** The Uncompromising Code Formatter *****
 [Actions_Status] [Documentation_Status] [Coverage_Status] [License:_MIT] [PyPI]
                  [Downloads] [conda-forge] [Code_style:_black]
 > âAny color you like.â _Black_ is the uncompromising Python code
 formatter. By using it, you agree to cede control over minutiae of hand-
 formatting. In return, _Black_ gives you speed, determinism, and freedom from
 `pycodestyle` nagging about formatting. You will save time and mental energy
@@ -28,28 +37,28 @@
 project you're reading. Formatting becomes transparent after a while and you
 can focus on the content instead. _Black_ makes code review faster by producing
 the smallest diffs possible. Try it out now using the [Black Playground](https:
 //black.vercel.app). Watch the [PyCon 2019 talk](https://youtu.be/esZLCuWs_2Y)
 to learn more. --- **[Read the documentation on ReadTheDocs!](https://
 black.readthedocs.io/en/stable)** --- ## Installation and usage ###
 Installation _Black_ can be installed by running `pip install black`. It
-requires Python 3.6.2+ to run. If you want to format Jupyter Notebooks, install
-with `pip install 'black[jupyter]'`. If you can't wait for the latest _hotness_
+requires Python 3.7+ to run. If you want to format Jupyter Notebooks, install
+with `pip install "black[jupyter]"`. If you can't wait for the latest _hotness_
 and want to install from GitHub, use: `pip install git+https://github.com/psf/
 black` ### Usage To get started right away with sensible defaults: ```sh black
 {source_file_or_directory} ``` You can run _Black_ as a package if running it
 as a script doesn't work: ```sh python -m black {source_file_or_directory} ```
 Further information can be found in our docs: - [Usage and Configuration]
 (https://black.readthedocs.io/en/stable/usage_and_configuration/index.html)
 _Black_ is already [successfully used](https://github.com/psf/black#used-by) by
 many projects, small and big. _Black_ has a comprehensive test suite, with
 efficient parallel tests, and our own auto formatting and parallel Continuous
 Integration runner. Now that we have become stable, you should not expect large
-formatting to changes in the future. Stylistic changes will mostly be responses
-to bug reports and support for new Python syntax. For more information please
+formatting changes in the future. Stylistic changes will mostly be responses to
+bug reports and support for new Python syntax. For more information please
 refer to the [The Black Code Style](https://black.readthedocs.io/en/stable/
 the_black_code_style/index.html). Also, as a safety measure which slows down
 processing, _Black_ will check that the reformatted code still produces a valid
 AST that is effectively equivalent to the original (see the [Pragmatism](https:
 //black.readthedocs.io/en/stable/the_black_code_style/current_style.html#ast-
 before-and-after-formatting) section for details). If you're feeling confident,
 use `--fast`. ## The _Black_ code style _Black_ is a PEP 8 compliant
@@ -89,85 +98,222 @@
 your code in compliance with many other _Black_ formatted projects. ## Used by
 The following notable open-source projects trust _Black_ with enforcing a
 consistent code style: pytest, tox, Pyramid, Django, Django Channels,
 Hypothesis, attrs, SQLAlchemy, Poetry, PyPA applications (Warehouse,
 Bandersnatch, Pipenv, virtualenv), pandas, Pillow, Twisted, LocalStack, every
 Datadog Agent Integration, Home Assistant, Zulip, Kedro, OpenOA, FLORIS, ORBIT,
 WOMBAT, and many more. The following organizations use _Black_: Facebook,
-Dropbox, KeepTruckin, Mozilla, Quora, Duolingo, QuantumBlack, Tesla. Are we
-missing anyone? Let us know. ## Testimonials **Mike Bayer**, [author of
-`SQLAlchemy`](https://www.sqlalchemy.org/): > I can't think of any single tool
-in my entire programming career that has given me a > bigger productivity
-increase by its introduction. I can now do refactorings in about > 1% of the
-keystrokes that it would have taken me previously when we had no way for > code
-to format itself. **Dusty Phillips**, [writer](https://smile.amazon.com/s/
-ref=nb_sb_noss?url=search-alias%3Daps&field-keywords=dusty+phillips): > _Black_
-is opinionated so you don't have to be. **Hynek Schlawack**, [creator of
-`attrs`](https://www.attrs.org/), core developer of Twisted and CPython: > An
-auto-formatter that doesn't suck is all I want for Xmas! **Carl Meyer**,
-[Django](https://www.djangoproject.com/) core developer: > At least the name is
-good. **Kenneth Reitz**, creator of [`requests`](https://
-requests.readthedocs.io/en/latest/) and [`pipenv`](https://readthedocs.org/
-projects/pipenv/): > This vastly improves the formatting of our code. Thanks a
-ton! ## Show your style Use the badge in your project's README.md: ```md [!
+Dropbox, KeepTruckin, Mozilla, Quora, Duolingo, QuantumBlack, Tesla, Archer
+Aviation. Are we missing anyone? Let us know. ## Testimonials **Mike Bayer**,
+[author of `SQLAlchemy`](https://www.sqlalchemy.org/): > I can't think of any
+single tool in my entire programming career that has given me a > bigger
+productivity increase by its introduction. I can now do refactorings in about >
+1% of the keystrokes that it would have taken me previously when we had no way
+for > code to format itself. **Dusty Phillips**, [writer](https://
+smile.amazon.com/s/ref=nb_sb_noss?url=search-alias%3Daps&field-
+keywords=dusty+phillips): > _Black_ is opinionated so you don't have to be.
+**Hynek Schlawack**, [creator of `attrs`](https://www.attrs.org/), core
+developer of Twisted and CPython: > An auto-formatter that doesn't suck is all
+I want for Xmas! **Carl Meyer**, [Django](https://www.djangoproject.com/) core
+developer: > At least the name is good. **Kenneth Reitz**, creator of
+[`requests`](https://requests.readthedocs.io/en/latest/) and [`pipenv`](https:/
+/readthedocs.org/projects/pipenv/): > This vastly improves the formatting of
+our code. Thanks a ton! ## Show your style Use the badge in your project's
+README.md: ```md [![Code style: black](https://img.shields.io/badge/
+code%20style-black-000000.svg)](https://github.com/psf/black) ``` Using the
+badge in README.rst: ``` .. image:: https://img.shields.io/badge/code%20style-
+black-000000.svg :target: https://github.com/psf/black ``` Looks like this: [!
 [Code style: black](https://img.shields.io/badge/code%20style-black-
-000000.svg)](https://github.com/psf/black) ``` Using the badge in README.rst:
-``` .. image:: https://img.shields.io/badge/code%20style-black-000000.svg :
-target: https://github.com/psf/black ``` Looks like this: [![Code style: black]
-(https://img.shields.io/badge/code%20style-black-000000.svg)](https://
-github.com/psf/black) ## License MIT ## Contributing Welcome! Happy to see you
-willing to make the project better. You can get started by reading this: -
-[Contributing: The basics](https://black.readthedocs.io/en/latest/contributing/
-the_basics.html) You can also take a look at the rest of the contributing docs
-or talk with the developers: - [Contributing documentation](https://
-black.readthedocs.io/en/latest/contributing/index.html) - [Chat on Discord]
-(https://discord.gg/RtVdv86PrH) ## Change log The log has become rather long.
-It moved to its own file. See [CHANGES](https://black.readthedocs.io/en/latest/
-change_log.html). ## Authors The author list is quite long nowadays, so it
-lives in its own file. See [AUTHORS.md](./AUTHORS.md) ## Code of Conduct
-Everyone participating in the _Black_ project, and in particular in the issue
-tracker, pull requests, and social media activity, is expected to treat other
-people with respect and more generally to follow the guidelines articulated in
-the [Python Community Code of Conduct](https://www.python.org/psf/
-codeofconduct/). At the same time, humor is encouraged. In fact, basic
-familiarity with Monty Python's Flying Circus is expected. We are not savages.
-And if you _really_ need to slap somebody, do it with a fish while dancing. #
-Change Log ## Unreleased ### Highlights  ### Stable style  ### Preview style
-### Configuration  ### Packaging  ### Parser  ### Performance  ### Output  ###
-_Blackd_  ### Integrations  ### Documentation  ## 22.8.0 ### Highlights -
-Python 3.11 is now supported, except for _blackd_ as aiohttp does not support
-3.11 as of publishing (#3234) - This is the last release that supports running
-_Black_ on Python 3.6 (formatting 3.6 code will continue to be supported until
-further notice) - Reword the stability policy to say that we may, in rare
-cases, make changes that affect code that was not previously formatted by
-_Black_ (#3155) ### Stable style - Fix an infinite loop when using `# fmt: on/
-off` in the middle of an expression or code block (#3158) - Fix incorrect
-handling of `# fmt: skip` on colon (`:`) lines (#3148) - Comments are no longer
-deleted when a line had spaces removed around power operators (#2874) ###
-Preview style - Single-character closing docstring quotes are no longer moved
-to their own line as this is invalid. This was a bug introduced in version
-22.6.0. (#3166) - `--skip-string-normalization` / `-S` now prevents docstring
-prefixes from being normalized as expected (#3168) - When using `--skip-magic-
+000000.svg)](https://github.com/psf/black) ## License MIT ## Contributing
+Welcome! Happy to see you willing to make the project better. You can get
+started by reading this: - [Contributing: The basics](https://
+black.readthedocs.io/en/latest/contributing/the_basics.html) You can also take
+a look at the rest of the contributing docs or talk with the developers: -
+[Contributing documentation](https://black.readthedocs.io/en/latest/
+contributing/index.html) - [Chat on Discord](https://discord.gg/RtVdv86PrH) ##
+Change log The log has become rather long. It moved to its own file. See
+[CHANGES](https://black.readthedocs.io/en/latest/change_log.html). ## Authors
+The author list is quite long nowadays, so it lives in its own file. See
+[AUTHORS.md](./AUTHORS.md) ## Code of Conduct Everyone participating in the
+_Black_ project, and in particular in the issue tracker, pull requests, and
+social media activity, is expected to treat other people with respect and more
+generally to follow the guidelines articulated in the [Python Community Code of
+Conduct](https://www.python.org/psf/codeofconduct/). At the same time, humor is
+encouraged. In fact, basic familiarity with Monty Python's Flying Circus is
+expected. We are not savages. And if you _really_ need to slap somebody, do it
+with a fish while dancing. # Change Log ## Unreleased ### Highlights  ###
+Stable style  ### Preview style  ### Configuration  ### Packaging  ### Parser
+### Performance  ### Output  ### _Blackd_  ### Integrations  ### Documentation
+## 23.3.0 ### Highlights This release fixes a longstanding confusing behavior
+in Black's GitHub action, where the version of the action did not determine the
+version of Black being run (issue #3382). In addition, there is a small bug fix
+around imports and a number of improvements to the preview style. Please try
+out the [preview style](https://black.readthedocs.io/en/stable/
+the_black_code_style/future_style.html#preview-style) with `black --preview`
+and tell us your feedback. All changes in the preview style are expected to
+become part of Black's stable style in January 2024. ### Stable style - Import
+lines with `# fmt: skip` and `# fmt: off` no longer have an extra blank line
+added when they are right after another import line (#3610) ### Preview style -
+Add trailing commas to collection literals even if there's a comment after the
+last entry (#3393) - `async def`, `async for`, and `async with` statements are
+now formatted consistently compared to their non-async version. (#3609) -
+`with` statements that contain two context managers will be consistently
+wrapped in parentheses (#3589) - Let string splitters respect [East Asian
+Width](https://www.unicode.org/reports/tr11/) (#3445) - Now long string
+literals can be split after East Asian commas and periods (`ã` U+3001
+IDEOGRAPHIC COMMA, `ã` U+3002 IDEOGRAPHIC FULL STOP, & `ï¼` U+FF0C FULLWIDTH
+COMMA) besides before spaces (#3445) - For stubs, enforce one blank line after
+a nested class with a body other than just `...` (#3564) - Improve handling of
+multiline strings by changing line split behavior (#1879) ### Parser - Added
+support for formatting files with invalid type comments (#3594) ###
+Integrations - Update GitHub Action to use the version of Black equivalent to
+action's version if version input is not specified (#3543) - Fix missing Python
+binary path in autoload script for vim (#3508) ### Documentation - Document
+that only the most recent release is supported for security issues;
+vulnerabilities should be reported through Tidelift (#3612) ## 23.1.0 ###
+Highlights This is the first release of 2023, and following our [stability
+policy](https://black.readthedocs.io/en/stable/the_black_code_style/
+index.html#stability-policy), it comes with a number of improvements to our
+stable style, including improvements to empty line handling, removal of
+redundant parentheses in several contexts, and output that highlights
+implicitly concatenated strings better. There are also many changes to the
+preview style; try out `black --preview` and give us feedback to help us set
+the stable style for next year. In addition to style changes, Black now
+automatically infers the supported Python versions from your `pyproject.toml`
+file, removing the need to set Black's target versions separately. ### Stable
+style  - Introduce the 2023 stable style, which incorporates most aspects of
+last year's preview style (#3418). Specific changes: - Enforce empty lines
+before classes and functions with sticky leading comments (#3302) (22.12.0) -
+Reformat empty and whitespace-only files as either an empty file (if no newline
+is present) or as a single newline character (if a newline is present) (#3348)
+(22.12.0) - Implicitly concatenated strings used as function args are now
+wrapped inside parentheses (#3307) (22.12.0) - Correctly handle trailing commas
+that are inside a line's leading non-nested parens (#3370) (22.12.0) - `--skip-
+string-normalization` / `-S` now prevents docstring prefixes from being
+normalized as expected (#3168) (since 22.8.0) - When using `--skip-magic-
 trailing-comma` or `-C`, trailing commas are stripped from subscript
-expressions with more than 1 element (#3209) - Implicitly concatenated strings
-inside a list, set, or tuple are now wrapped inside parentheses (#3162) - Fix a
-string merging/split issue when a comment is present in the middle of
-implicitly concatenated strings on its own line (#3227) ### _Blackd_ - `blackd`
-now supports enabling the preview style via the `X-Preview` header (#3217) ###
-Configuration - Black now uses the presence of debug f-strings to detect target
-version (#3215) - Fix misdetection of project root and verbose logging of
-sources in cases involving `--stdin-filename` (#3216) - Immediate `.gitignore`
-files in source directories given on the command line are now also respected,
-previously only `.gitignore` files in the project root and automatically
-discovered directories were respected (#3237) ### Documentation - Recommend
-using BlackConnect in IntelliJ IDEs (#3150) ### Integrations - Vim plugin:
-prefix messages with `Black: ` so it's clear they come from Black (#3194) -
-Docker: changed to a /opt/venv installation + added to PATH to be available to
-non-root users (#3202) ### Output - Change from deprecated
-`asyncio.get_event_loop()` to create our event loop which removes
+expressions with more than 1 element (#3209) (22.8.0) - Implicitly concatenated
+strings inside a list, set, or tuple are now wrapped inside parentheses (#3162)
+(22.8.0) - Fix a string merging/split issue when a comment is present in the
+middle of implicitly concatenated strings on its own line (#3227) (22.8.0) -
+Docstring quotes are no longer moved if it would violate the line length limit
+(#3044, #3430) (22.6.0) - Parentheses around return annotations are now managed
+(#2990) (22.6.0) - Remove unnecessary parentheses around awaited objects
+(#2991) (22.6.0) - Remove unnecessary parentheses in `with` statements (#2926)
+(22.6.0) - Remove trailing newlines after code block open (#3035) (22.6.0) -
+Code cell separators `#%%` are now standardised to `# %%` (#2919) (22.3.0) -
+Remove unnecessary parentheses from `except` statements (#2939) (22.3.0) -
+Remove unnecessary parentheses from tuple unpacking in `for` loops (#2945)
+(22.3.0) - Avoid magic-trailing-comma in single-element subscripts (#2942)
+(22.3.0) - Fix a crash when a colon line is marked between `# fmt: off` and `#
+fmt: on` (#3439) ### Preview style  - Format hex codes in unicode escape
+sequences in string literals (#2916) - Add parentheses around `if`-`else`
+expressions (#2278) - Improve performance on large expressions that contain
+many strings (#3467) - Fix a crash in preview style with assert + parenthesized
+string (#3415) - Fix crashes in preview style with walrus operators used in
+function return annotations and except clauses (#3423) - Fix a crash in preview
+advanced string processing where mixed implicitly concatenated regular and f-
+strings start with an empty span (#3463) - Fix a crash in preview advanced
+string processing where a standalone comment is placed before a dict's value
+(#3469) - Fix an issue where extra empty lines are added when a decorator has
+`# fmt: skip` applied or there is a standalone comment between decorators
+(#3470) - Do not put the closing quotes in a docstring on a separate line, even
+if the line is too long (#3430) - Long values in dict literals are now wrapped
+in parentheses; correspondingly unnecessary parentheses around short values in
+dict literals are now removed; long string lambda values are now wrapped in
+parentheses (#3440) - Fix two crashes in preview style involving edge cases
+with docstrings (#3451) - Exclude string type annotations from improved string
+processing; fix crash when the return type annotation is stringified and spans
+across multiple lines (#3462) - Wrap multiple context managers in parentheses
+when targeting Python 3.9+ (#3489) - Fix several crashes in preview style with
+walrus operators used in `with` statements or tuples (#3473) - Fix an invalid
+quote escaping bug in f-string expressions where it produced invalid code.
+Implicitly concatenated f-strings with different quotes can now be merged or
+quote-normalized by changing the quotes used in expressions. (#3509) - Fix
+crash on `await (yield)` when Black is compiled with mypyc (#3533) ###
+Configuration  - Black now tries to infer its `--target-version` from the
+project metadata specified in `pyproject.toml` (#3219) ### Packaging  - Upgrade
+mypyc from `0.971` to `0.991` so mypycified _Black_ can be built on armv7
+(#3380) - This also fixes some crashes while using compiled Black with a debug
+build of CPython - Drop specific support for the `tomli` requirement on 3.11
+alpha releases, working around a bug that would cause the requirement not to be
+installed on any non-final Python releases (#3448) - Black now depends on
+`packaging` version `22.0` or later. This is required for new functionality
+that needs to parse part of the project metadata (#3219) ### Output  - Calling
+`black --help` multiple times will return the same help contents each time
+(#3516) - Verbose logging now shows the values of `pyproject.toml`
+configuration variables (#3392) - Fix false symlink detection messages in
+verbose output due to using an incorrect relative path to the project root
+(#3385) ### Integrations  - Move 3.11 CI to normal flow now that all
+dependencies support 3.11 (#3446) - Docker: Add new `latest_prerelease` tag
+automation to follow latest black alpha release on docker images (#3465) ###
+Documentation  - Expand `vim-plug` installation instructions to offer more
+explicit options (#3468) ## 22.12.0 ### Preview style  - Enforce empty lines
+before classes and functions with sticky leading comments (#3302) - Reformat
+empty and whitespace-only files as either an empty file (if no newline is
+present) or as a single newline character (if a newline is present) (#3348) -
+Implicitly concatenated strings used as function args are now wrapped inside
+parentheses (#3307) - For assignment statements, prefer splitting the right
+hand side if the left hand side fits on a single line (#3368) - Correctly
+handle trailing commas that are inside a line's leading non-nested parens
+(#3370) ### Configuration  - Fix incorrectly applied `.gitignore` rules by
+considering the `.gitignore` location and the relative path to the target file
+(#3338) - Fix incorrectly ignoring `.gitignore` presence when more than one
+source directory is specified (#3336) ### Parser  - Parsing support has been
+added for walruses inside generator expression that are passed as function args
+(for example, `any(match := my_re.match(text) for text in texts)`) (#3327). ###
+Integrations  - Vim plugin: Optionally allow using the system installation of
+Black via `let g:black_use_virtualenv = 0`(#3309) ## 22.10.0 ### Highlights -
+Runtime support for Python 3.6 has been removed. Formatting 3.6 code will still
+be supported until further notice. ### Stable style - Fix a crash when `# fmt:
+on` is used on a different block level than `# fmt: off` (#3281) ### Preview
+style - Fix a crash when formatting some dicts with parenthesis-wrapped long
+string keys (#3262) ### Configuration - `.ipynb_checkpoints` directories are
+now excluded by default (#3293) - Add `--skip-source-first-line` / `-x` option
+to ignore the first line of source code while formatting (#3299) ### Packaging
+- Executables made with PyInstaller will no longer crash when formatting
+several files at once on macOS. Native x86-64 executables for macOS are
+available once again. (#3275) - Hatchling is now used as the build backend.
+This will not have any effect for users who install Black with its wheels from
+PyPI. (#3233) - Faster compiled wheels are now available for CPython 3.11
+(#3276) ### _Blackd_ - Windows style (CRLF) newlines will be preserved (#3257).
+### Integrations - Vim plugin: add flag (`g:black_preview`) to enable/disable
+the preview style (#3246) - Update GitHub Action to support formatting of
+Jupyter Notebook files via a `jupyter` option (#3282) - Update GitHub Action to
+support use of version specifiers (e.g. `<23`) for Black version (#3265) ##
+22.8.0 ### Highlights - Python 3.11 is now supported, except for _blackd_ as
+aiohttp does not support 3.11 as of publishing (#3234) - This is the last
+release that supports running _Black_ on Python 3.6 (formatting 3.6 code will
+continue to be supported until further notice) - Reword the stability policy to
+say that we may, in rare cases, make changes that affect code that was not
+previously formatted by _Black_ (#3155) ### Stable style - Fix an infinite loop
+when using `# fmt: on/off` in the middle of an expression or code block (#3158)
+- Fix incorrect handling of `# fmt: skip` on colon (`:`) lines (#3148) -
+Comments are no longer deleted when a line had spaces removed around power
+operators (#2874) ### Preview style - Single-character closing docstring quotes
+are no longer moved to their own line as this is invalid. This was a bug
+introduced in version 22.6.0. (#3166) - `--skip-string-normalization` / `-S`
+now prevents docstring prefixes from being normalized as expected (#3168) -
+When using `--skip-magic-trailing-comma` or `-C`, trailing commas are stripped
+from subscript expressions with more than 1 element (#3209) - Implicitly
+concatenated strings inside a list, set, or tuple are now wrapped inside
+parentheses (#3162) - Fix a string merging/split issue when a comment is
+present in the middle of implicitly concatenated strings on its own line
+(#3227) ### _Blackd_ - `blackd` now supports enabling the preview style via the
+`X-Preview` header (#3217) ### Configuration - Black now uses the presence of
+debug f-strings to detect target version (#3215) - Fix misdetection of project
+root and verbose logging of sources in cases involving `--stdin-filename`
+(#3216) - Immediate `.gitignore` files in source directories given on the
+command line are now also respected, previously only `.gitignore` files in the
+project root and automatically discovered directories were respected (#3237)
+### Documentation - Recommend using BlackConnect in IntelliJ IDEs (#3150) ###
+Integrations - Vim plugin: prefix messages with `Black: ` so it's clear they
+come from Black (#3194) - Docker: changed to a /opt/venv installation + added
+to PATH to be available to non-root users (#3202) ### Output - Change from
+deprecated `asyncio.get_event_loop()` to create our event loop which removes
 DeprecationWarning (#3164) - Remove logging from internal `blib2to3` library
 since it regularly emits error logs about failed caching that can and should be
 ignored (#3193) ### Parser - Type comments are now included in the AST
 equivalence check consistently so accidental deletion raises an error. Though
 type comments can't be tracked when running on PyPy 3.7 due to standard library
 limitations. (#2874) ### Performance - Reduce Black's startup time when
 formatting a single file by 15-30% (#3211) ## 22.6.0 ### Style - Fix unstable
```

### Comparing `tan-22.8.0/README.md` & `tan-23.3.0/README.md`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-![Black Logo](https://raw.githubusercontent.com/psf/black/main/docs/_static/logo2-readme.png)
+[![Black Logo](https://raw.githubusercontent.com/psf/black/main/docs/_static/logo2-readme.png)](https://black.readthedocs.io/en/stable/)
 
 <h2 align="center">The Uncompromising Code Formatter</h2>
 
 <p align="center">
 <a href="https://github.com/psf/black/actions"><img alt="Actions Status" src="https://github.com/psf/black/workflows/Test/badge.svg"></a>
 <a href="https://black.readthedocs.io/en/stable/?badge=stable"><img alt="Documentation Status" src="https://readthedocs.org/projects/black/badge/?version=stable"></a>
 <a href="https://coveralls.io/github/psf/black?branch=main"><img alt="Coverage Status" src="https://coveralls.io/repos/github/psf/black/badge.svg?branch=main"></a>
@@ -34,17 +34,16 @@
 
 ---
 
 ## Installation and usage
 
 ### Installation
 
-_Black_ can be installed by running `pip install black`. It requires Python 3.6.2+ to
-run. If you want to format Jupyter Notebooks, install with
-`pip install 'black[jupyter]'`.
+_Black_ can be installed by running `pip install black`. It requires Python 3.7+ to run.
+If you want to format Jupyter Notebooks, install with `pip install "black[jupyter]"`.
 
 If you can't wait for the latest _hotness_ and want to install from GitHub, use:
 
 `pip install git+https://github.com/psf/black`
 
 ### Usage
 
@@ -63,15 +62,15 @@
 Further information can be found in our docs:
 
 - [Usage and Configuration](https://black.readthedocs.io/en/stable/usage_and_configuration/index.html)
 
 _Black_ is already [successfully used](https://github.com/psf/black#used-by) by many
 projects, small and big. _Black_ has a comprehensive test suite, with efficient parallel
 tests, and our own auto formatting and parallel Continuous Integration runner. Now that
-we have become stable, you should not expect large formatting to changes in the future.
+we have become stable, you should not expect large formatting changes in the future.
 Stylistic changes will mostly be responses to bug reports and support for new Python
 syntax. For more information please refer to the
 [The Black Code Style](https://black.readthedocs.io/en/stable/the_black_code_style/index.html).
 
 Also, as a safety measure which slows down processing, _Black_ will check that the
 reformatted code still produces a valid AST that is effectively equivalent to the
 original (see the
@@ -135,15 +134,15 @@
 The following notable open-source projects trust _Black_ with enforcing a consistent
 code style: pytest, tox, Pyramid, Django, Django Channels, Hypothesis, attrs,
 SQLAlchemy, Poetry, PyPA applications (Warehouse, Bandersnatch, Pipenv, virtualenv),
 pandas, Pillow, Twisted, LocalStack, every Datadog Agent Integration, Home Assistant,
 Zulip, Kedro, OpenOA, FLORIS, ORBIT, WOMBAT, and many more.
 
 The following organizations use _Black_: Facebook, Dropbox, KeepTruckin, Mozilla, Quora,
-Duolingo, QuantumBlack, Tesla.
+Duolingo, QuantumBlack, Tesla, Archer Aviation.
 
 Are we missing anyone? Let us know.
 
 ## Testimonials
 
 **Mike Bayer**, [author of `SQLAlchemy`](https://www.sqlalchemy.org/):
```

#### html2text {}

```diff
@@ -1,9 +1,9 @@
-![Black Logo](https://raw.githubusercontent.com/psf/black/main/docs/_static/
-logo2-readme.png)
+[![Black Logo](https://raw.githubusercontent.com/psf/black/main/docs/_static/
+logo2-readme.png)](https://black.readthedocs.io/en/stable/)
                  ***** The Uncompromising Code Formatter *****
 [Actions_Status] [Documentation_Status] [Coverage_Status] [License:_MIT] [PyPI]
                  [Downloads] [conda-forge] [Code_style:_black]
 > âAny color you like.â _Black_ is the uncompromising Python code
 formatter. By using it, you agree to cede control over minutiae of hand-
 formatting. In return, _Black_ gives you speed, determinism, and freedom from
 `pycodestyle` nagging about formatting. You will save time and mental energy
@@ -11,28 +11,28 @@
 project you're reading. Formatting becomes transparent after a while and you
 can focus on the content instead. _Black_ makes code review faster by producing
 the smallest diffs possible. Try it out now using the [Black Playground](https:
 //black.vercel.app). Watch the [PyCon 2019 talk](https://youtu.be/esZLCuWs_2Y)
 to learn more. --- **[Read the documentation on ReadTheDocs!](https://
 black.readthedocs.io/en/stable)** --- ## Installation and usage ###
 Installation _Black_ can be installed by running `pip install black`. It
-requires Python 3.6.2+ to run. If you want to format Jupyter Notebooks, install
-with `pip install 'black[jupyter]'`. If you can't wait for the latest _hotness_
+requires Python 3.7+ to run. If you want to format Jupyter Notebooks, install
+with `pip install "black[jupyter]"`. If you can't wait for the latest _hotness_
 and want to install from GitHub, use: `pip install git+https://github.com/psf/
 black` ### Usage To get started right away with sensible defaults: ```sh black
 {source_file_or_directory} ``` You can run _Black_ as a package if running it
 as a script doesn't work: ```sh python -m black {source_file_or_directory} ```
 Further information can be found in our docs: - [Usage and Configuration]
 (https://black.readthedocs.io/en/stable/usage_and_configuration/index.html)
 _Black_ is already [successfully used](https://github.com/psf/black#used-by) by
 many projects, small and big. _Black_ has a comprehensive test suite, with
 efficient parallel tests, and our own auto formatting and parallel Continuous
 Integration runner. Now that we have become stable, you should not expect large
-formatting to changes in the future. Stylistic changes will mostly be responses
-to bug reports and support for new Python syntax. For more information please
+formatting changes in the future. Stylistic changes will mostly be responses to
+bug reports and support for new Python syntax. For more information please
 refer to the [The Black Code Style](https://black.readthedocs.io/en/stable/
 the_black_code_style/index.html). Also, as a safety measure which slows down
 processing, _Black_ will check that the reformatted code still produces a valid
 AST that is effectively equivalent to the original (see the [Pragmatism](https:
 //black.readthedocs.io/en/stable/the_black_code_style/current_style.html#ast-
 before-and-after-formatting) section for details). If you're feeling confident,
 use `--fast`. ## The _Black_ code style _Black_ is a PEP 8 compliant
@@ -72,45 +72,46 @@
 your code in compliance with many other _Black_ formatted projects. ## Used by
 The following notable open-source projects trust _Black_ with enforcing a
 consistent code style: pytest, tox, Pyramid, Django, Django Channels,
 Hypothesis, attrs, SQLAlchemy, Poetry, PyPA applications (Warehouse,
 Bandersnatch, Pipenv, virtualenv), pandas, Pillow, Twisted, LocalStack, every
 Datadog Agent Integration, Home Assistant, Zulip, Kedro, OpenOA, FLORIS, ORBIT,
 WOMBAT, and many more. The following organizations use _Black_: Facebook,
-Dropbox, KeepTruckin, Mozilla, Quora, Duolingo, QuantumBlack, Tesla. Are we
-missing anyone? Let us know. ## Testimonials **Mike Bayer**, [author of
-`SQLAlchemy`](https://www.sqlalchemy.org/): > I can't think of any single tool
-in my entire programming career that has given me a > bigger productivity
-increase by its introduction. I can now do refactorings in about > 1% of the
-keystrokes that it would have taken me previously when we had no way for > code
-to format itself. **Dusty Phillips**, [writer](https://smile.amazon.com/s/
-ref=nb_sb_noss?url=search-alias%3Daps&field-keywords=dusty+phillips): > _Black_
-is opinionated so you don't have to be. **Hynek Schlawack**, [creator of
-`attrs`](https://www.attrs.org/), core developer of Twisted and CPython: > An
-auto-formatter that doesn't suck is all I want for Xmas! **Carl Meyer**,
-[Django](https://www.djangoproject.com/) core developer: > At least the name is
-good. **Kenneth Reitz**, creator of [`requests`](https://
-requests.readthedocs.io/en/latest/) and [`pipenv`](https://readthedocs.org/
-projects/pipenv/): > This vastly improves the formatting of our code. Thanks a
-ton! ## Show your style Use the badge in your project's README.md: ```md [!
+Dropbox, KeepTruckin, Mozilla, Quora, Duolingo, QuantumBlack, Tesla, Archer
+Aviation. Are we missing anyone? Let us know. ## Testimonials **Mike Bayer**,
+[author of `SQLAlchemy`](https://www.sqlalchemy.org/): > I can't think of any
+single tool in my entire programming career that has given me a > bigger
+productivity increase by its introduction. I can now do refactorings in about >
+1% of the keystrokes that it would have taken me previously when we had no way
+for > code to format itself. **Dusty Phillips**, [writer](https://
+smile.amazon.com/s/ref=nb_sb_noss?url=search-alias%3Daps&field-
+keywords=dusty+phillips): > _Black_ is opinionated so you don't have to be.
+**Hynek Schlawack**, [creator of `attrs`](https://www.attrs.org/), core
+developer of Twisted and CPython: > An auto-formatter that doesn't suck is all
+I want for Xmas! **Carl Meyer**, [Django](https://www.djangoproject.com/) core
+developer: > At least the name is good. **Kenneth Reitz**, creator of
+[`requests`](https://requests.readthedocs.io/en/latest/) and [`pipenv`](https:/
+/readthedocs.org/projects/pipenv/): > This vastly improves the formatting of
+our code. Thanks a ton! ## Show your style Use the badge in your project's
+README.md: ```md [![Code style: black](https://img.shields.io/badge/
+code%20style-black-000000.svg)](https://github.com/psf/black) ``` Using the
+badge in README.rst: ``` .. image:: https://img.shields.io/badge/code%20style-
+black-000000.svg :target: https://github.com/psf/black ``` Looks like this: [!
 [Code style: black](https://img.shields.io/badge/code%20style-black-
-000000.svg)](https://github.com/psf/black) ``` Using the badge in README.rst:
-``` .. image:: https://img.shields.io/badge/code%20style-black-000000.svg :
-target: https://github.com/psf/black ``` Looks like this: [![Code style: black]
-(https://img.shields.io/badge/code%20style-black-000000.svg)](https://
-github.com/psf/black) ## License MIT ## Contributing Welcome! Happy to see you
-willing to make the project better. You can get started by reading this: -
-[Contributing: The basics](https://black.readthedocs.io/en/latest/contributing/
-the_basics.html) You can also take a look at the rest of the contributing docs
-or talk with the developers: - [Contributing documentation](https://
-black.readthedocs.io/en/latest/contributing/index.html) - [Chat on Discord]
-(https://discord.gg/RtVdv86PrH) ## Change log The log has become rather long.
-It moved to its own file. See [CHANGES](https://black.readthedocs.io/en/latest/
-change_log.html). ## Authors The author list is quite long nowadays, so it
-lives in its own file. See [AUTHORS.md](./AUTHORS.md) ## Code of Conduct
-Everyone participating in the _Black_ project, and in particular in the issue
-tracker, pull requests, and social media activity, is expected to treat other
-people with respect and more generally to follow the guidelines articulated in
-the [Python Community Code of Conduct](https://www.python.org/psf/
-codeofconduct/). At the same time, humor is encouraged. In fact, basic
-familiarity with Monty Python's Flying Circus is expected. We are not savages.
-And if you _really_ need to slap somebody, do it with a fish while dancing.
+000000.svg)](https://github.com/psf/black) ## License MIT ## Contributing
+Welcome! Happy to see you willing to make the project better. You can get
+started by reading this: - [Contributing: The basics](https://
+black.readthedocs.io/en/latest/contributing/the_basics.html) You can also take
+a look at the rest of the contributing docs or talk with the developers: -
+[Contributing documentation](https://black.readthedocs.io/en/latest/
+contributing/index.html) - [Chat on Discord](https://discord.gg/RtVdv86PrH) ##
+Change log The log has become rather long. It moved to its own file. See
+[CHANGES](https://black.readthedocs.io/en/latest/change_log.html). ## Authors
+The author list is quite long nowadays, so it lives in its own file. See
+[AUTHORS.md](./AUTHORS.md) ## Code of Conduct Everyone participating in the
+_Black_ project, and in particular in the issue tracker, pull requests, and
+social media activity, is expected to treat other people with respect and more
+generally to follow the guidelines articulated in the [Python Community Code of
+Conduct](https://www.python.org/psf/codeofconduct/). At the same time, humor is
+encouraged. In fact, basic familiarity with Monty Python's Flying Circus is
+expected. We are not savages. And if you _really_ need to slap somebody, do it
+with a fish while dancing.
```

### Comparing `tan-22.8.0/action.yml` & `tan-23.3.0/action.yml`

 * *Files 6% similar despite different names*

```diff
@@ -8,14 +8,19 @@
       '--check --diff'"
     required: false
     default: "--check --diff"
   src:
     description: "Source to run Black. Default: '.'"
     required: false
     default: "."
+  jupyter:
+    description:
+      "Set this option to true to include Jupyter Notebook files. Default: false"
+    required: false
+    default: false
   black_args:
     description: "[DEPRECATED] Black input arguments."
     required: false
     default: ""
     deprecationMessage:
       "Input `with.black_args` is deprecated. Use `with.options` and `with.src` instead."
   version:
@@ -34,11 +39,12 @@
         else
           python3 $GITHUB_ACTION_PATH/action/main.py
         fi
       env:
         # TODO: Remove once https://github.com/actions/runner/issues/665 is fixed.
         INPUT_OPTIONS: ${{ inputs.options }}
         INPUT_SRC: ${{ inputs.src }}
+        INPUT_JUPYTER: ${{ inputs.jupyter }}
         INPUT_BLACK_ARGS: ${{ inputs.black_args }}
         INPUT_VERSION: ${{ inputs.version }}
         pythonioencoding: utf-8
       shell: bash
```

### Comparing `tan-22.8.0/autoload/black.vim` & `tan-23.3.0/autoload/black.vim`

 * *Files 16% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 import vim
 
 def strtobool(text):
   if text.lower() in ['y', 'yes', 't', 'true', 'on', '1']:
     return True
   if text.lower() in ['n', 'no', 'f', 'false', 'off', '0']:
     return False
-  raise ValueError(f"{text} is not convertable to boolean")
+  raise ValueError(f"{text} is not convertible to boolean")
 
 class Flag(collections.namedtuple("FlagBase", "name, cast")):
   @property
   def var_name(self):
     return self.name.replace("-", "_")
 
   @property
@@ -26,56 +26,75 @@
 
 FLAGS = [
   Flag(name="line_length", cast=int),
   Flag(name="fast", cast=strtobool),
   Flag(name="skip_string_normalization", cast=strtobool),
   Flag(name="quiet", cast=strtobool),
   Flag(name="skip_magic_trailing_comma", cast=strtobool),
+  Flag(name="preview", cast=strtobool),
 ]
 
 
-def _get_python_binary(exec_prefix):
+def _get_python_binary(exec_prefix, pyver):
   try:
     default = vim.eval("g:pymode_python").strip()
   except vim.error:
     default = ""
   if default and os.path.exists(default):
     return default
   if sys.platform[:3] == "win":
     return exec_prefix / 'python.exe'
-  return exec_prefix / 'bin' / 'python3'
+  bin_path = exec_prefix / "bin"
+  exec_path = (bin_path / f"python{pyver[0]}.{pyver[1]}").resolve()
+  if exec_path.exists():
+    return exec_path
+  # It is possible that some environments may only have python3
+  exec_path = (bin_path / f"python3").resolve()
+  if exec_path.exists():
+    return exec_path
+  raise ValueError("python executable not found")
 
 def _get_pip(venv_path):
   if sys.platform[:3] == "win":
     return venv_path / 'Scripts' / 'pip.exe'
   return venv_path / 'bin' / 'pip'
 
 def _get_virtualenv_site_packages(venv_path, pyver):
   if sys.platform[:3] == "win":
     return venv_path / 'Lib' / 'site-packages'
   return venv_path / 'lib' / f'python{pyver[0]}.{pyver[1]}' / 'site-packages'
 
 def _initialize_black_env(upgrade=False):
+  if vim.eval("g:black_use_virtualenv ? 'true' : 'false'") == "false":
+    if upgrade:
+      print("Upgrade disabled due to g:black_use_virtualenv being disabled.")
+      print("Either use your system package manager (or pip) to upgrade black separately,")
+      print("or modify your vimrc to have 'let g:black_use_virtualenv = 1'.")
+      return False
+    else:
+      # Nothing needed to be done.
+      return True
+
   pyver = sys.version_info[:3]
-  if pyver < (3, 6, 2):
-    print("Sorry, Black requires Python 3.6.2+ to run.")
+  if pyver < (3, 7):
+    print("Sorry, Black requires Python 3.7+ to run.")
     return False
 
   from pathlib import Path
   import subprocess
   import venv
   virtualenv_path = Path(vim.eval("g:black_virtualenv")).expanduser()
   virtualenv_site_packages = str(_get_virtualenv_site_packages(virtualenv_path, pyver))
   first_install = False
   if not virtualenv_path.is_dir():
     print('Please wait, one time setup for Black.')
     _executable = sys.executable
     _base_executable = getattr(sys, "_base_executable", _executable)
     try:
-      executable = str(_get_python_binary(Path(sys.exec_prefix)))
+      executable = str(_get_python_binary(Path(sys.exec_prefix), pyver))
       sys.executable = executable
       sys._base_executable = executable
       print(f'Creating a virtualenv in {virtualenv_path}...')
       print('(this path can be customized in .vimrc by setting g:black_virtualenv)')
       venv.create(virtualenv_path, with_pip=True)
     except Exception:
       print('Encountered exception while creating virtualenv (see traceback below).')
@@ -141,14 +160,15 @@
     black_kwargs["target_versions"] = target_version
 
   mode = black.FileMode(
     line_length=configs["line_length"],
     string_normalization=not configs["skip_string_normalization"],
     is_pyi=vim.current.buffer.name.endswith('.pyi'),
     magic_trailing_comma=not configs["skip_magic_trailing_comma"],
+    preview=configs["preview"],
     **black_kwargs,
   )
   quiet = configs["quiet"]
 
   buffer_str = '\n'.join(vim.current.buffer) + '\n'
   try:
     new_buffer_str = black.format_file_contents(
```

### Comparing `tan-22.8.0/docs/Makefile` & `tan-23.3.0/docs/Makefile`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/_static/license.svg` & `tan-23.3.0/docs/_static/license.svg`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/_static/logo2-readme.png` & `tan-23.3.0/docs/_static/logo2-readme.png`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/_static/logo2.png` & `tan-23.3.0/docs/_static/logo2.png`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/_static/pypi_template.svg` & `tan-23.3.0/docs/_static/pypi_template.svg`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/conf.py` & `tan-23.3.0/docs/conf.py`

 * *Files 1% similar despite different names*

```diff
@@ -51,15 +51,15 @@
 
 make_pypi_svg(release)
 
 
 # -- General configuration ---------------------------------------------------
 
 # If your documentation needs a minimal Sphinx version, state it here.
-needs_sphinx = "3.0"
+needs_sphinx = "4.4"
 
 # Add any Sphinx extension module names here, as strings. They can be
 # extensions coming with Sphinx (named 'sphinx.ext.*') or your custom
 # ones.
 extensions = [
     "sphinx.ext.autodoc",
     "sphinx.ext.intersphinx",
```

### Comparing `tan-22.8.0/docs/contributing/gauging_changes.md` & `tan-23.3.0/docs/contributing/gauging_changes.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/contributing/index.md` & `tan-23.3.0/docs/contributing/index.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/contributing/issue_triage.md` & `tan-23.3.0/docs/contributing/issue_triage.md`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 # Issue triage
 
-Currently, _Black_ uses the issue tracker for bugs, feature requests, proposed design
+Currently, _Black_ uses the issue tracker for bugs, feature requests, proposed style
 modifications, and general user support. Each of these issues have to be triaged so they
 can be eventually be resolved somehow. This document outlines the triaging process and
 also the current guidelines and recommendations.
 
 ```{tip}
 If you're looking for a way to contribute without submitting patches, this might be
 the area for you. Since _Black_ is a popular project, its issue tracker is quite busy
@@ -38,32 +38,32 @@
 resolved.
 
 The lifecycle of a bug report or user support issue typically goes something like this:
 
 1. _the issue is waiting for triage_
 2. **identified** - has been marked with a type label and other relevant labels, more
    details or a functional reproduction may be still needed (and therefore should be
-   marked with `S: needs repro` or `S: awaiting reponse`)
+   marked with `S: needs repro` or `S: awaiting response`)
 3. **confirmed** - the issue can reproduced and necessary details have been provided
 4. **discussion** - initial triage has been done and now the general details on how the
    issue should be best resolved are being hashed out
 5. **awaiting fix** - no further discussion on the issue is necessary and a resolving PR
    is the next step
 6. **closed** - the issue has been resolved, reasons include:
    - the issue couldn't be reproduced
    - the issue has been fixed
    - duplicate of another pre-existing issue or is invalid
 
-For enhancement, documentation, and design issues, the lifecycle looks very similar but
+For enhancement, documentation, and style issues, the lifecycle looks very similar but
 the details are different:
 
 1. _the issue is waiting for triage_
 2. **identified** - has been marked with a type label and other relevant labels
 3. **discussion** - the merits of the suggested changes are currently being discussed, a
-   PR would be acceptable but would be at sigificant risk of being rejected
+   PR would be acceptable but would be at significant risk of being rejected
 4. **accepted & awaiting PR** - it's been determined the suggested changes are OK and a
    PR would be welcomed (`S: accepted`)
 5. **closed**: - the issue has been resolved, reasons include:
    - the suggested changes were implemented
    - it was rejected (due to technical concerns, ethos conflicts, etc.)
    - duplicate of a pre-existing issue or is invalid
```

### Comparing `tan-22.8.0/docs/contributing/reference/reference_classes.rst` & `tan-23.3.0/docs/contributing/reference/reference_classes.rst`

 * *Files 8% similar despite different names*

```diff
@@ -7,44 +7,50 @@
 
 :class:`BracketTracker`
 -----------------------
 
 .. autoclass:: black.brackets.BracketTracker
     :members:
 
-:class:`EmptyLineTracker`
+:class:`Line`
+-------------
+
+.. autoclass:: black.lines.Line
+    :members:
+    :special-members: __str__, __bool__
+
+:class:`LinesBlock`
 -------------------------
 
-.. autoclass:: black.EmptyLineTracker
+.. autoclass:: black.lines.LinesBlock
     :members:
 
-:class:`Line`
--------------
+:class:`EmptyLineTracker`
+-------------------------
 
-.. autoclass:: black.Line
+.. autoclass:: black.lines.EmptyLineTracker
     :members:
-    :special-members: __str__, __bool__
 
 :class:`LineGenerator`
 ----------------------
 
-.. autoclass:: black.LineGenerator
+.. autoclass:: black.linegen.LineGenerator
     :show-inheritance:
     :members:
 
 :class:`ProtoComment`
 ---------------------
 
 .. autoclass:: black.comments.ProtoComment
     :members:
 
 :class:`Report`
 ---------------
 
-.. autoclass:: black.Report
+.. autoclass:: black.report.Report
     :members:
     :special-members: __str__
 
 :class:`Visitor`
 ----------------
 
 .. autoclass:: black.nodes.Visitor
```

### Comparing `tan-22.8.0/docs/contributing/reference/reference_functions.rst` & `tan-23.3.0/docs/contributing/reference/reference_functions.rst`

 * *Files 2% similar despite different names*

```diff
@@ -133,17 +133,17 @@
 
 .. autofunction:: black.comments.generate_comments
 
 .. autofunction:: black.comments.generate_ignored_nodes
 
 .. autofunction:: black.comments.is_fmt_on
 
-.. autofunction:: black.comments.contains_fmt_on_at_column
+.. autofunction:: black.comments.children_contains_fmt_on
 
-.. autofunction:: black.nodes.first_leaf_column
+.. autofunction:: black.nodes.first_leaf_of
 
 .. autofunction:: black.linegen.generate_trailers_to_omit
 
 .. autofunction:: black.get_future_imports
 
 .. autofunction:: black.comments.list_comments
```

### Comparing `tan-22.8.0/docs/contributing/release_process.md` & `tan-23.3.0/docs/contributing/release_process.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/contributing/the_basics.md` & `tan-23.3.0/docs/contributing/the_basics.md`

 * *Files 3% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 # The basics
 
 An overview on contributing to the _Black_ project.
 
 ## Technicalities
 
-Development on the latest version of Python is preferred. As of this writing it's 3.9.
-You can use any operating system.
+Development on the latest version of Python is preferred. You can use any operating
+system.
 
 Install development dependencies inside a virtual environment of your choice, for
 example:
 
 ```console
 $ python3 -m venv .venv
 $ source .venv/bin/activate
```

### Comparing `tan-22.8.0/docs/faq.md` & `tan-23.3.0/docs/faq.md`

 * *Files 6% similar despite different names*

```diff
@@ -19,15 +19,15 @@
 tools such as `expand/unexpand` (for Linux) useful when contributing to Python projects.
 A workflow might consist of e.g. setting up appropriate pre-commit and post-merge git
 hooks, and scripting `unexpand` to run after applying _Black_.
 
 ## Does Black have an API?
 
 Not yet. _Black_ is fundamentally a command line tool. Many
-[integrations](integrations/index.rst) are provided, but a Python interface is not one
+[integrations](/integrations/index.md) are provided, but a Python interface is not one
 of them. A simple API is being [planned](https://github.com/psf/black/issues/779)
 though.
 
 ## Is Black safe to use?
 
 Yes. _Black_ is strictly about formatting, nothing else. Black strives to ensure that
 after formatting the AST is
@@ -35,15 +35,15 @@
 limited special cases where the code is allowed to differ. If issues are found, an error
 is raised and the file is left untouched. Magical comments that influence linters and
 other tools, such as `# noqa`, may be moved by _Black_. See below for more details.
 
 ## How stable is Black's style?
 
 Stable. _Black_ aims to enforce one style and one style only, with some room for
-pragmatism. See [The Black Code Style](the_black_code_style/index.rst) for more details.
+pragmatism. See [The Black Code Style](the_black_code_style/index.md) for more details.
 
 Starting in 2022, the formatting output will be stable for the releases made in the same
 year (other than unintentional bugs). It is possible to opt-in to the latest formatting
 styles, using the `--preview` flag.
 
 ## Why is my file not formatted?
 
@@ -82,23 +82,25 @@
 [slices](the_black_code_style/current_style.md#slices), and adhering to W503 hinders
 readability because operators are misaligned. Disable W503 and enable the
 disabled-by-default counterpart W504. E203 should be disabled while changes are still
 [discussed](https://github.com/PyCQA/pycodestyle/issues/373).
 
 ## Which Python versions does Black support?
 
-Currently the runtime requires Python 3.6-3.10. Formatting is supported for files
-containing syntax from Python 3.3 to 3.10. We promise to support at least all Python
+Currently the runtime requires Python 3.7-3.11. Formatting is supported for files
+containing syntax from Python 3.3 to 3.11. We promise to support at least all Python
 versions that have not reached their end of life. This is the case for both running
 _Black_ and formatting code.
 
 Support for formatting Python 2 code was removed in version 22.0. While we've made no
 plans to stop supporting older Python 3 minor versions immediately, their support might
 also be removed some time in the future without a deprecation period.
 
+Runtime support for 3.6 was removed in version 22.10.0.
+
 ## Why does my linter or typechecker complain after I format my code?
 
 Some linters and other tools use magical comments (e.g., `# noqa`, `# type: ignore`) to
 influence their behavior. While Black does its best to recognize such comments and leave
 them in the right place, this detection is not and cannot be perfect. Therefore, you'll
 sometimes have to manually move these comments to the right place after you format your
 codebase with _Black_.
```

### Comparing `tan-22.8.0/docs/getting_started.md` & `tan-23.3.0/docs/getting_started.md`

 * *Files 2% similar despite different names*

```diff
@@ -12,17 +12,16 @@
 ## Try it out online
 
 Also, you can try out _Black_ online for minimal fuss on the
 [Black Playground](https://black.vercel.app) generously created by José Padilla.
 
 ## Installation
 
-_Black_ can be installed by running `pip install black`. It requires Python 3.6.2+ to
-run. If you want to format Jupyter Notebooks, install with
-`pip install 'black[jupyter]'`.
+_Black_ can be installed by running `pip install black`. It requires Python 3.7+ to run.
+If you want to format Jupyter Notebooks, install with `pip install "black[jupyter]"`.
 
 If you can't wait for the latest _hotness_ and want to install from GitHub, use:
 
 `pip install git+https://github.com/psf/black`
 
 ## Basic usage
```

### Comparing `tan-22.8.0/docs/guides/introducing_black_to_your_project.md` & `tan-23.3.0/docs/guides/introducing_black_to_your_project.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/guides/using_black_with_other_tools.md` & `tan-23.3.0/docs/guides/using_black_with_other_tools.md`

 * *Files 5% similar despite different names*

```diff
@@ -47,17 +47,17 @@
 use_parentheses = True
 ensure_newline_before_comments = True
 line_length = 88
 ```
 
 #### Why those options above?
 
-_Black_ wraps imports that surpass `line-length` by moving identifiers into their own
-indented line. If that still doesn't fit the bill, it will put all of them in separate
-lines and put a trailing comma. A more detailed explanation of this behaviour can be
+_Black_ wraps imports that surpass `line-length` by moving identifiers onto separate
+lines and by adding a trailing comma after each. A more detailed explanation of this
+behaviour can be
 [found here](../the_black_code_style/current_style.md#how-black-wraps-lines).
 
 isort's default mode of wrapping imports that extend past the `line_length` limit is
 "Grid".
 
 ```py3
 from third_party import (lib1, lib2, lib3,
@@ -248,7 +248,39 @@
 
 ```toml
 [tool.pylint.format]
 max-line-length = "88"
 ```
 
 </details>
+
+### pycodestyle
+
+[pycodestyle](https://pycodestyle.pycqa.org/) is also a code linter like Flake8.
+
+#### Configuration
+
+```
+max-line-length = 88
+ignore = E203
+```
+
+#### Why those options above?
+
+pycodestyle should be configured to only complain about lines that surpass `88`
+characters via `max_line_length = 88`.
+
+See
+[Why are Flake8’s E203 and W503 violated?](https://black.readthedocs.io/en/stable/faq.html#why-are-flake8-s-e203-and-w503-violated)
+
+#### Formats
+
+<details>
+<summary>setup.cfg</summary>
+
+```cfg
+[pycodestyle]
+ignore = E203
+max_line_length = 88
+```
+
+</details>
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `tan-22.8.0/docs/index.md` & `tan-23.3.0/docs/index.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/integrations/editors.md` & `tan-23.3.0/docs/integrations/editors.md`

 * *Files 20% similar despite different names*

```diff
@@ -6,14 +6,27 @@
 
 - [wbolster/emacs-python-black](https://github.com/wbolster/emacs-python-black)
 - [proofit404/blacken](https://github.com/pythonic-emacs/blacken)
 - [Elpy](https://github.com/jorgenschaefer/elpy).
 
 ## PyCharm/IntelliJ IDEA
 
+There are three different ways you can use _Black_ from PyCharm:
+
+1. As local server using the BlackConnect plugin
+1. As external tool
+1. As file watcher
+
+The first option is the simplest to set up and formats the fastest (by spinning up
+{doc}`Black's HTTP server </usage_and_configuration/black_as_a_server>`, avoiding the
+startup cost on subsequent formats), but if you would prefer to not install a
+third-party plugin or blackd's extra dependencies, the other two are also great options.
+
+### As local server
+
 1. Install _Black_ with the `d` extra.
 
    ```console
    $ pip install 'black[d]'
    ```
 
 1. Install
@@ -42,14 +55,107 @@
    shortcut.
 
 1. Optionally, to run _Black_ on every file save:
 
    - In `Trigger Settings` section of plugin configuration check
      `Trigger when saving changed files`.
 
+### As external tool
+
+1. Install `black`.
+
+   ```console
+   $ pip install black
+   ```
+
+1. Locate your `black` installation folder.
+
+   On macOS / Linux / BSD:
+
+   ```console
+   $ which black
+   /usr/local/bin/black  # possible location
+   ```
+
+   On Windows:
+
+   ```console
+   $ where black
+   %LocalAppData%\Programs\Python\Python36-32\Scripts\black.exe  # possible location
+   ```
+
+   Note that if you are using a virtual environment detected by PyCharm, this is an
+   unneeded step. In this case the path to `black` is `$PyInterpreterDirectory$/black`.
+
+1. Open External tools in PyCharm/IntelliJ IDEA
+
+   On macOS:
+
+   `PyCharm -> Preferences -> Tools -> External Tools`
+
+   On Windows / Linux / BSD:
+
+   `File -> Settings -> Tools -> External Tools`
+
+1. Click the + icon to add a new external tool with the following values:
+
+   - Name: Black
+   - Description: Black is the uncompromising Python code formatter.
+   - Program: \<install_location_from_step_2>
+   - Arguments: `"$FilePath$"`
+
+1. Format the currently opened file by selecting `Tools -> External Tools -> black`.
+
+   - Alternatively, you can set a keyboard shortcut by navigating to
+     `Preferences or Settings -> Keymap -> External Tools -> External Tools - Black`.
+
+### As file watcher
+
+1. Install `black`.
+
+   ```console
+   $ pip install black
+   ```
+
+1. Locate your `black` installation folder.
+
+   On macOS / Linux / BSD:
+
+   ```console
+   $ which black
+   /usr/local/bin/black  # possible location
+   ```
+
+   On Windows:
+
+   ```console
+   $ where black
+   %LocalAppData%\Programs\Python\Python36-32\Scripts\black.exe  # possible location
+   ```
+
+   Note that if you are using a virtual environment detected by PyCharm, this is an
+   unneeded step. In this case the path to `black` is `$PyInterpreterDirectory$/black`.
+
+1. Make sure you have the
+   [File Watchers](https://plugins.jetbrains.com/plugin/7177-file-watchers) plugin
+   installed.
+1. Go to `Preferences or Settings -> Tools -> File Watchers` and click `+` to add a new
+   watcher:
+   - Name: Black
+   - File type: Python
+   - Scope: Project Files
+   - Program: \<install_location_from_step_2>
+   - Arguments: `$FilePath$`
+   - Output paths to refresh: `$FilePath$`
+   - Working directory: `$ProjectFileDir$`
+
+- In Advanced Options
+  - Uncheck "Auto-save edited files to trigger the watcher"
+  - Uncheck "Trigger the watcher on external changes"
+
 ## Wing IDE
 
 Wing IDE supports `black` via **Preference Settings** for system wide settings and
 **Project Properties** for per-project or workspace specific settings, as explained in
 the Wing documentation on
 [Auto-Reformatting](https://wingware.com/doc/edit/auto-reformatting). The detailed
 procedure is:
@@ -100,69 +206,123 @@
 
 Commands and shortcuts:
 
 - `:Black` to format the entire file (ranges not supported);
   - you can optionally pass `target_version=<version>` with the same values as in the
     command line.
 - `:BlackUpgrade` to upgrade _Black_ inside the virtualenv;
-- `:BlackVersion` to get the current version of _Black_ inside the virtualenv.
+- `:BlackVersion` to get the current version of _Black_ in use.
 
 Configuration:
 
 - `g:black_fast` (defaults to `0`)
 - `g:black_linelength` (defaults to `88`)
 - `g:black_skip_string_normalization` (defaults to `0`)
+- `g:black_skip_magic_trailing_comma` (defaults to `0`)
 - `g:black_virtualenv` (defaults to `~/.vim/black` or `~/.local/share/nvim/black`)
+- `g:black_use_virtualenv` (defaults to `1`)
+- `g:black_target_version` (defaults to `""`)
 - `g:black_quiet` (defaults to `0`)
+- `g:black_preview` (defaults to `0`)
+
+#### Installation
+
+This plugin **requires Vim 7.0+ built with Python 3.7+ support**. It needs Python 3.7 to
+be able to run _Black_ inside the Vim process which is much faster than calling an
+external command.
+
+##### `vim-plug`
 
 To install with [vim-plug](https://github.com/junegunn/vim-plug):
 
+_Black_'s `stable` branch tracks official version updates, and can be used to simply
+follow the most recent stable version.
+
 ```
 Plug 'psf/black', { 'branch': 'stable' }
 ```
 
+Another option which is a bit more explicit and offers more control is to use
+`vim-plug`'s `tag` option with a shell wildcard. This will resolve to the latest tag
+which matches the given pattern.
+
+The following matches all stable versions (see the
+[Release Process](../contributing/release_process.md) section for documentation of
+version scheme used by Black):
+
+```
+Plug 'psf/black', { 'tag': '*.*.*' }
+```
+
+and the following demonstrates pinning to a specific year's stable style (2022 in this
+case):
+
+```
+Plug 'psf/black', { 'tag': '22.*.*' }
+```
+
+##### Vundle
+
 or with [Vundle](https://github.com/VundleVim/Vundle.vim):
 
 ```
 Plugin 'psf/black'
 ```
 
 and execute the following in a terminal:
 
 ```console
 $ cd ~/.vim/bundle/black
 $ git checkout origin/stable -b stable
 ```
 
+##### Arch Linux
+
+On Arch Linux, the plugin is shipped with the
+[`python-black`](https://archlinux.org/packages/community/any/python-black/) package, so
+you can start using it in Vim after install with no additional setup.
+
+##### Vim 8 Native Plugin Management
+
 or you can copy the plugin files from
 [plugin/black.vim](https://github.com/psf/black/blob/stable/plugin/black.vim) and
 [autoload/black.vim](https://github.com/psf/black/blob/stable/autoload/black.vim).
 
 ```
 mkdir -p ~/.vim/pack/python/start/black/plugin
 mkdir -p ~/.vim/pack/python/start/black/autoload
 curl https://raw.githubusercontent.com/psf/black/stable/plugin/black.vim -o ~/.vim/pack/python/start/black/plugin/black.vim
 curl https://raw.githubusercontent.com/psf/black/stable/autoload/black.vim -o ~/.vim/pack/python/start/black/autoload/black.vim
 ```
 
 Let me know if this requires any changes to work with Vim 8's builtin `packadd`, or
 Pathogen, and so on.
 
-This plugin **requires Vim 7.0+ built with Python 3.6+ support**. It needs Python 3.6 to
-be able to run _Black_ inside the Vim process which is much faster than calling an
-external command.
+#### Usage
 
 On first run, the plugin creates its own virtualenv using the right Python version and
 automatically installs _Black_. You can upgrade it later by calling `:BlackUpgrade` and
 restarting Vim.
 
 If you need to do anything special to make your virtualenv work and install _Black_ (for
 example you want to run a version from main), create a virtualenv manually and point
 `g:black_virtualenv` to it. The plugin will use it.
 
+If you would prefer to use the system installation of _Black_ rather than a virtualenv,
+then add this to your vimrc:
+
+```
+let g:black_use_virtualenv = 0
+```
+
+Note that the `:BlackUpgrade` command is only usable and useful with a virtualenv, so
+when the virtualenv is not in use, `:BlackUpgrade` is disabled. If you need to upgrade
+the system installation of _Black_, then use your system package manager or pip--
+whatever tool you used to install _Black_ originally.
+
 To run _Black_ on save, add the following lines to `.vimrc` or `init.vim`:
 
 ```
 augroup black_on_save
   autocmd!
   autocmd BufWritePre *.py Black
 augroup end
@@ -170,14 +330,16 @@
 
 To run _Black_ on a key press (e.g. F9 below), add this:
 
 ```
 nnoremap <F9> :Black<CR>
 ```
 
+#### Troubleshooting
+
 **How to get Vim with Python 3.6?** On Ubuntu 17.10 Vim comes with Python 3.6 by
 default. On macOS with Homebrew run: `brew install vim`. When building Vim from source,
 use: `./configure --enable-python3interp=yes`. There's many guides online how to do
 this.
 
 **I get an import error when using _Black_ from a virtual environment**: If you get an
 error message like this:
```

### Comparing `tan-22.8.0/docs/integrations/github_actions.md` & `tan-23.3.0/docs/integrations/github_actions.md`

 * *Files 24% similar despite different names*

```diff
@@ -20,31 +20,53 @@
 
 on: [push, pull_request]
 
 jobs:
   lint:
     runs-on: ubuntu-latest
     steps:
-      - uses: actions/checkout@v2
+      - uses: actions/checkout@v3
       - uses: psf/black@stable
 ```
 
 We recommend the use of the `@stable` tag, but per version tags also exist if you prefer
 that. Note that the action's version you select is independent of the version of _Black_
 the action will use.
 
-The version of _Black_ the action will use can be configured via `version`. The action
-defaults to the latest release available on PyPI. Only versions available from PyPI are
-supported, so no commit SHAs or branch names.
+The version of _Black_ the action will use can be configured via `version`. This can be
+any
+[valid version specifier](https://packaging.python.org/en/latest/glossary/#term-Version-Specifier)
+or just the version number if you want an exact version. The action defaults to the
+latest release available on PyPI. Only versions available from PyPI are supported, so no
+commit SHAs or branch names.
+
+If you want to include Jupyter Notebooks, _Black_ must be installed with the `jupyter`
+extra. Installing the extra and including Jupyter Notebook files can be configured via
+`jupyter` (default is `false`).
 
 You can also configure the arguments passed to _Black_ via `options` (defaults to
-`'--check --diff'`) and `src` (default is `'.'`)
+`'--check --diff'`) and `src` (default is `'.'`). Please note that the
+[`--check` flag](labels/exit-code) is required so that the workflow fails if _Black_
+finds files that need to be formatted.
 
 Here's an example configuration:
 
 ```yaml
 - uses: psf/black@stable
   with:
     options: "--check --verbose"
     src: "./src"
+    jupyter: true
     version: "21.5b1"
 ```
+
+If you want to match versions covered by Black's
+[stability policy](labels/stability-policy), you can use the compatible release operator
+(`~=`):
+
+```yaml
+- uses: psf/black@stable
+  with:
+    options: "--check --verbose"
+    src: "./src"
+    version: "~= 22.0"
+```
```

### Comparing `tan-22.8.0/docs/integrations/index.md` & `tan-23.3.0/docs/integrations/index.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/integrations/source_version_control.md` & `tan-23.3.0/docs/integrations/source_version_control.md`

 * *Files 7% similar despite different names*

```diff
@@ -3,15 +3,15 @@
 Use [pre-commit](https://pre-commit.com/). Once you
 [have it installed](https://pre-commit.com/#install), add this to the
 `.pre-commit-config.yaml` in your repository:
 
 ```yaml
 repos:
   - repo: https://github.com/psf/black
-    rev: 22.8.0
+    rev: 23.3.0
     hooks:
       - id: black
         # It is recommended to specify the latest version of Python
         # supported by your project here, or alternatively use
         # pre-commit's default_language_version, see
         # https://pre-commit.com/#top_level-default_language_version
         language_version: python3.9
```

### Comparing `tan-22.8.0/docs/make.bat` & `tan-23.3.0/docs/make.bat`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/the_black_code_style/current_style.md` & `tan-23.3.0/docs/the_black_code_style/current_style.md`

 * *Files 4% similar despite different names*

```diff
@@ -81,14 +81,27 @@
     debug: bool = False,
 ):
     """Applies `variables` to the `template` and writes to `file`."""
     with open(file, "w") as f:
         ...
 ```
 
+If a data structure literal (tuple, list, set, dict) or a line of "from" imports cannot
+fit in the allotted length, it's always split into one element per line. This minimizes
+diffs as well as enables readers of code to find which commit introduced a particular
+entry. This also makes _Black_ compatible with
+[isort](../guides/using_black_with_other_tools.md#isort) with the ready-made `black`
+profile or manual configuration.
+
+You might have noticed that closing brackets are always dedented and that a trailing
+comma is always added. Such formatting produces smaller diffs; when you add or remove an
+element, it's always just one line. Also, having the closing bracket dedented provides a
+clear delimiter between two distinct sections of the code that otherwise share the same
+indentation level (like the arguments list and the docstring in the example above).
+
 (labels/why-no-backslashes)=
 
 _Black_ prefers parentheses over backslashes, and will remove backslashes if found.
 
 ```py3
 # in:
 
@@ -123,27 +136,14 @@
 grammar to accept breaks that would otherwise be parse errors. That makes them confusing
 to look at and brittle to modify. This is why _Black_ always gets rid of them.
 
 If you're reaching for backslashes, that's a clear signal that you can do better if you
 slightly refactor your code. I hope some of the examples above show you that there are
 many ways in which you can do it.
 
-You might have noticed that closing brackets are always dedented and that a trailing
-comma is always added. Such formatting produces smaller diffs; when you add or remove an
-element, it's always just one line. Also, having the closing bracket dedented provides a
-clear delimiter between two distinct sections of the code that otherwise share the same
-indentation level (like the arguments list and the docstring in the example above).
-
-If a data structure literal (tuple, list, set, dict) or a line of "from" imports cannot
-fit in the allotted length, it's always split into one element per line. This minimizes
-diffs as well as enables readers of code to find which commit introduced a particular
-entry. This also makes _Black_ compatible with
-[isort](../guides/using_black_with_other_tools.md#isort) with the ready-made `black`
-profile or manual configuration.
-
 ### Line length
 
 You probably noticed the peculiar default line length. _Black_ defaults to 88 characters
 per line, which happens to be 10% over 80. This number was found to produce
 significantly shorter files than sticking with 80 (the most popular), or even 79 (used
 by the standard library). In general,
 [90-ish seems like the wise choice](https://youtu.be/wf-BqAjZb8M?t=260).
@@ -190,15 +190,53 @@
 
 _Black_ avoids spurious vertical whitespace. This is in the spirit of PEP 8 which says
 that in-function vertical whitespace should only be used sparingly.
 
 _Black_ will allow single empty lines inside functions, and single and double empty
 lines on module level left by the original editors, except when they're within
 parenthesized expressions. Since such expressions are always reformatted to fit minimal
-space, this whitespace is lost.
+space, this whitespace is lost. The other exception is that it will remove any empty
+lines immediately following a statement that introduces a new indentation level.
+
+```python
+# in:
+
+def foo():
+
+    print("All the newlines above me should be deleted!")
+
+
+if condition:
+
+    print("No newline above me!")
+
+    print("There is a newline above me, and that's OK!")
+
+
+class Point:
+
+    x: int
+    y: int
+
+# out:
+
+def foo():
+    print("All the newlines above me should be deleted!")
+
+
+if condition:
+    print("No newline above me!")
+
+    print("There is a newline above me, and that's OK!")
+
+
+class Point:
+    x: int
+    y: int
+```
 
 It will also insert proper spacing before and after function definitions. It's one line
 before and after inner functions and two lines before and after module-level functions
 and classes. _Black_ will not put empty lines between function/class definitions and
 standalone comments that immediately precede the given function/class.
 
 _Black_ will enforce single empty lines between a class-level docstring and the first
@@ -402,14 +440,19 @@
 
 - prefer `...` over `pass`;
 - avoid using string literals in type annotations, stub files support forward references
   natively (like Python 3.7 code with `from __future__ import annotations`);
 - use variable annotations instead of type comments, even for stubs that target older
   versions of Python.
 
+### Line endings
+
+_Black_ will normalize line endings (`\n` or `\r\n`) based on the first line ending of
+the file.
+
 ## Pragmatism
 
 Early versions of _Black_ used to be absolutist in some respects. They took after its
 initial author. This was fine at the time as it made the implementation simpler and
 there were not many users anyway. Not many edge cases were reported. As a mature tool,
 _Black_ does make some exceptions to rules it otherwise holds. This section documents
 what those exceptions are and why this is the case.
@@ -448,23 +491,23 @@
 [MagicPython](https://github.com/MagicStack/MagicPython/) syntax highlighter, used by
 default by (among others) GitHub and Visual Studio Code, differentiates between
 r-strings and R-strings. The former are syntax highlighted as regular expressions while
 the latter are treated as true raw strings with no special semantics.
 
 ### AST before and after formatting
 
-When run with `--safe`, _Black_ checks that the code before and after is semantically
-equivalent. This check is done by comparing the AST of the source with the AST of the
-target. There are three limited cases in which the AST does differ:
+When run with `--safe` (the default), _Black_ checks that the code before and after is
+semantically equivalent. This check is done by comparing the AST of the source with the
+AST of the target. There are three limited cases in which the AST does differ:
 
 1. _Black_ cleans up leading and trailing whitespace of docstrings, re-indenting them if
    needed. It's been one of the most popular user-reported features for the formatter to
    fix whitespace issues with docstrings. While the result is technically an AST
-   difference, due to the various possibilities of forming docstrings, all realtime use
-   of docstrings that we're aware of sanitizes indentation and leading/trailing
+   difference, due to the various possibilities of forming docstrings, all real-world
+   uses of docstrings that we're aware of sanitize indentation and leading/trailing
    whitespace anyway.
 
 1. _Black_ manages optional parentheses for some statements. In the case of the `del`
    statement, presence of wrapping parentheses or lack of thereof changes the resulting
    AST but is semantically equivalent in the interpreter.
 
 1. _Black_ might move comments around, which includes type comments. Those are part of
```

### Comparing `tan-22.8.0/docs/the_black_code_style/index.md` & `tan-23.3.0/docs/the_black_code_style/index.md`

 * *Files 2% similar despite different names*

```diff
@@ -13,15 +13,15 @@
 
 While keeping the style unchanged throughout releases has always been a goal, the
 _Black_ code style isn't set in stone. It evolves to accommodate for new features in the
 Python language and, occasionally, in response to user feedback. Large-scale style
 preferences presented in {doc}`current_style` are very unlikely to change, but minor
 style aspects and details might change according to the stability policy presented
 below. Ongoing style considerations are tracked on GitHub with the
-[design](https://github.com/psf/black/labels/T%3A%20design) issue label.
+[style](https://github.com/psf/black/labels/T%3A%20style) issue label.
 
 (labels/stability-policy)=
 
 ## Stability Policy
 
 The following policy applies for the _Black_ code style, in non pre-release versions of
 _Black_:
```

### Comparing `tan-22.8.0/docs/usage_and_configuration/black_as_a_server.md` & `tan-23.3.0/docs/usage_and_configuration/black_as_a_server.md`

 * *Files 4% similar despite different names*

```diff
@@ -46,14 +46,17 @@
 correspond to command line flags for _Black_. There is one exception to this:
 `X-Protocol-Version` which if present, should have the value `1`, otherwise the request
 is rejected with `HTTP 501` (Not Implemented).
 
 The headers controlling how source code is formatted are:
 
 - `X-Line-Length`: corresponds to the `--line-length` command line flag.
+- `X-Skip-Source-First-Line`: corresponds to the `--skip-source-first-line` command line
+  flag. If present and its value is not an empty string, the first line of the source
+  code will be ignored.
 - `X-Skip-String-Normalization`: corresponds to the `--skip-string-normalization`
   command line flag. If present and its value is not the empty string, no string
   normalization will be performed.
 - `X-Skip-Magic-Trailing-Comma`: corresponds to the `--skip-magic-trailing-comma`
   command line flag. If present and its value is not an empty string, trailing commas
   will not be used as a reason to split lines.
 - `X-Preview`: corresponds to the `--preview` command line flag. If present and its
```

### Comparing `tan-22.8.0/docs/usage_and_configuration/black_docker_image.md` & `tan-23.3.0/docs/usage_and_configuration/black_docker_image.md`

 * *Files 6% similar despite different names*

```diff
@@ -6,14 +6,19 @@
 _Black_ images with the following tags are available:
 
 - release numbers, e.g. `21.5b2`, `21.6b0`, `21.7b0` etc.\
   ℹ Recommended for users who want to use a particular version of _Black_.
 - `latest_release` - tag created when a new version of _Black_ is released.\
   ℹ Recommended for users who want to use released versions of _Black_. It maps to [the latest release](https://github.com/psf/black/releases/latest)
   of _Black_.
+- `latest_prerelease` - tag created when a new alpha (prerelease) version of _Black_ is
+  released.\
+  ℹ Recommended for users who want to preview or test alpha versions of _Black_. Note that
+  the most recent release may be newer than any prerelease, because no prereleases are created
+  before most releases.
 - `latest` - tag used for the newest image of _Black_.\
   ℹ Recommended for users who always want to use the latest version of _Black_, even before
   it is released.
 
 There is one more tag used for _Black_ Docker images - `latest_non_release`. It is
 created for all unreleased
 [commits on the `main` branch](https://github.com/psf/black/commits/main). This tag is
```

### Comparing `tan-22.8.0/docs/usage_and_configuration/file_collection_and_discovery.md` & `tan-23.3.0/docs/usage_and_configuration/file_collection_and_discovery.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/usage_and_configuration/index.md` & `tan-23.3.0/docs/usage_and_configuration/index.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/docs/usage_and_configuration/the_basics.md` & `tan-23.3.0/docs/usage_and_configuration/the_basics.md`

 * *Files 3% similar despite different names*

```diff
@@ -36,14 +36,17 @@
 
 ```{program-output} tan --help
 
 ```
 
 </details>
 
+Note that all command-line options listed above can also be configured using a
+`pyproject.toml` file (more on that below).
+
 ### Code input alternatives
 
 #### Standard Input
 
 _Black_ supports formatting code via stdin, with the result being printed to stdout.
 Just let _Black_ know with `-` as the path.
 
@@ -72,14 +75,16 @@
 
 By default _Black_ reformats the files given and/or found in place. Sometimes you need
 _Black_ to just tell you what it _would_ do without actually rewriting the Python files.
 
 There's two variations to this mode that are independently enabled by their respective
 flags. Both variations can be enabled at once.
 
+(labels/exit-code)=
+
 #### Exit code
 
 Passing `--check` will make _Black_ exit with:
 
 - code 0 if nothing would change;
 - code 1 if some files would be reformatted; or
 - code 123 if there was an internal error
@@ -169,15 +174,15 @@
 
 ### Versions
 
 You can check the version of _Black_ you have installed using the `--version` flag.
 
 ```console
 $ black --version
-black, version 22.8.0
+black, version 23.3.0
 ```
 
 An option to require a specific version to be running is also provided.
 
 ```console
 $ black --required-version 21.9b0 -c "format = 'this'"
 format = "this"
@@ -200,17 +205,18 @@
 "No". _Black_ is all about sensible defaults. Applying those defaults will have your
 code in compliance with many other _Black_ formatted projects.
 
 ### What on Earth is a `pyproject.toml` file?
 
 [PEP 518](https://www.python.org/dev/peps/pep-0518/) defines `pyproject.toml` as a
 configuration file to store build system requirements for Python projects. With the help
-of tools like [Poetry](https://python-poetry.org/) or
-[Flit](https://flit.readthedocs.io/en/latest/) it can fully replace the need for
-`setup.py` and `setup.cfg` files.
+of tools like [Poetry](https://python-poetry.org/),
+[Flit](https://flit.readthedocs.io/en/latest/), or
+[Hatch](https://hatch.pypa.io/latest/) it can fully replace the need for `setup.py` and
+`setup.cfg` files.
 
 ### Where _Black_ looks for the file
 
 By default _Black_ looks for `pyproject.toml` starting from the common base directory of
 all files and directories passed on the command line. If it's not there, it looks in
 parent directories. It stops looking when it finds the file, or a `.git` directory, or a
 `.hg` directory, or the root of the file system, whichever comes first.
@@ -280,17 +286,14 @@
 
 _Black_ will only ever use one `pyproject.toml` file during an entire run. It doesn't
 look for multiple files, and doesn't compose configuration from different levels of the
 file hierarchy.
 
 ## Next steps
 
-You've probably noted that not all of the options you can pass to _Black_ have been
-covered. Don't worry, the rest will be covered in a later section.
-
 A good next step would be configuring auto-discovery so `black .` is all you need
 instead of laborously listing every file or directory. You can get started by heading
 over to [File collection and discovery](./file_collection_and_discovery.md).
 
 Another good choice would be setting up an
 [integration with your editor](../integrations/editors.md) of choice or with
 [pre-commit for source version control](../integrations/source_version_control.md).
```

### Comparing `tan-22.8.0/gallery/README.md` & `tan-23.3.0/gallery/README.md`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/gallery/gallery.py` & `tan-23.3.0/gallery/gallery.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/mypy.ini` & `tan-23.3.0/mypy.ini`

 * *Files 8% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 [mypy]
 # Specify the target platform details in config, so your developers are
 # free to run mypy on Windows, Linux, or macOS and get consistent
 # results.
-python_version=3.6
+python_version=3.7
 
 mypy_path=src
 
 show_column_numbers=True
 show_error_codes=True
 
 # be strict
@@ -15,19 +15,14 @@
 # except for...
 no_implicit_reexport = False
 
 # Unreachable blocks have been an issue when compiling mypyc, let's try
 # to avoid 'em in the first place.
 warn_unreachable=True
 
-[mypy-black]
-# The following is because of `patch_click()`. Remove when
-# we drop Python 3.6 support.
-warn_unused_ignores=False
-
 [mypy-blib2to3.driver.*]
 ignore_missing_imports = True
 
 [mypy-IPython.*]
 ignore_missing_imports = True
 
 [mypy-colorama.*]
```

### Comparing `tan-22.8.0/plugin/black.vim` & `tan-23.3.0/plugin/black.vim`

 * *Files 16% similar despite different names*

```diff
@@ -59,14 +59,20 @@
 endif
 if !exists("g:black_quiet")
   let g:black_quiet = 0
 endif
 if !exists("g:black_target_version")
   let g:black_target_version = ""
 endif
+if !exists("g:black_use_virtualenv")
+  let g:black_use_virtualenv = 1
+endif
+if !exists("g:black_preview")
+  let g:black_preview = 0
+endif
 
 function BlackComplete(ArgLead, CmdLine, CursorPos)
   return [
 \    'target_version=py27',
 \    'target_version=py36',
 \    'target_version=py37',
 \    'target_version=py38',
```

### Comparing `tan-22.8.0/scripts/check_pre_commit_rev_in_example.py` & `tan-23.3.0/scripts/check_pre_commit_rev_in_example.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/scripts/check_version_in_basics_example.py` & `tan-23.3.0/scripts/check_version_in_basics_example.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/scripts/diff_shades_gha_helper.py` & `tan-23.3.0/scripts/diff_shades_gha_helper.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/scripts/fuzz.py` & `tan-23.3.0/scripts/fuzz.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/scripts/migrate-black.py` & `tan-23.3.0/scripts/migrate-black.py`

 * *Files 5% similar despite different names*

```diff
@@ -45,14 +45,15 @@
             b"--allow-empty" in run(["git", "apply", "-h"], stdout=PIPE).stdout
         )
         quiet = b"--quiet" in run(["git", "apply", "-h"], stdout=PIPE).stdout
         git_diff = Popen(
             [
                 "git",
                 "diff",
+                "--binary",
                 "--find-copies",
                 "%s-black..%s-black" % (last_commit, commit),
             ],
             stdout=PIPE,
         )
         git_apply = Popen(
             [
```

### Comparing `tan-22.8.0/src/black/__init__.py` & `tan-23.3.0/src/black/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -26,14 +26,15 @@
     Tuple,
     Union,
 )
 
 import click
 from click.core import ParameterSource
 from mypy_extensions import mypyc_attr
+from pathspec import PathSpec
 from pathspec.patterns.gitwildmatch import GitWildMatchPatternError
 
 from _black_version import version as __version__
 from black.cache import Cache, get_cache_info, read_cache, write_cache
 from black.comments import normalize_fmt_off
 from black.const import (
     DEFAULT_EXCLUDES,
@@ -57,15 +58,15 @@
     jupyter_dependencies_are_installed,
     mask_cell,
     put_trailing_semicolon_back,
     remove_trailing_semicolon,
     unmask_cell,
 )
 from black.linegen import LN, LineGenerator, transform_line
-from black.lines import EmptyLineTracker, Line
+from black.lines import EmptyLineTracker, LinesBlock
 from black.mode import (
     FUTURE_FLAG_TO_FEATURE,
     VERSION_TO_FEATURES,
     Feature,
     Mode,
     TargetVersion,
     supports_feature,
@@ -214,16 +215,17 @@
 @click.option(
     "-t",
     "--target-version",
     type=click.Choice([v.name.lower() for v in TargetVersion]),
     callback=target_version_option_callback,
     multiple=True,
     help=(
-        "Python versions that should be supported by Black's output. [default: per-file"
-        " auto-detection]"
+        "Python versions that should be supported by Black's output. By default, Black"
+        " will try to infer this from the project metadata in pyproject.toml. If this"
+        " does not yield conclusive results, Black will use per-file auto-detection."
     ),
 )
 @click.option(
     "--pyi",
     is_flag=True,
     help=(
         "Format all input files like typing stubs regardless of file extension (useful"
@@ -239,20 +241,26 @@
     ),
 )
 @click.option(
     "--python-cell-magics",
     multiple=True,
     help=(
         "When processing Jupyter Notebooks, add the given magic to the list"
-        f" of known python-magics ({', '.join(PYTHON_CELL_MAGICS)})."
+        f" of known python-magics ({', '.join(sorted(PYTHON_CELL_MAGICS))})."
         " Useful for formatting cells with custom python magics."
     ),
     default=[],
 )
 @click.option(
+    "-x",
+    "--skip-source-first-line",
+    is_flag=True,
+    help="Skip the first line of the source code.",
+)
+@click.option(
     "-S",
     "--skip-string-normalization",
     is_flag=True,
     help="Don't normalize string quotes or prefixes.",
 )
 @click.option(
     "-C",
@@ -431,14 +439,15 @@
     check: bool,
     diff: bool,
     color: bool,
     fast: bool,
     pyi: bool,
     ipynb: bool,
     python_cell_magics: Sequence[str],
+    skip_source_first_line: bool,
     skip_string_normalization: bool,
     skip_magic_trailing_comma: bool,
     experimental_string_processing: bool,
     preview: bool,
     use_tabs: bool,
     quiet: bool,
     verbose: bool,
@@ -474,45 +483,54 @@
         if root:
             out(
                 f"Identified `{root}` as project root containing a {method}.",
                 fg="blue",
             )
 
             normalized = [
-                (source, source)
-                if source == "-"
-                else (normalize_path_maybe_ignore(Path(source), root), source)
+                (
+                    (source, source)
+                    if source == "-"
+                    else (normalize_path_maybe_ignore(Path(source), root), source)
+                )
                 for source in src
             ]
             srcs_string = ", ".join(
                 [
-                    f'"{_norm}"'
-                    if _norm
-                    else f'\033[31m"{source} (skipping - invalid)"\033[34m'
+                    (
+                        f'"{_norm}"'
+                        if _norm
+                        else f'\033[31m"{source} (skipping - invalid)"\033[34m'
+                    )
                     for _norm, source in normalized
                 ]
             )
             out(f"Sources to be formatted: {srcs_string}", fg="blue")
 
         if config:
             config_source = ctx.get_parameter_source("config")
             user_level_config = str(find_user_pyproject_toml())
             if config == user_level_config:
                 out(
-                    "Using configuration from user-level config at "
-                    f"'{user_level_config}'.",
+                    (
+                        "Using configuration from user-level config at "
+                        f"'{user_level_config}'."
+                    ),
                     fg="blue",
                 )
             elif config_source in (
                 ParameterSource.DEFAULT,
                 ParameterSource.DEFAULT_MAP,
             ):
                 out("Using configuration from project root.", fg="blue")
             else:
                 out(f"Using configuration in '{config}'.", fg="blue")
+            if ctx.default_map:
+                for param, value in ctx.default_map.items():
+                    out(f"{param}: {value}")
 
     error_msg = "Oh no! 💥 💔 💥"
     if (
         required_version
         and required_version != __version__
         and required_version != __version__.split(".")[0]
     ):
@@ -532,14 +550,15 @@
         # We'll autodetect later.
         versions = set()
     mode = Mode(
         target_versions=versions,
         line_length=line_length,
         is_pyi=pyi,
         is_ipynb=ipynb,
+        skip_source_first_line=skip_source_first_line,
         string_normalization=not skip_string_normalization,
         magic_trailing_comma=not skip_magic_trailing_comma,
         experimental_string_processing=experimental_string_processing,
         preview=preview,
         python_cell_magics=set(python_cell_magics),
         use_tabs=use_tabs,
     )
@@ -622,14 +641,19 @@
     report: "Report",
     stdin_filename: Optional[str],
 ) -> Set[Path]:
     """Compute the set of files to be formatted."""
     sources: Set[Path] = set()
     root = ctx.obj["root"]
 
+    using_default_exclude = exclude is None
+    exclude = re_compile_maybe_verbose(DEFAULT_EXCLUDES) if exclude is None else exclude
+    gitignore: Optional[Dict[Path, PathSpec]] = None
+    root_gitignore = get_gitignore(root)
+
     for s in src:
         if s == "-" and stdin_filename:
             p = Path(stdin_filename)
             is_stdin = True
         else:
             p = Path(s)
             is_stdin = False
@@ -655,24 +679,20 @@
             if p.suffix == ".ipynb" and not jupyter_dependencies_are_installed(
                 verbose=verbose, quiet=quiet
             ):
                 continue
 
             sources.add(p)
         elif p.is_dir():
-            if exclude is None:
-                exclude = re_compile_maybe_verbose(DEFAULT_EXCLUDES)
-                gitignore = get_gitignore(root)
-                p_gitignore = get_gitignore(p)
-                # No need to use p's gitignore if it is identical to root's gitignore
-                # (i.e. root and p point to the same directory).
-                if gitignore != p_gitignore:
-                    gitignore += p_gitignore
-            else:
-                gitignore = None
+            p = root / normalize_path_maybe_ignore(p, ctx.obj["root"], report)
+            if using_default_exclude:
+                gitignore = {
+                    root: root_gitignore,
+                    p: get_gitignore(p),
+                }
             sources.update(
                 gen_python_files(
                     p.iterdir(),
                     ctx.obj["root"],
                     include,
                     exclude,
                     extend_exclude,
@@ -795,24 +815,29 @@
     """
     if src.suffix == ".pyi":
         mode = replace(mode, is_pyi=True)
     elif src.suffix == ".ipynb":
         mode = replace(mode, is_ipynb=True)
 
     then = datetime.utcfromtimestamp(src.stat().st_mtime)
+    header = b""
     with open(src, "rb") as buf:
+        if mode.skip_source_first_line:
+            header = buf.readline()
         src_contents, encoding, newline = decode_bytes(buf.read())
     try:
         dst_contents = format_file_contents(src_contents, fast=fast, mode=mode)
     except NothingChanged:
         return False
     except JSONDecodeError:
         raise ValueError(
             f"File '{src}' cannot be parsed as valid Jupyter notebook."
         ) from None
+    src_contents = header.decode(encoding) + src_contents
+    dst_contents = header.decode(encoding) + dst_contents
 
     if write_back == WriteBack.YES:
         with open(src, "w", encoding=encoding, newline=newline) as f:
             f.write(dst_contents)
     elif write_back in (WriteBack.DIFF, WriteBack.COLOR_DIFF):
         now = datetime.utcnow()
         src_name = f"{src}\t{then} +0000"
@@ -906,17 +931,14 @@
 def format_file_contents(src_contents: str, *, fast: bool, mode: Mode) -> FileContent:
     """Reformat contents of a file and return new contents.
 
     If `fast` is False, additionally confirm that the reformatted code is
     valid by calling :func:`assert_equivalent` and :func:`assert_stable` on it.
     `mode` is passed to :func:`format_str`.
     """
-    if not src_contents.strip():
-        raise NothingChanged
-
     if mode.is_ipynb:
         dst_contents = format_ipynb_string(src_contents, fast=fast, mode=mode)
     else:
         dst_contents = format_str(src_contents, mode=mode)
     if src_contents == dst_contents:
         raise NothingChanged
 
@@ -1003,14 +1025,17 @@
 
 def format_ipynb_string(src_contents: str, *, fast: bool, mode: Mode) -> FileContent:
     """Format Jupyter notebook.
 
     Operate cell-by-cell, only on code cells, only for Python notebooks.
     If the ``.ipynb`` originally had a trailing newline, it'll be preserved.
     """
+    if not src_contents:
+        raise NothingChanged
+
     trailing_newline = src_contents[-1] == "\n"
     modified = False
     nb = json.loads(src_contents)
     validate_metadata(nb)
     for cell in nb["cells"]:
         if cell.get("cell_type", None) == "code":
             try:
@@ -1067,39 +1092,54 @@
     if src_contents != dst_contents:
         return _format_str_once(dst_contents, mode=mode)
     return dst_contents
 
 
 def _format_str_once(src_contents: str, *, mode: Mode) -> str:
     src_node = lib2to3_parse(src_contents.lstrip(), mode.target_versions)
-    dst_contents = []
+    dst_blocks: List[LinesBlock] = []
     if mode.target_versions:
         versions = mode.target_versions
     else:
         future_imports = get_future_imports(src_node)
         versions = detect_target_versions(src_node, future_imports=future_imports)
 
-    normalize_fmt_off(src_node, preview=mode.preview)
-    lines = LineGenerator(mode=mode)
-    elt = EmptyLineTracker(is_pyi=mode.is_pyi)
-    empty_line = Line(mode=mode)
-    after = 0
+    context_manager_features = {
+        feature
+        for feature in {Feature.PARENTHESIZED_CONTEXT_MANAGERS}
+        if supports_feature(versions, feature)
+    }
+    normalize_fmt_off(src_node)
+    lines = LineGenerator(mode=mode, features=context_manager_features)
+    elt = EmptyLineTracker(mode=mode)
     split_line_features = {
         feature
         for feature in {Feature.TRAILING_COMMA_IN_CALL, Feature.TRAILING_COMMA_IN_DEF}
         if supports_feature(versions, feature)
     }
+    block: Optional[LinesBlock] = None
     for current_line in lines.visit(src_node):
-        dst_contents.append(str(empty_line) * after)
-        before, after = elt.maybe_empty_lines(current_line)
-        dst_contents.append(str(empty_line) * before)
+        block = elt.maybe_empty_lines(current_line)
+        dst_blocks.append(block)
         for line in transform_line(
             current_line, mode=mode, features=split_line_features
         ):
-            dst_contents.append(str(line))
+            block.content_lines.append(str(line))
+    if dst_blocks:
+        dst_blocks[-1].after = 0
+    dst_contents = []
+    for block in dst_blocks:
+        dst_contents.extend(block.all_lines())
+    if not dst_contents:
+        # Use decode_bytes to retrieve the correct source newline (CRLF or LF),
+        # and check if normalized_content has more than one line
+        normalized_content, _, newline = decode_bytes(src_contents.encode("utf-8"))
+        if "\n" in normalized_content:
+            return newline
+        return ""
     return "".join(dst_contents)
 
 
 def decode_bytes(src: bytes) -> Tuple[FileContent, Encoding, NewLine]:
     """Return a tuple of (decoded_contents, encoding, newline).
 
     `newline` is either CRLF or LF but `decoded_contents` is decoded with
@@ -1127,14 +1167,18 @@
     - underscores in numeric literals;
     - trailing commas after * or ** in function signatures and calls;
     - positional only arguments in function signatures and lambdas;
     - assignment expression;
     - relaxed decorator syntax;
     - usage of __future__ flags (annotations);
     - print / exec statements;
+    - parenthesized context managers;
+    - match statements;
+    - except* clause;
+    - variadic generics;
     """
     features: Set[Feature] = set()
     if future_imports:
         features |= {
             FUTURE_FLAG_TO_FEATURE[future_import]
             for future_import in future_imports
             if future_import in FUTURE_FLAG_TO_FEATURE
@@ -1203,14 +1247,31 @@
             n.type == syms.annassign
             and len(n.children) >= 4
             and n.children[3].type == syms.testlist_star_expr
         ):
             features.add(Feature.ANN_ASSIGN_EXTENDED_RHS)
 
         elif (
+            n.type == syms.with_stmt
+            and len(n.children) > 2
+            and n.children[1].type == syms.atom
+        ):
+            atom_children = n.children[1].children
+            if (
+                len(atom_children) == 3
+                and atom_children[0].type == token.LPAR
+                and atom_children[1].type == syms.testlist_gexp
+                and atom_children[2].type == token.RPAR
+            ):
+                features.add(Feature.PARENTHESIZED_CONTEXT_MANAGERS)
+
+        elif n.type == syms.match_stmt:
+            features.add(Feature.PATTERN_MATCHING)
+
+        elif (
             n.type == syms.except_clause
             and len(n.children) >= 2
             and n.children[1].type == token.STAR
         ):
             features.add(Feature.EXCEPT_STAR)
 
         elif n.type in {syms.subscriptlist, syms.trailer} and any(
@@ -1374,21 +1435,23 @@
     except ImportError:
         pass
     else:
         modules.append(_unicodefun)
 
     for module in modules:
         if hasattr(module, "_verify_python3_env"):
-            module._verify_python3_env = lambda: None  # type: ignore
+            module._verify_python3_env = lambda: None
         if hasattr(module, "_verify_python_env"):
-            module._verify_python_env = lambda: None  # type: ignore
+            module._verify_python_env = lambda: None
 
 
 def patched_main() -> None:
-    if sys.platform == "win32" and getattr(sys, "frozen", False):
+    # PyInstaller patches multiprocessing to need freeze_support() even in non-Windows
+    # environments so just assume we always need to call it if frozen.
+    if getattr(sys, "frozen", False):
         from multiprocessing import freeze_support
 
         freeze_support()
 
     patch_click()
     main()
```

### Comparing `tan-22.8.0/src/black/brackets.py` & `tan-23.3.0/src/black/brackets.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 """Builds on top of nodes.py to track brackets."""
 
 import sys
 from dataclasses import dataclass, field
-from typing import Dict, Iterable, List, Optional, Tuple, Union
+from typing import Dict, Iterable, List, Optional, Sequence, Set, Tuple, Union
 
 if sys.version_info < (3, 8):
     from typing_extensions import Final
 else:
     from typing import Final
 
 from black.nodes import (
@@ -76,25 +76,35 @@
     def mark(self, leaf: Leaf) -> None:
         """Mark `leaf` with bracket-related metadata. Keep track of delimiters.
 
         All leaves receive an int `bracket_depth` field that stores how deep
         within brackets a given leaf is. 0 means there are no enclosing brackets
         that started on this line.
 
-        If a leaf is itself a closing bracket, it receives an `opening_bracket`
-        field that it forms a pair with. This is a one-directional link to
-        avoid reference cycles.
+        If a leaf is itself a closing bracket and there is a matching opening
+        bracket earlier, it receives an `opening_bracket` field with which it forms a
+        pair. This is a one-directional link to avoid reference cycles. Closing
+        bracket without opening happens on lines continued from previous
+        breaks, e.g. `) -> "ReturnType":` as part of a funcdef where we place
+        the return type annotation on its own line of the previous closing RPAR.
 
         If a leaf is a delimiter (a token on which Black can split the line if
         needed) and it's on depth 0, its `id()` is stored in the tracker's
         `delimiters` field.
         """
         if leaf.type == token.COMMENT:
             return
 
+        if (
+            self.depth == 0
+            and leaf.type in CLOSING_BRACKETS
+            and (self.depth, leaf.type) not in self.bracket_match
+        ):
+            return
+
         self.maybe_decrement_after_for_loop_variable(leaf)
         self.maybe_decrement_after_lambda_arguments(leaf)
         if leaf.type in CLOSING_BRACKETS:
             self.depth -= 1
             try:
                 opening_bracket = self.bracket_match.pop((self.depth, leaf.type))
             except KeyError as e:
@@ -336,7 +346,36 @@
             for leaf in c.leaves():
                 bt.mark(leaf)
     try:
         return bt.max_delimiter_priority()
 
     except ValueError:
         return 0
+
+
+def get_leaves_inside_matching_brackets(leaves: Sequence[Leaf]) -> Set[LeafID]:
+    """Return leaves that are inside matching brackets.
+
+    The input `leaves` can have non-matching brackets at the head or tail parts.
+    Matching brackets are included.
+    """
+    try:
+        # Start with the first opening bracket and ignore closing brackets before.
+        start_index = next(
+            i for i, l in enumerate(leaves) if l.type in OPENING_BRACKETS
+        )
+    except StopIteration:
+        return set()
+    bracket_stack = []
+    ids = set()
+    for i in range(start_index, len(leaves)):
+        leaf = leaves[i]
+        if leaf.type in OPENING_BRACKETS:
+            bracket_stack.append((BRACKET[leaf.type], i))
+        if leaf.type in CLOSING_BRACKETS:
+            if bracket_stack and leaf.type == bracket_stack[-1][0]:
+                _, start = bracket_stack.pop()
+                for j in range(start, i + 1):
+                    ids.add(id(leaves[j]))
+            else:
+                break
+    return ids
```

### Comparing `tan-22.8.0/src/black/cache.py` & `tan-23.3.0/src/black/cache.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/black/comments.py` & `tan-23.3.0/src/black/comments.py`

 * *Files 5% similar despite different names*

```diff
@@ -10,29 +10,30 @@
     from typing_extensions import Final
 
 from black.nodes import (
     CLOSING_BRACKETS,
     STANDALONE_COMMENT,
     WHITESPACE,
     container_of,
-    first_leaf_column,
+    first_leaf_of,
     preceding_leaf,
+    syms,
 )
 from blib2to3.pgen2 import token
-from blib2to3.pytree import Leaf, Node, type_repr
+from blib2to3.pytree import Leaf, Node
 
 # types
 LN = Union[Leaf, Node]
 
 FMT_OFF: Final = {"# fmt: off", "# fmt:off", "# yapf: disable"}
 FMT_SKIP: Final = {"# fmt: skip", "# fmt:skip"}
 FMT_PASS: Final = {*FMT_OFF, *FMT_SKIP}
 FMT_ON: Final = {"# fmt: on", "# fmt:on", "# yapf: enable"}
 
-COMMENT_EXCEPTIONS = {True: " !:#'", False: " !:#'%"}
+COMMENT_EXCEPTIONS = " !:#'"
 
 
 @dataclass
 class ProtoComment:
     """Describes a piece of syntax that is a comment.
 
     It's not a :class:`blib2to3.pytree.Leaf` so that:
@@ -45,15 +46,15 @@
 
     type: int  # token.COMMENT or STANDALONE_COMMENT
     value: str  # content of the comment
     newlines: int  # how many newlines before the comment
     consumed: int  # how many characters of the original leaf's prefix did we consume
 
 
-def generate_comments(leaf: LN, *, preview: bool) -> Iterator[Leaf]:
+def generate_comments(leaf: LN) -> Iterator[Leaf]:
     """Clean the prefix of the `leaf` and generate comments from it, if any.
 
     Comments in lib2to3 are shoved into the whitespace prefix.  This happens
     in `pgen2/driver.py:Driver.parse_tokens()`.  This was a brilliant implementation
     move because it does away with modifying the grammar to include all the
     possible places in which comments can be placed.
 
@@ -64,24 +65,20 @@
     No matter though, we can live without this.  We really only need to
     differentiate between inline and standalone comments.  The latter don't
     share the line with any code.
 
     Inline comments are emitted as regular token.COMMENT leaves.  Standalone
     are emitted with a fake STANDALONE_COMMENT token identifier.
     """
-    for pc in list_comments(
-        leaf.prefix, is_endmarker=leaf.type == token.ENDMARKER, preview=preview
-    ):
+    for pc in list_comments(leaf.prefix, is_endmarker=leaf.type == token.ENDMARKER):
         yield Leaf(pc.type, pc.value, prefix="\n" * pc.newlines)
 
 
 @lru_cache(maxsize=4096)
-def list_comments(
-    prefix: str, *, is_endmarker: bool, preview: bool
-) -> List[ProtoComment]:
+def list_comments(prefix: str, *, is_endmarker: bool) -> List[ProtoComment]:
     """Return a list of :class:`ProtoComment` objects parsed from the given `prefix`."""
     result: List[ProtoComment] = []
     if not prefix or "#" not in prefix:
         return result
 
     consumed = 0
     nlines = 0
@@ -99,25 +96,25 @@
                 ignored_lines += 1
             continue
 
         if index == ignored_lines and not is_endmarker:
             comment_type = token.COMMENT  # simple trailing comment
         else:
             comment_type = STANDALONE_COMMENT
-        comment = make_comment(line, preview=preview)
+        comment = make_comment(line)
         result.append(
             ProtoComment(
                 type=comment_type, value=comment, newlines=nlines, consumed=consumed
             )
         )
         nlines = 0
     return result
 
 
-def make_comment(content: str, *, preview: bool) -> str:
+def make_comment(content: str) -> str:
     """Return a consistently formatted comment from the given `content` string.
 
     All comments (except for "##", "#!", "#:", '#'") should have a single
     space between the hash sign and the content.
 
     If `content` didn't start with a hash sign, one is provided.
     """
@@ -130,49 +127,49 @@
     NON_BREAKING_SPACE = " "
     if (
         content
         and content[0] == NON_BREAKING_SPACE
         and not content.lstrip().startswith("type:")
     ):
         content = " " + content[1:]  # Replace NBSP by a simple space
-    if content and content[0] not in COMMENT_EXCEPTIONS[preview]:
+    if content and content[0] not in COMMENT_EXCEPTIONS:
         content = " " + content
     return "#" + content
 
 
-def normalize_fmt_off(node: Node, *, preview: bool) -> None:
+def normalize_fmt_off(node: Node) -> None:
     """Convert content between `# fmt: off`/`# fmt: on` into standalone comments."""
     try_again = True
     while try_again:
-        try_again = convert_one_fmt_off_pair(node, preview=preview)
+        try_again = convert_one_fmt_off_pair(node)
 
 
-def convert_one_fmt_off_pair(node: Node, *, preview: bool) -> bool:
+def convert_one_fmt_off_pair(node: Node) -> bool:
     """Convert content of a single `# fmt: off`/`# fmt: on` into a standalone comment.
 
     Returns True if a pair was converted.
     """
     for leaf in node.leaves():
         previous_consumed = 0
-        for comment in list_comments(leaf.prefix, is_endmarker=False, preview=preview):
+        for comment in list_comments(leaf.prefix, is_endmarker=False):
             if comment.value not in FMT_PASS:
                 previous_consumed = comment.consumed
                 continue
             # We only want standalone comments. If there's no previous leaf or
             # the previous leaf is indentation, it's a standalone comment in
             # disguise.
             if comment.value in FMT_PASS and comment.type != STANDALONE_COMMENT:
                 prev = preceding_leaf(leaf)
                 if prev:
                     if comment.value in FMT_OFF and prev.type not in WHITESPACE:
                         continue
                     if comment.value in FMT_SKIP and prev.type in WHITESPACE:
                         continue
 
-            ignored_nodes = list(generate_ignored_nodes(leaf, comment, preview=preview))
+            ignored_nodes = list(generate_ignored_nodes(leaf, comment))
             if not ignored_nodes:
                 continue
 
             first = ignored_nodes[0]  # Can be a container node with the `leaf`.
             parent = first.parent
             prefix = first.prefix
             if comment.value in FMT_OFF:
@@ -202,125 +199,128 @@
             assert first_idx is not None, "INTERNAL ERROR: fmt: on/off handling (2)"
             parent.insert_child(
                 first_idx,
                 Leaf(
                     STANDALONE_COMMENT,
                     hidden_value,
                     prefix=standalone_comment_prefix,
+                    fmt_pass_converted_first_leaf=first_leaf_of(first),
                 ),
             )
             return True
 
     return False
 
 
-def generate_ignored_nodes(
-    leaf: Leaf, comment: ProtoComment, *, preview: bool
-) -> Iterator[LN]:
+def generate_ignored_nodes(leaf: Leaf, comment: ProtoComment) -> Iterator[LN]:
     """Starting from the container of `leaf`, generate all leaves until `# fmt: on`.
 
     If comment is skip, returns leaf only.
     Stops at the end of the block.
     """
     if comment.value in FMT_SKIP:
-        yield from _generate_ignored_nodes_from_fmt_skip(leaf, comment, preview=preview)
+        yield from _generate_ignored_nodes_from_fmt_skip(leaf, comment)
         return
     container: Optional[LN] = container_of(leaf)
     while container is not None and container.type != token.ENDMARKER:
-        if is_fmt_on(container, preview=preview):
+        if is_fmt_on(container):
             return
 
         # fix for fmt: on in children
-        if contains_fmt_on_at_column(container, leaf.column, preview=preview):
-            for child in container.children:
-                if isinstance(child, Leaf) and is_fmt_on(child, preview=preview):
+        if children_contains_fmt_on(container):
+            for index, child in enumerate(container.children):
+                if isinstance(child, Leaf) and is_fmt_on(child):
                     if child.type in CLOSING_BRACKETS:
                         # This means `# fmt: on` is placed at a different bracket level
                         # than `# fmt: off`. This is an invalid use, but as a courtesy,
                         # we include this closing bracket in the ignored nodes.
                         # The alternative is to fail the formatting.
                         yield child
                     return
-                if contains_fmt_on_at_column(child, leaf.column, preview=preview):
+                if (
+                    child.type == token.INDENT
+                    and index < len(container.children) - 1
+                    and children_contains_fmt_on(container.children[index + 1])
+                ):
+                    # This means `# fmt: on` is placed right after an indentation
+                    # level, and we shouldn't swallow the previous INDENT token.
+                    return
+                if children_contains_fmt_on(child):
                     return
                 yield child
         else:
+            if container.type == token.DEDENT and container.next_sibling is None:
+                # This can happen when there is no matching `# fmt: on` comment at the
+                # same level as `# fmt: on`. We need to keep this DEDENT.
+                return
             yield container
             container = container.next_sibling
 
 
 def _generate_ignored_nodes_from_fmt_skip(
-    leaf: Leaf, comment: ProtoComment, *, preview: bool
+    leaf: Leaf, comment: ProtoComment
 ) -> Iterator[LN]:
     """Generate all leaves that should be ignored by the `# fmt: skip` from `leaf`."""
     prev_sibling = leaf.prev_sibling
     parent = leaf.parent
     # Need to properly format the leaf prefix to compare it to comment.value,
     # which is also formatted
-    comments = list_comments(leaf.prefix, is_endmarker=False, preview=preview)
+    comments = list_comments(leaf.prefix, is_endmarker=False)
     if not comments or comment.value != comments[0].value:
         return
     if prev_sibling is not None:
         leaf.prefix = ""
         siblings = [prev_sibling]
         while "\n" not in prev_sibling.prefix and prev_sibling.prev_sibling is not None:
             prev_sibling = prev_sibling.prev_sibling
             siblings.insert(0, prev_sibling)
-        for sibling in siblings:
-            yield sibling
+        yield from siblings
     elif (
-        parent is not None
-        and type_repr(parent.type) == "suite"
-        and leaf.type == token.NEWLINE
+        parent is not None and parent.type == syms.suite and leaf.type == token.NEWLINE
     ):
         # The `# fmt: skip` is on the colon line of the if/while/def/class/...
         # statements. The ignored nodes should be previous siblings of the
         # parent suite node.
         leaf.prefix = ""
         ignored_nodes: List[LN] = []
         parent_sibling = parent.prev_sibling
-        while parent_sibling is not None and type_repr(parent_sibling.type) != "suite":
+        while parent_sibling is not None and parent_sibling.type != syms.suite:
             ignored_nodes.insert(0, parent_sibling)
             parent_sibling = parent_sibling.prev_sibling
         # Special case for `async_stmt` where the ASYNC token is on the
         # grandparent node.
         grandparent = parent.parent
         if (
             grandparent is not None
             and grandparent.prev_sibling is not None
             and grandparent.prev_sibling.type == token.ASYNC
         ):
             ignored_nodes.insert(0, grandparent.prev_sibling)
         yield from iter(ignored_nodes)
 
 
-def is_fmt_on(container: LN, preview: bool) -> bool:
+def is_fmt_on(container: LN) -> bool:
     """Determine whether formatting is switched on within a container.
     Determined by whether the last `# fmt:` comment is `on` or `off`.
     """
     fmt_on = False
-    for comment in list_comments(container.prefix, is_endmarker=False, preview=preview):
+    for comment in list_comments(container.prefix, is_endmarker=False):
         if comment.value in FMT_ON:
             fmt_on = True
         elif comment.value in FMT_OFF:
             fmt_on = False
     return fmt_on
 
 
-def contains_fmt_on_at_column(container: LN, column: int, *, preview: bool) -> bool:
-    """Determine if children at a given column have formatting switched on."""
+def children_contains_fmt_on(container: LN) -> bool:
+    """Determine if children have formatting switched on."""
     for child in container.children:
-        if (
-            isinstance(child, Node)
-            and first_leaf_column(child) == column
-            or isinstance(child, Leaf)
-            and child.column == column
-        ):
-            if is_fmt_on(child, preview=preview):
-                return True
+        leaf = first_leaf_of(child)
+        if leaf is not None and is_fmt_on(leaf):
+            return True
 
     return False
 
 
 def contains_pragma_comment(comment_list: List[Leaf]) -> bool:
     """
     Returns:
```

### Comparing `tan-22.8.0/src/black/concurrency.py` & `tan-23.3.0/src/black/concurrency.py`

 * *Files 5% similar despite different names*

```diff
@@ -43,31 +43,22 @@
     for task in tasks:
         task.cancel()
 
 
 def shutdown(loop: asyncio.AbstractEventLoop) -> None:
     """Cancel all pending tasks on `loop`, wait for them, and close the loop."""
     try:
-        if sys.version_info[:2] >= (3, 7):
-            all_tasks = asyncio.all_tasks
-        else:
-            all_tasks = asyncio.Task.all_tasks
         # This part is borrowed from asyncio/runners.py in Python 3.7b2.
-        to_cancel = [task for task in all_tasks(loop) if not task.done()]
+        to_cancel = [task for task in asyncio.all_tasks(loop) if not task.done()]
         if not to_cancel:
             return
 
         for task in to_cancel:
             task.cancel()
-        if sys.version_info >= (3, 7):
-            loop.run_until_complete(asyncio.gather(*to_cancel, return_exceptions=True))
-        else:
-            loop.run_until_complete(
-                asyncio.gather(*to_cancel, loop=loop, return_exceptions=True)
-            )
+        loop.run_until_complete(asyncio.gather(*to_cancel, return_exceptions=True))
     finally:
         # `concurrent.futures.Future` objects cannot be cancelled once they
         # are already running. There might be some when the `shutdown()` happened.
         # Silence their logger's spew about the event loop being closed.
         cf_logger = logging.getLogger("concurrent.futures")
         cf_logger.setLevel(logging.CRITICAL)
         loop.close()
@@ -187,13 +178,10 @@
                 # well-formatted, store this information in the cache.
                 if write_back is WriteBack.YES or (
                     write_back is WriteBack.CHECK and changed is Changed.NO
                 ):
                     sources_to_cache.append(src)
                 report.done(src, changed)
     if cancelled:
-        if sys.version_info >= (3, 7):
-            await asyncio.gather(*cancelled, return_exceptions=True)
-        else:
-            await asyncio.gather(*cancelled, loop=loop, return_exceptions=True)
+        await asyncio.gather(*cancelled, return_exceptions=True)
     if sources_to_cache:
         write_cache(cache, sources_to_cache, mode)
```

### Comparing `tan-22.8.0/src/black/debug.py` & `tan-23.3.0/src/black/debug.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/black/files.py` & `tan-23.3.0/src/black/files.py`

 * *Files 22% similar despite different names*

```diff
@@ -14,27 +14,31 @@
     Pattern,
     Sequence,
     Tuple,
     Union,
 )
 
 from mypy_extensions import mypyc_attr
+from packaging.specifiers import InvalidSpecifier, Specifier, SpecifierSet
+from packaging.version import InvalidVersion, Version
 from pathspec import PathSpec
 from pathspec.patterns.gitwildmatch import GitWildMatchPatternError
 
 if sys.version_info >= (3, 11):
     try:
         import tomllib
     except ImportError:
         # Help users on older alphas
-        import tomli as tomllib
+        if not TYPE_CHECKING:
+            import tomli as tomllib
 else:
     import tomli as tomllib
 
 from black.handle_ipynb_magics import jupyter_dependencies_are_installed
+from black.mode import TargetVersion
 from black.output import err
 from black.report import Report
 
 if TYPE_CHECKING:
     import colorama  # noqa: F401
 
 
@@ -103,22 +107,111 @@
         # We do not have access to the user-level config directory, so ignore it.
         err(f"Ignoring user configuration directory due to {e!r}")
         return None
 
 
 @mypyc_attr(patchable=True)
 def parse_pyproject_toml(path_config: str) -> Dict[str, Any]:
-    """Parse a pyproject toml file, pulling out relevant parts for Black
+    """Parse a pyproject toml file, pulling out relevant parts for Black.
 
-    If parsing fails, will raise a tomllib.TOMLDecodeError
+    If parsing fails, will raise a tomllib.TOMLDecodeError.
     """
     with open(path_config, "rb") as f:
         pyproject_toml = tomllib.load(f)
-    config = pyproject_toml.get("tool", {}).get("black", {})
-    return {k.replace("--", "").replace("-", "_"): v for k, v in config.items()}
+    config: Dict[str, Any] = pyproject_toml.get("tool", {}).get("black", {})
+    config = {k.replace("--", "").replace("-", "_"): v for k, v in config.items()}
+
+    if "target_version" not in config:
+        inferred_target_version = infer_target_version(pyproject_toml)
+        if inferred_target_version is not None:
+            config["target_version"] = [v.name.lower() for v in inferred_target_version]
+
+    return config
+
+
+def infer_target_version(
+    pyproject_toml: Dict[str, Any]
+) -> Optional[List[TargetVersion]]:
+    """Infer Black's target version from the project metadata in pyproject.toml.
+
+    Supports the PyPA standard format (PEP 621):
+    https://packaging.python.org/en/latest/specifications/declaring-project-metadata/#requires-python
+
+    If the target version cannot be inferred, returns None.
+    """
+    project_metadata = pyproject_toml.get("project", {})
+    requires_python = project_metadata.get("requires-python", None)
+    if requires_python is not None:
+        try:
+            return parse_req_python_version(requires_python)
+        except InvalidVersion:
+            pass
+        try:
+            return parse_req_python_specifier(requires_python)
+        except (InvalidSpecifier, InvalidVersion):
+            pass
+
+    return None
+
+
+def parse_req_python_version(requires_python: str) -> Optional[List[TargetVersion]]:
+    """Parse a version string (i.e. ``"3.7"``) to a list of TargetVersion.
+
+    If parsing fails, will raise a packaging.version.InvalidVersion error.
+    If the parsed version cannot be mapped to a valid TargetVersion, returns None.
+    """
+    version = Version(requires_python)
+    if version.release[0] != 3:
+        return None
+    try:
+        return [TargetVersion(version.release[1])]
+    except (IndexError, ValueError):
+        return None
+
+
+def parse_req_python_specifier(requires_python: str) -> Optional[List[TargetVersion]]:
+    """Parse a specifier string (i.e. ``">=3.7,<3.10"``) to a list of TargetVersion.
+
+    If parsing fails, will raise a packaging.specifiers.InvalidSpecifier error.
+    If the parsed specifier cannot be mapped to a valid TargetVersion, returns None.
+    """
+    specifier_set = strip_specifier_set(SpecifierSet(requires_python))
+    if not specifier_set:
+        return None
+
+    target_version_map = {f"3.{v.value}": v for v in TargetVersion}
+    compatible_versions: List[str] = list(specifier_set.filter(target_version_map))
+    if compatible_versions:
+        return [target_version_map[v] for v in compatible_versions]
+    return None
+
+
+def strip_specifier_set(specifier_set: SpecifierSet) -> SpecifierSet:
+    """Strip minor versions for some specifiers in the specifier set.
+
+    For background on version specifiers, see PEP 440:
+    https://peps.python.org/pep-0440/#version-specifiers
+    """
+    specifiers = []
+    for s in specifier_set:
+        if "*" in str(s):
+            specifiers.append(s)
+        elif s.operator in ["~=", "==", ">=", "==="]:
+            version = Version(s.version)
+            stripped = Specifier(f"{s.operator}{version.major}.{version.minor}")
+            specifiers.append(stripped)
+        elif s.operator == ">":
+            version = Version(s.version)
+            if len(version.release) > 2:
+                s = Specifier(f">={version.major}.{version.minor}")
+            specifiers.append(s)
+        else:
+            specifiers.append(s)
+
+    return SpecifierSet(",".join(str(s) for s in specifiers))
 
 
 @lru_cache()
 def find_user_pyproject_toml() -> Path:
     r"""Return the path to the top-level user configuration for black.
 
     This looks for ~\.black on Windows and ~/.config/black on Linux and other
@@ -177,14 +270,27 @@
         if report:
             report.path_ignored(path, f"cannot be read because {e}")
         return None
 
     return root_relative_path
 
 
+def path_is_ignored(
+    path: Path, gitignore_dict: Dict[Path, PathSpec], report: Report
+) -> bool:
+    for gitignore_path, pattern in gitignore_dict.items():
+        relative_path = normalize_path_maybe_ignore(path, gitignore_path, report)
+        if relative_path is None:
+            break
+        if pattern.match_file(relative_path):
+            report.path_ignored(path, "matches a .gitignore file content")
+            return True
+    return False
+
+
 def path_is_excluded(
     normalized_path: str,
     pattern: Optional[Pattern[str]],
 ) -> bool:
     match = pattern.search(normalized_path) if pattern else None
     return bool(match and match.group(0))
 
@@ -193,36 +299,36 @@
     paths: Iterable[Path],
     root: Path,
     include: Pattern[str],
     exclude: Pattern[str],
     extend_exclude: Optional[Pattern[str]],
     force_exclude: Optional[Pattern[str]],
     report: Report,
-    gitignore: Optional[PathSpec],
+    gitignore_dict: Optional[Dict[Path, PathSpec]],
     *,
     verbose: bool,
     quiet: bool,
 ) -> Iterator[Path]:
     """Generate all files under `path` whose paths are not excluded by the
     `exclude_regex`, `extend_exclude`, or `force_exclude` regexes,
     but are included by the `include` regex.
 
     Symbolic links pointing outside of the `root` directory are ignored.
 
     `report` is where output about exclusions goes.
     """
+
     assert root.is_absolute(), f"INTERNAL ERROR: `root` must be absolute but is {root}"
     for child in paths:
         normalized_path = normalize_path_maybe_ignore(child, root, report)
         if normalized_path is None:
             continue
 
         # First ignore files matching .gitignore, if passed
-        if gitignore is not None and gitignore.match_file(normalized_path):
-            report.path_ignored(child, "matches the .gitignore file content")
+        if gitignore_dict and path_is_ignored(child, gitignore_dict, report):
             continue
 
         # Then ignore with `--exclude` `--extend-exclude` and `--force-exclude` options.
         normalized_path = "/" + normalized_path
         if child.is_dir():
             normalized_path += "/"
 
@@ -239,23 +345,30 @@
         if path_is_excluded(normalized_path, force_exclude):
             report.path_ignored(child, "matches the --force-exclude regular expression")
             continue
 
         if child.is_dir():
             # If gitignore is None, gitignore usage is disabled, while a Falsey
             # gitignore is when the directory doesn't have a .gitignore file.
+            if gitignore_dict is not None:
+                new_gitignore_dict = {
+                    **gitignore_dict,
+                    root / child: get_gitignore(child),
+                }
+            else:
+                new_gitignore_dict = None
             yield from gen_python_files(
                 child.iterdir(),
                 root,
                 include,
                 exclude,
                 extend_exclude,
                 force_exclude,
                 report,
-                gitignore + get_gitignore(child) if gitignore is not None else None,
+                new_gitignore_dict,
                 verbose=verbose,
                 quiet=quiet,
             )
 
         elif child.is_file():
             if child.suffix == ".ipynb" and not jupyter_dependencies_are_installed(
                 verbose=verbose, quiet=quiet
```

### Comparing `tan-22.8.0/src/black/handle_ipynb_magics.py` & `tan-23.3.0/src/black/handle_ipynb_magics.py`

 * *Files 0% similar despite different names*

```diff
@@ -60,15 +60,15 @@
     try:
         import IPython  # noqa:F401
         import tokenize_rt  # noqa:F401
     except ModuleNotFoundError:
         if verbose or not quiet:
             msg = (
                 "Skipping .ipynb files as Jupyter dependencies are not installed.\n"
-                "You can fix this by running ``pip install black[jupyter]``"
+                'You can fix this by running ``pip install "black[jupyter]"``'
             )
             out(msg)
         return False
     else:
         return True
```

### Comparing `tan-22.8.0/src/black/linegen.py` & `tan-23.3.0/src/black/linegen.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,59 +1,71 @@
 """
 Generating lines of code.
 """
 import sys
+from dataclasses import replace
+from enum import Enum, auto
 from functools import partial, wraps
 from typing import Collection, Iterator, List, Optional, Set, Union, cast
 
-from black.brackets import COMMA_PRIORITY, DOT_PRIORITY, max_delimiter_priority_in_atom
+from black.brackets import (
+    COMMA_PRIORITY,
+    DOT_PRIORITY,
+    get_leaves_inside_matching_brackets,
+    max_delimiter_priority_in_atom,
+)
 from black.comments import FMT_OFF, generate_comments, list_comments
 from black.lines import (
     Line,
+    RHSResult,
     append_leaves,
     can_be_split,
     can_omit_invisible_parens,
     is_line_short_enough,
     line_to_string,
 )
 from black.mode import Feature, Mode, Preview
 from black.nodes import (
     ASSIGNMENTS,
+    BRACKETS,
     CLOSING_BRACKETS,
     OPENING_BRACKETS,
     RARROW,
     STANDALONE_COMMENT,
     STATEMENT,
     WHITESPACE,
     Visitor,
     ensure_visible,
     is_arith_like,
+    is_async_stmt_or_funcdef,
     is_atom_with_invisible_parens,
     is_docstring,
     is_empty_tuple,
     is_lpar_token,
     is_multiline_string,
     is_name_token,
     is_one_sequence_between,
     is_one_tuple,
     is_rpar_token,
     is_stub_body,
     is_stub_suite,
+    is_tuple_containing_walrus,
     is_vararg,
     is_walrus_assignment,
     is_yield,
     syms,
     wrap_in_parentheses,
 )
 from black.numerics import normalize_numeric_literal
 from black.strings import (
     fix_docstring,
     get_string_prefix,
     normalize_string_prefix,
     normalize_string_quotes,
+    normalize_unicode_escape_sequences,
 )
 from black.trans import (
     CannotTransform,
     StringMerger,
     StringParenStripper,
     StringParenWrapper,
     StringSplitter,
@@ -77,16 +89,17 @@
 class LineGenerator(Visitor[Line]):
     """Generates reformatted Line objects.  Empty lines are not emitted.
 
     Note: destroys the tree it's visiting by mutating prefixes of its leaves
     in ways that will no longer stringify to valid Python code on the tree.
     """
 
-    def __init__(self, mode: Mode) -> None:
+    def __init__(self, mode: Mode, features: Collection[Feature]) -> None:
         self.mode = mode
+        self.features = features
         self.current_line: Line
         self.__post_init__()
 
     def line(self, indent: int = 0) -> Iterator[Line]:
         """Generate a line.
 
         If the line is empty, only emit if it makes sense.
@@ -94,23 +107,34 @@
 
         If any lines were generated, set up a new current_line.
         """
         if not self.current_line:
             self.current_line.depth += indent
             return  # Line is empty, don't emit. Creating a new one unnecessary.
 
+        if (
+            Preview.improved_async_statements_handling in self.mode
+            and len(self.current_line.leaves) == 1
+            and is_async_stmt_or_funcdef(self.current_line.leaves[0])
+        ):
+            # Special case for async def/for/with statements. `visit_async_stmt`
+            # adds an `ASYNC` leaf then visits the child def/for/with statement
+            # nodes. Line yields from those nodes shouldn't treat the former
+            # `ASYNC` leaf as a complete line.
+            return
+
         complete_line = self.current_line
         self.current_line = Line(mode=self.mode, depth=complete_line.depth + indent)
         yield complete_line
 
     def visit_default(self, node: LN) -> Iterator[Line]:
         """Default `visit_*()` implementation. Recurses to children of `node`."""
         if isinstance(node, Leaf):
             any_open_brackets = self.current_line.bracket_tracker.any_open_brackets()
-            for comment in generate_comments(node, preview=self.mode.preview):
+            for comment in generate_comments(node):
                 if any_open_brackets:
                     # any comment within brackets is subject to splitting
                     self.current_line.append(comment)
                 elif comment.type == token.COMMENT:
                     # regular trailing comment
                     self.current_line.append(comment)
                     yield from self.line()
@@ -128,14 +152,30 @@
                 node.value = normalize_string_quotes(node.value)
             if node.type == token.NUMBER:
                 normalize_numeric_literal(node)
             if node.type not in WHITESPACE:
                 self.current_line.append(node)
         yield from super().visit_default(node)
 
+    def visit_test(self, node: Node) -> Iterator[Line]:
+        """Visit an `x if y else z` test"""
+
+        if Preview.parenthesize_conditional_expressions in self.mode:
+            already_parenthesized = (
+                node.prev_sibling and node.prev_sibling.type == token.LPAR
+            )
+
+            if not already_parenthesized:
+                lpar = Leaf(token.LPAR, "")
+                rpar = Leaf(token.RPAR, "")
+                node.insert_child(0, lpar)
+                node.append_child(rpar)
+
+        yield from self.visit_default(node)
+
     def visit_INDENT(self, node: Leaf) -> Iterator[Line]:
         """Increase indentation level, maybe yield a line."""
         # In blib2to3 INDENT never holds comments.
         yield from self.line(+1)
         yield from self.visit_default(node)
 
     def visit_DEDENT(self, node: Leaf) -> Iterator[Line]:
@@ -162,51 +202,69 @@
 
         The relevant Python language `keywords` for a given statement will be
         NAME leaves within it. This methods puts those on a separate line.
 
         `parens` holds a set of string leaf values immediately after which
         invisible parens should be put.
         """
-        normalize_invisible_parens(node, parens_after=parens, preview=self.mode.preview)
+        normalize_invisible_parens(
+            node, parens_after=parens, mode=self.mode, features=self.features
+        )
         for child in node.children:
             if is_name_token(child) and child.value in keywords:
                 yield from self.line()
 
             yield from self.visit(child)
 
-    def visit_funcdef(self, node: Node) -> Iterator[Line]:
-        """Visit function definition."""
-        if Preview.annotation_parens not in self.mode:
-            yield from self.visit_stmt(node, keywords={"def"}, parens=set())
-        else:
-            yield from self.line()
-
-            # Remove redundant brackets around return type annotation.
-            is_return_annotation = False
-            for child in node.children:
-                if child.type == token.RARROW:
-                    is_return_annotation = True
-                elif is_return_annotation:
+    def visit_dictsetmaker(self, node: Node) -> Iterator[Line]:
+        if Preview.wrap_long_dict_values_in_parens in self.mode:
+            for i, child in enumerate(node.children):
+                if i == 0:
+                    continue
+                if node.children[i - 1].type == token.COLON:
                     if child.type == syms.atom and child.children[0].type == token.LPAR:
                         if maybe_make_parens_invisible_in_atom(
                             child,
                             parent=node,
                             remove_brackets_around_comma=False,
                         ):
                             wrap_in_parentheses(node, child, visible=False)
                     else:
                         wrap_in_parentheses(node, child, visible=False)
-                    is_return_annotation = False
+        yield from self.visit_default(node)
 
-            for child in node.children:
-                yield from self.visit(child)
+    def visit_funcdef(self, node: Node) -> Iterator[Line]:
+        """Visit function definition."""
+        yield from self.line()
+
+        # Remove redundant brackets around return type annotation.
+        is_return_annotation = False
+        for child in node.children:
+            if child.type == token.RARROW:
+                is_return_annotation = True
+            elif is_return_annotation:
+                if child.type == syms.atom and child.children[0].type == token.LPAR:
+                    if maybe_make_parens_invisible_in_atom(
+                        child,
+                        parent=node,
+                        remove_brackets_around_comma=False,
+                    ):
+                        wrap_in_parentheses(node, child, visible=False)
+                else:
+                    wrap_in_parentheses(node, child, visible=False)
+                is_return_annotation = False
+
+        for child in node.children:
+            yield from self.visit(child)
 
     def visit_match_case(self, node: Node) -> Iterator[Line]:
         """Visit either a match or case statement."""
-        normalize_invisible_parens(node, parens_after=set(), preview=self.mode.preview)
+        normalize_invisible_parens(
+            node, parens_after=set(), mode=self.mode, features=self.features
+        )
 
         yield from self.line()
         for child in node.children:
             yield from self.visit(child)
 
     def visit_suite(self, node: Node) -> Iterator[Line]:
         """Visit a suite."""
@@ -251,16 +309,19 @@
 
             if child.type == token.ASYNC or child.type == STANDALONE_COMMENT:
                 # STANDALONE_COMMENT happens when `# fmt: skip` is applied on the async
                 # line.
                 break
 
         internal_stmt = next(children)
-        for child in internal_stmt.children:
-            yield from self.visit(child)
+        if Preview.improved_async_statements_handling in self.mode:
+            yield from self.visit(internal_stmt)
+        else:
+            for child in internal_stmt.children:
+                yield from self.visit(child)
 
     def visit_decorators(self, node: Node) -> Iterator[Line]:
         """Visit decorators."""
         for child in node.children:
             yield from self.line()
             yield from self.visit(child)
 
@@ -280,16 +341,15 @@
                 # It shouldn't wrap hexadecimal, binary and octal literals
                 and not value.startswith(("0x", "0b", "0o"))
                 # It shouldn't wrap complex literals
                 and "j" not in value
             ):
                 wrap_in_parentheses(node, leaf)
 
-        if Preview.remove_redundant_parens in self.mode:
-            remove_await_parens(node)
+        remove_await_parens(node)
 
         yield from self.visit_default(node)
 
     def visit_SEMI(self, leaf: Leaf) -> Iterator[Line]:
         """Remove a semicolon and put the other statement on a separate line."""
         yield from self.line()
 
@@ -317,35 +377,31 @@
             lpar = Leaf(token.LPAR, "(")
             rpar = Leaf(token.RPAR, ")")
             index = operand.remove() or 0
             node.insert_child(index, Node(syms.atom, [lpar, operand, rpar]))
         yield from self.visit_default(node)
 
     def visit_STRING(self, leaf: Leaf) -> Iterator[Line]:
+        if Preview.hex_codes_in_unicode_sequences in self.mode:
+            normalize_unicode_escape_sequences(leaf)
+
         if is_docstring(leaf) and "\\\n" not in leaf.value:
             # We're ignoring docstrings with backslash newline escapes because changing
             # indentation of those changes the AST representation of the code.
-            if Preview.normalize_docstring_quotes_and_prefixes_properly in self.mode:
-                # There was a bug where --skip-string-normalization wouldn't stop us
-                # from normalizing docstring prefixes. To maintain stability, we can
-                # only address this buggy behaviour while the preview style is enabled.
-                if self.mode.string_normalization:
-                    docstring = normalize_string_prefix(leaf.value)
-                    # visit_default() does handle string normalization for us, but
-                    # since this method acts differently depending on quote style (ex.
-                    # see padding logic below), there's a possibility for unstable
-                    # formatting as visit_default() is called *after*. To avoid a
-                    # situation where this function formats a docstring differently on
-                    # the second pass, normalize it early.
-                    docstring = normalize_string_quotes(docstring)
-                else:
-                    docstring = leaf.value
-            else:
-                # ... otherwise, we'll keep the buggy behaviour >.<
+            if self.mode.string_normalization:
                 docstring = normalize_string_prefix(leaf.value)
+                # visit_default() does handle string normalization for us, but
+                # since this method acts differently depending on quote style (ex.
+                # see padding logic below), there's a possibility for unstable
+                # formatting as visit_default() is called *after*. To avoid a
+                # situation where this function formats a docstring differently on
+                # the second pass, normalize it early.
+                docstring = normalize_string_quotes(docstring)
+            else:
+                docstring = leaf.value
             prefix = get_string_prefix(docstring)
             docstring = docstring[len(prefix) :]  # Remove the prefix
             quote_char = docstring[0]
             # A natural way to remove the outer quotes is to do:
             #   docstring = docstring.strip(quote_char)
             # but that breaks on """""x""" (which is '""x').
             # So we actually need to remove the first character and the next two
@@ -357,50 +413,53 @@
             indent = indent_style * self.current_line.depth
 
             if is_multiline_string(leaf):
                 docstring = fix_docstring(docstring, indent, not self.mode.use_tabs)
             else:
                 docstring = docstring.strip()
 
+            has_trailing_backslash = False
             if docstring:
                 # Add some padding if the docstring starts / ends with a quote mark.
                 if docstring[0] == quote_char:
                     docstring = " " + docstring
                 if docstring[-1] == quote_char:
                     docstring += " "
                 if docstring[-1] == "\\":
                     backslash_count = len(docstring) - len(docstring.rstrip("\\"))
                     if backslash_count % 2:
                         # Odd number of tailing backslashes, add some padding to
                         # avoid escaping the closing string quote.
                         docstring += " "
+                        has_trailing_backslash = True
             elif not docstring_started_empty:
                 docstring = " "
 
             # We could enforce triple quotes at this point.
             quote = quote_char * quote_len
 
             # It's invalid to put closing single-character quotes on a new line.
-            if Preview.long_docstring_quotes_on_newline in self.mode and quote_len == 3:
+            if self.mode and quote_len == 3:
                 # We need to find the length of the last line of the docstring
                 # to find if we can add the closing quotes to the line without
                 # exceeding the maximum line length.
-                # If docstring is one line, then we need to add the length
-                # of the indent, prefix, and starting quotes. Ending quotes are
-                # handled later.
+                # If docstring is one line, we don't put the closing quotes on a
+                # separate line because it looks ugly (#3320).
                 lines = docstring.splitlines()
                 last_line_length = len(lines[-1]) if docstring else 0
 
-                if len(lines) == 1:
-                    last_line_length += len(indent) + len(prefix) + quote_len
-
                 # If adding closing quotes would cause the last line to exceed
                 # the maximum line length then put a line break before the
                 # closing quotes
-                if last_line_length + quote_len > self.mode.line_length:
+                if (
+                    len(lines) > 1
+                    and last_line_length + quote_len > self.mode.line_length
+                    and len(indent) + quote_len <= self.mode.line_length
+                    and not has_trailing_backslash
+                ):
                     leaf.value = prefix + quote + docstring + "\n" + indent + quote
                 else:
                     leaf.value = prefix + quote + docstring + quote
             else:
                 leaf.value = prefix + quote + docstring + quote
 
         yield from self.visit_default(leaf)
@@ -416,22 +475,16 @@
             v, keywords={"if", "else", "elif"}, parens={"if", "elif"}
         )
         self.visit_while_stmt = partial(v, keywords={"while", "else"}, parens={"while"})
         self.visit_for_stmt = partial(v, keywords={"for", "else"}, parens={"for", "in"})
         self.visit_try_stmt = partial(
             v, keywords={"try", "except", "else", "finally"}, parens=Ø
         )
-        if self.mode.preview:
-            self.visit_except_clause = partial(
-                v, keywords={"except"}, parens={"except"}
-            )
-            self.visit_with_stmt = partial(v, keywords={"with"}, parens={"with"})
-        else:
-            self.visit_except_clause = partial(v, keywords={"except"}, parens=Ø)
-            self.visit_with_stmt = partial(v, keywords={"with"}, parens=Ø)
+        self.visit_except_clause = partial(v, keywords={"except"}, parens={"except"})
+        self.visit_with_stmt = partial(v, keywords={"with"}, parens={"with"})
         self.visit_classdef = partial(v, keywords={"class"}, parens=Ø)
         self.visit_expr_stmt = partial(v, keywords=Ø, parens=ASSIGNMENTS)
         self.visit_return_stmt = partial(v, keywords={"return"}, parens={"return"})
         self.visit_import_from = partial(v, keywords=Ø, parens={"import"})
         self.visit_del_stmt = partial(v, keywords=Ø, parens={"del"})
         self.visit_async_funcdef = self.visit_async_stmt
         self.visit_decorated = self.visit_decorators
@@ -450,72 +503,67 @@
 
     `features` are syntactical features that may be used in the output.
     """
     if line.is_comment:
         yield line
         return
 
-    # Force spaces to ensure len(line) is correct
-    line_str = line.render(force_spaces=True).strip("\n")
+    line_str = line_to_string(line)
 
     ll = mode.line_length
     sn = mode.string_normalization
     string_merge = StringMerger(ll, sn)
     string_paren_strip = StringParenStripper(ll, sn)
     string_split = StringSplitter(ll, sn)
     string_paren_wrap = StringParenWrapper(ll, sn)
 
     transformers: List[Transformer]
     if (
         not line.contains_uncollapsable_type_comments()
         and not line.should_split_rhs
         and not line.magic_trailing_comma
         and (
-            is_line_short_enough(line, line_length=mode.line_length, line_str=line_str)
+            is_line_short_enough(line, mode=mode, line_str=line_str)
             or line.contains_unsplittable_type_ignore()
         )
         and not (line.inside_brackets and line.contains_standalone_comments())
     ):
         # Only apply basic string preprocessing, since lines shouldn't be split here.
         if Preview.string_processing in mode:
             transformers = [string_merge, string_paren_strip]
         else:
             transformers = []
     elif line.is_def:
         transformers = [left_hand_split]
     else:
 
         def _rhs(
-            self: object, line: Line, features: Collection[Feature]
+            self: object, line: Line, features: Collection[Feature], mode: Mode
         ) -> Iterator[Line]:
             """Wraps calls to `right_hand_split`.
 
             The calls increasingly `omit` right-hand trailers (bracket pairs with
             content), meaning the trailers get glued together to split on another
             bracket pair instead.
             """
             for omit in generate_trailers_to_omit(line, mode.line_length):
-                lines = list(
-                    right_hand_split(line, mode.line_length, features, omit=omit)
-                )
+                lines = list(right_hand_split(line, mode, features, omit=omit))
                 # Note: this check is only able to figure out if the first line of the
                 # *current* transformation fits in the line length.  This is true only
                 # for simple cases.  All others require running more transforms via
                 # `transform_line()`.  This check doesn't know if those would succeed.
-                if is_line_short_enough(lines[0], line_length=mode.line_length):
+                if is_line_short_enough(lines[0], mode=mode):
                     yield from lines
                     return
 
             # All splits failed, best effort split with no omits.
             # This mostly happens to multiline strings that are by definition
             # reported as not fitting a single line, as well as lines that contain
             # trailing commas (those have to be exploded).
-            yield from right_hand_split(
-                line, line_length=mode.line_length, features=features
-            )
+            yield from right_hand_split(line, mode, features=features)
 
         # HACK: nested functions (like _rhs) compiled by mypyc don't retain their
         # __name__ attribute which is needed in `run_transformer` further down.
         # Unfortunately a nested class breaks mypyc too. So a class must be created
         # via type ... https://github.com/mypyc/mypyc/issues/884
         rhs = type("rhs", (), {"__call__": _rhs})()
 
@@ -559,15 +607,23 @@
             yield from result
             break
 
     else:
         yield line
 
 
-def left_hand_split(line: Line, _features: Collection[Feature] = ()) -> Iterator[Line]:
+class _BracketSplitComponent(Enum):
+    head = auto()
+    body = auto()
+    tail = auto()
+
+
+def left_hand_split(
+    line: Line, _features: Collection[Feature], mode: Mode
+) -> Iterator[Line]:
     """Split line into many lines, starting with the first matching bracket pair.
 
     Note: this usually looks weird, only use this for function definitions.
     Prefer RHS otherwise.  This is why this function is not symmetrical with
     :func:`right_hand_split` which also handles optional parentheses.
     """
     tail_leaves: List[Leaf] = []
@@ -589,37 +645,59 @@
         if current_leaves is head_leaves:
             if leaf.type in OPENING_BRACKETS:
                 matching_bracket = leaf
                 current_leaves = body_leaves
     if not matching_bracket:
         raise CannotSplit("No brackets found")
 
-    head = bracket_split_build_line(head_leaves, line, matching_bracket)
-    body = bracket_split_build_line(body_leaves, line, matching_bracket, is_body=True)
-    tail = bracket_split_build_line(tail_leaves, line, matching_bracket)
+    head = bracket_split_build_line(
+        head_leaves, line, matching_bracket, component=_BracketSplitComponent.head
+    )
+    body = bracket_split_build_line(
+        body_leaves, line, matching_bracket, component=_BracketSplitComponent.body
+    )
+    tail = bracket_split_build_line(
+        tail_leaves, line, matching_bracket, component=_BracketSplitComponent.tail
+    )
     bracket_split_succeeded_or_raise(head, body, tail)
     for result in (head, body, tail):
         if result:
             yield result
 
 
 def right_hand_split(
     line: Line,
-    line_length: int,
+    mode: Mode,
     features: Collection[Feature] = (),
     omit: Collection[LeafID] = (),
 ) -> Iterator[Line]:
     """Split line into many lines, starting with the last matching bracket pair.
 
     If the split was by optional parentheses, attempt splitting without them, too.
     `omit` is a collection of closing bracket IDs that shouldn't be considered for
     this split.
 
     Note: running this function modifies `bracket_depth` on the leaves of `line`.
     """
+    rhs_result = _first_right_hand_split(line, omit=omit)
+    yield from _maybe_split_omitting_optional_parens(
+        rhs_result, line, mode, features=features, omit=omit
+    )
+
+
+def _first_right_hand_split(
+    line: Line,
+    omit: Collection[LeafID] = (),
+) -> RHSResult:
+    """Split the line into head, body, tail starting with the last bracket pair.
+
+    Note: this function should not have side effects. It's relied upon by
+    _maybe_split_omitting_optional_parens to get an opinion whether to prefer
+    splitting on the right side of an assignment statement.
+    """
     tail_leaves: List[Leaf] = []
     body_leaves: List[Leaf] = []
     head_leaves: List[Leaf] = []
     current_leaves = tail_leaves
     opening_bracket: Optional[Leaf] = None
     closing_bracket: Optional[Leaf] = None
     for leaf in reversed(line.leaves):
@@ -637,63 +715,133 @@
         # all content is in the tail.  Otherwise, if `head_leaves` are empty, it means
         # the matching `opening_bracket` wasn't available on `line` anymore.
         raise CannotSplit("No brackets found")
 
     tail_leaves.reverse()
     body_leaves.reverse()
     head_leaves.reverse()
-    head = bracket_split_build_line(head_leaves, line, opening_bracket)
-    body = bracket_split_build_line(body_leaves, line, opening_bracket, is_body=True)
-    tail = bracket_split_build_line(tail_leaves, line, opening_bracket)
+    head = bracket_split_build_line(
+        head_leaves, line, opening_bracket, component=_BracketSplitComponent.head
+    )
+    body = bracket_split_build_line(
+        body_leaves, line, opening_bracket, component=_BracketSplitComponent.body
+    )
+    tail = bracket_split_build_line(
+        tail_leaves, line, opening_bracket, component=_BracketSplitComponent.tail
+    )
     bracket_split_succeeded_or_raise(head, body, tail)
+    return RHSResult(head, body, tail, opening_bracket, closing_bracket)
+
+
+def _maybe_split_omitting_optional_parens(
+    rhs: RHSResult,
+    line: Line,
+    mode: Mode,
+    features: Collection[Feature] = (),
+    omit: Collection[LeafID] = (),
+) -> Iterator[Line]:
     if (
         Feature.FORCE_OPTIONAL_PARENTHESES not in features
         # the opening bracket is an optional paren
-        and opening_bracket.type == token.LPAR
-        and not opening_bracket.value
+        and rhs.opening_bracket.type == token.LPAR
+        and not rhs.opening_bracket.value
         # the closing bracket is an optional paren
-        and closing_bracket.type == token.RPAR
-        and not closing_bracket.value
+        and rhs.closing_bracket.type == token.RPAR
+        and not rhs.closing_bracket.value
         # it's not an import (optional parens are the only thing we can split on
         # in this case; attempting a split without them is a waste of time)
         and not line.is_import
         # there are no standalone comments in the body
-        and not body.contains_standalone_comments(0)
+        and not rhs.body.contains_standalone_comments(0)
         # and we can actually remove the parens
-        and can_omit_invisible_parens(body, line_length)
+        and can_omit_invisible_parens(rhs, mode.line_length)
     ):
-        omit = {id(closing_bracket), *omit}
+        omit = {id(rhs.closing_bracket), *omit}
         try:
-            yield from right_hand_split(line, line_length, features=features, omit=omit)
-            return
+            # The RHSResult Omitting Optional Parens.
+            rhs_oop = _first_right_hand_split(line, omit=omit)
+            if not (
+                Preview.prefer_splitting_right_hand_side_of_assignments in line.mode
+                # the split is right after `=`
+                and len(rhs.head.leaves) >= 2
+                and rhs.head.leaves[-2].type == token.EQUAL
+                # the left side of assignment contains brackets
+                and any(leaf.type in BRACKETS for leaf in rhs.head.leaves[:-1])
+                # the left side of assignment is short enough (the -1 is for the ending
+                # optional paren)
+                and is_line_short_enough(
+                    rhs.head, mode=replace(mode, line_length=mode.line_length - 1)
+                )
+                # the left side of assignment won't explode further because of magic
+                # trailing comma
+                and rhs.head.magic_trailing_comma is None
+                # the split by omitting optional parens isn't preferred by some other
+                # reason
+                and not _prefer_split_rhs_oop(rhs_oop, mode)
+            ):
+                yield from _maybe_split_omitting_optional_parens(
+                    rhs_oop, line, mode, features=features, omit=omit
+                )
+                return
 
         except CannotSplit as e:
             if not (
-                can_be_split(body)
-                or is_line_short_enough(body, line_length=line_length)
+                can_be_split(rhs.body) or is_line_short_enough(rhs.body, mode=mode)
             ):
                 raise CannotSplit(
                     "Splitting failed, body is still too long and can't be split."
                 ) from e
 
-            elif head.contains_multiline_strings() or tail.contains_multiline_strings():
+            elif (
+                rhs.head.contains_multiline_strings()
+                or rhs.tail.contains_multiline_strings()
+            ):
                 raise CannotSplit(
                     "The current optional pair of parentheses is bound to fail to"
                     " satisfy the splitting algorithm because the head or the tail"
                     " contains multiline strings which by definition never fit one"
                     " line."
                 ) from e
 
-    ensure_visible(opening_bracket)
-    ensure_visible(closing_bracket)
-    for result in (head, body, tail):
+    ensure_visible(rhs.opening_bracket)
+    ensure_visible(rhs.closing_bracket)
+    for result in (rhs.head, rhs.body, rhs.tail):
         if result:
             yield result
 
 
+def _prefer_split_rhs_oop(rhs_oop: RHSResult, mode: Mode) -> bool:
+    """
+    Returns whether we should prefer the result from a split omitting optional parens.
+    """
+    has_closing_bracket_after_assign = False
+    for leaf in reversed(rhs_oop.head.leaves):
+        if leaf.type == token.EQUAL:
+            break
+        if leaf.type in CLOSING_BRACKETS:
+            has_closing_bracket_after_assign = True
+            break
+    return (
+        # contains matching brackets after the `=` (done by checking there is a
+        # closing bracket)
+        has_closing_bracket_after_assign
+        or (
+            # the split is actually from inside the optional parens (done by checking
+            # the first line still contains the `=`)
+            any(leaf.type == token.EQUAL for leaf in rhs_oop.head.leaves)
+            # the first line is short enough
+            and is_line_short_enough(rhs_oop.head, mode=mode)
+        )
+        # contains unsplittable type ignore
+        or rhs_oop.head.contains_unsplittable_type_ignore()
+        or rhs_oop.body.contains_unsplittable_type_ignore()
+        or rhs_oop.tail.contains_unsplittable_type_ignore()
+    )
+
+
 def bracket_split_succeeded_or_raise(head: Line, body: Line, tail: Line) -> None:
     """Raise :exc:`CannotSplit` if the last left- or right-hand split failed.
 
     Do nothing otherwise.
 
     A left- or right-hand split is based on a pair of brackets. Content before
     (and including) the opening bracket is left on one line, content inside the
@@ -713,23 +861,31 @@
             raise CannotSplit(
                 f"Splitting brackets on an empty body to save {tail_len} characters is"
                 " not worth it"
             )
 
 
 def bracket_split_build_line(
-    leaves: List[Leaf], original: Line, opening_bracket: Leaf, *, is_body: bool = False
+    leaves: List[Leaf],
+    original: Line,
+    opening_bracket: Leaf,
+    *,
+    component: _BracketSplitComponent,
 ) -> Line:
     """Return a new line with given `leaves` and respective comments from `original`.
 
-    If `is_body` is True, the result line is one-indented inside brackets and as such
-    has its first leaf's prefix normalized and a trailing comma added when expected.
+    If it's the head component, brackets will be tracked so trailing commas are
+    respected.
+
+    If it's the body component, the result line is one-indented inside brackets and as
+    such has its first leaf's prefix normalized and a trailing comma added when
+    expected.
     """
     result = Line(mode=original.mode, depth=original.depth)
-    if is_body:
+    if component is _BracketSplitComponent.body:
         result.inside_brackets = True
         result.depth += 1
         if leaves:
             # Since body is a new indent level, remove spurious leading whitespace.
             normalize_prefix(leaves[0], inside_brackets=True)
             # Ensure a trailing comma for imports and standalone function arguments, but
             # be careful not to add one after any comments or within type annotations.
@@ -759,41 +915,73 @@
                         continue
 
                     if leaves[i].type != token.COMMA:
                         new_comma = Leaf(token.COMMA, ",")
                         leaves.insert(i + 1, new_comma)
                     break
 
+    leaves_to_track: Set[LeafID] = set()
+    if component is _BracketSplitComponent.head:
+        leaves_to_track = get_leaves_inside_matching_brackets(leaves)
     # Populate the line
     for leaf in leaves:
-        result.append(leaf, preformatted=True)
+        result.append(
+            leaf,
+            preformatted=True,
+            track_bracket=id(leaf) in leaves_to_track,
+        )
         for comment_after in original.comments_after(leaf):
             result.append(comment_after, preformatted=True)
-    if is_body and should_split_line(result, opening_bracket):
+    if component is _BracketSplitComponent.body and should_split_line(
+        result, opening_bracket
+    ):
         result.should_split_rhs = True
     return result
 
 
 def dont_increase_indentation(split_func: Transformer) -> Transformer:
     """Normalize prefix of the first leaf in every line returned by `split_func`.
 
     This is a decorator over relevant split functions.
     """
 
     @wraps(split_func)
-    def split_wrapper(line: Line, features: Collection[Feature] = ()) -> Iterator[Line]:
-        for split_line in split_func(line, features):
+    def split_wrapper(
+        line: Line, features: Collection[Feature], mode: Mode
+    ) -> Iterator[Line]:
+        for split_line in split_func(line, features, mode):
             normalize_prefix(split_line.leaves[0], inside_brackets=True)
             yield split_line
 
     return split_wrapper
 
 
+def _get_last_non_comment_leaf(line: Line) -> Optional[int]:
+    for leaf_idx in range(len(line.leaves) - 1, 0, -1):
+        if line.leaves[leaf_idx].type != STANDALONE_COMMENT:
+            return leaf_idx
+    return None
+
+
+def _safe_add_trailing_comma(safe: bool, delimiter_priority: int, line: Line) -> Line:
+    if (
+        safe
+        and delimiter_priority == COMMA_PRIORITY
+        and line.leaves[-1].type != token.COMMA
+        and line.leaves[-1].type != STANDALONE_COMMENT
+    ):
+        new_comma = Leaf(token.COMMA, ",")
+        line.append(new_comma)
+    return line
+
+
 @dont_increase_indentation
-def delimiter_split(line: Line, features: Collection[Feature] = ()) -> Iterator[Line]:
+def delimiter_split(
+    line: Line, features: Collection[Feature], mode: Mode
+) -> Iterator[Line]:
     """Split according to delimiters of the highest priority.
 
     If the appropriate Features are given, the split will add trailing commas
     also in function signatures and calls that contain `*` and `**`.
     """
     try:
         last_leaf = line.leaves[-1]
@@ -825,15 +1013,16 @@
             yield current_line
 
             current_line = Line(
                 mode=line.mode, depth=line.depth, inside_brackets=line.inside_brackets
             )
             current_line.append(leaf)
 
-    for leaf in line.leaves:
+    last_non_comment_leaf = _get_last_non_comment_leaf(line)
+    for leaf_idx, leaf in enumerate(line.leaves):
         yield from append_to_line(leaf)
 
         for comment_after in line.comments_after(leaf):
             yield from append_to_line(comment_after)
 
         lowest_depth = min(lowest_depth, leaf.bracket_depth)
         if leaf.bracket_depth == lowest_depth:
@@ -842,36 +1031,40 @@
                     trailing_comma_safe and Feature.TRAILING_COMMA_IN_DEF in features
                 )
             elif is_vararg(leaf, within={syms.arglist, syms.argument}):
                 trailing_comma_safe = (
                     trailing_comma_safe and Feature.TRAILING_COMMA_IN_CALL in features
                 )
 
+        if (
+            Preview.add_trailing_comma_consistently in mode
+            and last_leaf.type == STANDALONE_COMMENT
+            and leaf_idx == last_non_comment_leaf
+        ):
+            current_line = _safe_add_trailing_comma(
+                trailing_comma_safe, delimiter_priority, current_line
+            )
+
         leaf_priority = bt.delimiters.get(id(leaf))
         if leaf_priority == delimiter_priority:
             yield current_line
 
             current_line = Line(
                 mode=line.mode, depth=line.depth, inside_brackets=line.inside_brackets
             )
     if current_line:
-        if (
-            trailing_comma_safe
-            and delimiter_priority == COMMA_PRIORITY
-            and current_line.leaves[-1].type != token.COMMA
-            and current_line.leaves[-1].type != STANDALONE_COMMENT
-        ):
-            new_comma = Leaf(token.COMMA, ",")
-            current_line.append(new_comma)
+        current_line = _safe_add_trailing_comma(
+            trailing_comma_safe, delimiter_priority, current_line
+        )
         yield current_line
 
 
 @dont_increase_indentation
 def standalone_comment_split(
-    line: Line, features: Collection[Feature] = ()
+    line: Line, features: Collection[Feature], mode: Mode
 ) -> Iterator[Line]:
     """Split standalone comments from the rest of the line."""
     if not line.contains_standalone_comments(0):
         raise CannotSplit("Line does not have any standalone comments")
 
     current_line = Line(
         mode=line.mode, depth=line.depth, inside_brackets=line.inside_brackets
@@ -915,103 +1108,113 @@
             leaf.prefix = "\n" * nl_count
             return
 
     leaf.prefix = ""
 
 
 def normalize_invisible_parens(
-    node: Node, parens_after: Set[str], *, preview: bool
+    node: Node, parens_after: Set[str], *, mode: Mode, features: Collection[Feature]
 ) -> None:
     """Make existing optional parentheses invisible or create new ones.
 
     `parens_after` is a set of string leaf values immediately after which parens
     should be put.
 
     Standardizes on visible parentheses for single-element tuples, and keeps
     existing visible parentheses for other tuples and generator expressions.
     """
-    for pc in list_comments(node.prefix, is_endmarker=False, preview=preview):
+    for pc in list_comments(node.prefix, is_endmarker=False):
         if pc.value in FMT_OFF:
             # This `node` has a prefix with `# fmt: off`, don't mess with parens.
             return
+
+    # The multiple context managers grammar has a different pattern, thus this is
+    # separate from the for-loop below. This possibly wraps them in invisible parens,
+    # and later will be removed in remove_with_parens when needed.
+    if node.type == syms.with_stmt:
+        _maybe_wrap_cms_in_parens(node, mode, features)
+
     check_lpar = False
     for index, child in enumerate(list(node.children)):
         # Fixes a bug where invisible parens are not properly stripped from
         # assignment statements that contain type annotations.
         if isinstance(child, Node) and child.type == syms.annassign:
             normalize_invisible_parens(
-                child, parens_after=parens_after, preview=preview
+                child, parens_after=parens_after, mode=mode, features=features
             )
 
         # Add parentheses around long tuple unpacking in assignments.
         if (
             index == 0
             and isinstance(child, Node)
             and child.type == syms.testlist_star_expr
         ):
             check_lpar = True
 
         if check_lpar:
             if (
-                preview
-                and child.type == syms.atom
+                child.type == syms.atom
                 and node.type == syms.for_stmt
                 and isinstance(child.prev_sibling, Leaf)
                 and child.prev_sibling.type == token.NAME
                 and child.prev_sibling.value == "for"
             ):
                 if maybe_make_parens_invisible_in_atom(
                     child,
                     parent=node,
                     remove_brackets_around_comma=True,
                 ):
                     wrap_in_parentheses(node, child, visible=False)
-            elif preview and isinstance(child, Node) and node.type == syms.with_stmt:
+            elif isinstance(child, Node) and node.type == syms.with_stmt:
                 remove_with_parens(child, node)
             elif child.type == syms.atom:
                 if maybe_make_parens_invisible_in_atom(
                     child,
                     parent=node,
                 ):
                     wrap_in_parentheses(node, child, visible=False)
             elif is_one_tuple(child):
                 wrap_in_parentheses(node, child, visible=True)
             elif node.type == syms.import_from:
-                # "import from" nodes store parentheses directly as part of
-                # the statement
-                if is_lpar_token(child):
-                    assert is_rpar_token(node.children[-1])
-                    # make parentheses invisible
-                    child.value = ""
-                    node.children[-1].value = ""
-                elif child.type != token.STAR:
-                    # insert invisible parentheses
-                    node.insert_child(index, Leaf(token.LPAR, ""))
-                    node.append_child(Leaf(token.RPAR, ""))
+                _normalize_import_from(node, child, index)
                 break
             elif (
                 index == 1
                 and child.type == token.STAR
                 and node.type == syms.except_clause
             ):
                 # In except* (PEP 654), the star is actually part of
                 # of the keyword. So we need to skip the insertion of
                 # invisible parentheses to work more precisely.
                 continue
 
             elif not (isinstance(child, Leaf) and is_multiline_string(child)):
                 wrap_in_parentheses(node, child, visible=False)
 
-        comma_check = child.type == token.COMMA if preview else False
+        comma_check = child.type == token.COMMA
 
         check_lpar = isinstance(child, Leaf) and (
             child.value in parens_after or comma_check
         )
 
 
+def _normalize_import_from(parent: Node, child: LN, index: int) -> None:
+    # "import from" nodes store parentheses directly as part of
+    # the statement
+    if is_lpar_token(child):
+        assert is_rpar_token(parent.children[-1])
+        # make parentheses invisible
+        child.value = ""
+        parent.children[-1].value = ""
+    elif child.type != token.STAR:
+        # insert invisible parentheses
+        parent.insert_child(index, Leaf(token.LPAR, ""))
+        parent.append_child(Leaf(token.RPAR, ""))
+
+
 def remove_await_parens(node: Node) -> None:
     if node.children[0].type == token.AWAIT and len(node.children) > 1:
         if (
             node.children[1].type == syms.atom
             and node.children[1].children[0].type == token.LPAR
         ):
             if maybe_make_parens_invisible_in_atom(
@@ -1026,26 +1229,70 @@
             # the AST due to operator precedence.
             # Therefore we only aim to remove brackets around
             # power nodes that aren't also await expressions themselves.
             # https://peps.python.org/pep-0492/#updated-operator-precedence-table
             # N.B. We've still removed any redundant nested brackets though :)
             opening_bracket = cast(Leaf, node.children[1].children[0])
             closing_bracket = cast(Leaf, node.children[1].children[-1])
-            bracket_contents = cast(Node, node.children[1].children[1])
-            if bracket_contents.type != syms.power:
-                ensure_visible(opening_bracket)
-                ensure_visible(closing_bracket)
-            elif (
-                bracket_contents.type == syms.power
-                and bracket_contents.children[0].type == token.AWAIT
-            ):
-                ensure_visible(opening_bracket)
-                ensure_visible(closing_bracket)
-                # If we are in a nested await then recurse down.
-                remove_await_parens(bracket_contents)
+            bracket_contents = node.children[1].children[1]
+            if isinstance(bracket_contents, Node):
+                if bracket_contents.type != syms.power:
+                    ensure_visible(opening_bracket)
+                    ensure_visible(closing_bracket)
+                elif (
+                    bracket_contents.type == syms.power
+                    and bracket_contents.children[0].type == token.AWAIT
+                ):
+                    ensure_visible(opening_bracket)
+                    ensure_visible(closing_bracket)
+                    # If we are in a nested await then recurse down.
+                    remove_await_parens(bracket_contents)
+
+
+def _maybe_wrap_cms_in_parens(
+    node: Node, mode: Mode, features: Collection[Feature]
+) -> None:
+    """When enabled and safe, wrap the multiple context managers in invisible parens.
+
+    It is only safe when `features` contain Feature.PARENTHESIZED_CONTEXT_MANAGERS.
+    """
+    if (
+        Feature.PARENTHESIZED_CONTEXT_MANAGERS not in features
+        or Preview.wrap_multiple_context_managers_in_parens not in mode
+        or len(node.children) <= 2
+        # If it's an atom, it's already wrapped in parens.
+        or node.children[1].type == syms.atom
+    ):
+        return
+    colon_index: Optional[int] = None
+    for i in range(2, len(node.children)):
+        if node.children[i].type == token.COLON:
+            colon_index = i
+            break
+    if colon_index is not None:
+        lpar = Leaf(token.LPAR, "")
+        rpar = Leaf(token.RPAR, "")
+        context_managers = node.children[1:colon_index]
+        for child in context_managers:
+            child.remove()
+        # After wrapping, the with_stmt will look like this:
+        #   with_stmt
+        #     NAME 'with'
+        #     atom
+        #       LPAR ''
+        #       testlist_gexp
+        #         ... <-- context_managers
+        #       /testlist_gexp
+        #       RPAR ''
+        #     /atom
+        #     COLON ':'
+        new_child = Node(
+            syms.atom, [lpar, Node(syms.testlist_gexp, context_managers), rpar]
+        )
+        node.insert_child(1, new_child)
 
 
 def remove_with_parens(node: Node, parent: Node) -> None:
     """Recursively hide optional parens in `with` statements."""
     # Removing all unnecessary parentheses in with statements in one pass is a tad
     # complex as different variations of bracketed statements result in pretty
     # different parse trees:
@@ -1105,26 +1352,31 @@
         or (
             # This condition tries to prevent removing non-optional brackets
             # around a tuple, however, can be a bit overzealous so we provide
             # and option to skip this check for `for` and `with` statements.
             not remove_brackets_around_comma
             and max_delimiter_priority_in_atom(node) >= COMMA_PRIORITY
         )
+        or is_tuple_containing_walrus(node)
     ):
         return False
 
     if is_walrus_assignment(node):
         if parent.type in [
             syms.annassign,
             syms.expr_stmt,
             syms.assert_stmt,
             syms.return_stmt,
+            syms.except_clause,
+            syms.funcdef,
+            syms.with_stmt,
             # these ones aren't useful to end users, but they do please fuzzers
             syms.for_stmt,
             syms.del_stmt,
+            syms.for_stmt,
         ]:
             return False
 
     first = node.children[0]
     last = node.children[-1]
     if is_lpar_token(first) and is_rpar_token(last):
         middle = node.children[1]
@@ -1257,40 +1509,40 @@
     features: Collection[Feature],
     *,
     line_str: str = "",
 ) -> List[Line]:
     if not line_str:
         line_str = line_to_string(line)
     result: List[Line] = []
-    for transformed_line in transform(line, features):
+    for transformed_line in transform(line, features, mode):
         if str(transformed_line).strip("\n") == line_str:
             raise CannotTransform("Line transformer returned an unchanged result")
 
         result.extend(transform_line(transformed_line, mode=mode, features=features))
 
+    features_set = set(features)
     if (
-        transform.__class__.__name__ != "rhs"
+        Feature.FORCE_OPTIONAL_PARENTHESES in features_set
+        or transform.__class__.__name__ != "rhs"
         or not line.bracket_tracker.invisible
         or any(bracket.value for bracket in line.bracket_tracker.invisible)
         or line.contains_multiline_strings()
         or result[0].contains_uncollapsable_type_comments()
         or result[0].contains_unsplittable_type_ignore()
-        or is_line_short_enough(result[0], line_length=mode.line_length)
+        or is_line_short_enough(result[0], mode=mode)
         # If any leaves have no parents (which _can_ occur since
         # `transform(line)` potentially destroys the line's underlying node
         # structure), then we can't proceed. Doing so would cause the below
         # call to `append_leaves()` to fail.
         or any(leaf.parent is None for leaf in line.leaves)
     ):
         return result
 
     line_copy = line.clone()
     append_leaves(line_copy, line, line.leaves)
-    features_fop = set(features) | {Feature.FORCE_OPTIONAL_PARENTHESES}
+    features_fop = features_set | {Feature.FORCE_OPTIONAL_PARENTHESES}
     second_opinion = run_transformer(
         line_copy, transform, mode, features_fop, line_str=line_str
     )
-    if all(
-        is_line_short_enough(ln, line_length=mode.line_length) for ln in second_opinion
-    ):
+    if all(is_line_short_enough(ln, mode=mode) for ln in second_opinion):
         result = second_opinion
     return result
```

### Comparing `tan-22.8.0/src/black/lines.py` & `tan-23.3.0/src/black/lines.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,46 +1,51 @@
 import itertools
+import math
 import sys
 from dataclasses import dataclass, field
 from typing import (
     Callable,
     Dict,
     Iterator,
     List,
     Optional,
     Sequence,
     Tuple,
     TypeVar,
+    Union,
     cast,
 )
 
-from black.brackets import DOT_PRIORITY, BracketTracker
+from black.brackets import COMMA_PRIORITY, DOT_PRIORITY, BracketTracker
 from black.mode import Mode, Preview
 from black.nodes import (
     BRACKETS,
     CLOSING_BRACKETS,
     OPENING_BRACKETS,
     STANDALONE_COMMENT,
     TEST_DESCENDANTS,
     child_towards,
     is_import,
     is_multiline_string,
     is_one_sequence_between,
     is_type_comment,
+    is_with_or_async_with_stmt,
     replace_child,
     syms,
     whitespace,
 )
+from black.strings import str_width
 from blib2to3.pgen2 import token
 from blib2to3.pytree import Leaf, Node
 
 # types
 T = TypeVar("T")
 Index = int
 LeafID = int
+LN = Union[Leaf, Node]
 
 
 @dataclass
 class Line:
     """Holds leaves and comments. Can be printed with `str(line)`."""
 
     mode: Mode
@@ -49,15 +54,17 @@
     # keys ordered like `leaves`
     comments: Dict[LeafID, List[Leaf]] = field(default_factory=dict)
     bracket_tracker: BracketTracker = field(default_factory=BracketTracker)
     inside_brackets: bool = False
     should_split_rhs: bool = False
     magic_trailing_comma: Optional[Leaf] = None
 
-    def append(self, leaf: Leaf, preformatted: bool = False) -> None:
+    def append(
+        self, leaf: Leaf, preformatted: bool = False, track_bracket: bool = False
+    ) -> None:
         """Add a new `leaf` to the end of the line.
 
         Unless `preformatted` is True, the `leaf` will receive a new consistent
         whitespace prefix and metadata applied by :class:`BracketTracker`.
         Trailing commas are maybe removed, unpacked for loop variables are
         demoted from being delimiters.
 
@@ -71,15 +78,15 @@
             del self.leaves[-2:]
         if self.leaves and not preformatted:
             # Note: at this point leaf.prefix should be empty except for
             # imports, for which we only preserve newlines.
             leaf.prefix += whitespace(
                 leaf, complex_subscript=self.is_complex_subscript(leaf)
             )
-        if self.inside_brackets or not preformatted:
+        if self.inside_brackets or not preformatted or track_bracket:
             self.bracket_tracker.mark(leaf)
             if self.mode.magic_trailing_comma:
                 if self.has_magic_trailing_comma(leaf):
                     self.magic_trailing_comma = leaf
             elif self.has_magic_trailing_comma(leaf, ensure_removable=True):
                 self.remove_trailing_comma()
         if not self.append_comment(leaf):
@@ -114,14 +121,19 @@
 
     @property
     def is_import(self) -> bool:
         """Is this an import line?"""
         return bool(self) and is_import(self.leaves[0])
 
     @property
+    def is_with_or_async_with_stmt(self) -> bool:
+        """Is this a with_stmt line?"""
+        return bool(self) and is_with_or_async_with_stmt(self.leaves[0])
+
+    @property
     def is_class(self) -> bool:
         """Is this line a class definition?"""
         return (
             bool(self)
             and self.leaves[0].type == token.NAME
             and self.leaves[0].value == "class"
         )
@@ -180,14 +192,34 @@
     @property
     def opens_block(self) -> bool:
         """Does this line open a new level of indentation."""
         if len(self.leaves) == 0:
             return False
         return self.leaves[-1].type == token.COLON
 
+    def is_fmt_pass_converted(
+        self, *, first_leaf_matches: Optional[Callable[[Leaf], bool]] = None
+    ) -> bool:
+        """Is this line converted from fmt off/skip code?
+
+        If first_leaf_matches is not None, it only returns True if the first
+        leaf of converted code matches.
+        """
+        if len(self.leaves) != 1:
+            return False
+        leaf = self.leaves[0]
+        if (
+            leaf.type != STANDALONE_COMMENT
+            or leaf.fmt_pass_converted_first_leaf is None
+        ):
+            return False
+        return first_leaf_matches is None or first_leaf_matches(
+            leaf.fmt_pass_converted_first_leaf
+        )
+
     def contains_standalone_comments(self, depth_limit: int = sys.maxsize) -> bool:
         """If so, needs to be split before emitting."""
         for leaf in self.leaves:
             if leaf.type == STANDALONE_COMMENT and leaf.bracket_depth <= depth_limit:
                 return True
 
         return False
@@ -269,31 +301,29 @@
     ) -> bool:
         """Return True if we have a magic trailing comma, that is when:
         - there's a trailing comma here
         - it's not a one-tuple
         - it's not a single-element subscript
         Additionally, if ensure_removable:
         - it's not from square bracket indexing
-        (specifically, single-element square bracket indexing with
-        Preview.skip_magic_trailing_comma_in_subscript)
+        (specifically, single-element square bracket indexing)
         """
         if not (
             closing.type in CLOSING_BRACKETS
             and self.leaves
             and self.leaves[-1].type == token.COMMA
         ):
             return False
 
         if closing.type == token.RBRACE:
             return True
 
         if closing.type == token.RSQB:
             if (
-                Preview.one_element_subscript in self.mode
-                and closing.parent
+                closing.parent
                 and closing.parent.type == syms.trailer
                 and closing.opening_bracket
                 and is_one_sequence_between(
                     closing.opening_bracket,
                     closing,
                     self.leaves,
                     brackets=(token.LSQB, token.RSQB),
@@ -303,26 +333,24 @@
 
             if not ensure_removable:
                 return True
 
             comma = self.leaves[-1]
             if comma.parent is None:
                 return False
-            if Preview.skip_magic_trailing_comma_in_subscript in self.mode:
-                return (
-                    comma.parent.type != syms.subscriptlist
-                    or closing.opening_bracket is None
-                    or not is_one_sequence_between(
-                        closing.opening_bracket,
-                        closing,
-                        self.leaves,
-                        brackets=(token.LSQB, token.RSQB),
-                    )
+            return (
+                comma.parent.type != syms.subscriptlist
+                or closing.opening_bracket is None
+                or not is_one_sequence_between(
+                    closing.opening_bracket,
+                    closing,
+                    self.leaves,
+                    brackets=(token.LSQB, token.RSQB),
                 )
-            return comma.parent.type == syms.listmaker
+            )
 
         if self.is_import:
             return True
 
         if closing.opening_bracket is not None and not is_one_sequence_between(
             closing.opening_bracket, closing, self.leaves
         ):
@@ -449,75 +477,137 @@
 
     def __bool__(self) -> bool:
         """Return True if the line has leaves or comments."""
         return bool(self.leaves or self.comments)
 
 
 @dataclass
+class RHSResult:
+    """Intermediate split result from a right hand split."""
+
+    head: Line
+    body: Line
+    tail: Line
+    opening_bracket: Leaf
+    closing_bracket: Leaf
+
+
+@dataclass
+class LinesBlock:
+    """Class that holds information about a block of formatted lines.
+
+    This is introduced so that the EmptyLineTracker can look behind the standalone
+    comments and adjust their empty lines for class or def lines.
+    """
+
+    mode: Mode
+    previous_block: Optional["LinesBlock"]
+    original_line: Line
+    before: int = 0
+    content_lines: List[str] = field(default_factory=list)
+    after: int = 0
+
+    def all_lines(self) -> List[str]:
+        empty_line = str(Line(mode=self.mode))
+        return (
+            [empty_line * self.before] + self.content_lines + [empty_line * self.after]
+        )
+
+
+@dataclass
 class EmptyLineTracker:
     """Provides a stateful method that returns the number of potential extra
     empty lines needed before and after the currently processed line.
 
     Note: this tracker works on lines that haven't been split yet.  It assumes
     the prefix of the first leaf consists of optional newlines.  Those newlines
     are consumed by `maybe_empty_lines()` and included in the computation.
     """
 
-    is_pyi: bool = False
+    mode: Mode
     previous_line: Optional[Line] = None
-    previous_after: int = 0
-    previous_defs: List[int] = field(default_factory=list)
+    previous_block: Optional[LinesBlock] = None
+    previous_defs: List[Line] = field(default_factory=list)
+    semantic_leading_comment: Optional[LinesBlock] = None
 
-    def maybe_empty_lines(self, current_line: Line) -> Tuple[int, int]:
+    def maybe_empty_lines(self, current_line: Line) -> LinesBlock:
         """Return the number of extra empty lines before and after the `current_line`.
 
         This is for separating `def`, `async def` and `class` with extra empty
         lines (two on module-level).
         """
         before, after = self._maybe_empty_lines(current_line)
+        previous_after = self.previous_block.after if self.previous_block else 0
         before = (
             # Black should not insert empty lines at the beginning
             # of the file
             0
             if self.previous_line is None
-            else before - self.previous_after
+            else before - previous_after
         )
-        self.previous_after = after
+        block = LinesBlock(
+            mode=self.mode,
+            previous_block=self.previous_block,
+            original_line=current_line,
+            before=before,
+            after=after,
+        )
+
+        # Maintain the semantic_leading_comment state.
+        if current_line.is_comment:
+            if self.previous_line is None or (
+                not self.previous_line.is_decorator
+                # `or before` means this comment already has an empty line before
+                and (not self.previous_line.is_comment or before)
+                and (self.semantic_leading_comment is None or before)
+            ):
+                self.semantic_leading_comment = block
+        # `or before` means this decorator already has an empty line before
+        elif not current_line.is_decorator or before:
+            self.semantic_leading_comment = None
+
         self.previous_line = current_line
-        return before, after
+        self.previous_block = block
+        return block
 
     def _maybe_empty_lines(self, current_line: Line) -> Tuple[int, int]:
         max_allowed = 1
         if current_line.depth == 0:
-            max_allowed = 1 if self.is_pyi else 2
+            max_allowed = 1 if self.mode.is_pyi else 2
         if current_line.leaves:
             # Consume the first leaf's extra newlines.
             first_leaf = current_line.leaves[0]
             before = first_leaf.prefix.count("\n")
             before = min(before, max_allowed)
             first_leaf.prefix = ""
         else:
             before = 0
         depth = current_line.depth
-        while self.previous_defs and self.previous_defs[-1] >= depth:
-            if self.is_pyi:
+        while self.previous_defs and self.previous_defs[-1].depth >= depth:
+            if self.mode.is_pyi:
                 assert self.previous_line is not None
                 if depth and not current_line.is_def and self.previous_line.is_def:
                     # Empty lines between attributes and methods should be preserved.
                     before = min(1, before)
+                elif (
+                    Preview.blank_line_after_nested_stub_class in self.mode
+                    and self.previous_defs[-1].is_class
+                    and not self.previous_defs[-1].is_stub_class
+                ):
+                    before = 1
                 elif depth:
                     before = 0
                 else:
                     before = 1
             else:
                 if depth:
                     before = 1
                 elif (
                     not depth
-                    and self.previous_defs[-1]
+                    and self.previous_defs[-1].depth
                     and current_line.leaves[-1].type == token.COLON
                     and (
                         current_line.leaves[0].value
                         not in ("with", "try", "for", "while", "if", "match")
                     )
                 ):
                     # We shouldn't add two newlines between an indented function and
@@ -534,62 +624,70 @@
         if current_line.is_decorator or current_line.is_def or current_line.is_class:
             return self._maybe_empty_lines_for_class_or_def(current_line, before)
 
         if (
             self.previous_line
             and self.previous_line.is_import
             and not current_line.is_import
+            and not current_line.is_fmt_pass_converted(first_leaf_matches=is_import)
             and depth == self.previous_line.depth
         ):
             return (before or 1), 0
 
         if (
             self.previous_line
             and self.previous_line.is_class
             and current_line.is_triple_quoted_string
         ):
             return before, 1
 
-        if (
-            Preview.remove_block_trailing_newline in current_line.mode
-            and self.previous_line
-            and self.previous_line.opens_block
-        ):
+        if self.previous_line and self.previous_line.opens_block:
             return 0, 0
         return before, 0
 
     def _maybe_empty_lines_for_class_or_def(
         self, current_line: Line, before: int
     ) -> Tuple[int, int]:
         if not current_line.is_decorator:
-            self.previous_defs.append(current_line.depth)
+            self.previous_defs.append(current_line)
         if self.previous_line is None:
             # Don't insert empty lines before the first line in the file.
             return 0, 0
 
         if self.previous_line.is_decorator:
-            if self.is_pyi and current_line.is_stub_class:
+            if self.mode.is_pyi and current_line.is_stub_class:
                 # Insert an empty line after a decorated stub class
                 return 0, 1
 
             return 0, 0
 
         if self.previous_line.depth < current_line.depth and (
             self.previous_line.is_class or self.previous_line.is_def
         ):
             return 0, 0
 
+        comment_to_add_newlines: Optional[LinesBlock] = None
         if (
             self.previous_line.is_comment
             and self.previous_line.depth == current_line.depth
             and before == 0
         ):
-            return 0, 0
+            slc = self.semantic_leading_comment
+            if (
+                slc is not None
+                and slc.previous_block is not None
+                and not slc.previous_block.original_line.is_class
+                and not slc.previous_block.original_line.opens_block
+                and slc.before <= 1
+            ):
+                comment_to_add_newlines = slc
+            else:
+                return 0, 0
 
-        if self.is_pyi:
+        if self.mode.is_pyi:
             if current_line.is_class or self.previous_line.is_class:
                 if self.previous_line.depth < current_line.depth:
                     newlines = 0
                 elif self.previous_line.depth > current_line.depth:
                     newlines = 1
                 elif current_line.is_stub_class and self.previous_line.is_stub_class:
                     # No blank line between classes with an empty body
@@ -609,14 +707,21 @@
                     newlines = 1
             elif self.previous_line.depth > current_line.depth:
                 newlines = 1
             else:
                 newlines = 0
         else:
             newlines = 1 if current_line.depth else 2
+        if comment_to_add_newlines is not None:
+            previous_block = comment_to_add_newlines.previous_block
+            if previous_block is not None:
+                comment_to_add_newlines.before = (
+                    max(comment_to_add_newlines.before, newlines) - previous_block.after
+                )
+                newlines = 0
         return newlines, 0
 
 
 def enumerate_reversed(sequence: Sequence[T]) -> Iterator[Tuple[Index, T]]:
     """Like `reversed(enumerate(sequence))` if that were possible."""
     index = len(sequence) - 1
     for element in reversed(sequence):
@@ -644,28 +749,105 @@
         replace_child(old_leaf, new_leaf)
         new_line.append(new_leaf, preformatted=preformatted)
 
         for comment_leaf in old_line.comments_after(old_leaf):
             new_line.append(comment_leaf, preformatted=True)
 
 
-def is_line_short_enough(line: Line, *, line_length: int, line_str: str = "") -> bool:
-    """Return True if `line` is no longer than `line_length`.
-
+def is_line_short_enough(  # noqa: C901
+    line: Line, *, mode: Mode, line_str: str = ""
+) -> bool:
+    """For non-multiline strings, return True if `line` is no longer than `line_length`.
+    For multiline strings, looks at the context around `line` to determine
+    if it should be inlined or split up.
     Uses the provided `line_str` rendering, if any, otherwise computes a new one.
     """
     if not line_str:
-        line_str = line_to_string(line, force_spaces=True)
+        line_str = line_to_string(line)
     else:
         line_str = line_str.expandtabs(tabsize=4)
-    return (
-        len(line_str) <= line_length
-        and "\n" not in line_str  # multiline strings
-        and not line.contains_standalone_comments()
-    )
+
+    width = str_width if mode.preview else len
+
+    if Preview.multiline_string_handling not in mode:
+        return (
+            width(line_str) <= mode.line_length
+            and "\n" not in line_str  # multiline strings
+            and not line.contains_standalone_comments()
+        )
+
+    if line.contains_standalone_comments():
+        return False
+    if "\n" not in line_str:
+        # No multiline strings (MLS) present
+        return width(line_str) <= mode.line_length
+
+    first, *_, last = line_str.split("\n")
+    if width(first) > mode.line_length or width(last) > mode.line_length:
+        return False
+
+    # Traverse the AST to examine the context of the multiline string (MLS),
+    # tracking aspects such as depth and comma existence,
+    # to determine whether to split the MLS or keep it together.
+    # Depth (which is based on the existing bracket_depth concept)
+    # is needed to determine nesting level of the MLS.
+    # Includes special case for trailing commas.
+    commas: List[int] = []  # tracks number of commas per depth level
+    multiline_string: Optional[Leaf] = None
+    # store the leaves that contain parts of the MLS
+    multiline_string_contexts: List[LN] = []
+
+    max_level_to_update = math.inf  # track the depth of the MLS
+    for i, leaf in enumerate(line.leaves):
+        if max_level_to_update == math.inf:
+            had_comma: Optional[int] = None
+            if leaf.bracket_depth + 1 > len(commas):
+                commas.append(0)
+            elif leaf.bracket_depth + 1 < len(commas):
+                had_comma = commas.pop()
+            if (
+                had_comma is not None
+                and multiline_string is not None
+                and multiline_string.bracket_depth == leaf.bracket_depth + 1
+            ):
+                # Have left the level with the MLS, stop tracking commas
+                max_level_to_update = leaf.bracket_depth
+                if had_comma > 0:
+                    # MLS was in parens with at least one comma - force split
+                    return False
+
+        if leaf.bracket_depth <= max_level_to_update and leaf.type == token.COMMA:
+            # Ignore non-nested trailing comma
+            # directly after MLS/MLS-containing expression
+            ignore_ctxs: List[Optional[LN]] = [None]
+            ignore_ctxs += multiline_string_contexts
+            if not (leaf.prev_sibling in ignore_ctxs and i == len(line.leaves) - 1):
+                commas[leaf.bracket_depth] += 1
+        if max_level_to_update != math.inf:
+            max_level_to_update = min(max_level_to_update, leaf.bracket_depth)
+
+        if is_multiline_string(leaf):
+            if len(multiline_string_contexts) > 0:
+                # >1 multiline string cannot fit on a single line - force split
+                return False
+            multiline_string = leaf
+            ctx: LN = leaf
+            # fetch the leaf components of the MLS in the AST
+            while str(ctx) in line_str:
+                multiline_string_contexts.append(ctx)
+                if ctx.parent is None:
+                    break
+                ctx = ctx.parent
+
+    # May not have a triple-quoted multiline string at all,
+    # in case of a regular string with embedded newlines and line continuations
+    if len(multiline_string_contexts) == 0:
+        return True
+
+    return all(val == 0 for val in commas)
 
 
 def can_be_split(line: Line) -> bool:
     """Return False if the line cannot be split *for sure*.
 
     This is not an exhaustive search but a cheap heuristic that we can use to
     avoid some unfortunate formattings (mostly around wrapping unsplittable code
@@ -697,33 +879,50 @@
             if dot_count > 1 and call_count > 1:
                 return False
 
     return True
 
 
 def can_omit_invisible_parens(
-    line: Line,
+    rhs: RHSResult,
     line_length: int,
 ) -> bool:
-    """Does `line` have a shape safe to reformat without optional parens around it?
+    """Does `rhs.body` have a shape safe to reformat without optional parens around it?
 
     Returns True for only a subset of potentially nice looking formattings but
     the point is to not return false positives that end up producing lines that
     are too long.
     """
+    line = rhs.body
     bt = line.bracket_tracker
     if not bt.delimiters:
         # Without delimiters the optional parentheses are useless.
         return True
 
     max_priority = bt.max_delimiter_priority()
-    if bt.delimiter_count_with_priority(max_priority) > 1:
+    delimiter_count = bt.delimiter_count_with_priority(max_priority)
+    if delimiter_count > 1:
         # With more than one delimiter of a kind the optional parentheses read better.
         return False
 
+    if delimiter_count == 1:
+        if (
+            Preview.wrap_multiple_context_managers_in_parens in line.mode
+            and max_priority == COMMA_PRIORITY
+            and rhs.head.is_with_or_async_with_stmt
+        ):
+            # For two context manager with statements, the optional parentheses read
+            # better. In this case, `rhs.body` is the context managers part of
+            # the with statement. `rhs.head` is the `with (` part on the previous
+            # line.
+            return False
+        # Otherwise it may also read better, but we don't do it today and requires
+        # careful considerations for all possible cases. See
+        # https://github.com/psf/black/issues/2156.
+
     if max_priority == DOT_PRIORITY:
         # A single stranded method call doesn't require optional parentheses.
         return True
 
     assert len(line.leaves) >= 2, "Stranded delimiter"
 
     # With a single delimiter, omit if the expression starts or ends with
```

### Comparing `tan-22.8.0/src/black/mode.py` & `tan-23.3.0/src/black/mode.py`

 * *Files 3% similar despite different names*

```diff
@@ -46,14 +46,15 @@
     RELAXED_DECORATORS = 10
     PATTERN_MATCHING = 11
     UNPACKING_ON_FLOW = 12
     ANN_ASSIGN_EXTENDED_RHS = 13
     EXCEPT_STAR = 14
     VARIADIC_GENERICS = 15
     DEBUG_F_STRINGS = 16
+    PARENTHESIZED_CONTEXT_MANAGERS = 17
     FORCE_OPTIONAL_PARENTHESES = 50
 
     # __future__ flags
     FUTURE_ANNOTATIONS = 51
 
 
 FUTURE_FLAG_TO_FEATURE: Final = {
@@ -102,28 +103,30 @@
         Feature.ASYNC_KEYWORDS,
         Feature.FUTURE_ANNOTATIONS,
         Feature.ASSIGNMENT_EXPRESSIONS,
         Feature.RELAXED_DECORATORS,
         Feature.POS_ONLY_ARGUMENTS,
         Feature.UNPACKING_ON_FLOW,
         Feature.ANN_ASSIGN_EXTENDED_RHS,
+        Feature.PARENTHESIZED_CONTEXT_MANAGERS,
     },
     TargetVersion.PY310: {
         Feature.F_STRINGS,
         Feature.DEBUG_F_STRINGS,
         Feature.NUMERIC_UNDERSCORES,
         Feature.TRAILING_COMMA_IN_CALL,
         Feature.TRAILING_COMMA_IN_DEF,
         Feature.ASYNC_KEYWORDS,
         Feature.FUTURE_ANNOTATIONS,
         Feature.ASSIGNMENT_EXPRESSIONS,
         Feature.RELAXED_DECORATORS,
         Feature.POS_ONLY_ARGUMENTS,
         Feature.UNPACKING_ON_FLOW,
         Feature.ANN_ASSIGN_EXTENDED_RHS,
+        Feature.PARENTHESIZED_CONTEXT_MANAGERS,
         Feature.PATTERN_MATCHING,
     },
     TargetVersion.PY311: {
         Feature.F_STRINGS,
         Feature.DEBUG_F_STRINGS,
         Feature.NUMERIC_UNDERSCORES,
         Feature.TRAILING_COMMA_IN_CALL,
@@ -131,60 +134,69 @@
         Feature.ASYNC_KEYWORDS,
         Feature.FUTURE_ANNOTATIONS,
         Feature.ASSIGNMENT_EXPRESSIONS,
         Feature.RELAXED_DECORATORS,
         Feature.POS_ONLY_ARGUMENTS,
         Feature.UNPACKING_ON_FLOW,
         Feature.ANN_ASSIGN_EXTENDED_RHS,
+        Feature.PARENTHESIZED_CONTEXT_MANAGERS,
         Feature.PATTERN_MATCHING,
         Feature.EXCEPT_STAR,
         Feature.VARIADIC_GENERICS,
     },
 }
 
 
 def supports_feature(target_versions: Set[TargetVersion], feature: Feature) -> bool:
     return all(feature in VERSION_TO_FEATURES[version] for version in target_versions)
 
 
 class Preview(Enum):
     """Individual preview style features."""
 
-    annotation_parens = auto()
-    long_docstring_quotes_on_newline = auto()
-    normalize_docstring_quotes_and_prefixes_properly = auto()
-    one_element_subscript = auto()
-    remove_block_trailing_newline = auto()
-    remove_redundant_parens = auto()
+    add_trailing_comma_consistently = auto()
+    blank_line_after_nested_stub_class = auto()
+    hex_codes_in_unicode_sequences = auto()
+    improved_async_statements_handling = auto()
+    multiline_string_handling = auto()
+    prefer_splitting_right_hand_side_of_assignments = auto()
+    # NOTE: string_processing requires wrap_long_dict_values_in_parens
+    # for https://github.com/psf/black/issues/3117 to be fixed.
     string_processing = auto()
+    parenthesize_conditional_expressions = auto()
     skip_magic_trailing_comma_in_subscript = auto()
+    wrap_long_dict_values_in_parens = auto()
+    wrap_multiple_context_managers_in_parens = auto()
 
 
 class Deprecated(UserWarning):
     """Visible deprecation warning."""
 
 
 @dataclass
 class Mode:
     target_versions: Set[TargetVersion] = field(default_factory=set)
     line_length: int = DEFAULT_LINE_LENGTH
     string_normalization: bool = True
     is_pyi: bool = False
     is_ipynb: bool = False
+    skip_source_first_line: bool = False
     magic_trailing_comma: bool = True
     experimental_string_processing: bool = False
     python_cell_magics: Set[str] = field(default_factory=set)
     preview: bool = False
     use_tabs: bool = False
 
     def __post_init__(self) -> None:
         if self.experimental_string_processing:
             warn(
-                "`experimental string processing` has been included in `preview`"
-                " and deprecated. Use `preview` instead.",
+                (
+                    "`experimental string processing` has been included in `preview`"
+                    " and deprecated. Use `preview` instead."
+                ),
                 Deprecated,
             )
 
     def __contains__(self, feature: Preview) -> bool:
         """
         Provide `Preview.FEATURE in Mode` syntax that mirrors the ``preview`` flag.
 
@@ -205,14 +217,15 @@
             version_str = "-"
         parts = [
             version_str,
             str(self.line_length),
             str(int(self.string_normalization)),
             str(int(self.is_pyi)),
             str(int(self.is_ipynb)),
+            str(int(self.skip_source_first_line)),
             str(int(self.magic_trailing_comma)),
             str(int(self.experimental_string_processing)),
             str(int(self.preview)),
             sha256((",".join(sorted(self.python_cell_magics))).encode()).hexdigest(),
             str(int(self.use_tabs)),
         ]
         return ".".join(parts)
```

### Comparing `tan-22.8.0/src/black/nodes.py` & `tan-23.3.0/src/black/nodes.py`

 * *Files 2% similar despite different names*

```diff
@@ -498,20 +498,22 @@
         if parent.prev_sibling is not None and parent.prev_sibling.type in BRACKETS:
             break
 
         container = parent
     return container
 
 
-def first_leaf_column(node: Node) -> Optional[int]:
-    """Returns the column of the first leaf child of a node."""
-    for child in node.children:
-        if isinstance(child, Leaf):
-            return child.column
-    return None
+def first_leaf_of(node: LN) -> Optional[Leaf]:
+    """Returns the first leaf of the node tree."""
+    if isinstance(node, Leaf):
+        return node
+    if node.children:
+        return first_leaf_of(node.children[0])
+    else:
+        return None
 
 
 def is_arith_like(node: LN) -> bool:
     """Whether node is an arithmetic or a binary arithmetic expression"""
     return node.type in {
         syms.arith_expr,
         syms.shift_expr,
@@ -557,14 +559,25 @@
     return (
         node.type in IMPLICIT_TUPLE
         and len(node.children) == 2
         and node.children[1].type == token.COMMA
     )
 
 
+def is_tuple_containing_walrus(node: LN) -> bool:
+    """Return True if `node` holds a tuple that contains a walrus operator."""
+    if node.type != syms.atom:
+        return False
+    gexp = unwrap_singleton_parenthesis(node)
+    if gexp is None or gexp.type != syms.testlist_gexp:
+        return False
+
+    return any(child.type == syms.namedexpr_test for child in gexp.children)
+
+
 def is_one_sequence_between(
     opening: Leaf,
     closing: Leaf,
     leaves: List[Leaf],
     brackets: Tuple[int, int] = (token.LPAR, token.RPAR),
 ) -> bool:
     """Return True if content between `opening` and `closing` is a one-sequence."""
@@ -772,14 +785,41 @@
         and (
             (v == "import" and p and p.type == syms.import_name)
             or (v == "from" and p and p.type == syms.import_from)
         )
     )
 
 
+def is_with_or_async_with_stmt(leaf: Leaf) -> bool:
+    """Return True if the given leaf starts a with or async with statement."""
+    return bool(
+        leaf.type == token.NAME
+        and leaf.value == "with"
+        and leaf.parent
+        and leaf.parent.type == syms.with_stmt
+    ) or bool(
+        leaf.type == token.ASYNC
+        and leaf.next_sibling
+        and leaf.next_sibling.type == syms.with_stmt
+    )
+
+
+def is_async_stmt_or_funcdef(leaf: Leaf) -> bool:
+    """Return True if the given leaf starts an async def/for/with statement.
+
+    Note that `async def` can be either an `async_stmt` or `async_funcdef`,
+    the latter is used when it has decorators.
+    """
+    return bool(
+        leaf.type == token.ASYNC
+        and leaf.parent
+        and leaf.parent.type in {syms.async_stmt, syms.async_funcdef}
+    )
+
+
 def is_type_comment(leaf: Leaf, suffix: str = "") -> bool:
     """Return True if the given leaf is a special comment.
     Only returns true for type comments for now."""
     t = leaf.type
     v = leaf.value
     return t in {token.COMMENT, STANDALONE_COMMENT} and v.startswith("# type:" + suffix)
 
@@ -842,7 +882,19 @@
 
 def is_string_token(nl: NL) -> TypeGuard[Leaf]:
     return nl.type == token.STRING
 
 
 def is_number_token(nl: NL) -> TypeGuard[Leaf]:
     return nl.type == token.NUMBER
+
+
+def is_part_of_annotation(leaf: Leaf) -> bool:
+    """Returns whether this leaf is part of type annotations."""
+    ancestor = leaf.parent
+    while ancestor is not None:
+        if ancestor.prev_sibling and ancestor.prev_sibling.type == token.RARROW:
+            return True
+        if ancestor.parent and ancestor.parent.type == syms.tname:
+            return True
+        ancestor = ancestor.parent
+    return False
```

### Comparing `tan-22.8.0/src/black/numerics.py` & `tan-23.3.0/src/black/numerics.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/black/output.py` & `tan-23.3.0/src/black/output.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/black/parsing.py` & `tan-23.3.0/src/black/parsing.py`

 * *Files 3% similar despite different names*

```diff
@@ -7,15 +7,15 @@
 from typing import Any, Iterable, Iterator, List, Set, Tuple, Type, Union
 
 if sys.version_info < (3, 8):
     from typing_extensions import Final
 else:
     from typing import Final
 
-from black.mode import Feature, TargetVersion, supports_feature
+from black.mode import VERSION_TO_FEATURES, Feature, TargetVersion, supports_feature
 from black.nodes import syms
 from blib2to3 import pygram
 from blib2to3.pgen2 import driver
 from blib2to3.pgen2.grammar import Grammar
 from blib2to3.pgen2.parse import ParseError
 from blib2to3.pgen2.tokenize import TokenError
 from blib2to3.pytree import Leaf, Node
@@ -23,20 +23,21 @@
 ast3: Any
 
 _IS_PYPY = platform.python_implementation() == "PyPy"
 
 try:
     from typed_ast import ast3
 except ImportError:
-    # Either our python version is too low, or we're on pypy
-    if sys.version_info < (3, 7) or (sys.version_info < (3, 8) and not _IS_PYPY):
+    if sys.version_info < (3, 8) and not _IS_PYPY:
         print(
-            "The typed_ast package is required but not installed.\n"
-            "You can upgrade to Python 3.8+ or install typed_ast with\n"
-            "`python3 -m pip install typed-ast`.",
+            (
+                "The typed_ast package is required but not installed.\n"
+                "You can upgrade to Python 3.8+ or install typed_ast with\n"
+                "`python3 -m pip install typed-ast`."
+            ),
             file=sys.stderr,
         )
         sys.exit(1)
     else:
         ast3 = ast
 
 
@@ -47,15 +48,15 @@
     """Raised when input source code fails all parse attempts."""
 
 
 def get_grammars(target_versions: Set[TargetVersion]) -> List[Grammar]:
     if not target_versions:
         # No target_version specified, so try all grammars.
         return [
-            # Python 3.7+
+            # Python 3.7-3.9
             pygram.python_grammar_no_print_statement_no_exec_statement_async_keywords,
             # Python 3.0-3.6
             pygram.python_grammar_no_print_statement_no_exec_statement,
             # Python 3.10+
             pygram.python_grammar_soft_keywords,
         ]
 
@@ -67,15 +68,15 @@
         # Python 3.7-3.9
         grammars.append(
             pygram.python_grammar_no_print_statement_no_exec_statement_async_keywords
         )
     if not supports_feature(target_versions, Feature.ASYNC_KEYWORDS):
         # Python 3.0-3.6
         grammars.append(pygram.python_grammar_no_print_statement_no_exec_statement)
-    if supports_feature(target_versions, Feature.PATTERN_MATCHING):
+    if any(Feature.PATTERN_MATCHING in VERSION_TO_FEATURES[v] for v in target_versions):
         # Python 3.10+
         grammars.append(pygram.python_grammar_soft_keywords)
 
     # At least one of the above branches must have been taken, because every Python
     # version has exactly one of the two 'ASYNC_*' flags
     return grammars
 
@@ -143,48 +144,58 @@
 def lib2to3_unparse(node: Node) -> str:
     """Given a lib2to3 node, return its string representation."""
     code = str(node)
     return code
 
 
 def parse_single_version(
-    src: str, version: Tuple[int, int]
+    src: str, version: Tuple[int, int], *, type_comments: bool
 ) -> Union[ast.AST, ast3.AST]:
     filename = "<unknown>"
     # typed-ast is needed because of feature version limitations in the builtin ast 3.8>
     if sys.version_info >= (3, 8) and version >= (3,):
-        return ast.parse(src, filename, feature_version=version, type_comments=True)
+        return ast.parse(
+            src, filename, feature_version=version, type_comments=type_comments
+        )
 
     if _IS_PYPY:
         # PyPy 3.7 doesn't support type comment tracking which is not ideal, but there's
         # not much we can do as typed-ast won't work either.
         if sys.version_info >= (3, 8):
-            return ast3.parse(src, filename, type_comments=True)
+            return ast3.parse(src, filename, type_comments=type_comments)
         else:
             return ast3.parse(src, filename)
     else:
-        # Typed-ast is guaranteed to be used here and automatically tracks type
-        # comments separately.
-        return ast3.parse(src, filename, feature_version=version[1])
-
-    raise AssertionError("INTERNAL ERROR: Tried parsing unsupported Python version!")
+        if type_comments:
+            # Typed-ast is guaranteed to be used here and automatically tracks type
+            # comments separately.
+            return ast3.parse(src, filename, feature_version=version[1])
+        else:
+            return ast.parse(src, filename)
 
 
 def parse_ast(src: str) -> Union[ast.AST, ast3.AST]:
     # TODO: support Python 4+ ;)
     versions = [(3, minor) for minor in range(3, sys.version_info[1] + 1)]
 
     first_error = ""
     for version in sorted(versions, reverse=True):
         try:
-            return parse_single_version(src, version)
+            return parse_single_version(src, version, type_comments=True)
         except SyntaxError as e:
             if not first_error:
                 first_error = str(e)
 
+    # Try to parse without type comments
+    for version in sorted(versions, reverse=True):
+        try:
+            return parse_single_version(src, version, type_comments=False)
+        except SyntaxError:
+            pass
+
     raise SyntaxError(first_error)
 
 
 ast3_AST: Final[Type[ast3.AST]] = ast3.AST
 
 
 def _normalize(lineend: str, value: str) -> str:
```

### Comparing `tan-22.8.0/src/black/report.py` & `tan-23.3.0/src/black/report.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/black/rusty.py` & `tan-23.3.0/src/black/rusty.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/black/strings.py` & `tan-23.3.0/src/black/strings.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,27 +1,39 @@
 """
 Simple formatting on strings. Further string formatting code is in trans.py.
 """
 
 import re
 import sys
 from functools import lru_cache
-from typing import List, Pattern
+from typing import List, Match, Pattern
+
+from blib2to3.pytree import Leaf
 
 if sys.version_info < (3, 8):
     from typing_extensions import Final
 else:
     from typing import Final
 
+from black._width_table import WIDTH_TABLE
 
 STRING_PREFIX_CHARS: Final = "furbFURB"  # All possible string prefix characters.
 STRING_PREFIX_RE: Final = re.compile(
     r"^([" + STRING_PREFIX_CHARS + r"]*)(.*)$", re.DOTALL
 )
 FIRST_NON_WHITESPACE_RE: Final = re.compile(r"\s*\t+\s*(\S)")
+UNICODE_ESCAPE_RE: Final = re.compile(
+    r"(?P<backslashes>\\+)(?P<body>"
+    r"(u(?P<u>[a-fA-F0-9]{4}))"  # Character with 16-bit hex value xxxx
+    r"|(U(?P<U>[a-fA-F0-9]{8}))"  # Character with 32-bit hex value xxxxxxxx
+    r"|(x(?P<x>[a-fA-F0-9]{2}))"  # Character with hex value hh
+    r"|(N\{(?P<N>[a-zA-Z0-9 \-]{2,})\})"  # Character named name in the Unicode database
+    r")",
+    re.VERBOSE,
+)
 
 
 def sub_twice(regex: Pattern[str], replacement: str, original: str) -> str:
     """Replace `regex` with `replacement` twice on `original`.
 
     This is used by string normalization to perform replaces on
     overlapping matches.
@@ -235,7 +247,92 @@
     if new_escape_count > orig_escape_count:
         return s  # Do not introduce more escaping
 
     if new_escape_count == orig_escape_count and orig_quote == '"':
         return s  # Prefer double quotes
 
     return f"{prefix}{new_quote}{new_body}{new_quote}"
+
+
+def normalize_unicode_escape_sequences(leaf: Leaf) -> None:
+    """Replace hex codes in Unicode escape sequences with lowercase representation."""
+    text = leaf.value
+    prefix = get_string_prefix(text)
+    if "r" in prefix.lower():
+        return
+
+    def replace(m: Match[str]) -> str:
+        groups = m.groupdict()
+        back_slashes = groups["backslashes"]
+
+        if len(back_slashes) % 2 == 0:
+            return back_slashes + groups["body"]
+
+        if groups["u"]:
+            # \u
+            return back_slashes + "u" + groups["u"].lower()
+        elif groups["U"]:
+            # \U
+            return back_slashes + "U" + groups["U"].lower()
+        elif groups["x"]:
+            # \x
+            return back_slashes + "x" + groups["x"].lower()
+        else:
+            assert groups["N"], f"Unexpected match: {m}"
+            # \N{}
+            return back_slashes + "N{" + groups["N"].upper() + "}"
+
+    leaf.value = re.sub(UNICODE_ESCAPE_RE, replace, text)
+
+
+@lru_cache(maxsize=4096)
+def char_width(char: str) -> int:
+    """Return the width of a single character as it would be displayed in a
+    terminal or editor (which respects Unicode East Asian Width).
+
+    Full width characters are counted as 2, while half width characters are
+    counted as 1.  Also control characters are counted as 0.
+    """
+    table = WIDTH_TABLE
+    codepoint = ord(char)
+    highest = len(table) - 1
+    lowest = 0
+    idx = highest // 2
+    while True:
+        start_codepoint, end_codepoint, width = table[idx]
+        if codepoint < start_codepoint:
+            highest = idx - 1
+        elif codepoint > end_codepoint:
+            lowest = idx + 1
+        else:
+            return 0 if width < 0 else width
+        if highest < lowest:
+            break
+        idx = (highest + lowest) // 2
+    return 1
+
+
+def str_width(line_str: str) -> int:
+    """Return the width of `line_str` as it would be displayed in a terminal
+    or editor (which respects Unicode East Asian Width).
+
+    You could utilize this function to determine, for example, if a string
+    is too wide to display in a terminal or editor.
+    """
+    if line_str.isascii():
+        # Fast path for a line consisting of only ASCII characters
+        return len(line_str)
+    return sum(map(char_width, line_str))
+
+
+def count_chars_in_width(line_str: str, max_width: int) -> int:
+    """Count the number of characters in `line_str` that would fit in a
+    terminal or editor of `max_width` (which respects Unicode East Asian
+    Width).
+    """
+    total_width = 0
+    for i, char in enumerate(line_str):
+        width = char_width(char)
+        if width + total_width > max_width:
+            return i
+        total_width += width
+    return len(line_str)
```

### Comparing `tan-22.8.0/src/black/trans.py` & `tan-23.3.0/src/black/trans.py`

 * *Files 3% similar despite different names*

```diff
@@ -26,66 +26,72 @@
 if sys.version_info < (3, 8):
     from typing_extensions import Final, Literal
 else:
     from typing import Literal, Final
 
 from mypy_extensions import trait
 
-from black.brackets import BracketMatchError
 from black.comments import contains_pragma_comment
 from black.lines import Line, append_leaves
-from black.mode import Feature
+from black.mode import Feature, Mode
 from black.nodes import (
     CLOSING_BRACKETS,
     OPENING_BRACKETS,
     STANDALONE_COMMENT,
     is_empty_lpar,
     is_empty_par,
     is_empty_rpar,
+    is_part_of_annotation,
     parent_type,
     replace_child,
     syms,
 )
 from black.rusty import Err, Ok, Result
 from black.strings import (
     assert_is_leaf_string,
+    count_chars_in_width,
     get_string_prefix,
     has_triple_quotes,
     normalize_string_quotes,
+    str_width,
 )
 from blib2to3.pgen2 import token
 from blib2to3.pytree import Leaf, Node
 
 
 class CannotTransform(Exception):
     """Base class for errors raised by Transformers."""
 
 
 # types
 T = TypeVar("T")
 LN = Union[Leaf, Node]
-Transformer = Callable[[Line, Collection[Feature]], Iterator[Line]]
+Transformer = Callable[[Line, Collection[Feature], Mode], Iterator[Line]]
 Index = int
 NodeType = int
 ParserState = int
 StringID = int
 TResult = Result[T, CannotTransform]  # (T)ransform Result
-TMatchResult = TResult[Index]
+TMatchResult = TResult[List[Index]]
+
+SPLIT_SAFE_CHARS = frozenset(["\u3001", "\u3002", "\uff0c"])  # East Asian stops
 
 
 def TErr(err_msg: str) -> Err[CannotTransform]:
     """(T)ransform Err
 
     Convenience function used when working with the TResult type.
     """
     cant_transform = CannotTransform(err_msg)
     return Err(cant_transform)
 
 
-def hug_power_op(line: Line, features: Collection[Feature]) -> Iterator[Line]:
+def hug_power_op(
+    line: Line, features: Collection[Feature], mode: Mode
+) -> Iterator[Line]:
     """A transformer which normalizes spacing around power operators."""
 
     # Performance optimization to avoid unnecessary Leaf clones and other ops.
     for leaf in line.leaves:
         if leaf.type == token.DOUBLESTAR:
             break
     else:
@@ -194,22 +200,27 @@
         self.line_length = line_length
         self.normalize_strings = normalize_strings
 
     @abstractmethod
     def do_match(self, line: Line) -> TMatchResult:
         """
         Returns:
-            * Ok(string_idx) such that `line.leaves[string_idx]` is our target
-            string, if a match was able to be made.
+            * Ok(string_indices) such that for each index, `line.leaves[index]`
+            is our target string if a match was able to be made. For
+            transformers that don't result in more lines (e.g. StringMerger,
+            StringParenStripper), multiple matches and transforms are done at
+            once to reduce the complexity.
                 OR
-            * Err(CannotTransform), if a match was not able to be made.
+            * Err(CannotTransform), if no match could be made.
         """
 
     @abstractmethod
-    def do_transform(self, line: Line, string_idx: int) -> Iterator[TResult[Line]]:
+    def do_transform(
+        self, line: Line, string_indices: List[int]
+    ) -> Iterator[TResult[Line]]:
         """
         Yields:
             * Ok(new_line) where new_line is the new transformed line.
                 OR
             * Err(CannotTransform) if the transformation failed for some reason. The
             `do_match(...)` template method should usually be used to reject
             the form of the given Line, but in some cases it is difficult to
@@ -219,15 +230,17 @@
         Side Effects:
             This method should NOT mutate @line directly, but it MAY mutate the
             Line's underlying Node structure. (WARNING: If the underlying Node
             structure IS altered, then this method should NOT be allowed to
             yield an CannotTransform after that point.)
         """
 
-    def __call__(self, line: Line, _features: Collection[Feature]) -> Iterator[Line]:
+    def __call__(
+        self, line: Line, _features: Collection[Feature], _mode: Mode
+    ) -> Iterator[Line]:
         """
         StringTransformer instances have a call signature that mirrors that of
         the Transformer type.
 
         Raises:
             CannotTransform(...) if the concrete StringTransformer class is unable
             to transform @line.
@@ -242,17 +255,17 @@
         if isinstance(match_result, Err):
             cant_transform = match_result.err()
             raise CannotTransform(
                 f"The string transformer {self.__class__.__name__} does not recognize"
                 " this line as one that it can transform."
             ) from cant_transform
 
-        string_idx = match_result.ok()
+        string_indices = match_result.ok()
 
-        for line_result in self.do_transform(line, string_idx):
+        for line_result in self.do_transform(line, string_indices):
             if isinstance(line_result, Err):
                 cant_transform = line_result.err()
                 raise CannotTransform(
                     "StringTransformer failed while attempting to transform string."
                 ) from cant_transform
             line = line_result.ok()
             yield line
@@ -347,15 +360,15 @@
 
 
 class StringMerger(StringTransformer, CustomSplitMapMixin):
     """StringTransformer that merges strings together.
 
     Requirements:
         (A) The line contains adjacent strings such that ALL of the validation checks
-        listed in StringMerger.__validate_msg(...)'s docstring pass.
+        listed in StringMerger._validate_msg(...)'s docstring pass.
             OR
         (B) The line contains a string which uses line continuation backslashes.
 
     Transformations:
         Depending on which of the two requirements above where met, either:
 
         (A) The string group associated with the target string is merged.
@@ -367,36 +380,58 @@
     """
 
     def do_match(self, line: Line) -> TMatchResult:
         LL = line.leaves
 
         is_valid_index = is_valid_index_factory(LL)
 
-        for i, leaf in enumerate(LL):
+        string_indices = []
+        idx = 0
+        while is_valid_index(idx):
+            leaf = LL[idx]
             if (
                 leaf.type == token.STRING
-                and is_valid_index(i + 1)
-                and LL[i + 1].type == token.STRING
+                and is_valid_index(idx + 1)
+                and LL[idx + 1].type == token.STRING
             ):
-                return Ok(i)
+                if not is_part_of_annotation(leaf):
+                    string_indices.append(idx)
 
-            if leaf.type == token.STRING and "\\\n" in leaf.value:
-                return Ok(i)
+                # Advance to the next non-STRING leaf.
+                idx += 2
+                while is_valid_index(idx) and LL[idx].type == token.STRING:
+                    idx += 1
+
+            elif leaf.type == token.STRING and "\\\n" in leaf.value:
+                string_indices.append(idx)
+                # Advance to the next non-STRING leaf.
+                idx += 1
+                while is_valid_index(idx) and LL[idx].type == token.STRING:
+                    idx += 1
 
-        return TErr("This line has no strings that need merging.")
+            else:
+                idx += 1
+
+        if string_indices:
+            return Ok(string_indices)
+        else:
+            return TErr("This line has no strings that need merging.")
 
-    def do_transform(self, line: Line, string_idx: int) -> Iterator[TResult[Line]]:
+    def do_transform(
+        self, line: Line, string_indices: List[int]
+    ) -> Iterator[TResult[Line]]:
         new_line = line
+
         rblc_result = self._remove_backslash_line_continuation_chars(
-            new_line, string_idx
+            new_line, string_indices
         )
         if isinstance(rblc_result, Ok):
             new_line = rblc_result.ok()
 
-        msg_result = self._merge_string_group(new_line, string_idx)
+        msg_result = self._merge_string_group(new_line, string_indices)
         if isinstance(msg_result, Ok):
             new_line = msg_result.ok()
 
         if isinstance(rblc_result, Err) and isinstance(msg_result, Err):
             msg_cant_transform = msg_result.err()
             rblc_cant_transform = rblc_result.err()
             cant_transform = CannotTransform(
@@ -409,67 +444,121 @@
 
             yield Err(cant_transform)
         else:
             yield Ok(new_line)
 
     @staticmethod
     def _remove_backslash_line_continuation_chars(
-        line: Line, string_idx: int
+        line: Line, string_indices: List[int]
     ) -> TResult[Line]:
         """
         Merge strings that were split across multiple lines using
         line-continuation backslashes.
 
         Returns:
             Ok(new_line), if @line contains backslash line-continuation
             characters.
                 OR
             Err(CannotTransform), otherwise.
         """
         LL = line.leaves
 
-        string_leaf = LL[string_idx]
-        if not (
-            string_leaf.type == token.STRING
-            and "\\\n" in string_leaf.value
-            and not has_triple_quotes(string_leaf.value)
-        ):
+        indices_to_transform = []
+        for string_idx in string_indices:
+            string_leaf = LL[string_idx]
+            if (
+                string_leaf.type == token.STRING
+                and "\\\n" in string_leaf.value
+                and not has_triple_quotes(string_leaf.value)
+            ):
+                indices_to_transform.append(string_idx)
+
+        if not indices_to_transform:
             return TErr(
-                f"String leaf {string_leaf} does not contain any backslash line"
-                " continuation characters."
+                "Found no string leaves that contain backslash line continuation"
+                " characters."
             )
 
         new_line = line.clone()
         new_line.comments = line.comments.copy()
         append_leaves(new_line, line, LL)
 
-        new_string_leaf = new_line.leaves[string_idx]
-        new_string_leaf.value = new_string_leaf.value.replace("\\\n", "")
+        for string_idx in indices_to_transform:
+            new_string_leaf = new_line.leaves[string_idx]
+            new_string_leaf.value = new_string_leaf.value.replace("\\\n", "")
 
         return Ok(new_line)
 
-    def _merge_string_group(self, line: Line, string_idx: int) -> TResult[Line]:
+    def _merge_string_group(
+        self, line: Line, string_indices: List[int]
+    ) -> TResult[Line]:
         """
-        Merges string group (i.e. set of adjacent strings) where the first
-        string in the group is `line.leaves[string_idx]`.
+        Merges string groups (i.e. set of adjacent strings).
+
+        Each index from `string_indices` designates one string group's first
+        leaf in `line.leaves`.
 
         Returns:
             Ok(new_line), if ALL of the validation checks found in
-            __validate_msg(...) pass.
+            _validate_msg(...) pass.
                 OR
             Err(CannotTransform), otherwise.
         """
         LL = line.leaves
 
         is_valid_index = is_valid_index_factory(LL)
 
-        vresult = self._validate_msg(line, string_idx)
-        if isinstance(vresult, Err):
-            return vresult
+        # A dict of {string_idx: tuple[num_of_strings, string_leaf]}.
+        merged_string_idx_dict: Dict[int, Tuple[int, Leaf]] = {}
+        for string_idx in string_indices:
+            vresult = self._validate_msg(line, string_idx)
+            if isinstance(vresult, Err):
+                continue
+            merged_string_idx_dict[string_idx] = self._merge_one_string_group(
+                LL, string_idx, is_valid_index
+            )
+
+        if not merged_string_idx_dict:
+            return TErr("No string group is merged")
+
+        # Build the final line ('new_line') that this method will later return.
+        new_line = line.clone()
+        previous_merged_string_idx = -1
+        previous_merged_num_of_strings = -1
+        for i, leaf in enumerate(LL):
+            if i in merged_string_idx_dict:
+                previous_merged_string_idx = i
+                previous_merged_num_of_strings, string_leaf = merged_string_idx_dict[i]
+                new_line.append(string_leaf)
+
+            if (
+                previous_merged_string_idx
+                <= i
+                < previous_merged_string_idx + previous_merged_num_of_strings
+            ):
+                for comment_leaf in line.comments_after(LL[i]):
+                    new_line.append(comment_leaf, preformatted=True)
+                continue
+
+            append_leaves(new_line, line, [leaf])
 
+        return Ok(new_line)
+
+    def _merge_one_string_group(
+        self, LL: List[Leaf], string_idx: int, is_valid_index: Callable[[int], bool]
+    ) -> Tuple[int, Leaf]:
+        """
+        Merges one string group where the first string in the group is
+        `LL[string_idx]`.
+
+        Returns:
+            A tuple of `(num_of_strings, leaf)` where `num_of_strings` is the
+            number of strings merged and `leaf` is the newly merged string
+            to be replaced in the new line.
+        """
         # If the string group is wrapped inside an Atom node, we must make sure
         # to later replace that Atom with our new (merged) string leaf.
         atom_node = LL[string_idx].parent
 
         # We will place BREAK_MARK in between every two substrings that we
         # merge. We will then later go through our final result and use the
         # various instances of BREAK_MARK we find to add the right values to
@@ -487,14 +576,20 @@
             Returns:
                 A string that is identical to @string except that
                 @string_prefix has been stripped, the surrounding QUOTE
                 characters have been removed, and any remaining QUOTE
                 characters have been escaped.
             """
             assert_is_leaf_string(string)
+            if "f" in string_prefix:
+                string = _toggle_fexpr_quotes(string, QUOTE)
+                # After quotes toggling, quotes in expressions won't be escaped
+                # because quotes can't be reused in f-strings. So we can simply
+                # let the escaping logic below run without knowing f-string
+                # expressions.
 
             RE_EVEN_BACKSLASHES = r"(?:(?<!\\)(?:\\\\)*)"
             naked_string = string[len(string_prefix) + 1 : -1]
             naked_string = re.sub(
                 "(" + RE_EVEN_BACKSLASHES + ")" + QUOTE, r"\1\\" + QUOTE, naked_string
             )
             return naked_string
@@ -584,48 +679,40 @@
                     LL[idx].remove()
                 if first_child_idx is not None:
                     atom_node.insert_child(first_child_idx, string_leaf)
             else:
                 # Else replace the atom node with the new string leaf.
                 replace_child(atom_node, string_leaf)
 
-        # Build the final line ('new_line') that this method will later return.
-        new_line = line.clone()
-        for i, leaf in enumerate(LL):
-            if i == string_idx:
-                new_line.append(string_leaf)
-
-            if string_idx <= i < string_idx + num_of_strings:
-                for comment_leaf in line.comments_after(LL[i]):
-                    new_line.append(comment_leaf, preformatted=True)
-                continue
-
-            append_leaves(new_line, line, [leaf])
-
         self.add_custom_splits(string_leaf.value, custom_splits)
-        return Ok(new_line)
+        return num_of_strings, string_leaf
 
     @staticmethod
     def _validate_msg(line: Line, string_idx: int) -> TResult[None]:
         """Validate (M)erge (S)tring (G)roup
 
-        Transform-time string validation logic for __merge_string_group(...).
+        Transform-time string validation logic for _merge_string_group(...).
 
         Returns:
             * Ok(None), if ALL validation checks (listed below) pass.
                 OR
             * Err(CannotTransform), if any of the following are true:
                 - The target string group does not contain ANY stand-alone comments.
                 - The target string is not in a string group (i.e. it has no
                   adjacent strings).
                 - The string group has more than one inline comment.
                 - The string group has an inline comment that appears to be a pragma.
                 - The set of all string prefixes in the string group is of
                   length greater than one and is not equal to {"", "f"}.
                 - The string group consists of raw strings.
+                - The string group is stringified type annotations. We don't want to
+                  process stringified type annotations since pyright doesn't support
+                  them spanning multiple string values. (NOTE: mypy, pytype, pyre do
+                  support them, so we can change if pyright also gains support in the
+                  future. See https://github.com/microsoft/pyright/issues/4359.)
         """
         # We first check for "inner" stand-alone comments (i.e. stand-alone
         # comments that have a string leaf before them AND after them).
         for inc in [1, -1]:
             i = string_idx
             found_sa_comment = False
             is_valid_index = is_valid_index_factory(line.leaves)
@@ -707,15 +794,23 @@
     """
 
     def do_match(self, line: Line) -> TMatchResult:
         LL = line.leaves
 
         is_valid_index = is_valid_index_factory(LL)
 
-        for idx, leaf in enumerate(LL):
+        string_indices = []
+
+        idx = -1
+        while True:
+            idx += 1
+            if idx >= len(LL):
+                break
+            leaf = LL[idx]
+
             # Should be a string...
             if leaf.type != token.STRING:
                 continue
 
             # If this is a "pointless" string...
             if (
                 leaf.parent
@@ -789,53 +884,81 @@
                     token.DOUBLESTAR,
                     token.LSQB,
                     token.LPAR,
                     token.DOT,
                 }:
                     continue
 
-                return Ok(string_idx)
+                string_indices.append(string_idx)
+                idx = string_idx
+                while idx < len(LL) - 1 and LL[idx + 1].type == token.STRING:
+                    idx += 1
 
+        if string_indices:
+            return Ok(string_indices)
         return TErr("This line has no strings wrapped in parens.")
 
-    def do_transform(self, line: Line, string_idx: int) -> Iterator[TResult[Line]]:
+    def do_transform(
+        self, line: Line, string_indices: List[int]
+    ) -> Iterator[TResult[Line]]:
         LL = line.leaves
 
-        string_parser = StringParser()
-        rpar_idx = string_parser.parse(LL, string_idx)
+        string_and_rpar_indices: List[int] = []
+        for string_idx in string_indices:
+            string_parser = StringParser()
+            rpar_idx = string_parser.parse(LL, string_idx)
 
-        for leaf in (LL[string_idx - 1], LL[rpar_idx]):
-            if line.comments_after(leaf):
-                yield TErr(
-                    "Will not strip parentheses which have comments attached to them."
-                )
-                return
+            should_transform = True
+            for leaf in (LL[string_idx - 1], LL[rpar_idx]):
+                if line.comments_after(leaf):
+                    # Should not strip parentheses which have comments attached
+                    # to them.
+                    should_transform = False
+                    break
+            if should_transform:
+                string_and_rpar_indices.extend((string_idx, rpar_idx))
+
+        if string_and_rpar_indices:
+            yield Ok(self._transform_to_new_line(line, string_and_rpar_indices))
+        else:
+            yield Err(
+                CannotTransform("All string groups have comments attached to them.")
+            )
+
+    def _transform_to_new_line(
+        self, line: Line, string_and_rpar_indices: List[int]
+    ) -> Line:
+        LL = line.leaves
 
         new_line = line.clone()
         new_line.comments = line.comments.copy()
-        try:
-            append_leaves(new_line, line, LL[: string_idx - 1])
-        except BracketMatchError:
-            # HACK: I believe there is currently a bug somewhere in
-            # right_hand_split() that is causing brackets to not be tracked
-            # properly by a shared BracketTracker.
-            append_leaves(new_line, line, LL[: string_idx - 1], preformatted=True)
-
-        string_leaf = Leaf(token.STRING, LL[string_idx].value)
-        LL[string_idx - 1].remove()
-        replace_child(LL[string_idx], string_leaf)
-        new_line.append(string_leaf)
 
-        append_leaves(
-            new_line, line, LL[string_idx + 1 : rpar_idx] + LL[rpar_idx + 1 :]
-        )
+        previous_idx = -1
+        # We need to sort the indices, since string_idx and its matching
+        # rpar_idx may not come in order, e.g. in
+        # `("outer" % ("inner".join(items)))`, the "inner" string's
+        # string_idx is smaller than "outer" string's rpar_idx.
+        for idx in sorted(string_and_rpar_indices):
+            leaf = LL[idx]
+            lpar_or_rpar_idx = idx - 1 if leaf.type == token.STRING else idx
+            append_leaves(new_line, line, LL[previous_idx + 1 : lpar_or_rpar_idx])
+            if leaf.type == token.STRING:
+                string_leaf = Leaf(token.STRING, LL[idx].value)
+                LL[lpar_or_rpar_idx].remove()  # Remove lpar.
+                replace_child(LL[idx], string_leaf)
+                new_line.append(string_leaf)
+            else:
+                LL[lpar_or_rpar_idx].remove()  # This is a rpar.
 
-        LL[rpar_idx].remove()
+            previous_idx = idx
 
-        yield Ok(new_line)
+        # Append the leaves after the last idx:
+        append_leaves(new_line, line, LL[idx + 1 :])
+
+        return new_line
 
 
 class BaseStringSplitter(StringTransformer):
     """
     Abstract class for StringTransformers which transform a Line's strings by splitting
     them or placing them on their own lines where necessary to avoid going over
     the configured line length.
@@ -880,15 +1003,20 @@
         """
 
     def do_match(self, line: Line) -> TMatchResult:
         match_result = self.do_splitter_match(line)
         if isinstance(match_result, Err):
             return match_result
 
-        string_idx = match_result.ok()
+        string_indices = match_result.ok()
+        assert len(string_indices) == 1, (
+            f"{self.__class__.__name__} should only find one match at a time, found"
+            f" {len(string_indices)}"
+        )
+        string_idx = string_indices[0]
         vresult = self._validate(line, string_idx)
         if isinstance(vresult, Err):
             return vresult
 
         return match_result
 
     def _validate(self, line: Line, string_idx: int) -> TResult[None]:
@@ -1036,15 +1164,15 @@
                 has_comments = True
                 # WMA4 two spaces before the '#' character.
                 offset += 2
 
             # WMA4 the length of the inline comment.
             offset += len(comment_leaf.value)
 
-        max_string_length = self.line_length - offset
+        max_string_length = count_chars_in_width(str(line), self.line_length - offset)
         return max_string_length
 
     @staticmethod
     def _prefer_paren_wrap_match(LL: List[Leaf]) -> Optional[int]:
         """
         Returns:
             string_idx such that @LL[string_idx] is equal to our target (i.e.
@@ -1054,31 +1182,27 @@
                 OR
             None, otherwise.
         """
         # The line must start with a string.
         if LL[0].type != token.STRING:
             return None
 
-        matching_nodes = [
-            syms.listmaker,
-            syms.dictsetmaker,
-            syms.testlist_gexp,
-        ]
-        # If the string is an immediate child of a list/set/tuple literal...
-        if (
-            parent_type(LL[0]) in matching_nodes
-            or parent_type(LL[0].parent) in matching_nodes
+        # If the string is surrounded by commas (or is the first/last child)...
+        prev_sibling = LL[0].prev_sibling
+        next_sibling = LL[0].next_sibling
+        if not prev_sibling and not next_sibling and parent_type(LL[0]) == syms.atom:
+            # If it's an atom string, we need to check the parent atom's siblings.
+            parent = LL[0].parent
+            assert parent is not None  # For type checkers.
+            prev_sibling = parent.prev_sibling
+            next_sibling = parent.next_sibling
+        if (not prev_sibling or prev_sibling.type == token.COMMA) and (
+            not next_sibling or next_sibling.type == token.COMMA
         ):
-            # And the string is surrounded by commas (or is the first/last child)...
-            prev_sibling = LL[0].prev_sibling
-            next_sibling = LL[0].next_sibling
-            if (not prev_sibling or prev_sibling.type == token.COMMA) and (
-                not next_sibling or next_sibling.type == token.COMMA
-            ):
-                return 0
+            return 0
 
         return None
 
 
 def iter_fexpr_spans(s: str) -> Iterator[Tuple[int, int]]:
     """
     Yields spans corresponding to expressions in a given f-string.
@@ -1126,14 +1250,38 @@
         i += 1
 
 
 def fstring_contains_expr(s: str) -> bool:
     return any(iter_fexpr_spans(s))
 
 
+def _toggle_fexpr_quotes(fstring: str, old_quote: str) -> str:
+    """
+    Toggles quotes used in f-string expressions that are `old_quote`.
+
+    f-string expressions can't contain backslashes, so we need to toggle the
+    quotes if the f-string itself will end up using the same quote. We can
+    simply toggle without escaping because, quotes can't be reused in f-string
+    expressions. They will fail to parse.
+
+    NOTE: If PEP 701 is accepted, above statement will no longer be true.
+    Though if quotes can be reused, we can simply reuse them without updates or
+    escaping, once Black figures out how to parse the new grammar.
+    """
+    new_quote = "'" if old_quote == '"' else '"'
+    parts = []
+    previous_index = 0
+    for start, end in iter_fexpr_spans(fstring):
+        parts.append(fstring[previous_index:start])
+        parts.append(fstring[start:end].replace(old_quote, new_quote))
+        previous_index = end
+    parts.append(fstring[previous_index:])
+    return "".join(parts)
+
+
 class StringSplitter(BaseStringSplitter, CustomSplitMapMixin):
     """
     StringTransformer that splits "atom" strings (i.e. strings which exist on
     lines by themselves).
 
     Requirements:
         * The line consists ONLY of a single string (possibly prefixed by a
@@ -1218,18 +1366,25 @@
         if is_valid_index(idx) and LL[idx].type == token.COMMA:
             idx += 1
 
         # But no more leaves are allowed...
         if is_valid_index(idx):
             return TErr("This line does not end with a string.")
 
-        return Ok(string_idx)
+        return Ok([string_idx])
 
-    def do_transform(self, line: Line, string_idx: int) -> Iterator[TResult[Line]]:
+    def do_transform(
+        self, line: Line, string_indices: List[int]
+    ) -> Iterator[TResult[Line]]:
         LL = line.leaves
+        assert len(string_indices) == 1, (
+            f"{self.__class__.__name__} should only find one match at a time, found"
+            f" {len(string_indices)}"
+        )
+        string_idx = string_indices[0]
 
         QUOTE = LL[string_idx].value[-1]
 
         is_valid_index = is_valid_index_factory(LL)
         insert_str_child = insert_str_child_factory(LL[string_idx])
 
         prefix = get_string_prefix(LL[string_idx].value).lower()
@@ -1242,15 +1397,15 @@
             LL[string_idx].value
         )
 
         first_string_line = True
 
         string_op_leaves = self._get_string_operator_leaves(LL)
         string_op_leaves_length = (
-            sum([len(str(prefix_leaf)) for prefix_leaf in string_op_leaves]) + 1
+            sum(len(str(prefix_leaf)) for prefix_leaf in string_op_leaves) + 1
             if string_op_leaves
             else 0
         )
 
         def maybe_append_string_operators(new_line: Line) -> None:
             """
             Side Effects:
@@ -1264,47 +1419,49 @@
                 replace_child(LL[i], prefix_leaf)
                 new_line.append(prefix_leaf)
 
         ends_with_comma = (
             is_valid_index(string_idx + 1) and LL[string_idx + 1].type == token.COMMA
         )
 
-        def max_last_string() -> int:
+        def max_last_string_column() -> int:
             """
             Returns:
-                The max allowed length of the string value used for the last
-                line we will construct.
+                The max allowed width of the string value used for the last
+                line we will construct.  Note that this value means the width
+                rather than the number of characters (e.g., many East Asian
+                characters expand to two columns).
             """
             result = self.line_length
             result -= line.depth * 4
             result -= 1 if ends_with_comma else 0
             result -= string_op_leaves_length
             return result
 
-        # --- Calculate Max Break Index (for string value)
+        # --- Calculate Max Break Width (for string value)
         # We start with the line length limit
-        max_break_idx = self.line_length
+        max_break_width = self.line_length
         # The last index of a string of length N is N-1.
-        max_break_idx -= 1
+        max_break_width -= 1
         # Leading whitespace is not present in the string value (e.g. Leaf.value).
-        max_break_idx -= line.depth * 4
-        if max_break_idx < 0:
+        max_break_width -= line.depth * 4
+        if max_break_width < 0:
             yield TErr(
                 f"Unable to split {LL[string_idx].value} at such high of a line depth:"
                 f" {line.depth}"
             )
             return
 
         # Check if StringMerger registered any custom splits.
         custom_splits = self.pop_custom_splits(LL[string_idx].value)
         # We use them ONLY if none of them would produce lines that exceed the
         # line limit.
         use_custom_breakpoints = bool(
             custom_splits
-            and all(csplit.break_idx <= max_break_idx for csplit in custom_splits)
+            and all(csplit.break_idx <= max_break_width for csplit in custom_splits)
         )
 
         # Temporary storage for the remaining chunk of the string line that
         # can't fit onto the line currently being constructed.
         rest_value = LL[string_idx].value
 
         def more_splits_should_be_made() -> bool:
@@ -1312,25 +1469,28 @@
             Returns:
                 True iff `rest_value` (the remaining string value from the last
                 split), should be split again.
             """
             if use_custom_breakpoints:
                 return len(custom_splits) > 1
             else:
-                return len(rest_value) > max_last_string()
+                return str_width(rest_value) > max_last_string_column()
 
         string_line_results: List[Ok[Line]] = []
         while more_splits_should_be_made():
             if use_custom_breakpoints:
                 # Custom User Split (manual)
                 csplit = custom_splits.pop(0)
                 break_idx = csplit.break_idx
             else:
                 # Algorithmic Split (automatic)
-                max_bidx = max_break_idx - string_op_leaves_length
+                max_bidx = (
+                    count_chars_in_width(rest_value, max_break_width)
+                    - string_op_leaves_length
+                )
                 maybe_break_idx = self._get_break_idx(rest_value, max_bidx)
                 if maybe_break_idx is None:
                     # If we are unable to algorithmically determine a good split
                     # and this string has custom splits registered to it, we
                     # fall back to using them--which means we have to start
                     # over from the beginning.
                     if custom_splits:
@@ -1359,17 +1519,22 @@
             # There is probably a better way to accomplish what is being done
             # here...
             #
             # If this substring is an f-string, we _could_ remove the 'f'
             # prefix, and the current custom split did NOT originally use a
             # prefix...
             if (
-                next_value != self._normalize_f_string(next_value, prefix)
-                and use_custom_breakpoints
+                use_custom_breakpoints
                 and not csplit.has_prefix
+                and (
+                    # `next_value == prefix + QUOTE` happens when the custom
+                    # split is an empty string.
+                    next_value == prefix + QUOTE
+                    or next_value != self._normalize_f_string(next_value, prefix)
+                )
             ):
                 # Then `csplit.break_idx` will be off by one after removing
                 # the 'f' prefix.
                 break_idx += 1
                 next_value = rest_value[:break_idx] + QUOTE
 
             if drop_pointless_f_prefix:
@@ -1414,15 +1579,15 @@
             for leaf in LL[string_idx + 1 :]:
                 temp_value += str(leaf)
                 if leaf.type == token.LPAR:
                     break
 
             # Try to fit them all on the same line with the last substring...
             if (
-                len(temp_value) <= max_last_string()
+                str_width(temp_value) <= max_last_string_column()
                 or LL[string_idx + 1].type == token.COMMA
             ):
                 last_line.append(rest_leaf)
                 append_leaves(last_line, line, LL[string_idx + 1 :])
                 yield Ok(last_line)
             # Otherwise, place the last substring on one line and everything
             # else on a line below that...
@@ -1534,27 +1699,28 @@
         def passes_all_checks(i: Index) -> bool:
             """
             Returns:
                 True iff ALL of the conditions listed in the 'Transformations'
                 section of this classes' docstring would be be met by returning @i.
             """
             is_space = string[i] == " "
+            is_split_safe = is_valid_index(i - 1) and string[i - 1] in SPLIT_SAFE_CHARS
 
             is_not_escaped = True
             j = i - 1
             while is_valid_index(j) and string[j] == "\\":
                 is_not_escaped = not is_not_escaped
                 j -= 1
 
             is_big_enough = (
                 len(string[i:]) >= self.MIN_SUBSTR_SIZE
                 and len(string[:i]) >= self.MIN_SUBSTR_SIZE
             )
             return (
-                is_space
+                (is_space or is_split_safe)
                 and is_not_escaped
                 and is_big_enough
                 and not breaks_unsplittable_expression(i)
             )
 
         # First, we check all indices BELOW @max_break_idx.
         break_idx = max_break_idx
@@ -1638,18 +1804,19 @@
         * The line is an assignment statement (e.g. `x = <string>` or `x +=
         <string>`) such that the variable is being assigned the value of some
         string.
             OR
         * The line is a dictionary key assignment where some valid key is being
         assigned the value of some string.
             OR
+        * The line is an lambda expression and the value is a string.
+            OR
         * The line starts with an "atom" string that prefers to be wrapped in
-        parens. It's preferred to be wrapped when it's is an immediate child of
-        a list/set/tuple literal, AND the string is surrounded by commas (or is
-        the first/last child).
+        parens. It's preferred to be wrapped when the string is surrounded by
+        commas (or is the first/last child).
 
     Transformations:
         The chosen string is wrapped in parentheses and then split at the LPAR.
 
         We then have one line which ends with an LPAR and another line that
         starts with the chosen string. The latter line is then split again at
         the RPAR. This results in the RPAR (and possibly a trailing comma)
@@ -1684,34 +1851,36 @@
             )
 
         string_idx = (
             self._return_match(LL)
             or self._else_match(LL)
             or self._assert_match(LL)
             or self._assign_match(LL)
-            or self._dict_match(LL)
+            or self._dict_or_lambda_match(LL)
             or self._prefer_paren_wrap_match(LL)
         )
 
         if string_idx is not None:
             string_value = line.leaves[string_idx].value
-            # If the string has no spaces...
-            if " " not in string_value:
+            # If the string has neither spaces nor East Asian stops...
+            if not any(
+                char == " " or char in SPLIT_SAFE_CHARS for char in string_value
+            ):
                 # And will still violate the line length limit when split...
-                max_string_length = self.line_length - ((line.depth + 1) * 4)
-                if len(string_value) > max_string_length:
+                max_string_width = self.line_length - ((line.depth + 1) * 4)
+                if str_width(string_value) > max_string_width:
                     # And has no associated custom splits...
                     if not self.has_custom_splits(string_value):
                         # Then we should NOT put this string on its own line.
                         return TErr(
                             "We do not wrap long strings in parentheses when the"
                             " resultant line would still be over the specified line"
                             " length and can't be split further by StringSplitter."
                         )
-            return Ok(string_idx)
+            return Ok([string_idx])
 
         return TErr("This line does not contain any non-atomic strings.")
 
     @staticmethod
     def _return_match(LL: List[Leaf]) -> Optional[int]:
         """
         Returns:
@@ -1842,31 +2011,32 @@
                         # But no more leaves are allowed...
                         if not is_valid_index(idx):
                             return string_idx
 
         return None
 
     @staticmethod
-    def _dict_match(LL: List[Leaf]) -> Optional[int]:
+    def _dict_or_lambda_match(LL: List[Leaf]) -> Optional[int]:
         """
         Returns:
             string_idx such that @LL[string_idx] is equal to our target (i.e.
             matched) string, if this line matches the dictionary key assignment
-            statement requirements listed in the 'Requirements' section of this
-            classes' docstring.
+            statement or lambda expression requirements listed in the
+            'Requirements' section of this classes' docstring.
                 OR
             None, otherwise.
         """
-        # If this line is apart of a dictionary key assignment...
-        if syms.dictsetmaker in [parent_type(LL[0]), parent_type(LL[0].parent)]:
+        # If this line is a part of a dictionary key assignment or lambda expression...
+        parent_types = [parent_type(LL[0]), parent_type(LL[0].parent)]
+        if syms.dictsetmaker in parent_types or syms.lambdef in parent_types:
             is_valid_index = is_valid_index_factory(LL)
 
             for i, leaf in enumerate(LL):
-                # We MUST find a colon...
-                if leaf.type == token.COLON:
+                # We MUST find a colon, it can either be dict's or lambda's colon...
+                if leaf.type == token.COLON and i < len(LL) - 1:
                     idx = i + 2 if is_empty_par(LL[i + 1]) else i + 1
 
                     # That colon MUST be followed by a string...
                     if is_valid_index(idx) and LL[idx].type == token.STRING:
                         string_idx = idx
 
                         # Skip the string trailer, if one exists.
@@ -1879,16 +2049,23 @@
 
                         # But no more leaves are allowed...
                         if not is_valid_index(idx):
                             return string_idx
 
         return None
 
-    def do_transform(self, line: Line, string_idx: int) -> Iterator[TResult[Line]]:
+    def do_transform(
+        self, line: Line, string_indices: List[int]
+    ) -> Iterator[TResult[Line]]:
         LL = line.leaves
+        assert len(string_indices) == 1, (
+            f"{self.__class__.__name__} should only find one match at a time, found"
+            f" {len(string_indices)}"
+        )
+        string_idx = string_indices[0]
 
         is_valid_index = is_valid_index_factory(LL)
         insert_str_child = insert_str_child_factory(LL[string_idx])
 
         comma_idx = -1
         ends_with_comma = False
         if LL[comma_idx].type == token.COMMA:
@@ -1952,14 +2129,33 @@
 
             if old_parens_exist:
                 assert right_leaves and right_leaves[-1].type == token.RPAR, (
                     "Apparently, old parentheses do NOT exist?!"
                     f" (left_leaves={left_leaves}, right_leaves={right_leaves})"
                 )
                 old_rpar_leaf = right_leaves.pop()
+            elif right_leaves and right_leaves[-1].type == token.RPAR:
+                # Special case for lambda expressions as dict's value, e.g.:
+                #     my_dict = {
+                #        "key": lambda x: f"formatted: {x},
+                #     }
+                # After wrapping the dict's value with parentheses, the string is
+                # followed by a RPAR but its opening bracket is lambda's, not
+                # the string's:
+                #        "key": (lambda x: f"formatted: {x}),
+                opening_bracket = right_leaves[-1].opening_bracket
+                if opening_bracket is not None and opening_bracket in left_leaves:
+                    index = left_leaves.index(opening_bracket)
+                    if (
+                        index > 0
+                        and index < len(left_leaves) - 1
+                        and left_leaves[index - 1].type == token.COLON
+                        and left_leaves[index + 1].value == "lambda"
+                    ):
+                        right_leaves.pop()
 
             append_leaves(string_line, line, right_leaves)
 
         yield Ok(string_line)
 
         # --- Last Line
         last_line = line.clone()
```

### Comparing `tan-22.8.0/src/blackd/__init__.py` & `tan-23.3.0/src/blackd/__init__.py`

 * *Files 8% similar despite different names*

```diff
@@ -26,24 +26,26 @@
 # This is used internally by tests to shut down the server prematurely
 _stop_signal = asyncio.Event()
 
 # Request headers
 PROTOCOL_VERSION_HEADER = "X-Protocol-Version"
 LINE_LENGTH_HEADER = "X-Line-Length"
 PYTHON_VARIANT_HEADER = "X-Python-Variant"
+SKIP_SOURCE_FIRST_LINE = "X-Skip-Source-First-Line"
 SKIP_STRING_NORMALIZATION_HEADER = "X-Skip-String-Normalization"
 SKIP_MAGIC_TRAILING_COMMA = "X-Skip-Magic-Trailing-Comma"
 PREVIEW = "X-Preview"
 FAST_OR_SAFE_HEADER = "X-Fast-Or-Safe"
 DIFF_HEADER = "X-Diff"
 
 BLACK_HEADERS = [
     PROTOCOL_VERSION_HEADER,
     LINE_LENGTH_HEADER,
     PYTHON_VARIANT_HEADER,
+    SKIP_SOURCE_FIRST_LINE,
     SKIP_STRING_NORMALIZATION_HEADER,
     SKIP_MAGIC_TRAILING_COMMA,
     PREVIEW,
     FAST_OR_SAFE_HEADER,
     DIFF_HEADER,
 ]
 
@@ -107,36 +109,57 @@
 
         skip_string_normalization = bool(
             request.headers.get(SKIP_STRING_NORMALIZATION_HEADER, False)
         )
         skip_magic_trailing_comma = bool(
             request.headers.get(SKIP_MAGIC_TRAILING_COMMA, False)
         )
+        skip_source_first_line = bool(
+            request.headers.get(SKIP_SOURCE_FIRST_LINE, False)
+        )
         preview = bool(request.headers.get(PREVIEW, False))
         fast = False
         if request.headers.get(FAST_OR_SAFE_HEADER, "safe") == "fast":
             fast = True
         mode = black.FileMode(
             target_versions=versions,
             is_pyi=pyi,
             line_length=line_length,
+            skip_source_first_line=skip_source_first_line,
             string_normalization=not skip_string_normalization,
             magic_trailing_comma=not skip_magic_trailing_comma,
             preview=preview,
         )
         req_bytes = await request.content.read()
         charset = request.charset if request.charset is not None else "utf8"
         req_str = req_bytes.decode(charset)
         then = datetime.utcnow()
 
+        header = ""
+        if skip_source_first_line:
+            first_newline_position: int = req_str.find("\n") + 1
+            header = req_str[:first_newline_position]
+            req_str = req_str[first_newline_position:]
+
         loop = asyncio.get_event_loop()
         formatted_str = await loop.run_in_executor(
             executor, partial(black.format_file_contents, req_str, fast=fast, mode=mode)
         )
 
+        # Preserve CRLF line endings
+        if req_str[req_str.find("\n") - 1] == "\r":
+            formatted_str = formatted_str.replace("\n", "\r\n")
+            # If, after swapping line endings, nothing changed, then say so
+            if formatted_str == req_str:
+                raise black.NothingChanged
+
+        # Put the source first line back
+        req_str = header + req_str
+        formatted_str = header + formatted_str
+
         # Only output the diff in the HTTP response
         only_diff = bool(request.headers.get(DIFF_HEADER, False))
         if only_diff:
             now = datetime.utcnow()
             src_name = f"In\t{then} +0000"
             dst_name = f"Out\t{now} +0000"
             loop = asyncio.get_event_loop()
```

### Comparing `tan-22.8.0/src/blib2to3/Grammar.txt` & `tan-23.3.0/src/blib2to3/Grammar.txt`

 * *Files 0% similar despite different names*

```diff
@@ -182,15 +182,15 @@
 # These need to be in a single rule to avoid grammar that is ambiguous
 # to our LL(1) parser. Even though 'test' includes '*expr' in star_expr,
 # we explicitly match '*' here, too, to give it proper precedence.
 # Illegal combinations and orderings are blocked in ast.c:
 # multiple (test comp_for) arguments are blocked; keyword unpackings
 # that precede iterable unpackings are blocked; etc.
 argument: ( test [comp_for] |
-            test ':=' test |
+            test ':=' test [comp_for] |
             test 'as' test |
             test '=' asexpr_test |
 	    '**' test |
             '*' test )
 
 comp_iter: comp_for | comp_if
 comp_for: [ASYNC] 'for' exprlist 'in' or_test [comp_iter]
```

### Comparing `tan-22.8.0/src/blib2to3/LICENSE` & `tan-23.3.0/src/blib2to3/LICENSE`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/PatternGrammar.txt` & `tan-23.3.0/src/blib2to3/PatternGrammar.txt`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/README` & `tan-23.3.0/src/blib2to3/README`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/pgen2/conv.py` & `tan-23.3.0/src/blib2to3/pgen2/conv.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/pgen2/driver.py` & `tan-23.3.0/src/blib2to3/pgen2/driver.py`

 * *Files 0% similar despite different names*

```diff
@@ -103,15 +103,15 @@
         else:
             token = next(self._tokens)
         self._counter += 1
         return token
 
     def can_advance(self, to: int) -> bool:
         # Try to eat, fail if it can't. The eat operation is cached
-        # so there wont be any additional cost of eating here
+        # so there won't be any additional cost of eating here
         try:
             self.eat(to)
         except StopIteration:
             return False
         else:
             return True
```

### Comparing `tan-22.8.0/src/blib2to3/pgen2/grammar.py` & `tan-23.3.0/src/blib2to3/pgen2/grammar.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/pgen2/literals.py` & `tan-23.3.0/src/blib2to3/pgen2/literals.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/pgen2/parse.py` & `tan-23.3.0/src/blib2to3/pgen2/parse.py`

 * *Files 1% similar despite different names*

```diff
@@ -28,15 +28,15 @@
     Set,
     TYPE_CHECKING,
 )
 from blib2to3.pgen2.grammar import Grammar
 from blib2to3.pytree import convert, NL, Context, RawNode, Leaf, Node
 
 if TYPE_CHECKING:
-    from blib2to3.driver import TokenProxy
+    from blib2to3.pgen2.driver import TokenProxy
 
 
 Results = Dict[Text, NL]
 Convert = Callable[[Grammar, RawNode], Union[Node, Leaf]]
 DFA = List[List[Tuple[int, int]]]
 DFAS = Tuple[DFA, Dict[int, int]]
```

### Comparing `tan-22.8.0/src/blib2to3/pgen2/pgen.py` & `tan-23.3.0/src/blib2to3/pgen2/pgen.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/pgen2/token.py` & `tan-23.3.0/src/blib2to3/pgen2/token.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/pgen2/tokenize.py` & `tan-23.3.0/src/blib2to3/pgen2/tokenize.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/pygram.py` & `tan-23.3.0/src/blib2to3/pygram.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/src/blib2to3/pytree.py` & `tan-23.3.0/src/blib2to3/pytree.py`

 * *Files 1% similar despite different names*

```diff
@@ -388,23 +388,28 @@
     bracket_depth: int
     # Changed later in brackets.py
     opening_bracket: Optional["Leaf"] = None
     used_names: Optional[Set[Text]]
     _prefix = ""  # Whitespace and comments preceding this token in the input
     lineno: int = 0  # Line where this token starts in the input
     column: int = 0  # Column where this token starts in the input
+    # If not None, this Leaf is created by converting a block of fmt off/skip
+    # code, and `fmt_pass_converted_first_leaf` points to the first Leaf in the
+    # converted code.
+    fmt_pass_converted_first_leaf: Optional["Leaf"] = None
 
     def __init__(
         self,
         type: int,
         value: Text,
         context: Optional[Context] = None,
         prefix: Optional[Text] = None,
         fixers_applied: List[Any] = [],
         opening_bracket: Optional["Leaf"] = None,
+        fmt_pass_converted_first_leaf: Optional["Leaf"] = None,
     ) -> None:
         """
         Initializer.
 
         Takes a type constant (a token number < 256), a string value, and an
         optional context keyword argument.
         """
@@ -415,14 +420,15 @@
         self.type = type
         self.value = value
         if prefix is not None:
             self._prefix = prefix
         self.fixers_applied: Optional[List[Any]] = fixers_applied[:]
         self.children = []
         self.opening_bracket = opening_bracket
+        self.fmt_pass_converted_first_leaf = fmt_pass_converted_first_leaf
 
     def __repr__(self) -> str:
         """Return a canonical string representation."""
         from .pgen2.token import tok_name
 
         assert self.type is not None
         return "%s(%s, %r)" % (
```

### Comparing `tan-22.8.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb` & `tan-23.3.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/jupyter/notebook_trailing_newline.ipynb` & `tan-23.3.0/tests/data/jupyter/notebook_trailing_newline.ipynb`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/jupyter/notebook_without_changes.ipynb` & `tan-23.3.0/tests/data/jupyter/notebook_without_changes.ipynb`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/debug_visitor.out` & `tan-23.3.0/tests/data/miscellaneous/debug_visitor.out`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/debug_visitor.py` & `tan-23.3.0/tests/data/miscellaneous/debug_visitor.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/decorators.py` & `tan-23.3.0/tests/data/miscellaneous/decorators.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/docstring_no_string_normalization.py` & `tan-23.3.0/tests/data/miscellaneous/docstring_no_string_normalization.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff` & `tan-23.3.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff`

 * *Files 1% similar despite different names*

```diff
@@ -140,16 +140,17 @@
  ....__class__
  list[str]
  dict[str, int]
  tuple[str, ...]
 -tuple[
 -    str, int, float, dict[str, int]
 -]
+-tuple[str, int, float, dict[str, int],]
++tuple[str, int, float, dict[str, int]]
 +tuple[str, int, float, dict[str, int]]
- tuple[str, int, float, dict[str, int],]
  very_long_variable_name_filters: t.List[
      t.Tuple[str, t.Union[str, t.List[t.Optional[str]]]],
  ]
  xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
      sync(async_xxxx_xxx_xxxx_xxxxx_xxxx_xxx.__func__)
  )
  xxxx_xxx_xxxx_xxxxx_xxxx_xxx: Callable[..., List[SomeClass]] = classmethod(  # type: ignore
```

### Comparing `tan-22.8.0/tests/data/miscellaneous/force_py36.py` & `tan-23.3.0/tests/data/miscellaneous/force_py36.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/force_pyi.py` & `tan-23.3.0/tests/data/miscellaneous/force_pyi.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/long_strings_flag_disabled.py` & `tan-23.3.0/tests/data/miscellaneous/long_strings_flag_disabled.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/python2_detection.py` & `tan-23.3.0/tests/data/miscellaneous/python2_detection.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/string_quotes.py` & `tan-23.3.0/tests/data/miscellaneous/string_quotes.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/miscellaneous/stub.pyi` & `tan-23.3.0/tests/data/miscellaneous/stub.pyi`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/preview/cantfit.py` & `tan-23.3.0/tests/data/preview/cantfit.py`

 * *Files 2% similar despite different names*

```diff
@@ -75,18 +75,22 @@
 normal_name = (
     but_the_function_name_is_now_ridiculously_long_and_it_is_still_super_annoying(
         [1, 2, 3], arg1, [1, 2, 3], arg2, [1, 2, 3], arg3
     )
 )
 # long arguments
 normal_name = normal_function_name(
-    "but with super long string arguments that on their own exceed the line limit so"
-    " there's no way it can ever fit",
-    "eggs with spam and eggs and spam with eggs with spam and eggs and spam with eggs"
-    " with spam and eggs and spam with eggs",
+    (
+        "but with super long string arguments that on their own exceed the line limit"
+        " so there's no way it can ever fit"
+    ),
+    (
+        "eggs with spam and eggs and spam with eggs with spam and eggs and spam with"
+        " eggs with spam and eggs and spam with eggs"
+    ),
     this_is_a_ridiculously_long_name_and_nobody_in_their_right_mind_would_use_one_like_it=0,
 )
 string_variable_name = "a string that is waaaaaaaayyyyyyyy too long, even in parens, there's nothing you can do"  # noqa
 for key in """
     hostname
     port
     username
```

### Comparing `tan-22.8.0/tests/data/preview/comments7.py` & `tan-23.3.0/tests/data/preview/comments7.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/preview/docstring_preview.py` & `tan-23.3.0/tests/data/simple_cases/docstring_preview.py`

 * *Files 1% similar despite different names*

```diff
@@ -50,21 +50,19 @@
     'We do not want to put the closing quote on a new line as that is invalid (see GH-3141).'
 
 
 # output
 
 
 def docstring_almost_at_line_limit():
-    """long docstring.................................................................
-    """
+    """long docstring................................................................."""
 
 
 def docstring_almost_at_line_limit_with_prefix():
-    f"""long docstring................................................................
-    """
+    f"""long docstring................................................................"""
 
 
 def mulitline_docstring_almost_at_line_limit():
     """long docstring.................................................................
 
     ..................................................................................
     """
```

### Comparing `tan-22.8.0/tests/data/preview/long_strings.py` & `tan-23.3.0/tests/data/preview/long_strings.py`

 * *Files 2% similar despite different names*

```diff
@@ -14,23 +14,31 @@
 
 D2 = {1.0: "This is a really long string that can't possibly be expected to fit all together on one line. Also it is inside a dictionary, so formatting is more difficult.", 2.0: "This is another really really (not really) long string that also can't be expected to fit on one line and is, like the other string, inside a dictionary."}
 
 D3 = {x: "This is a really long string that can't possibly be expected to fit all together on one line. Also it is inside a dictionary, so formatting is more difficult.", y: "This is another really really (not really) long string that also can't be expected to fit on one line and is, like the other string, inside a dictionary."}
 
 D4 = {"A long and ridiculous {}".format(string_key): "This is a really really really long string that has to go i,side of a dictionary. It is soooo bad.", some_func("calling", "some", "stuff"): "This is a really really really long string that has to go inside of a dictionary. It is {soooo} bad (#{x}).".format(sooo="soooo", x=2), "A %s %s" % ("formatted", "string"): "This is a really really really long string that has to go inside of a dictionary. It is %s bad (#%d)." % ("soooo", 2)}
 
-L1 = ["The is a short string", "This is a really long string that can't possibly be expected to fit all together on one line. Also it is inside a list literal, so it's expected to be wrapped in parens when spliting to avoid implicit str concatenation.", short_call("arg", {"key": "value"}), "This is another really really (not really) long string that also can't be expected to fit on one line and is, like the other string, inside a list literal.", ("parens should be stripped for short string in list")]
+D5 = {  # Test for https://github.com/psf/black/issues/3261
+    ("This is a really long string that can't be expected to fit in one line and is used as a nested dict's key"): {"inner": "value"},
+}
+
+D6 = {  # Test for https://github.com/psf/black/issues/3261
+    ("This is a really long string that can't be expected to fit in one line and is used as a dict's key"): ["value1", "value2"],
+}
+
+L1 = ["The is a short string", "This is a really long string that can't possibly be expected to fit all together on one line. Also it is inside a list literal, so it's expected to be wrapped in parens when splitting to avoid implicit str concatenation.", short_call("arg", {"key": "value"}), "This is another really really (not really) long string that also can't be expected to fit on one line and is, like the other string, inside a list literal.", ("parens should be stripped for short string in list")]
 
 L2 = ["This is a really long string that can't be expected to fit in one line and is the only child of a list literal."]
 
-S1 = {"The is a short string", "This is a really long string that can't possibly be expected to fit all together on one line. Also it is inside a set literal, so it's expected to be wrapped in parens when spliting to avoid implicit str concatenation.", short_call("arg", {"key": "value"}), "This is another really really (not really) long string that also can't be expected to fit on one line and is, like the other string, inside a set literal.", ("parens should be stripped for short string in set")}
+S1 = {"The is a short string", "This is a really long string that can't possibly be expected to fit all together on one line. Also it is inside a set literal, so it's expected to be wrapped in parens when splitting to avoid implicit str concatenation.", short_call("arg", {"key": "value"}), "This is another really really (not really) long string that also can't be expected to fit on one line and is, like the other string, inside a set literal.", ("parens should be stripped for short string in set")}
 
 S2 = {"This is a really long string that can't be expected to fit in one line and is the only child of a set literal."}
 
-T1 = ("The is a short string", "This is a really long string that can't possibly be expected to fit all together on one line. Also it is inside a tuple literal, so it's expected to be wrapped in parens when spliting to avoid implicit str concatenation.", short_call("arg", {"key": "value"}), "This is another really really (not really) long string that also can't be expected to fit on one line and is, like the other string, inside a tuple literal.", ("parens should be stripped for short string in list"))
+T1 = ("The is a short string", "This is a really long string that can't possibly be expected to fit all together on one line. Also it is inside a tuple literal, so it's expected to be wrapped in parens when splitting to avoid implicit str concatenation.", short_call("arg", {"key": "value"}), "This is another really really (not really) long string that also can't be expected to fit on one line and is, like the other string, inside a tuple literal.", ("parens should be stripped for short string in list"))
 
 T2 = ("This is a really long string that can't be expected to fit in one line and is the only child of a tuple literal.",)
 
 func_with_keywords(my_arg, my_kwarg="Long keyword strings also need to be wrapped, but they will probably need to be handled a little bit differently.")
 
 bad_split1 = (
     'But what should happen when code has already been formatted but in the wrong way? Like'
@@ -266,14 +274,40 @@
     "........................................................................ \\N{LAO KO LA}"
 )
 
 string_with_escaped_nameescape = (
     "........................................................................... \\N{LAO KO LA}"
 )
 
+msg = lambda x: f"this is a very very very long lambda value {x} that doesn't fit on a single line"
+
+dict_with_lambda_values = {
+    "join": lambda j: (
+        f"{j.__class__.__name__}({some_function_call(j.left)}, "
+        f"{some_function_call(j.right)})"
+    ),
+}
+
+# Complex string concatenations with a method call in the middle.
+code = (
+    ("    return [\n")
+    + (
+        ", \n".join(
+            "        (%r, self.%s, visitor.%s)"
+            % (attrname, attrname, visit_name)
+            for attrname, visit_name in names
+        )
+    )
+    + ("\n    ]\n")
+)
+
+
+# Test case of an outer string' parens enclose an inner string's parens.
+call(body=("%s %s" % ((",".join(items)), suffix)))
+
 
 # output
 
 
 x = (
     "This is a really long string that can't possibly be expected to fit all together"
     " on one line. In fact it may even take up three or more lines... like four or"
@@ -285,16 +319,18 @@
     " on one line. In fact it may even take up three or more lines... like four or"
     " five... but probably just three."
 )
 
 y = "Short string"
 
 print(
-    "This is a really long string inside of a print statement with extra arguments"
-    " attached at the end of it.",
+    (
+        "This is a really long string inside of a print statement with extra arguments"
+        " attached at the end of it."
+    ),
     x,
     y,
     z,
 )
 
 print(
     "This is a really long string inside of a print statement with no extra arguments"
@@ -348,25 +384,37 @@
     some_func("calling", "some", "stuff"): (
         "This is a really really really long string that has to go inside of a"
         " dictionary. It is {soooo} bad (#{x}).".format(sooo="soooo", x=2)
     ),
     "A %s %s"
     % ("formatted", "string"): (
         "This is a really really really long string that has to go inside of a"
-        " dictionary. It is %s bad (#%d)."
-    )
-    % ("soooo", 2),
+        " dictionary. It is %s bad (#%d)." % ("soooo", 2)
+    ),
+}
+
+D5 = {  # Test for https://github.com/psf/black/issues/3261
+    "This is a really long string that can't be expected to fit in one line and is used as a nested dict's key": {
+        "inner": "value"
+    },
+}
+
+D6 = {  # Test for https://github.com/psf/black/issues/3261
+    "This is a really long string that can't be expected to fit in one line and is used as a dict's key": [
+        "value1",
+        "value2",
+    ],
 }
 
 L1 = [
     "The is a short string",
     (
         "This is a really long string that can't possibly be expected to fit all"
         " together on one line. Also it is inside a list literal, so it's expected to"
-        " be wrapped in parens when spliting to avoid implicit str concatenation."
+        " be wrapped in parens when splitting to avoid implicit str concatenation."
     ),
     short_call("arg", {"key": "value"}),
     (
         "This is another really really (not really) long string that also can't be"
         " expected to fit on one line and is, like the other string, inside a list"
         " literal."
     ),
@@ -379,15 +427,15 @@
 ]
 
 S1 = {
     "The is a short string",
     (
         "This is a really long string that can't possibly be expected to fit all"
         " together on one line. Also it is inside a set literal, so it's expected to be"
-        " wrapped in parens when spliting to avoid implicit str concatenation."
+        " wrapped in parens when splitting to avoid implicit str concatenation."
     ),
     short_call("arg", {"key": "value"}),
     (
         "This is another really really (not really) long string that also can't be"
         " expected to fit on one line and is, like the other string, inside a set"
         " literal."
     ),
@@ -400,15 +448,15 @@
 }
 
 T1 = (
     "The is a short string",
     (
         "This is a really long string that can't possibly be expected to fit all"
         " together on one line. Also it is inside a tuple literal, so it's expected to"
-        " be wrapped in parens when spliting to avoid implicit str concatenation."
+        " be wrapped in parens when splitting to avoid implicit str concatenation."
     ),
     short_call("arg", {"key": "value"}),
     (
         "This is another really really (not really) long string that also can't be"
         " expected to fit on one line and is, like the other string, inside a tuple"
         " literal."
     ),
@@ -449,21 +497,23 @@
 bad_split3 = (
     "What if we have inline comments on "  # First Comment
     "each line of a bad split? In that "  # Second Comment
     "case, we should just leave it alone."  # Third Comment
 )
 
 bad_split_func1(
-    "But what should happen when code has already "
-    "been formatted but in the wrong way? Like "
-    "with a space at the end instead of the "
-    "beginning. Or what about when it is split too "
-    "soon? In the case of a split that is too "
-    "short, black will try to honer the custom "
-    "split.",
+    (
+        "But what should happen when code has already "
+        "been formatted but in the wrong way? Like "
+        "with a space at the end instead of the "
+        "beginning. Or what about when it is split too "
+        "soon? In the case of a split that is too "
+        "short, black will try to honer the custom "
+        "split."
+    ),
     xxx,
     yyy,
     zzz,
 )
 
 bad_split_func2(
     xxx,
@@ -558,17 +608,19 @@
 
 comment_string = (  # This comment gets thrown to the top.
     "Long lines with inline comments should have their comments appended to the"
     " reformatted string's enclosing right parentheses."
 )
 
 arg_comment_string = print(
-    "Long lines with inline comments which are apart of (and not the only member of) an"
-    " argument list should have their comments appended to the reformatted string's"
-    " enclosing left parentheses.",  # This comment gets thrown to the top.
+    (  # This comment gets thrown to the top.
+        "Long lines with inline comments which are apart of (and not the only member"
+        " of) an argument list should have their comments appended to the reformatted"
+        " string's enclosing left parentheses."
+    ),
     "Arg #2",
     "Arg #3",
     "Arg #4",
     "Arg #5",
 )
 
 pragma_comment_string1 = "Lines which end with an inline pragma comment of the form `# <pragma>: <...>` should be left alone."  # noqa: E501
@@ -620,31 +672,39 @@
 
 return (
     "A really really really really really really really really really really really"
     " really really long {} {}".format("return", "value")
 )
 
 func_with_bad_comma(
-    "This is a really long string argument to a function that has a trailing comma"
-    " which should NOT be there.",
+    (
+        "This is a really long string argument to a function that has a trailing comma"
+        " which should NOT be there."
+    ),
 )
 
 func_with_bad_comma(
-    "This is a really long string argument to a function that has a trailing comma"
-    " which should NOT be there.",  # comment after comma
+    (  # comment after comma
+        "This is a really long string argument to a function that has a trailing comma"
+        " which should NOT be there."
+    ),
 )
 
 func_with_bad_comma(
-    "This is a really long string argument to a function that has a trailing comma"
-    " which should NOT be there.",
+    (
+        "This is a really long string argument to a function that has a trailing comma"
+        " which should NOT be there."
+    ),
 )
 
 func_with_bad_comma(
-    "This is a really long string argument to a function that has a trailing comma"
-    " which should NOT be there.",  # comment after comma
+    (  # comment after comma
+        "This is a really long string argument to a function that has a trailing comma"
+        " which should NOT be there."
+    ),
 )
 
 func_with_bad_parens_that_wont_fit_in_one_line(
     "short string that should have parens stripped", x, y, z
 )
 
 func_with_bad_parens_that_wont_fit_in_one_line(
@@ -767,7 +827,35 @@
     " KO LA}"
 )
 
 string_with_escaped_nameescape = (
     "..........................................................................."
     " \\N{LAO KO LA}"
 )
+
+msg = (
+    lambda x: (
+        f"this is a very very very long lambda value {x} that doesn't fit on a single"
+        " line"
+    )
+)
+
+dict_with_lambda_values = {
+    "join": lambda j: (
+        f"{j.__class__.__name__}({some_function_call(j.left)}, "
+        f"{some_function_call(j.right)})"
+    ),
+}
+
+# Complex string concatenations with a method call in the middle.
+code = (
+    "    return [\n"
+    + ", \n".join(
+        "        (%r, self.%s, visitor.%s)" % (attrname, attrname, visit_name)
+        for attrname, visit_name in names
+    )
+    + "\n    ]\n"
+)
+
+
+# Test case of an outer string' parens enclose an inner string's parens.
+call(body="%s %s" % (",".join(items), suffix))
```

### Comparing `tan-22.8.0/tests/data/preview/long_strings__edge_case.py` & `tan-23.3.0/tests/data/preview/long_strings__edge_case.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/preview/long_strings__regression.py` & `tan-23.3.0/tests/data/preview/long_strings__regression.py`

 * *Files 7% similar despite different names*

```diff
@@ -520,14 +520,50 @@
 
 xxxxxx_xxx_xxxx_xx_xxxxx_xxxxxxxx_xxxxxxxx_xxxxxxxxxx_xxxx_xxxx_xxxxx = xxxx.xxxxxx.xxxxxxxxx.xxxxxxxxxxxxxxxxxxxx(
     xx_xxxxxx={
         "x3_xxxxxxxx": "xxx3_xxxxx_xxxxxxxx_xxxxxxxx_xxxxxxxxxx_xxxxxxxx_xxxxxx_xxxxxxx",
     },
 )
 
+# Regression test for https://github.com/psf/black/issues/3117.
+some_dict = {
+    "something_something":
+        r"Lorem ipsum dolor sit amet, an sed convenire eloquentiam \t"
+        r"signiferumque, duo ea vocibus consetetur scriptorem. Facer \t",
+}
+
+# Regression test for https://github.com/psf/black/issues/3459.
+xxxx(
+    empty_str_as_first_split=''
+    f'xxxxxxx {xxxxxxxxxx} xxx xxxxxxxxxx xxxxx xxx xxx xx '
+    'xxxxx xxxxxxxxx xxxxxxx, xxx xxxxxxxxxxx xxx xxxxx. '
+    f'xxxxxxxxxxxxx xxxx xx xxxxxxxxxx. xxxxx: {x.xxx}',
+    empty_u_str_as_first_split=u''
+    f'xxxxxxx {xxxxxxxxxx} xxx xxxxxxxxxx xxxxx xxx xxx xx '
+    'xxxxx xxxxxxxxx xxxxxxx, xxx xxxxxxxxxxx xxx xxxxx. '
+    f'xxxxxxxxxxxxx xxxx xx xxxxxxxxxx. xxxxx: {x.xxx}',
+)
+
+# Regression test for https://github.com/psf/black/issues/3455.
+a_dict = {
+    "/this/is/a/very/very/very/very/very/very/very/very/very/very/long/key/without/spaces":
+        # And there is a comment before the value
+        ("item1", "item2", "item3"),
+}
+
+# Regression test for https://github.com/psf/black/issues/3506.
+s = (
+    "With single quote: ' "
+    f" {my_dict['foo']}"
+    ' With double quote: " '
+    f' {my_dict["bar"]}'
+)
+
+s = f'Lorem Ipsum is simply dummy text of the printing and typesetting industry:\'{my_dict["foo"]}\''
+
 
 # output
 
 
 class A:
     def foo():
         result = type(message)("")
@@ -675,28 +711,32 @@
             )
 
 
 class A:
     def foo():
         some_func_call(
             "xxxxxxxxxx",
-            "xx {xxxxxxxxxxx}/xxxxxxxxxxx.xxx xxxx.xxx && xxxxxx -x "
-            '"xxxx xxxxxxx xxxxxx xxxx; xxxx xxxxxx_xxxxx xxxxxx xxxx; '
-            "xxxx.xxxx_xxxxxx(['xxxx.xxx'], xxxx.xxxxxxx().xxxxxxxxxx)\" ",
+            (
+                "xx {xxxxxxxxxxx}/xxxxxxxxxxx.xxx xxxx.xxx && xxxxxx -x "
+                '"xxxx xxxxxxx xxxxxx xxxx; xxxx xxxxxx_xxxxx xxxxxx xxxx; '
+                "xxxx.xxxx_xxxxxx(['xxxx.xxx'], xxxx.xxxxxxx().xxxxxxxxxx)\" "
+            ),
             None,
             ("xxxxxxxxxxx",),
         ),
 
 
 class A:
     def foo():
         some_func_call(
-            "xx {xxxxxxxxxxx}/xxxxxxxxxxx.xxx xxxx.xxx && xxxxxx -x "
-            "xxxx, ('xxxxxxx xxxxxx xxxx, xxxx') xxxxxx_xxxxx xxxxxx xxxx; "
-            "xxxx.xxxx_xxxxxx(['xxxx.xxx'], xxxx.xxxxxxx().xxxxxxxxxx)\" ",
+            (
+                "xx {xxxxxxxxxxx}/xxxxxxxxxxx.xxx xxxx.xxx && xxxxxx -x "
+                "xxxx, ('xxxxxxx xxxxxx xxxx, xxxx') xxxxxx_xxxxx xxxxxx xxxx; "
+                "xxxx.xxxx_xxxxxx(['xxxx.xxx'], xxxx.xxxxxxx().xxxxxxxxxx)\" "
+            ),
             None,
             ("xxxxxxxxxxx",),
         ),
 
 
 xxxxxxx = {
     "xx": (
@@ -806,16 +846,18 @@
 some_commented_string = (
     "This string is long but not so long that it needs hahahah toooooo be so greatttt"  # But these
     " {} that I just can't think of any more good words to say about it at"  # comments will stay
     " allllllllllll".format("ha")  # comments here are fine
 )
 
 lpar_and_rpar_have_comments = func_call(  # LPAR Comment
-    "Long really ridiculous type of string that shouldn't really even exist at all. I"
-    " mean commmme onnn!!!",  # Comma Comment
+    (  # Comma Comment
+        "Long really ridiculous type of string that shouldn't really even exist at all."
+        " I mean commmme onnn!!!"
+    ),
 )  # RPAR Comment
 
 cmd_fstring = (
     "sudo -E deluge-console info --detailed --sort-reverse=time_added "
     f"{'' if ID is None else ID} | perl -nE 'print if /^{field}:/'"
 )
 
@@ -966,17 +1008,17 @@
             x.xxxxx.xxxxxx.xxxxx.xxxxxx,
             x.xxxxx.xxxxxx.xxxxx.xxxx,
         ], (
             "xxxxxxxxxxx xxxxxxx xxxx (xxxxxx xxxx) %x xxx xxxxx" % xxxxxxx_xxxx
         )
 
 
-value.__dict__[
-    key
-] = "test"  # set some Thrift field to non-None in the struct aa bb cc dd ee
+value.__dict__[key] = (
+    "test"  # set some Thrift field to non-None in the struct aa bb cc dd ee
+)
 
 RE_ONE_BACKSLASH = {
     "asdf_hjkl_jkl": re.compile(
         r"(?<!([0-9]\ ))(?<=(^|\ ))([A-Z]+(\ )?|[0-9](\ )|[a-z](\ )){4,7}([A-Z]|[0-9]|[a-z])($|\b)(?!(\ ?([0-9]\ )|(\.)))"
     ),
 }
 
@@ -1168,7 +1210,46 @@
 xxxxxx_xxx_xxxx_xx_xxxxx_xxxxxxxx_xxxxxxxx_xxxxxxxxxx_xxxx_xxxx_xxxxx = xxxx.xxxxxx.xxxxxxxxx.xxxxxxxxxxxxxxxxxxxx(
     xx_xxxxxx={
         "x3_xxxxxxxx": (
             "xxx3_xxxxx_xxxxxxxx_xxxxxxxx_xxxxxxxxxx_xxxxxxxx_xxxxxx_xxxxxxx"
         ),
     },
 )
+
+# Regression test for https://github.com/psf/black/issues/3117.
+some_dict = {
+    "something_something": (
+        r"Lorem ipsum dolor sit amet, an sed convenire eloquentiam \t"
+        r"signiferumque, duo ea vocibus consetetur scriptorem. Facer \t"
+    ),
+}
+
+# Regression test for https://github.com/psf/black/issues/3459.
+xxxx(
+    empty_str_as_first_split=(
+        ""
+        f"xxxxxxx {xxxxxxxxxx} xxx xxxxxxxxxx xxxxx xxx xxx xx "
+        "xxxxx xxxxxxxxx xxxxxxx, xxx xxxxxxxxxxx xxx xxxxx. "
+        f"xxxxxxxxxxxxx xxxx xx xxxxxxxxxx. xxxxx: {x.xxx}"
+    ),
+    empty_u_str_as_first_split=(
+        ""
+        f"xxxxxxx {xxxxxxxxxx} xxx xxxxxxxxxx xxxxx xxx xxx xx "
+        "xxxxx xxxxxxxxx xxxxxxx, xxx xxxxxxxxxxx xxx xxxxx. "
+        f"xxxxxxxxxxxxx xxxx xx xxxxxxxxxx. xxxxx: {x.xxx}"
+    ),
+)
+
+# Regression test for https://github.com/psf/black/issues/3455.
+a_dict = {
+    "/this/is/a/very/very/very/very/very/very/very/very/very/very/long/key/without/spaces":
+    # And there is a comment before the value
+    ("item1", "item2", "item3"),
+}
+
+# Regression test for https://github.com/psf/black/issues/3506.
+s = f"With single quote: '  {my_dict['foo']} With double quote: \"  {my_dict['bar']}"
+
+s = (
+    "Lorem Ipsum is simply dummy text of the printing and typesetting"
+    f" industry:'{my_dict['foo']}'"
+)
```

### Comparing `tan-22.8.0/tests/data/preview/one_element_subscript.py` & `tan-23.3.0/tests/data/simple_cases/one_element_subscript.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/preview/remove_await_parens.py` & `tan-23.3.0/tests/data/simple_cases/remove_await_parens.py`

 * *Files 8% similar despite different names*

```diff
@@ -73,17 +73,21 @@
 
 async def main():
     await (await (asyncio.sleep(1)))
 
 async def main():
     await (await (await (await (await (asyncio.sleep(1))))))
 
+async def main():
+    await (yield)
+
 # output
 import asyncio
 
+
 # Control example
 async def main():
     await asyncio.sleep(1)
 
 
 # Remove brackets for short coroutine/task
 async def main():
@@ -162,7 +166,11 @@
 
 async def main():
     await (await asyncio.sleep(1))
 
 
 async def main():
     await (await (await (await (await asyncio.sleep(1)))))
+
+
+async def main():
+    await (yield)
```

### Comparing `tan-22.8.0/tests/data/preview/remove_except_parens.py` & `tan-23.3.0/tests/data/simple_cases/remove_except_parens.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/preview/remove_for_brackets.py` & `tan-23.3.0/tests/data/simple_cases/remove_for_brackets.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/preview/remove_newline_after_code_block_open.py` & `tan-23.3.0/tests/data/simple_cases/remove_newline_after_code_block_open.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/preview/return_annotation_brackets.py` & `tan-23.3.0/tests/data/simple_cases/return_annotation_brackets.py`

 * *Files 12% similar despite different names*

```diff
@@ -83,18 +83,14 @@
 def foo() -> tuple[loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooong, loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooong, loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooong]:
     return 2
 
 # Magic trailing comma example
 def foo() -> tuple[int, int, int,]:
     return 2
 
-# Long string example
-def frobnicate() -> "ThisIsTrulyUnreasonablyExtremelyLongClassName | list[ThisIsTrulyUnreasonablyExtremelyLongClassName]":
-    pass
-
 # output
 # Control
 def double(a: int) -> int:
     return 2 * a
 
 
 # Remove the brackets
@@ -208,15 +204,7 @@
     tuple[
         int,
         int,
         int,
     ]
 ):
     return 2
-
-
-# Long string example
-def frobnicate() -> (
-    "ThisIsTrulyUnreasonablyExtremelyLongClassName |"
-    " list[ThisIsTrulyUnreasonablyExtremelyLongClassName]"
-):
-    pass
```

### Comparing `tan-22.8.0/tests/data/preview_39/remove_with_brackets.py` & `tan-23.3.0/tests/data/py_39/remove_with_brackets.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_310/pattern_matching_complex.py` & `tan-23.3.0/tests/data/py_310/pattern_matching_complex.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_310/pattern_matching_extras.py` & `tan-23.3.0/tests/data/py_310/pattern_matching_extras.py`

 * *Files 4% similar despite different names*

```diff
@@ -110,10 +110,10 @@
         print(bar1.aa, bar1.bb)
     case _:
         print("no match", "\n")
 
 
 match bar1:
     case Foo(
-        normal=x, perhaps=[list, {an: d, dict: 1.0}] as y, otherwise=something, q=t as u
+        normal=x, perhaps=[list, {"x": d, "y": 1.0}] as y, otherwise=something, q=t as u
     ):
         pass
```

### Comparing `tan-22.8.0/tests/data/py_310/pattern_matching_generic.py` & `tan-23.3.0/tests/data/py_310/pattern_matching_generic.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_310/pattern_matching_simple.py` & `tan-23.3.0/tests/data/py_310/pattern_matching_simple.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_310/pattern_matching_style.py` & `tan-23.3.0/tests/data/py_310/pattern_matching_style.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_311/pep_646.py` & `tan-23.3.0/tests/data/py_311/pep_646.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_311/pep_654.py` & `tan-23.3.0/tests/data/py_311/pep_654.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_311/pep_654_style.py` & `tan-23.3.0/tests/data/py_311/pep_654_style.py`

 * *Files 4% similar despite different names*

```diff
@@ -72,15 +72,15 @@
 
 try:
     try:
         raise ValueError(42)
     except:
         try:
             raise TypeError(int)
-        except* (Exception):
+        except* Exception:
             pass
         1 / 0
 except Exception as e:
     exc = e
 
 try:
     try:
```

### Comparing `tan-22.8.0/tests/data/py_36/numeric_literals.py` & `tan-23.3.0/tests/data/py_36/numeric_literals.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_37/python37.py` & `tan-23.3.0/tests/data/py_37/python37.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_38/pep_570.py` & `tan-23.3.0/tests/data/py_38/pep_570.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_38/pep_572.py` & `tan-23.3.0/tests/data/py_38/pep_572.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_38/pep_572_remove_parens.py` & `tan-23.3.0/tests/data/py_38/pep_572_remove_parens.py`

 * *Files 27% similar despite different names*

```diff
@@ -45,14 +45,33 @@
     await (b := 1)
     yield (a := 2)
     raise (c := 3)
 
 def this_is_so_dumb() -> (please := no):
     pass
 
+async def await_the_walrus():
+    with (x := y):
+        pass
+
+    with (x := y) as z, (a := b) as c:
+        pass
+
+    with (x := await y):
+        pass
+
+    with (x := await a, y := await b):
+        pass
+
+    with ((x := await a, y := await b)):
+        pass
+
+    with (x := await a), (y := await b):
+        pass
+
 
 # output
 if foo := 0:
     pass
 
 if foo := 1:
     pass
@@ -99,7 +118,26 @@
     yield (a := 2)
     raise (c := 3)
 
 
 def this_is_so_dumb() -> (please := no):
     pass
 
+
+async def await_the_walrus():
+    with (x := y):
+        pass
+
+    with (x := y) as z, (a := b) as c:
+        pass
+
+    with (x := await y):
+        pass
+
+    with (x := await a, y := await b):
+        pass
+
+    with (x := await a, y := await b):
+        pass
+
+    with (x := await a), (y := await b):
+        pass
```

### Comparing `tan-22.8.0/tests/data/py_38/python38.py` & `tan-23.3.0/tests/data/py_38/python38.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/py_39/python39.py` & `tan-23.3.0/tests/data/py_39/python39.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/attribute_access_on_number_literals.py` & `tan-23.3.0/tests/data/simple_cases/attribute_access_on_number_literals.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/class_blank_parentheses.py` & `tan-23.3.0/tests/data/simple_cases/class_blank_parentheses.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/class_methods_new_line.py` & `tan-23.3.0/tests/data/simple_cases/class_methods_new_line.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/collections.py` & `tan-23.3.0/tests/data/simple_cases/collections.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/comments.py` & `tan-23.3.0/tests/data/simple_cases/comments.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/comments2.py` & `tan-23.3.0/tests/data/simple_cases/comments2.py`

 * *Files 0% similar despite different names*

```diff
@@ -222,14 +222,15 @@
     add_compiler(compiler_from_env())
 else:
     # for compiler in compilers.values():
     # add_compiler(compiler)
     add_compiler(compilers[(7.0, 32)])
     # add_compiler(compilers[(7.1, 64)])
 
+
 # Comment before function.
 def inline_comments_in_brackets_ruin_everything():
     if typedargslist:
         parameters.children = [children[0], body, children[-1]]  # (1  # )1
         parameters.children = [
             children[0],
             body,
```

### Comparing `tan-22.8.0/tests/data/simple_cases/comments3.py` & `tan-23.3.0/tests/data/simple_cases/comments3.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 # The percent-percent comments are Spyder IDE cells.
 
-#%%
+
+# %%
 def func():
     x = """
     a really long string
     """
     lcomp3 = [
         # This one is actually too long to fit in a single line.
         element.split("\n", 1)[0]
@@ -40,8 +41,8 @@
         capture_locals=capture_locals,
         # copy the set of _seen exceptions so that duplicates
         # shared between sub-exceptions are not omitted
         _seen=set(_seen),
     )
 
 
-#%%
+# %%
```

### Comparing `tan-22.8.0/tests/data/simple_cases/comments4.py` & `tan-23.3.0/tests/data/simple_cases/comments4.py`

 * *Files 0% similar despite different names*

```diff
@@ -81,14 +81,14 @@
         )
         .filter(User.xyz.is_(None))
     )
 
 
 def foo3(list_a, list_b):
     return (
-        # Standlone comment but weirdly placed.
+        # Standalone comment but weirdly placed.
         User.query.filter(User.foo == "bar")
         .filter(
             db.or_(User.field_a.astext.in_(list_a), User.field_b.astext.in_(list_b))
         )
         .filter(User.xyz.is_(None))
     )
```

### Comparing `tan-22.8.0/tests/data/simple_cases/comments5.py` & `tan-23.3.0/tests/data/simple_cases/comments5.py`

 * *Files 10% similar despite different names*

```diff
@@ -54,18 +54,20 @@
 # leading 2
 @deco2(with_args=True)
 # leading function comment
 def decorated1():
     ...
 
 
-# Note: crappy but inevitable.  The current design of EmptyLineTracker doesn't
-# allow this to work correctly.  The user will have to split those lines by
-# hand.
+# Note: this is fixed in
+# Preview.empty_lines_before_class_or_def_with_leading_comments.
+# In the current style, the user will have to split those lines by hand.
 some_instruction
+
+
 # This comment should be split from `some_instruction` by two lines but isn't.
 def g():
     ...
 
 
 if __name__ == "__main__":
     main()
```

### Comparing `tan-22.8.0/tests/data/simple_cases/comments6.py` & `tan-23.3.0/tests/data/simple_cases/comments6.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/comments_non_breaking_space.py` & `tan-23.3.0/tests/data/simple_cases/comments_non_breaking_space.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/composition.py` & `tan-23.3.0/tests/data/simple_cases/composition.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/composition_no_trailing_comma.py` & `tan-23.3.0/tests/data/simple_cases/composition_no_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/docstring.py` & `tan-23.3.0/tests/data/simple_cases/docstring.py`

 * *Files 9% similar despite different names*

```diff
@@ -169,14 +169,19 @@
   \ '''
 
 
 def multiline_backslash_2():
   '''
   hey there \ '''
 
+# Regression test for #3425
+def multiline_backslash_really_long_dont_crash():
+    """
+    hey there hello guten tag hi hoow are you ola zdravstvuyte ciao como estas ca va \ """
+
 
 def multiline_backslash_3():
   '''
   already escaped \\ '''
 
 
 def my_god_its_full_of_stars_1():
@@ -387,14 +392,20 @@
 
 
 def multiline_backslash_2():
     """
     hey there \ """
 
 
+# Regression test for #3425
+def multiline_backslash_really_long_dont_crash():
+    """
+    hey there hello guten tag hi hoow are you ola zdravstvuyte ciao como estas ca va \ """
+
+
 def multiline_backslash_3():
     """
     already escaped \\"""
 
 
 def my_god_its_full_of_stars_1():
     "I'm sorry Dave\u2001"
```

### Comparing `tan-22.8.0/tests/data/simple_cases/empty_lines.py` & `tan-23.3.0/tests/data/simple_cases/empty_lines.py`

 * *Files 0% similar despite different names*

```diff
@@ -115,15 +115,14 @@
 
     assert p is not None, f"INTERNAL ERROR: hand-made leaf without parent: {leaf!r}"
 
     prev = leaf.prev_sibling
     if not prev:
         prevp = preceding_leaf(p)
         if not prevp or prevp.type in OPENING_BRACKETS:
-
             return NO
 
         if prevp.type == token.EQUAL:
             if prevp.parent and prevp.parent.type in {
                 syms.typedargslist,
                 syms.varargslist,
                 syms.parameters,
```

### Comparing `tan-22.8.0/tests/data/simple_cases/expression.diff` & `tan-23.3.0/tests/data/simple_cases/expression.diff`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/expression.py` & `tan-23.3.0/tests/data/simple_cases/expression.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/fmtonoff.py` & `tan-23.3.0/tests/data/simple_cases/fmtonoff.py`

 * *Ordering differences only*

 * *Files 0% similar despite different names*

```diff
@@ -191,24 +191,24 @@
 #!/usr/bin/env python3
 import asyncio
 import sys
 
 from third_party import X, Y, Z
 
 from library import some_connection, some_decorator
-
 # fmt: off
 from third_party import (X,
                          Y, Z)
 # fmt: on
 f"trigger 3.6 mode"
 # Comment 1
 
 # Comment 2
 
+
 # fmt: off
 def func_no_args():
   a; b; c
   if True: raise RuntimeError
   if False: ...
   for i in range(10):
     print(i)
```

### Comparing `tan-22.8.0/tests/data/simple_cases/fmtonoff2.py` & `tan-23.3.0/tests/data/simple_cases/fmtonoff2.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/fmtskip2.py` & `tan-23.3.0/tests/data/simple_cases/fmtskip2.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/fmtskip8.py` & `tan-23.3.0/tests/data/simple_cases/fmtskip8.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/fstring.py` & `tan-23.3.0/tests/data/simple_cases/fstring.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/function.py` & `tan-23.3.0/tests/data/simple_cases/function.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/function2.py` & `tan-23.3.0/tests/data/simple_cases/function2.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/function_trailing_comma.py` & `tan-23.3.0/tests/data/simple_cases/function_trailing_comma.py`

 * *Files 24% similar despite different names*

```diff
@@ -45,14 +45,25 @@
 
 def func() -> ((also_super_long_type_annotation_that_may_cause_an_AST_related_crash_in_black(
         this_shouldn_t_get_a_trailing_comma_too
     ))
 ):
     pass
 
+
+# Make sure inner one-element tuple won't explode
+some_module.some_function(
+    argument1, (one_element_tuple,), argument4, argument5, argument6
+)
+
+# Inner trailing comma causes outer to explode
+some_module.some_function(
+    argument1, (one, two,), argument4, argument5, argument6
+)
+
 # output
 
 def f(
     a,
 ):
     d = {
         "key": "value",
@@ -101,17 +112,17 @@
             "g": 7,
             "h": 8,
         }["a"]
     ):
         pass
 
 
-def xxxxxxxxxxxxxxxxxxxxxxxxxxxx() -> Set[
-    "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
-]:
+def xxxxxxxxxxxxxxxxxxxxxxxxxxxx() -> (
+    Set["xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"]
+):
     json = {
         "k": {
             "k2": {
                 "k3": [
                     1,
                 ]
             }
@@ -125,29 +136,43 @@
     returning_a_deeply_nested_import_of_a_type_i_suppose
 ):
     pass
 
 
 def some_method_with_a_really_long_name(
     very_long_parameter_so_yeah: str, another_long_parameter: int
-) -> (
-    another_case_of_returning_a_deeply_nested_import_of_a_type_i_suppose_cause_why_not
-):
+) -> another_case_of_returning_a_deeply_nested_import_of_a_type_i_suppose_cause_why_not:
     pass
 
 
 def func() -> (
     also_super_long_type_annotation_that_may_cause_an_AST_related_crash_in_black(
         this_shouldn_t_get_a_trailing_comma_too
     )
 ):
     pass
 
 
 def func() -> (
-    (
-        also_super_long_type_annotation_that_may_cause_an_AST_related_crash_in_black(
-            this_shouldn_t_get_a_trailing_comma_too
-        )
+    also_super_long_type_annotation_that_may_cause_an_AST_related_crash_in_black(
+        this_shouldn_t_get_a_trailing_comma_too
     )
 ):
     pass
+
+
+# Make sure inner one-element tuple won't explode
+some_module.some_function(
+    argument1, (one_element_tuple,), argument4, argument5, argument6
+)
+
+# Inner trailing comma causes outer to explode
+some_module.some_function(
+    argument1,
+    (
+        one,
+        two,
+    ),
+    argument4,
+    argument5,
+    argument6,
+)
```

### Comparing `tan-22.8.0/tests/data/simple_cases/import_spacing.py` & `tan-23.3.0/tests/data/simple_cases/import_spacing.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/power_op_spacing.py` & `tan-23.3.0/tests/data/simple_cases/power_op_spacing.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/remove_parens.py` & `tan-23.3.0/tests/data/simple_cases/remove_parens.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/slices.py` & `tan-23.3.0/tests/data/simple_cases/slices.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/string_prefixes.py` & `tan-23.3.0/tests/data/simple_cases/string_prefixes.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/torture.py` & `tan-23.3.0/tests/data/simple_cases/torture.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/trailing_comma_optional_parens1.py` & `tan-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens1.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/simple_cases/trailing_comma_optional_parens3.py` & `tan-23.3.0/tests/data/simple_cases/trailing_comma_optional_parens3.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/data/tabs/docstring_tabs.py` & `tan-23.3.0/tests/data/tabs/docstring_tabs.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/optional.py` & `tan-23.3.0/tests/optional.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/test_black.py` & `tan-23.3.0/tests/test_black.py`

 * *Files 9% similar despite different names*

```diff
@@ -27,5518 +27,6286 @@
 000001a0: 726f 6d20 7479 7069 6e67 2069 6d70 6f72  rom typing impor
 000001b0: 7420 280a 2020 2020 416e 792c 0a20 2020  t (.    Any,.   
 000001c0: 2043 616c 6c61 626c 652c 0a20 2020 2044   Callable,.    D
 000001d0: 6963 742c 0a20 2020 2049 7465 7261 746f  ict,.    Iterato
 000001e0: 722c 0a20 2020 204c 6973 742c 0a20 2020  r,.    List,.   
 000001f0: 204f 7074 696f 6e61 6c2c 0a20 2020 2053   Optional,.    S
 00000200: 6571 7565 6e63 652c 0a20 2020 2054 7970  equence,.    Typ
-00000210: 6556 6172 2c0a 2020 2020 556e 696f 6e2c  eVar,.    Union,
-00000220: 0a29 0a66 726f 6d20 756e 6974 7465 7374  .).from unittest
-00000230: 2e6d 6f63 6b20 696d 706f 7274 204d 6167  .mock import Mag
-00000240: 6963 4d6f 636b 2c20 7061 7463 680a 0a69  icMock, patch..i
-00000250: 6d70 6f72 7420 636c 6963 6b0a 696d 706f  mport click.impo
-00000260: 7274 2070 7974 6573 740a 6672 6f6d 2063  rt pytest.from c
-00000270: 6c69 636b 2069 6d70 6f72 7420 756e 7374  lick import unst
-00000280: 796c 650a 6672 6f6d 2063 6c69 636b 2e74  yle.from click.t
-00000290: 6573 7469 6e67 2069 6d70 6f72 7420 436c  esting import Cl
-000002a0: 6952 756e 6e65 720a 6672 6f6d 2070 6174  iRunner.from pat
-000002b0: 6873 7065 6320 696d 706f 7274 2050 6174  hspec import Pat
-000002c0: 6853 7065 630a 0a69 6d70 6f72 7420 626c  hSpec..import bl
-000002d0: 6163 6b0a 696d 706f 7274 2062 6c61 636b  ack.import black
-000002e0: 2e66 696c 6573 0a66 726f 6d20 626c 6163  .files.from blac
-000002f0: 6b20 696d 706f 7274 2046 6561 7475 7265  k import Feature
-00000300: 2c20 5461 7267 6574 5665 7273 696f 6e0a  , TargetVersion.
-00000310: 6672 6f6d 2062 6c61 636b 2069 6d70 6f72  from black impor
-00000320: 7420 7265 5f63 6f6d 7069 6c65 5f6d 6179  t re_compile_may
-00000330: 6265 5f76 6572 626f 7365 2061 7320 636f  be_verbose as co
-00000340: 6d70 696c 655f 7061 7474 6572 6e0a 6672  mpile_pattern.fr
-00000350: 6f6d 2062 6c61 636b 2e63 6163 6865 2069  om black.cache i
-00000360: 6d70 6f72 7420 6765 745f 6361 6368 655f  mport get_cache_
-00000370: 6469 722c 2067 6574 5f63 6163 6865 5f66  dir, get_cache_f
-00000380: 696c 650a 6672 6f6d 2062 6c61 636b 2e64  ile.from black.d
-00000390: 6562 7567 2069 6d70 6f72 7420 4465 6275  ebug import Debu
-000003a0: 6756 6973 6974 6f72 0a66 726f 6d20 626c  gVisitor.from bl
-000003b0: 6163 6b2e 6f75 7470 7574 2069 6d70 6f72  ack.output impor
-000003c0: 7420 636f 6c6f 725f 6469 6666 2c20 6469  t color_diff, di
-000003d0: 6666 0a66 726f 6d20 626c 6163 6b2e 7265  ff.from black.re
-000003e0: 706f 7274 2069 6d70 6f72 7420 5265 706f  port import Repo
-000003f0: 7274 0a0a 2320 496d 706f 7274 206f 7468  rt..# Import oth
-00000400: 6572 2074 6573 7420 636c 6173 7365 730a  er test classes.
-00000410: 6672 6f6d 2074 6573 7473 2e75 7469 6c20  from tests.util 
-00000420: 696d 706f 7274 2028 0a20 2020 2044 4154  import (.    DAT
-00000430: 415f 4449 522c 0a20 2020 2044 4546 4155  A_DIR,.    DEFAU
-00000440: 4c54 5f4d 4f44 452c 0a20 2020 2044 4554  LT_MODE,.    DET
-00000450: 4552 4d49 4e49 5354 4943 5f48 4541 4445  ERMINISTIC_HEADE
-00000460: 522c 0a20 2020 2050 524f 4a45 4354 5f52  R,.    PROJECT_R
-00000470: 4f4f 542c 0a20 2020 2050 5933 365f 5645  OOT,.    PY36_VE
-00000480: 5253 494f 4e53 2c0a 2020 2020 5448 4953  RSIONS,.    THIS
-00000490: 5f44 4952 2c0a 2020 2020 426c 6163 6b42  _DIR,.    BlackB
-000004a0: 6173 6554 6573 7443 6173 652c 0a20 2020  aseTestCase,.   
-000004b0: 2061 7373 6572 745f 666f 726d 6174 2c0a   assert_format,.
-000004c0: 2020 2020 6368 616e 6765 5f64 6972 6563      change_direc
-000004d0: 746f 7279 2c0a 2020 2020 6475 6d70 5f74  tory,.    dump_t
-000004e0: 6f5f 7374 6465 7272 2c0a 2020 2020 6666  o_stderr,.    ff
-000004f0: 2c0a 2020 2020 6673 2c0a 2020 2020 6765  ,.    fs,.    ge
-00000500: 745f 6361 7365 5f70 6174 682c 0a20 2020  t_case_path,.   
-00000510: 2072 6561 645f 6461 7461 2c0a 2020 2020   read_data,.    
-00000520: 7265 6164 5f64 6174 615f 6672 6f6d 5f66  read_data_from_f
-00000530: 696c 652c 0a29 0a0a 5448 4953 5f46 494c  ile,.)..THIS_FIL
-00000540: 4520 3d20 5061 7468 285f 5f66 696c 655f  E = Path(__file_
-00000550: 5f29 0a45 4d50 5459 5f43 4f4e 4649 4720  _).EMPTY_CONFIG 
-00000560: 3d20 5448 4953 5f44 4952 202f 2022 6461  = THIS_DIR / "da
-00000570: 7461 2220 2f20 2265 6d70 7479 5f70 7970  ta" / "empty_pyp
-00000580: 726f 6a65 6374 2e74 6f6d 6c22 0a50 5933  roject.toml".PY3
-00000590: 365f 4152 4753 203d 205b 6622 2d2d 7461  6_ARGS = [f"--ta
-000005a0: 7267 6574 2d76 6572 7369 6f6e 3d7b 7665  rget-version={ve
-000005b0: 7273 696f 6e2e 6e61 6d65 2e6c 6f77 6572  rsion.name.lower
-000005c0: 2829 7d22 2066 6f72 2076 6572 7369 6f6e  ()}" for version
-000005d0: 2069 6e20 5059 3336 5f56 4552 5349 4f4e   in PY36_VERSION
-000005e0: 535d 0a44 4546 4155 4c54 5f45 5843 4c55  S].DEFAULT_EXCLU
-000005f0: 4445 203d 2062 6c61 636b 2e72 655f 636f  DE = black.re_co
-00000600: 6d70 696c 655f 6d61 7962 655f 7665 7262  mpile_maybe_verb
-00000610: 6f73 6528 626c 6163 6b2e 636f 6e73 742e  ose(black.const.
-00000620: 4445 4641 554c 545f 4558 434c 5544 4553  DEFAULT_EXCLUDES
-00000630: 290a 4445 4641 554c 545f 494e 434c 5544  ).DEFAULT_INCLUD
-00000640: 4520 3d20 626c 6163 6b2e 7265 5f63 6f6d  E = black.re_com
-00000650: 7069 6c65 5f6d 6179 6265 5f76 6572 626f  pile_maybe_verbo
-00000660: 7365 2862 6c61 636b 2e63 6f6e 7374 2e44  se(black.const.D
-00000670: 4546 4155 4c54 5f49 4e43 4c55 4445 5329  EFAULT_INCLUDES)
-00000680: 0a54 203d 2054 7970 6556 6172 2822 5422  .T = TypeVar("T"
-00000690: 290a 5220 3d20 5479 7065 5661 7228 2252  ).R = TypeVar("R
-000006a0: 2229 0a0a 2320 4d61 7463 6820 7468 6520  ")..# Match the 
-000006b0: 7469 6d65 206f 7574 7075 7420 696e 2061  time output in a
-000006c0: 2064 6966 662c 2062 7574 206e 6f74 6869   diff, but nothi
-000006d0: 6e67 2065 6c73 650a 4449 4646 5f54 494d  ng else.DIFF_TIM
-000006e0: 4520 3d20 7265 2e63 6f6d 7069 6c65 2872  E = re.compile(r
-000006f0: 225c 745b 5c64 5c2d 3a2b 5c2e 205d 2b22  "\t[\d\-:+\. ]+"
-00000700: 290a 0a0a 4063 6f6e 7465 7874 6d61 6e61  )...@contextmana
-00000710: 6765 720a 6465 6620 6361 6368 655f 6469  ger.def cache_di
-00000720: 7228 6578 6973 7473 3a20 626f 6f6c 203d  r(exists: bool =
-00000730: 2054 7275 6529 202d 3e20 4974 6572 6174   True) -> Iterat
-00000740: 6f72 5b50 6174 685d 3a0a 2020 2020 7769  or[Path]:.    wi
-00000750: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
-00000760: 6374 6f72 7928 2920 6173 2077 6f72 6b73  ctory() as works
-00000770: 7061 6365 3a0a 2020 2020 2020 2020 6361  pace:.        ca
-00000780: 6368 655f 6469 7220 3d20 5061 7468 2877  che_dir = Path(w
-00000790: 6f72 6b73 7061 6365 290a 2020 2020 2020  orkspace).      
-000007a0: 2020 6966 206e 6f74 2065 7869 7374 733a    if not exists:
-000007b0: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
-000007c0: 6865 5f64 6972 203d 2063 6163 6865 5f64  he_dir = cache_d
-000007d0: 6972 202f 2022 6e65 7722 0a20 2020 2020  ir / "new".     
-000007e0: 2020 2077 6974 6820 7061 7463 6828 2262     with patch("b
-000007f0: 6c61 636b 2e63 6163 6865 2e43 4143 4845  lack.cache.CACHE
-00000800: 5f44 4952 222c 2063 6163 6865 5f64 6972  _DIR", cache_dir
-00000810: 293a 0a20 2020 2020 2020 2020 2020 2079  ):.            y
-00000820: 6965 6c64 2063 6163 6865 5f64 6972 0a0a  ield cache_dir..
-00000830: 0a40 636f 6e74 6578 746d 616e 6167 6572  .@contextmanager
-00000840: 0a64 6566 2065 7665 6e74 5f6c 6f6f 7028  .def event_loop(
-00000850: 2920 2d3e 2049 7465 7261 746f 725b 4e6f  ) -> Iterator[No
-00000860: 6e65 5d3a 0a20 2020 2070 6f6c 6963 7920  ne]:.    policy 
-00000870: 3d20 6173 796e 6369 6f2e 6765 745f 6576  = asyncio.get_ev
-00000880: 656e 745f 6c6f 6f70 5f70 6f6c 6963 7928  ent_loop_policy(
-00000890: 290a 2020 2020 6c6f 6f70 203d 2070 6f6c  ).    loop = pol
-000008a0: 6963 792e 6e65 775f 6576 656e 745f 6c6f  icy.new_event_lo
-000008b0: 6f70 2829 0a20 2020 2061 7379 6e63 696f  op().    asyncio
-000008c0: 2e73 6574 5f65 7665 6e74 5f6c 6f6f 7028  .set_event_loop(
-000008d0: 6c6f 6f70 290a 2020 2020 7472 793a 0a20  loop).    try:. 
-000008e0: 2020 2020 2020 2079 6965 6c64 0a0a 2020         yield..  
-000008f0: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
-00000900: 2020 206c 6f6f 702e 636c 6f73 6528 290a     loop.close().
-00000910: 0a0a 636c 6173 7320 4661 6b65 436f 6e74  ..class FakeCont
-00000920: 6578 7428 636c 6963 6b2e 436f 6e74 6578  ext(click.Contex
-00000930: 7429 3a0a 2020 2020 2222 2241 2066 616b  t):.    """A fak
-00000940: 6520 636c 6963 6b20 436f 6e74 6578 7420  e click Context 
-00000950: 666f 7220 7768 656e 2063 616c 6c69 6e67  for when calling
-00000960: 2066 756e 6374 696f 6e73 2074 6861 7420   functions that 
-00000970: 6e65 6564 2069 742e 2222 220a 0a20 2020  need it."""..   
-00000980: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00000990: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-000009a0: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
-000009b0: 745f 6d61 703a 2044 6963 745b 7374 722c  t_map: Dict[str,
-000009c0: 2041 6e79 5d20 3d20 7b7d 0a20 2020 2020   Any] = {}.     
-000009d0: 2020 2023 2044 756d 6d79 2072 6f6f 742c     # Dummy root,
-000009e0: 2073 696e 6365 206d 6f73 7420 6f66 2074   since most of t
-000009f0: 6865 2074 6573 7473 2064 6f6e 2774 2063  he tests don't c
-00000a00: 6172 6520 6162 6f75 7420 6974 0a20 2020  are about it.   
-00000a10: 2020 2020 2073 656c 662e 6f62 6a3a 2044       self.obj: D
-00000a20: 6963 745b 7374 722c 2041 6e79 5d20 3d20  ict[str, Any] = 
-00000a30: 7b22 726f 6f74 223a 2050 524f 4a45 4354  {"root": PROJECT
-00000a40: 5f52 4f4f 547d 0a0a 0a63 6c61 7373 2046  _ROOT}...class F
-00000a50: 616b 6550 6172 616d 6574 6572 2863 6c69  akeParameter(cli
-00000a60: 636b 2e50 6172 616d 6574 6572 293a 0a20  ck.Parameter):. 
-00000a70: 2020 2022 2222 4120 6661 6b65 2063 6c69     """A fake cli
-00000a80: 636b 2050 6172 616d 6574 6572 2066 6f72  ck Parameter for
-00000a90: 2077 6865 6e20 6361 6c6c 696e 6720 6675   when calling fu
-00000aa0: 6e63 7469 6f6e 7320 7468 6174 206e 6565  nctions that nee
-00000ab0: 6420 6974 2e22 2222 0a0a 2020 2020 6465  d it."""..    de
-00000ac0: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
-00000ad0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00000ae0: 2020 7061 7373 0a0a 0a63 6c61 7373 2042    pass...class B
-00000af0: 6c61 636b 5275 6e6e 6572 2843 6c69 5275  lackRunner(CliRu
-00000b00: 6e6e 6572 293a 0a20 2020 2022 2222 4d61  nner):.    """Ma
-00000b10: 6b65 2073 7572 6520 5354 444f 5554 2061  ke sure STDOUT a
-00000b20: 6e64 2053 5444 4552 5220 6172 6520 6b65  nd STDERR are ke
-00000b30: 7074 2073 6570 6172 6174 6520 7768 656e  pt separate when
-00000b40: 2074 6573 7469 6e67 2042 6c61 636b 2076   testing Black v
-00000b50: 6961 2069 7473 2043 4c49 2e22 2222 0a0a  ia its CLI."""..
-00000b60: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00000b70: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00000b80: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-00000b90: 5f5f 696e 6974 5f5f 286d 6978 5f73 7464  __init__(mix_std
-00000ba0: 6572 723d 4661 6c73 6529 0a0a 0a64 6566  err=False)...def
-00000bb0: 2069 6e76 6f6b 6542 6c61 636b 280a 2020   invokeBlack(.  
-00000bc0: 2020 6172 6773 3a20 4c69 7374 5b73 7472    args: List[str
-00000bd0: 5d2c 2065 7869 745f 636f 6465 3a20 696e  ], exit_code: in
-00000be0: 7420 3d20 302c 2069 676e 6f72 655f 636f  t = 0, ignore_co
-00000bf0: 6e66 6967 3a20 626f 6f6c 203d 2054 7275  nfig: bool = Tru
-00000c00: 650a 2920 2d3e 204e 6f6e 653a 0a20 2020  e.) -> None:.   
-00000c10: 2072 756e 6e65 7220 3d20 426c 6163 6b52   runner = BlackR
-00000c20: 756e 6e65 7228 290a 2020 2020 6966 2069  unner().    if i
-00000c30: 676e 6f72 655f 636f 6e66 6967 3a0a 2020  gnore_config:.  
-00000c40: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
-00000c50: 2d76 6572 626f 7365 222c 2022 2d2d 636f  -verbose", "--co
-00000c60: 6e66 6967 222c 2073 7472 2854 4849 535f  nfig", str(THIS_
-00000c70: 4449 5220 2f20 2265 6d70 7479 2e74 6f6d  DIR / "empty.tom
-00000c80: 6c22 292c 202a 6172 6773 5d0a 2020 2020  l"), *args].    
-00000c90: 7265 7375 6c74 203d 2072 756e 6e65 722e  result = runner.
-00000ca0: 696e 766f 6b65 2862 6c61 636b 2e6d 6169  invoke(black.mai
-00000cb0: 6e2c 2061 7267 732c 2063 6174 6368 5f65  n, args, catch_e
-00000cc0: 7863 6570 7469 6f6e 733d 4661 6c73 6529  xceptions=False)
-00000cd0: 0a20 2020 2061 7373 6572 7420 7265 7375  .    assert resu
-00000ce0: 6c74 2e73 7464 6f75 745f 6279 7465 7320  lt.stdout_bytes 
-00000cf0: 6973 206e 6f74 204e 6f6e 650a 2020 2020  is not None.    
-00000d00: 6173 7365 7274 2072 6573 756c 742e 7374  assert result.st
-00000d10: 6465 7272 5f62 7974 6573 2069 7320 6e6f  derr_bytes is no
-00000d20: 7420 4e6f 6e65 0a20 2020 206d 7367 203d  t None.    msg =
-00000d30: 2028 0a20 2020 2020 2020 2066 2246 6169   (.        f"Fai
-00000d40: 6c65 6420 7769 7468 2061 7267 733a 207b  led with args: {
-00000d50: 6172 6773 7d5c 6e22 0a20 2020 2020 2020  args}\n".       
-00000d60: 2066 2273 7464 6f75 743a 207b 7265 7375   f"stdout: {resu
-00000d70: 6c74 2e73 7464 6f75 745f 6279 7465 732e  lt.stdout_bytes.
-00000d80: 6465 636f 6465 2829 2172 7d5c 6e22 0a20  decode()!r}\n". 
-00000d90: 2020 2020 2020 2066 2273 7464 6572 723a         f"stderr:
-00000da0: 207b 7265 7375 6c74 2e73 7464 6572 725f   {result.stderr_
-00000db0: 6279 7465 732e 6465 636f 6465 2829 2172  bytes.decode()!r
-00000dc0: 7d5c 6e22 0a20 2020 2020 2020 2066 2265  }\n".        f"e
-00000dd0: 7863 6570 7469 6f6e 3a20 7b72 6573 756c  xception: {resul
-00000de0: 742e 6578 6365 7074 696f 6e7d 220a 2020  t.exception}".  
-00000df0: 2020 290a 2020 2020 6173 7365 7274 2072    ).    assert r
-00000e00: 6573 756c 742e 6578 6974 5f63 6f64 6520  esult.exit_code 
-00000e10: 3d3d 2065 7869 745f 636f 6465 2c20 6d73  == exit_code, ms
-00000e20: 670a 0a0a 636c 6173 7320 426c 6163 6b54  g...class BlackT
-00000e30: 6573 7443 6173 6528 426c 6163 6b42 6173  estCase(BlackBas
-00000e40: 6554 6573 7443 6173 6529 3a0a 2020 2020  eTestCase):.    
-00000e50: 696e 766f 6b65 426c 6163 6b20 3d20 7374  invokeBlack = st
-00000e60: 6174 6963 6d65 7468 6f64 2869 6e76 6f6b  aticmethod(invok
-00000e70: 6542 6c61 636b 290a 0a20 2020 2064 6566  eBlack)..    def
-00000e80: 2074 6573 745f 656d 7074 795f 6666 2873   test_empty_ff(s
-00000e90: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00000ea0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-00000eb0: 2022 220a 2020 2020 2020 2020 746d 705f   "".        tmp_
-00000ec0: 6669 6c65 203d 2050 6174 6828 626c 6163  file = Path(blac
-00000ed0: 6b2e 6475 6d70 5f74 6f5f 6669 6c65 2829  k.dump_to_file()
-00000ee0: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-00000ef0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00000f00: 6173 7365 7274 4661 6c73 6528 6666 2874  assertFalse(ff(t
-00000f10: 6d70 5f66 696c 652c 2077 7269 7465 5f62  mp_file, write_b
-00000f20: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
-00000f30: 6163 6b2e 5945 5329 290a 2020 2020 2020  ack.YES)).      
-00000f40: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00000f50: 746d 705f 6669 6c65 2c20 656e 636f 6469  tmp_file, encodi
-00000f60: 6e67 3d22 7574 6638 2229 2061 7320 663a  ng="utf8") as f:
-00000f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000f80: 2061 6374 7561 6c20 3d20 662e 7265 6164   actual = f.read
-00000f90: 2829 0a20 2020 2020 2020 2066 696e 616c  ().        final
-00000fa0: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-00000fb0: 6f73 2e75 6e6c 696e 6b28 746d 705f 6669  os.unlink(tmp_fi
-00000fc0: 6c65 290a 2020 2020 2020 2020 7365 6c66  le).        self
-00000fd0: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
-00000fe0: 616c 2865 7870 6563 7465 642c 2061 6374  al(expected, act
-00000ff0: 7561 6c29 0a0a 2020 2020 6465 6620 7465  ual)..    def te
-00001000: 7374 5f65 7870 6572 696d 656e 7461 6c5f  st_experimental_
-00001010: 7374 7269 6e67 5f70 726f 6365 7373 696e  string_processin
-00001020: 675f 7761 726e 7328 7365 6c66 2920 2d3e  g_warns(self) ->
-00001030: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
-00001040: 656c 662e 6173 7365 7274 5761 726e 7328  elf.assertWarns(
-00001050: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-00001060: 636b 2e6d 6f64 652e 4465 7072 6563 6174  ck.mode.Deprecat
-00001070: 6564 2c20 626c 6163 6b2e 4d6f 6465 2c20  ed, black.Mode, 
-00001080: 6578 7065 7269 6d65 6e74 616c 5f73 7472  experimental_str
-00001090: 696e 675f 7072 6f63 6573 7369 6e67 3d54  ing_processing=T
-000010a0: 7275 650a 2020 2020 2020 2020 290a 0a20  rue.        ).. 
-000010b0: 2020 2064 6566 2074 6573 745f 7069 7069     def test_pipi
-000010c0: 6e67 2873 656c 6629 202d 3e20 4e6f 6e65  ng(self) -> None
-000010d0: 3a0a 2020 2020 2020 2020 736f 7572 6365  :.        source
-000010e0: 2c20 6578 7065 6374 6564 203d 2072 6561  , expected = rea
-000010f0: 645f 6461 7461 5f66 726f 6d5f 6669 6c65  d_data_from_file
-00001100: 2850 524f 4a45 4354 5f52 4f4f 5420 2f20  (PROJECT_ROOT / 
-00001110: 2273 7263 2f62 6c61 636b 2f5f 5f69 6e69  "src/black/__ini
-00001120: 745f 5f2e 7079 2229 0a20 2020 2020 2020  t__.py").       
-00001130: 2072 6573 756c 7420 3d20 426c 6163 6b52   result = BlackR
-00001140: 756e 6e65 7228 292e 696e 766f 6b65 280a  unner().invoke(.
-00001150: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-00001160: 6b2e 6d61 696e 2c0a 2020 2020 2020 2020  k.main,.        
-00001170: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
-00001180: 2020 2020 2020 222d 222c 0a20 2020 2020        "-",.     
-00001190: 2020 2020 2020 2020 2020 2022 2d2d 6661             "--fa
-000011a0: 7374 222c 0a20 2020 2020 2020 2020 2020  st",.           
-000011b0: 2020 2020 2066 222d 2d6c 696e 652d 6c65       f"--line-le
-000011c0: 6e67 7468 3d7b 626c 6163 6b2e 4445 4641  ngth={black.DEFA
-000011d0: 554c 545f 4c49 4e45 5f4c 454e 4754 487d  ULT_LINE_LENGTH}
-000011e0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000011f0: 2020 2066 222d 2d63 6f6e 6669 673d 7b45     f"--config={E
-00001200: 4d50 5459 5f43 4f4e 4649 477d 222c 0a20  MPTY_CONFIG}",. 
-00001210: 2020 2020 2020 2020 2020 205d 2c0a 2020             ],.  
-00001220: 2020 2020 2020 2020 2020 696e 7075 743d            input=
-00001230: 4279 7465 7349 4f28 736f 7572 6365 2e65  BytesIO(source.e
-00001240: 6e63 6f64 6528 2275 7466 3822 2929 2c0a  ncode("utf8")),.
-00001250: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00001260: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00001270: 616c 2872 6573 756c 742e 6578 6974 5f63  al(result.exit_c
-00001280: 6f64 652c 2030 290a 2020 2020 2020 2020  ode, 0).        
-00001290: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
-000012a0: 7445 7175 616c 2865 7870 6563 7465 642c  tEqual(expected,
-000012b0: 2072 6573 756c 742e 6f75 7470 7574 290a   result.output).
-000012c0: 2020 2020 2020 2020 6966 2073 6f75 7263          if sourc
-000012d0: 6520 213d 2072 6573 756c 742e 6f75 7470  e != result.outp
-000012e0: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
-000012f0: 626c 6163 6b2e 6173 7365 7274 5f65 7175  black.assert_equ
-00001300: 6976 616c 656e 7428 736f 7572 6365 2c20  ivalent(source, 
-00001310: 7265 7375 6c74 2e6f 7574 7075 7429 0a20  result.output). 
-00001320: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-00001330: 2e61 7373 6572 745f 7374 6162 6c65 2873  .assert_stable(s
-00001340: 6f75 7263 652c 2072 6573 756c 742e 6f75  ource, result.ou
-00001350: 7470 7574 2c20 4445 4641 554c 545f 4d4f  tput, DEFAULT_MO
-00001360: 4445 290a 0a20 2020 2064 6566 2074 6573  DE)..    def tes
-00001370: 745f 7069 7069 6e67 5f64 6966 6628 7365  t_piping_diff(se
-00001380: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00001390: 2020 2020 2064 6966 665f 6865 6164 6572       diff_header
-000013a0: 203d 2072 652e 636f 6d70 696c 6528 0a20   = re.compile(. 
-000013b0: 2020 2020 2020 2020 2020 2072 2228 5354             r"(ST
-000013c0: 4449 4e7c 5354 444f 5554 295c 745c 645c  DIN|STDOUT)\t\d\
-000013d0: 645c 645c 642d 5c64 5c64 2d5c 645c 6420  d\d\d-\d\d-\d\d 
-000013e0: 5c64 5c64 3a5c 645c 643a 5c64 5c64 5c2e  \d\d:\d\d:\d\d\.
-000013f0: 5c64 5c64 5c64 5c64 5c64 5c64 2022 0a20  \d\d\d\d\d\d ". 
-00001400: 2020 2020 2020 2020 2020 2072 225c 2b5c             r"\+\
-00001410: 645c 645c 645c 6422 0a20 2020 2020 2020  d\d\d\d".       
-00001420: 2029 0a20 2020 2020 2020 2073 6f75 7263   ).        sourc
-00001430: 652c 205f 203d 2072 6561 645f 6461 7461  e, _ = read_data
-00001440: 2822 7369 6d70 6c65 5f63 6173 6573 222c  ("simple_cases",
-00001450: 2022 6578 7072 6573 7369 6f6e 2e70 7922   "expression.py"
-00001460: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
-00001470: 6564 2c20 5f20 3d20 7265 6164 5f64 6174  ed, _ = read_dat
-00001480: 6128 2273 696d 706c 655f 6361 7365 7322  a("simple_cases"
-00001490: 2c20 2265 7870 7265 7373 696f 6e2e 6469  , "expression.di
-000014a0: 6666 2229 0a20 2020 2020 2020 2061 7267  ff").        arg
-000014b0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-000014c0: 2020 222d 222c 0a20 2020 2020 2020 2020    "-",.         
-000014d0: 2020 2022 2d2d 6661 7374 222c 0a20 2020     "--fast",.   
-000014e0: 2020 2020 2020 2020 2066 222d 2d6c 696e           f"--lin
-000014f0: 652d 6c65 6e67 7468 3d7b 626c 6163 6b2e  e-length={black.
-00001500: 4445 4641 554c 545f 4c49 4e45 5f4c 454e  DEFAULT_LINE_LEN
-00001510: 4754 487d 222c 0a20 2020 2020 2020 2020  GTH}",.         
-00001520: 2020 2022 2d2d 6469 6666 222c 0a20 2020     "--diff",.   
-00001530: 2020 2020 2020 2020 2066 222d 2d63 6f6e           f"--con
-00001540: 6669 673d 7b45 4d50 5459 5f43 4f4e 4649  fig={EMPTY_CONFI
-00001550: 477d 222c 0a20 2020 2020 2020 205d 0a20  G}",.        ]. 
-00001560: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00001570: 426c 6163 6b52 756e 6e65 7228 292e 696e  BlackRunner().in
-00001580: 766f 6b65 280a 2020 2020 2020 2020 2020  voke(.          
-00001590: 2020 626c 6163 6b2e 6d61 696e 2c20 6172    black.main, ar
-000015a0: 6773 2c20 696e 7075 743d 4279 7465 7349  gs, input=BytesI
-000015b0: 4f28 736f 7572 6365 2e65 6e63 6f64 6528  O(source.encode(
-000015c0: 2275 7466 3822 2929 0a20 2020 2020 2020  "utf8")).       
-000015d0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-000015e0: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-000015f0: 6c74 2e65 7869 745f 636f 6465 2c20 3029  lt.exit_code, 0)
-00001600: 0a20 2020 2020 2020 2061 6374 7561 6c20  .        actual 
-00001610: 3d20 6469 6666 5f68 6561 6465 722e 7375  = diff_header.su
-00001620: 6228 4445 5445 524d 494e 4953 5449 435f  b(DETERMINISTIC_
-00001630: 4845 4144 4552 2c20 7265 7375 6c74 2e6f  HEADER, result.o
-00001640: 7574 7075 7429 0a20 2020 2020 2020 2061  utput).        a
-00001650: 6374 7561 6c20 3d20 6163 7475 616c 2e72  ctual = actual.r
-00001660: 7374 7269 7028 2920 2b20 225c 6e22 2020  strip() + "\n"  
-00001670: 2320 7468 6520 6469 6666 206f 7574 7075  # the diff outpu
-00001680: 7420 6861 7320 6120 7472 6169 6c69 6e67  t has a trailing
-00001690: 2073 7061 6365 0a20 2020 2020 2020 2073   space.        s
-000016a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000016b0: 6578 7065 6374 6564 2c20 6163 7475 616c  expected, actual
-000016c0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-000016d0: 7069 7069 6e67 5f64 6966 665f 7769 7468  piping_diff_with
-000016e0: 5f63 6f6c 6f72 2873 656c 6629 202d 3e20  _color(self) -> 
-000016f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
-00001700: 7572 6365 2c20 5f20 3d20 7265 6164 5f64  urce, _ = read_d
-00001710: 6174 6128 2273 696d 706c 655f 6361 7365  ata("simple_case
-00001720: 7322 2c20 2265 7870 7265 7373 696f 6e2e  s", "expression.
-00001730: 7079 2229 0a20 2020 2020 2020 2061 7267  py").        arg
-00001740: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-00001750: 2020 222d 222c 0a20 2020 2020 2020 2020    "-",.         
-00001760: 2020 2022 2d2d 6661 7374 222c 0a20 2020     "--fast",.   
-00001770: 2020 2020 2020 2020 2066 222d 2d6c 696e           f"--lin
-00001780: 652d 6c65 6e67 7468 3d7b 626c 6163 6b2e  e-length={black.
-00001790: 4445 4641 554c 545f 4c49 4e45 5f4c 454e  DEFAULT_LINE_LEN
-000017a0: 4754 487d 222c 0a20 2020 2020 2020 2020  GTH}",.         
-000017b0: 2020 2022 2d2d 6469 6666 222c 0a20 2020     "--diff",.   
-000017c0: 2020 2020 2020 2020 2022 2d2d 636f 6c6f           "--colo
-000017d0: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
-000017e0: 6622 2d2d 636f 6e66 6967 3d7b 454d 5054  f"--config={EMPT
-000017f0: 595f 434f 4e46 4947 7d22 2c0a 2020 2020  Y_CONFIG}",.    
-00001800: 2020 2020 5d0a 2020 2020 2020 2020 7265      ].        re
-00001810: 7375 6c74 203d 2042 6c61 636b 5275 6e6e  sult = BlackRunn
-00001820: 6572 2829 2e69 6e76 6f6b 6528 0a20 2020  er().invoke(.   
-00001830: 2020 2020 2020 2020 2062 6c61 636b 2e6d           black.m
-00001840: 6169 6e2c 2061 7267 732c 2069 6e70 7574  ain, args, input
-00001850: 3d42 7974 6573 494f 2873 6f75 7263 652e  =BytesIO(source.
-00001860: 656e 636f 6465 2822 7574 6638 2229 290a  encode("utf8")).
-00001870: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00001880: 2020 6163 7475 616c 203d 2072 6573 756c    actual = resul
-00001890: 742e 6f75 7470 7574 0a20 2020 2020 2020  t.output.       
-000018a0: 2023 2041 6761 696e 2c20 7468 6520 636f   # Again, the co
-000018b0: 6e74 656e 7473 2061 7265 2063 6865 636b  ntents are check
-000018c0: 6564 2069 6e20 6120 6469 6666 6572 656e  ed in a differen
-000018d0: 7420 7465 7374 2c20 736f 206f 6e6c 7920  t test, so only 
-000018e0: 6c6f 6f6b 2066 6f72 2063 6f6c 6f72 732e  look for colors.
-000018f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00001900: 7365 7274 496e 2822 5c30 3333 5b31 6d22  sertIn("\033[1m"
-00001910: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-00001920: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00001930: 225c 3033 335b 3336 6d22 2c20 6163 7475  "\033[36m", actu
-00001940: 616c 290a 2020 2020 2020 2020 7365 6c66  al).        self
-00001950: 2e61 7373 6572 7449 6e28 225c 3033 335b  .assertIn("\033[
-00001960: 3332 6d22 2c20 6163 7475 616c 290a 2020  32m", actual).  
-00001970: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00001980: 7449 6e28 225c 3033 335b 3331 6d22 2c20  tIn("\033[31m", 
-00001990: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
-000019a0: 7365 6c66 2e61 7373 6572 7449 6e28 225c  self.assertIn("\
-000019b0: 3033 335b 306d 222c 2061 6374 7561 6c29  033[0m", actual)
-000019c0: 0a0a 2020 2020 4070 6174 6368 2822 626c  ..    @patch("bl
-000019d0: 6163 6b2e 6475 6d70 5f74 6f5f 6669 6c65  ack.dump_to_file
-000019e0: 222c 2064 756d 705f 746f 5f73 7464 6572  ", dump_to_stder
-000019f0: 7229 0a20 2020 2064 6566 205f 7465 7374  r).    def _test
-00001a00: 5f77 6970 2873 656c 6629 202d 3e20 4e6f  _wip(self) -> No
-00001a10: 6e65 3a0a 2020 2020 2020 2020 736f 7572  ne:.        sour
-00001a20: 6365 2c20 6578 7065 6374 6564 203d 2072  ce, expected = r
-00001a30: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
-00001a40: 6c61 6e65 6f75 7322 2c20 2277 6970 2229  laneous", "wip")
-00001a50: 0a20 2020 2020 2020 2073 7973 2e73 6574  .        sys.set
-00001a60: 7472 6163 6528 7472 6163 6566 756e 6329  trace(tracefunc)
-00001a70: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
-00001a80: 7265 706c 6163 6528 0a20 2020 2020 2020  replace(.       
-00001a90: 2020 2020 2044 4546 4155 4c54 5f4d 4f44       DEFAULT_MOD
-00001aa0: 452c 0a20 2020 2020 2020 2020 2020 2065  E,.            e
-00001ab0: 7870 6572 696d 656e 7461 6c5f 7374 7269  xperimental_stri
-00001ac0: 6e67 5f70 726f 6365 7373 696e 673d 4661  ng_processing=Fa
-00001ad0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00001ae0: 2074 6172 6765 745f 7665 7273 696f 6e73   target_versions
-00001af0: 3d7b 626c 6163 6b2e 5461 7267 6574 5665  ={black.TargetVe
-00001b00: 7273 696f 6e2e 5059 3338 7d2c 0a20 2020  rsion.PY38},.   
-00001b10: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
-00001b20: 6374 7561 6c20 3d20 6673 2873 6f75 7263  ctual = fs(sourc
-00001b30: 652c 206d 6f64 653d 6d6f 6465 290a 2020  e, mode=mode).  
-00001b40: 2020 2020 2020 7379 732e 7365 7474 7261        sys.settra
-00001b50: 6365 284e 6f6e 6529 0a20 2020 2020 2020  ce(None).       
-00001b60: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
-00001b70: 6174 4571 7561 6c28 6578 7065 6374 6564  atEqual(expected
-00001b80: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-00001b90: 2020 626c 6163 6b2e 6173 7365 7274 5f65    black.assert_e
-00001ba0: 7175 6976 616c 656e 7428 736f 7572 6365  quivalent(source
-00001bb0: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-00001bc0: 2020 626c 6163 6b2e 6173 7365 7274 5f73    black.assert_s
-00001bd0: 7461 626c 6528 736f 7572 6365 2c20 6163  table(source, ac
-00001be0: 7475 616c 2c20 626c 6163 6b2e 4669 6c65  tual, black.File
-00001bf0: 4d6f 6465 2829 290a 0a20 2020 2064 6566  Mode())..    def
-00001c00: 2074 6573 745f 7065 705f 3537 325f 7665   test_pep_572_ve
-00001c10: 7273 696f 6e5f 6465 7465 6374 696f 6e28  rsion_detection(
-00001c20: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00001c30: 2020 2020 2020 2073 6f75 7263 652c 205f         source, _
-00001c40: 203d 2072 6561 645f 6461 7461 2822 7079   = read_data("py
-00001c50: 5f33 3822 2c20 2270 6570 5f35 3732 2229  _38", "pep_572")
-00001c60: 0a20 2020 2020 2020 2072 6f6f 7420 3d20  .        root = 
-00001c70: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
-00001c80: 7273 6528 736f 7572 6365 290a 2020 2020  rse(source).    
-00001c90: 2020 2020 6665 6174 7572 6573 203d 2062      features = b
-00001ca0: 6c61 636b 2e67 6574 5f66 6561 7475 7265  lack.get_feature
-00001cb0: 735f 7573 6564 2872 6f6f 7429 0a20 2020  s_used(root).   
-00001cc0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00001cd0: 496e 2862 6c61 636b 2e46 6561 7475 7265  In(black.Feature
-00001ce0: 2e41 5353 4947 4e4d 454e 545f 4558 5052  .ASSIGNMENT_EXPR
-00001cf0: 4553 5349 4f4e 532c 2066 6561 7475 7265  ESSIONS, feature
-00001d00: 7329 0a20 2020 2020 2020 2076 6572 7369  s).        versi
-00001d10: 6f6e 7320 3d20 626c 6163 6b2e 6465 7465  ons = black.dete
-00001d20: 6374 5f74 6172 6765 745f 7665 7273 696f  ct_target_versio
-00001d30: 6e73 2872 6f6f 7429 0a20 2020 2020 2020  ns(root).       
-00001d40: 2073 656c 662e 6173 7365 7274 496e 2862   self.assertIn(b
-00001d50: 6c61 636b 2e54 6172 6765 7456 6572 7369  lack.TargetVersi
-00001d60: 6f6e 2e50 5933 382c 2076 6572 7369 6f6e  on.PY38, version
-00001d70: 7329 0a0a 2020 2020 6465 6620 7465 7374  s)..    def test
-00001d80: 5f65 7870 7265 7373 696f 6e5f 6666 2873  _expression_ff(s
-00001d90: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00001da0: 2020 2020 2020 736f 7572 6365 2c20 6578        source, ex
-00001db0: 7065 6374 6564 203d 2072 6561 645f 6461  pected = read_da
-00001dc0: 7461 2822 7369 6d70 6c65 5f63 6173 6573  ta("simple_cases
-00001dd0: 222c 2022 6578 7072 6573 7369 6f6e 2e70  ", "expression.p
-00001de0: 7922 290a 2020 2020 2020 2020 746d 705f  y").        tmp_
-00001df0: 6669 6c65 203d 2050 6174 6828 626c 6163  file = Path(blac
-00001e00: 6b2e 6475 6d70 5f74 6f5f 6669 6c65 2873  k.dump_to_file(s
-00001e10: 6f75 7263 6529 290a 2020 2020 2020 2020  ource)).        
-00001e20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00001e30: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
-00001e40: 2866 6628 746d 705f 6669 6c65 2c20 7772  (ff(tmp_file, wr
-00001e50: 6974 655f 6261 636b 3d62 6c61 636b 2e57  ite_back=black.W
-00001e60: 7269 7465 4261 636b 2e59 4553 2929 0a20  riteBack.YES)). 
-00001e70: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00001e80: 6f70 656e 2874 6d70 5f66 696c 652c 2065  open(tmp_file, e
-00001e90: 6e63 6f64 696e 673d 2275 7466 3822 2920  ncoding="utf8") 
-00001ea0: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-00001eb0: 2020 2020 2020 6163 7475 616c 203d 2066        actual = f
-00001ec0: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
-00001ed0: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
-00001ee0: 2020 2020 206f 732e 756e 6c69 6e6b 2874       os.unlink(t
-00001ef0: 6d70 5f66 696c 6529 0a20 2020 2020 2020  mp_file).       
-00001f00: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
-00001f10: 6174 4571 7561 6c28 6578 7065 6374 6564  atEqual(expected
-00001f20: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-00001f30: 2020 7769 7468 2070 6174 6368 2822 626c    with patch("bl
-00001f40: 6163 6b2e 6475 6d70 5f74 6f5f 6669 6c65  ack.dump_to_file
-00001f50: 222c 2064 756d 705f 746f 5f73 7464 6572  ", dump_to_stder
-00001f60: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00001f70: 626c 6163 6b2e 6173 7365 7274 5f65 7175  black.assert_equ
-00001f80: 6976 616c 656e 7428 736f 7572 6365 2c20  ivalent(source, 
-00001f90: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
-00001fa0: 2020 2020 626c 6163 6b2e 6173 7365 7274      black.assert
-00001fb0: 5f73 7461 626c 6528 736f 7572 6365 2c20  _stable(source, 
-00001fc0: 6163 7475 616c 2c20 4445 4641 554c 545f  actual, DEFAULT_
-00001fd0: 4d4f 4445 290a 0a20 2020 2064 6566 2074  MODE)..    def t
-00001fe0: 6573 745f 6578 7072 6573 7369 6f6e 5f64  est_expression_d
-00001ff0: 6966 6628 7365 6c66 2920 2d3e 204e 6f6e  iff(self) -> Non
-00002000: 653a 0a20 2020 2020 2020 2073 6f75 7263  e:.        sourc
-00002010: 652c 205f 203d 2072 6561 645f 6461 7461  e, _ = read_data
-00002020: 2822 7369 6d70 6c65 5f63 6173 6573 222c  ("simple_cases",
-00002030: 2022 6578 7072 6573 7369 6f6e 2e70 7922   "expression.py"
-00002040: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
-00002050: 6564 2c20 5f20 3d20 7265 6164 5f64 6174  ed, _ = read_dat
-00002060: 6128 2273 696d 706c 655f 6361 7365 7322  a("simple_cases"
-00002070: 2c20 2265 7870 7265 7373 696f 6e2e 6469  , "expression.di
-00002080: 6666 2229 0a20 2020 2020 2020 2074 6d70  ff").        tmp
-00002090: 5f66 696c 6520 3d20 5061 7468 2862 6c61  _file = Path(bla
-000020a0: 636b 2e64 756d 705f 746f 5f66 696c 6528  ck.dump_to_file(
-000020b0: 736f 7572 6365 2929 0a20 2020 2020 2020  source)).       
-000020c0: 2064 6966 665f 6865 6164 6572 203d 2072   diff_header = r
-000020d0: 652e 636f 6d70 696c 6528 0a20 2020 2020  e.compile(.     
-000020e0: 2020 2020 2020 2072 6622 7b72 652e 6573         rf"{re.es
-000020f0: 6361 7065 2873 7472 2874 6d70 5f66 696c  cape(str(tmp_fil
-00002100: 6529 297d 5c74 5c64 5c64 5c64 5c64 2d5c  e))}\t\d\d\d\d-\
-00002110: 645c 642d 5c64 5c64 2022 0a20 2020 2020  d\d-\d\d ".     
-00002120: 2020 2020 2020 2072 225c 645c 643a 5c64         r"\d\d:\d
-00002130: 5c64 3a5c 645c 645c 2e5c 645c 645c 645c  \d:\d\d\.\d\d\d\
-00002140: 645c 645c 6420 5c2b 5c64 5c64 5c64 5c64  d\d\d \+\d\d\d\d
-00002150: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00002160: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00002170: 2020 2020 2072 6573 756c 7420 3d20 426c       result = Bl
-00002180: 6163 6b52 756e 6e65 7228 292e 696e 766f  ackRunner().invo
-00002190: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
-000021a0: 2020 2020 626c 6163 6b2e 6d61 696e 2c20      black.main, 
-000021b0: 5b22 2d2d 6469 6666 222c 2073 7472 2874  ["--diff", str(t
-000021c0: 6d70 5f66 696c 6529 2c20 6622 2d2d 636f  mp_file), f"--co
-000021d0: 6e66 6967 3d7b 454d 5054 595f 434f 4e46  nfig={EMPTY_CONF
-000021e0: 4947 7d22 5d0a 2020 2020 2020 2020 2020  IG}"].          
-000021f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00002200: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00002210: 2872 6573 756c 742e 6578 6974 5f63 6f64  (result.exit_cod
-00002220: 652c 2030 290a 2020 2020 2020 2020 6669  e, 0).        fi
-00002230: 6e61 6c6c 793a 0a20 2020 2020 2020 2020  nally:.         
-00002240: 2020 206f 732e 756e 6c69 6e6b 2874 6d70     os.unlink(tmp
-00002250: 5f66 696c 6529 0a20 2020 2020 2020 2061  _file).        a
-00002260: 6374 7561 6c20 3d20 7265 7375 6c74 2e6f  ctual = result.o
-00002270: 7574 7075 740a 2020 2020 2020 2020 6163  utput.        ac
-00002280: 7475 616c 203d 2064 6966 665f 6865 6164  tual = diff_head
-00002290: 6572 2e73 7562 2844 4554 4552 4d49 4e49  er.sub(DETERMINI
-000022a0: 5354 4943 5f48 4541 4445 522c 2061 6374  STIC_HEADER, act
-000022b0: 7561 6c29 0a20 2020 2020 2020 2069 6620  ual).        if 
-000022c0: 6578 7065 6374 6564 2021 3d20 6163 7475  expected != actu
-000022d0: 616c 3a0a 2020 2020 2020 2020 2020 2020  al:.            
-000022e0: 6475 6d70 203d 2062 6c61 636b 2e64 756d  dump = black.dum
-000022f0: 705f 746f 5f66 696c 6528 6163 7475 616c  p_to_file(actual
-00002300: 290a 2020 2020 2020 2020 2020 2020 6d73  ).            ms
-00002310: 6720 3d20 280a 2020 2020 2020 2020 2020  g = (.          
-00002320: 2020 2020 2020 2245 7870 6563 7465 6420        "Expected 
-00002330: 6469 6666 2069 736e 2774 2065 7175 616c  diff isn't equal
-00002340: 2074 6f20 7468 6520 6163 7475 616c 2e20   to the actual. 
-00002350: 4966 2079 6f75 206d 6164 6520 6368 616e  If you made chan
-00002360: 6765 7320 746f 220a 2020 2020 2020 2020  ges to".        
-00002370: 2020 2020 2020 2020 2220 6578 7072 6573          " expres
-00002380: 7369 6f6e 2e70 7920 616e 6420 7468 6973  sion.py and this
-00002390: 2069 7320 616e 2061 6e74 6963 6970 6174   is an anticipat
-000023a0: 6564 2064 6966 6665 7265 6e63 652c 206f  ed difference, o
-000023b0: 7665 7277 7269 7465 220a 2020 2020 2020  verwrite".      
-000023c0: 2020 2020 2020 2020 2020 6622 2074 6573            f" tes
-000023d0: 7473 2f64 6174 612f 6578 7072 6573 7369  ts/data/expressi
-000023e0: 6f6e 2e64 6966 6620 7769 7468 207b 6475  on.diff with {du
-000023f0: 6d70 7d22 0a20 2020 2020 2020 2020 2020  mp}".           
-00002400: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-00002410: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00002420: 6578 7065 6374 6564 2c20 6163 7475 616c  expected, actual
-00002430: 2c20 6d73 6729 0a0a 2020 2020 6465 6620  , msg)..    def 
-00002440: 7465 7374 5f65 7870 7265 7373 696f 6e5f  test_expression_
-00002450: 6469 6666 5f77 6974 685f 636f 6c6f 7228  diff_with_color(
-00002460: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00002470: 2020 2020 2020 2073 6f75 7263 652c 205f         source, _
-00002480: 203d 2072 6561 645f 6461 7461 2822 7369   = read_data("si
-00002490: 6d70 6c65 5f63 6173 6573 222c 2022 6578  mple_cases", "ex
-000024a0: 7072 6573 7369 6f6e 2e70 7922 290a 2020  pression.py").  
-000024b0: 2020 2020 2020 6578 7065 6374 6564 2c20        expected, 
-000024c0: 5f20 3d20 7265 6164 5f64 6174 6128 2273  _ = read_data("s
-000024d0: 696d 706c 655f 6361 7365 7322 2c20 2265  imple_cases", "e
-000024e0: 7870 7265 7373 696f 6e2e 6469 6666 2229  xpression.diff")
-000024f0: 0a20 2020 2020 2020 2074 6d70 5f66 696c  .        tmp_fil
-00002500: 6520 3d20 5061 7468 2862 6c61 636b 2e64  e = Path(black.d
-00002510: 756d 705f 746f 5f66 696c 6528 736f 7572  ump_to_file(sour
-00002520: 6365 2929 0a20 2020 2020 2020 2074 7279  ce)).        try
-00002530: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00002540: 7375 6c74 203d 2042 6c61 636b 5275 6e6e  sult = BlackRunn
-00002550: 6572 2829 2e69 6e76 6f6b 6528 0a20 2020  er().invoke(.   
-00002560: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
-00002570: 636b 2e6d 6169 6e2c 0a20 2020 2020 2020  ck.main,.       
-00002580: 2020 2020 2020 2020 205b 222d 2d64 6966           ["--dif
-00002590: 6622 2c20 222d 2d63 6f6c 6f72 222c 2073  f", "--color", s
-000025a0: 7472 2874 6d70 5f66 696c 6529 2c20 6622  tr(tmp_file), f"
-000025b0: 2d2d 636f 6e66 6967 3d7b 454d 5054 595f  --config={EMPTY_
-000025c0: 434f 4e46 4947 7d22 5d2c 0a20 2020 2020  CONFIG}"],.     
-000025d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000025e0: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-000025f0: 2020 2020 2020 6f73 2e75 6e6c 696e 6b28        os.unlink(
-00002600: 746d 705f 6669 6c65 290a 2020 2020 2020  tmp_file).      
-00002610: 2020 6163 7475 616c 203d 2072 6573 756c    actual = resul
-00002620: 742e 6f75 7470 7574 0a20 2020 2020 2020  t.output.       
-00002630: 2023 2057 6520 6368 6563 6b20 7468 6520   # We check the 
-00002640: 636f 6e74 656e 7473 206f 6620 7468 6520  contents of the 
-00002650: 6469 6666 2069 6e20 6074 6573 745f 6578  diff in `test_ex
-00002660: 7072 6573 7369 6f6e 5f64 6966 6660 2e20  pression_diff`. 
-00002670: 416c 6c0a 2020 2020 2020 2020 2320 7765  All.        # we
-00002680: 206e 6565 6420 746f 2063 6865 636b 2068   need to check h
-00002690: 6572 6520 6973 2074 6861 7420 636f 6c6f  ere is that colo
-000026a0: 7220 636f 6465 7320 6578 6973 7420 696e  r codes exist in
-000026b0: 2074 6865 2072 6573 756c 742e 0a20 2020   the result..   
-000026c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000026d0: 496e 2822 5c30 3333 5b31 6d22 2c20 6163  In("\033[1m", ac
-000026e0: 7475 616c 290a 2020 2020 2020 2020 7365  tual).        se
-000026f0: 6c66 2e61 7373 6572 7449 6e28 225c 3033  lf.assertIn("\03
-00002700: 335b 3336 6d22 2c20 6163 7475 616c 290a  3[36m", actual).
-00002710: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00002720: 6572 7449 6e28 225c 3033 335b 3332 6d22  ertIn("\033[32m"
-00002730: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-00002740: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00002750: 225c 3033 335b 3331 6d22 2c20 6163 7475  "\033[31m", actu
-00002760: 616c 290a 2020 2020 2020 2020 7365 6c66  al).        self
-00002770: 2e61 7373 6572 7449 6e28 225c 3033 335b  .assertIn("\033[
-00002780: 306d 222c 2061 6374 7561 6c29 0a0a 2020  0m", actual)..  
-00002790: 2020 6465 6620 7465 7374 5f64 6574 6563    def test_detec
-000027a0: 745f 706f 735f 6f6e 6c79 5f61 7267 756d  t_pos_only_argum
-000027b0: 656e 7473 2873 656c 6629 202d 3e20 4e6f  ents(self) -> No
-000027c0: 6e65 3a0a 2020 2020 2020 2020 736f 7572  ne:.        sour
-000027d0: 6365 2c20 5f20 3d20 7265 6164 5f64 6174  ce, _ = read_dat
-000027e0: 6128 2270 795f 3338 222c 2022 7065 705f  a("py_38", "pep_
-000027f0: 3537 3022 290a 2020 2020 2020 2020 726f  570").        ro
-00002800: 6f74 203d 2062 6c61 636b 2e6c 6962 3274  ot = black.lib2t
-00002810: 6f33 5f70 6172 7365 2873 6f75 7263 6529  o3_parse(source)
-00002820: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-00002830: 7320 3d20 626c 6163 6b2e 6765 745f 6665  s = black.get_fe
-00002840: 6174 7572 6573 5f75 7365 6428 726f 6f74  atures_used(root
-00002850: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00002860: 7373 6572 7449 6e28 626c 6163 6b2e 4665  ssertIn(black.Fe
-00002870: 6174 7572 652e 504f 535f 4f4e 4c59 5f41  ature.POS_ONLY_A
-00002880: 5247 554d 454e 5453 2c20 6665 6174 7572  RGUMENTS, featur
-00002890: 6573 290a 2020 2020 2020 2020 7665 7273  es).        vers
-000028a0: 696f 6e73 203d 2062 6c61 636b 2e64 6574  ions = black.det
-000028b0: 6563 745f 7461 7267 6574 5f76 6572 7369  ect_target_versi
-000028c0: 6f6e 7328 726f 6f74 290a 2020 2020 2020  ons(root).      
-000028d0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-000028e0: 626c 6163 6b2e 5461 7267 6574 5665 7273  black.TargetVers
-000028f0: 696f 6e2e 5059 3338 2c20 7665 7273 696f  ion.PY38, versio
-00002900: 6e73 290a 0a20 2020 2064 6566 2074 6573  ns)..    def tes
-00002910: 745f 6465 7465 6374 5f64 6562 7567 5f66  t_detect_debug_f
-00002920: 5f73 7472 696e 6773 2873 656c 6629 202d  _strings(self) -
-00002930: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00002940: 726f 6f74 203d 2062 6c61 636b 2e6c 6962  root = black.lib
-00002950: 3274 6f33 5f70 6172 7365 2822 2222 6622  2to3_parse("""f"
-00002960: 7b78 3d7d 2220 2222 2229 0a20 2020 2020  {x=}" """).     
-00002970: 2020 2066 6561 7475 7265 7320 3d20 626c     features = bl
-00002980: 6163 6b2e 6765 745f 6665 6174 7572 6573  ack.get_features
-00002990: 5f75 7365 6428 726f 6f74 290a 2020 2020  _used(root).    
-000029a0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-000029b0: 6e28 626c 6163 6b2e 4665 6174 7572 652e  n(black.Feature.
-000029c0: 4445 4255 475f 465f 5354 5249 4e47 532c  DEBUG_F_STRINGS,
-000029d0: 2066 6561 7475 7265 7329 0a20 2020 2020   features).     
-000029e0: 2020 2076 6572 7369 6f6e 7320 3d20 626c     versions = bl
-000029f0: 6163 6b2e 6465 7465 6374 5f74 6172 6765  ack.detect_targe
-00002a00: 745f 7665 7273 696f 6e73 2872 6f6f 7429  t_versions(root)
-00002a10: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00002a20: 7365 7274 496e 2862 6c61 636b 2e54 6172  sertIn(black.Tar
-00002a30: 6765 7456 6572 7369 6f6e 2e50 5933 382c  getVersion.PY38,
-00002a40: 2076 6572 7369 6f6e 7329 0a0a 2020 2020   versions)..    
-00002a50: 2020 2020 726f 6f74 203d 2062 6c61 636b      root = black
-00002a60: 2e6c 6962 3274 6f33 5f70 6172 7365 280a  .lib2to3_parse(.
-00002a70: 2020 2020 2020 2020 2020 2020 2222 2266              """f
-00002a80: 227b 787d 225c 6e66 277b 223d 227d 275c  "{x}"\nf'{"="}'\
-00002a90: 6e66 277b 2878 3a3d 3529 7d27 5c6e 6627  nf'{(x:=5)}'\nf'
-00002aa0: 7b66 2861 3d22 333d 2229 7d27 5c6e 6627  {f(a="3=")}'\nf'
-00002ab0: 7b78 3a3d 3130 7d27 5c6e 2222 220a 2020  {x:=10}'\n""".  
-00002ac0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00002ad0: 6665 6174 7572 6573 203d 2062 6c61 636b  features = black
-00002ae0: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
-00002af0: 6564 2872 6f6f 7429 0a20 2020 2020 2020  ed(root).       
-00002b00: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
-00002b10: 6e28 626c 6163 6b2e 4665 6174 7572 652e  n(black.Feature.
-00002b20: 4445 4255 475f 465f 5354 5249 4e47 532c  DEBUG_F_STRINGS,
-00002b30: 2066 6561 7475 7265 7329 0a0a 2020 2020   features)..    
-00002b40: 2020 2020 2320 5765 2064 6f6e 2774 2079      # We don't y
-00002b50: 6574 2073 7570 706f 7274 2066 6561 7475  et support featu
-00002b60: 7265 2076 6572 7369 6f6e 2064 6574 6563  re version detec
-00002b70: 7469 6f6e 2069 6e20 6e65 7374 6564 2066  tion in nested f
-00002b80: 2d73 7472 696e 6773 0a20 2020 2020 2020  -strings.       
-00002b90: 2072 6f6f 7420 3d20 626c 6163 6b2e 6c69   root = black.li
-00002ba0: 6232 746f 335f 7061 7273 6528 0a20 2020  b2to3_parse(.   
-00002bb0: 2020 2020 2020 2020 2022 2222 6622 6865           """f"he
-00002bc0: 6172 6420 6120 7275 6d6f 7572 2074 6861  ard a rumour tha
-00002bd0: 7420 7b20 6627 7b31 2b31 3d7d 2720 7d20  t { f'{1+1=}' } 
-00002be0: 2e2e 2e20 7365 656d 7320 6c69 6b65 2069  ... seems like i
-00002bf0: 7420 636f 756c 6420 6265 2074 7275 6522  t could be true"
-00002c00: 2022 2222 0a20 2020 2020 2020 2029 0a20   """.        ). 
-00002c10: 2020 2020 2020 2066 6561 7475 7265 7320         features 
-00002c20: 3d20 626c 6163 6b2e 6765 745f 6665 6174  = black.get_feat
-00002c30: 7572 6573 5f75 7365 6428 726f 6f74 290a  ures_used(root).
-00002c40: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00002c50: 6572 744e 6f74 496e 2862 6c61 636b 2e46  ertNotIn(black.F
-00002c60: 6561 7475 7265 2e44 4542 5547 5f46 5f53  eature.DEBUG_F_S
-00002c70: 5452 494e 4753 2c20 6665 6174 7572 6573  TRINGS, features
-00002c80: 290a 0a20 2020 2040 7061 7463 6828 2262  )..    @patch("b
-00002c90: 6c61 636b 2e64 756d 705f 746f 5f66 696c  lack.dump_to_fil
-00002ca0: 6522 2c20 6475 6d70 5f74 6f5f 7374 6465  e", dump_to_stde
-00002cb0: 7272 290a 2020 2020 6465 6620 7465 7374  rr).    def test
-00002cc0: 5f73 7472 696e 675f 7175 6f74 6573 2873  _string_quotes(s
-00002cd0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00002ce0: 2020 2020 2020 736f 7572 6365 2c20 6578        source, ex
-00002cf0: 7065 6374 6564 203d 2072 6561 645f 6461  pected = read_da
-00002d00: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
-00002d10: 7322 2c20 2273 7472 696e 675f 7175 6f74  s", "string_quot
-00002d20: 6573 2229 0a20 2020 2020 2020 206d 6f64  es").        mod
-00002d30: 6520 3d20 626c 6163 6b2e 4d6f 6465 2870  e = black.Mode(p
-00002d40: 7265 7669 6577 3d54 7275 6529 0a20 2020  review=True).   
-00002d50: 2020 2020 2061 7373 6572 745f 666f 726d       assert_form
-00002d60: 6174 2873 6f75 7263 652c 2065 7870 6563  at(source, expec
-00002d70: 7465 642c 206d 6f64 6529 0a20 2020 2020  ted, mode).     
-00002d80: 2020 206d 6f64 6520 3d20 7265 706c 6163     mode = replac
-00002d90: 6528 6d6f 6465 2c20 7374 7269 6e67 5f6e  e(mode, string_n
-00002da0: 6f72 6d61 6c69 7a61 7469 6f6e 3d46 616c  ormalization=Fal
-00002db0: 7365 290a 2020 2020 2020 2020 6e6f 745f  se).        not_
-00002dc0: 6e6f 726d 616c 697a 6564 203d 2066 7328  normalized = fs(
-00002dd0: 736f 7572 6365 2c20 6d6f 6465 3d6d 6f64  source, mode=mod
-00002de0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-00002df0: 6173 7365 7274 466f 726d 6174 4571 7561  assertFormatEqua
-00002e00: 6c28 736f 7572 6365 2e72 6570 6c61 6365  l(source.replace
-00002e10: 2822 5c5c 5c6e 222c 2022 2229 2c20 6e6f  ("\\\n", ""), no
-00002e20: 745f 6e6f 726d 616c 697a 6564 290a 2020  t_normalized).  
-00002e30: 2020 2020 2020 626c 6163 6b2e 6173 7365        black.asse
-00002e40: 7274 5f65 7175 6976 616c 656e 7428 736f  rt_equivalent(so
-00002e50: 7572 6365 2c20 6e6f 745f 6e6f 726d 616c  urce, not_normal
-00002e60: 697a 6564 290a 2020 2020 2020 2020 626c  ized).        bl
-00002e70: 6163 6b2e 6173 7365 7274 5f73 7461 626c  ack.assert_stabl
-00002e80: 6528 736f 7572 6365 2c20 6e6f 745f 6e6f  e(source, not_no
-00002e90: 726d 616c 697a 6564 2c20 6d6f 6465 3d6d  rmalized, mode=m
-00002ea0: 6f64 6529 0a0a 2020 2020 6465 6620 7465  ode)..    def te
-00002eb0: 7374 5f73 6b69 705f 6d61 6769 635f 7472  st_skip_magic_tr
-00002ec0: 6169 6c69 6e67 5f63 6f6d 6d61 2873 656c  ailing_comma(sel
-00002ed0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00002ee0: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
-00002ef0: 7265 6164 5f64 6174 6128 2273 696d 706c  read_data("simpl
-00002f00: 655f 6361 7365 7322 2c20 2265 7870 7265  e_cases", "expre
-00002f10: 7373 696f 6e22 290a 2020 2020 2020 2020  ssion").        
-00002f20: 6578 7065 6374 6564 2c20 5f20 3d20 7265  expected, _ = re
-00002f30: 6164 5f64 6174 6128 0a20 2020 2020 2020  ad_data(.       
-00002f40: 2020 2020 2022 6d69 7363 656c 6c61 6e65       "miscellane
-00002f50: 6f75 7322 2c20 2265 7870 7265 7373 696f  ous", "expressio
-00002f60: 6e5f 736b 6970 5f6d 6167 6963 5f74 7261  n_skip_magic_tra
-00002f70: 696c 696e 675f 636f 6d6d 612e 6469 6666  iling_comma.diff
-00002f80: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00002f90: 2020 2020 746d 705f 6669 6c65 203d 2050      tmp_file = P
-00002fa0: 6174 6828 626c 6163 6b2e 6475 6d70 5f74  ath(black.dump_t
-00002fb0: 6f5f 6669 6c65 2873 6f75 7263 6529 290a  o_file(source)).
-00002fc0: 2020 2020 2020 2020 6469 6666 5f68 6561          diff_hea
-00002fd0: 6465 7220 3d20 7265 2e63 6f6d 7069 6c65  der = re.compile
-00002fe0: 280a 2020 2020 2020 2020 2020 2020 7266  (.            rf
-00002ff0: 227b 7265 2e65 7363 6170 6528 7374 7228  "{re.escape(str(
-00003000: 746d 705f 6669 6c65 2929 7d5c 745c 645c  tmp_file))}\t\d\
-00003010: 645c 645c 642d 5c64 5c64 2d5c 645c 6420  d\d\d-\d\d-\d\d 
-00003020: 220a 2020 2020 2020 2020 2020 2020 7222  ".            r"
-00003030: 5c64 5c64 3a5c 645c 643a 5c64 5c64 5c2e  \d\d:\d\d:\d\d\.
-00003040: 5c64 5c64 5c64 5c64 5c64 5c64 205c 2b5c  \d\d\d\d\d\d \+\
-00003050: 645c 645c 645c 6422 0a20 2020 2020 2020  d\d\d\d".       
-00003060: 2029 0a20 2020 2020 2020 2074 7279 3a0a   ).        try:.
-00003070: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00003080: 6c74 203d 2042 6c61 636b 5275 6e6e 6572  lt = BlackRunner
-00003090: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
-000030a0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-000030b0: 2e6d 6169 6e2c 205b 222d 4322 2c20 222d  .main, ["-C", "-
-000030c0: 2d64 6966 6622 2c20 7374 7228 746d 705f  -diff", str(tmp_
-000030d0: 6669 6c65 292c 2066 222d 2d63 6f6e 6669  file), f"--confi
-000030e0: 673d 7b45 4d50 5459 5f43 4f4e 4649 477d  g={EMPTY_CONFIG}
-000030f0: 225d 0a20 2020 2020 2020 2020 2020 2029  "].            )
-00003100: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00003110: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00003120: 7375 6c74 2e65 7869 745f 636f 6465 2c20  sult.exit_code, 
-00003130: 3029 0a20 2020 2020 2020 2066 696e 616c  0).        final
-00003140: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-00003150: 6f73 2e75 6e6c 696e 6b28 746d 705f 6669  os.unlink(tmp_fi
-00003160: 6c65 290a 2020 2020 2020 2020 6163 7475  le).        actu
-00003170: 616c 203d 2072 6573 756c 742e 6f75 7470  al = result.outp
-00003180: 7574 0a20 2020 2020 2020 2061 6374 7561  ut.        actua
-00003190: 6c20 3d20 6469 6666 5f68 6561 6465 722e  l = diff_header.
-000031a0: 7375 6228 4445 5445 524d 494e 4953 5449  sub(DETERMINISTI
-000031b0: 435f 4845 4144 4552 2c20 6163 7475 616c  C_HEADER, actual
-000031c0: 290a 2020 2020 2020 2020 6163 7475 616c  ).        actual
-000031d0: 203d 2061 6374 7561 6c2e 7273 7472 6970   = actual.rstrip
-000031e0: 2829 202b 2022 5c6e 2220 2023 2074 6865  () + "\n"  # the
-000031f0: 2064 6966 6620 6f75 7470 7574 2068 6173   diff output has
-00003200: 2061 2074 7261 696c 696e 6720 7370 6163   a trailing spac
-00003210: 650a 2020 2020 2020 2020 6966 2065 7870  e.        if exp
-00003220: 6563 7465 6420 213d 2061 6374 7561 6c3a  ected != actual:
-00003230: 0a20 2020 2020 2020 2020 2020 2064 756d  .            dum
-00003240: 7020 3d20 626c 6163 6b2e 6475 6d70 5f74  p = black.dump_t
-00003250: 6f5f 6669 6c65 2861 6374 7561 6c29 0a20  o_file(actual). 
-00003260: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
-00003270: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00003280: 2020 2022 4578 7065 6374 6564 2064 6966     "Expected dif
-00003290: 6620 6973 6e27 7420 6571 7561 6c20 746f  f isn't equal to
-000032a0: 2074 6865 2061 6374 7561 6c2e 2049 6620   the actual. If 
-000032b0: 796f 7520 6d61 6465 2063 6861 6e67 6573  you made changes
-000032c0: 2074 6f22 0a20 2020 2020 2020 2020 2020   to".           
-000032d0: 2020 2020 2022 2065 7870 7265 7373 696f       " expressio
-000032e0: 6e2e 7079 2061 6e64 2074 6869 7320 6973  n.py and this is
-000032f0: 2061 6e20 616e 7469 6369 7061 7465 6420   an anticipated 
-00003300: 6469 6666 6572 656e 6365 2c20 6f76 6572  difference, over
-00003310: 7772 6974 6522 0a20 2020 2020 2020 2020  write".         
-00003320: 2020 2020 2020 2066 2220 7465 7374 732f         f" tests/
-00003330: 6461 7461 2f65 7870 7265 7373 696f 6e5f  data/expression_
-00003340: 736b 6970 5f6d 6167 6963 5f74 7261 696c  skip_magic_trail
-00003350: 696e 675f 636f 6d6d 612e 6469 6666 2077  ing_comma.diff w
-00003360: 6974 6820 7b64 756d 707d 220a 2020 2020  ith {dump}".    
-00003370: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00003380: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00003390: 7445 7175 616c 2865 7870 6563 7465 642c  tEqual(expected,
-000033a0: 2061 6374 7561 6c2c 206d 7367 290a 0a20   actual, msg).. 
-000033b0: 2020 2040 7061 7463 6828 2262 6c61 636b     @patch("black
-000033c0: 2e64 756d 705f 746f 5f66 696c 6522 2c20  .dump_to_file", 
-000033d0: 6475 6d70 5f74 6f5f 7374 6465 7272 290a  dump_to_stderr).
-000033e0: 2020 2020 6465 6620 7465 7374 5f61 7379      def test_asy
-000033f0: 6e63 5f61 735f 6964 656e 7469 6669 6572  nc_as_identifier
-00003400: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00003410: 2020 2020 2020 2020 736f 7572 6365 5f70          source_p
-00003420: 6174 6820 3d20 6765 745f 6361 7365 5f70  ath = get_case_p
-00003430: 6174 6828 226d 6973 6365 6c6c 616e 656f  ath("miscellaneo
-00003440: 7573 222c 2022 6173 796e 635f 6173 5f69  us", "async_as_i
-00003450: 6465 6e74 6966 6965 7222 290a 2020 2020  dentifier").    
-00003460: 2020 2020 736f 7572 6365 2c20 6578 7065      source, expe
-00003470: 6374 6564 203d 2072 6561 645f 6461 7461  cted = read_data
-00003480: 5f66 726f 6d5f 6669 6c65 2873 6f75 7263  _from_file(sourc
-00003490: 655f 7061 7468 290a 2020 2020 2020 2020  e_path).        
-000034a0: 6163 7475 616c 203d 2066 7328 736f 7572  actual = fs(sour
-000034b0: 6365 290a 2020 2020 2020 2020 7365 6c66  ce).        self
-000034c0: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
-000034d0: 616c 2865 7870 6563 7465 642c 2061 6374  al(expected, act
-000034e0: 7561 6c29 0a20 2020 2020 2020 206d 616a  ual).        maj
-000034f0: 6f72 2c20 6d69 6e6f 7220 3d20 7379 732e  or, minor = sys.
-00003500: 7665 7273 696f 6e5f 696e 666f 5b3a 325d  version_info[:2]
-00003510: 0a20 2020 2020 2020 2069 6620 6d61 6a6f  .        if majo
-00003520: 7220 3c20 3320 6f72 2028 6d61 6a6f 7220  r < 3 or (major 
-00003530: 3c3d 2033 2061 6e64 206d 696e 6f72 203c  <= 3 and minor <
-00003540: 2037 293a 0a20 2020 2020 2020 2020 2020   7):.           
-00003550: 2062 6c61 636b 2e61 7373 6572 745f 6571   black.assert_eq
-00003560: 7569 7661 6c65 6e74 2873 6f75 7263 652c  uivalent(source,
-00003570: 2061 6374 7561 6c29 0a20 2020 2020 2020   actual).       
-00003580: 2062 6c61 636b 2e61 7373 6572 745f 7374   black.assert_st
-00003590: 6162 6c65 2873 6f75 7263 652c 2061 6374  able(source, act
-000035a0: 7561 6c2c 2044 4546 4155 4c54 5f4d 4f44  ual, DEFAULT_MOD
-000035b0: 4529 0a20 2020 2020 2020 2023 2065 6e73  E).        # ens
-000035c0: 7572 6520 626c 6163 6b20 6361 6e20 7061  ure black can pa
-000035d0: 7273 6520 7468 6973 2077 6865 6e20 7468  rse this when th
-000035e0: 6520 7461 7267 6574 2069 7320 332e 360a  e target is 3.6.
-000035f0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-00003600: 6f6b 6542 6c61 636b 285b 7374 7228 736f  okeBlack([str(so
-00003610: 7572 6365 5f70 6174 6829 2c20 222d 2d74  urce_path), "--t
-00003620: 6172 6765 742d 7665 7273 696f 6e22 2c20  arget-version", 
-00003630: 2270 7933 3622 5d29 0a20 2020 2020 2020  "py36"]).       
-00003640: 2023 2062 7574 206e 6f74 206f 6e20 332e   # but not on 3.
-00003650: 372c 2062 6563 6175 7365 2061 7379 6e63  7, because async
-00003660: 2f61 7761 6974 2069 7320 6e6f 206c 6f6e  /await is no lon
-00003670: 6765 7220 616e 2069 6465 6e74 6966 6965  ger an identifie
-00003680: 720a 2020 2020 2020 2020 7365 6c66 2e69  r.        self.i
-00003690: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
-000036a0: 736f 7572 6365 5f70 6174 6829 2c20 222d  source_path), "-
-000036b0: 2d74 6172 6765 742d 7665 7273 696f 6e22  -target-version"
-000036c0: 2c20 2270 7933 3722 5d2c 2065 7869 745f  , "py37"], exit_
-000036d0: 636f 6465 3d31 3233 290a 0a20 2020 2040  code=123)..    @
-000036e0: 7061 7463 6828 2262 6c61 636b 2e64 756d  patch("black.dum
-000036f0: 705f 746f 5f66 696c 6522 2c20 6475 6d70  p_to_file", dump
-00003700: 5f74 6f5f 7374 6465 7272 290a 2020 2020  _to_stderr).    
-00003710: 6465 6620 7465 7374 5f70 7974 686f 6e33  def test_python3
-00003720: 3728 7365 6c66 2920 2d3e 204e 6f6e 653a  7(self) -> None:
-00003730: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
-00003740: 7061 7468 203d 2067 6574 5f63 6173 655f  path = get_case_
-00003750: 7061 7468 2822 7079 5f33 3722 2c20 2270  path("py_37", "p
-00003760: 7974 686f 6e33 3722 290a 2020 2020 2020  ython37").      
-00003770: 2020 736f 7572 6365 2c20 6578 7065 6374    source, expect
-00003780: 6564 203d 2072 6561 645f 6461 7461 5f66  ed = read_data_f
-00003790: 726f 6d5f 6669 6c65 2873 6f75 7263 655f  rom_file(source_
-000037a0: 7061 7468 290a 2020 2020 2020 2020 6163  path).        ac
-000037b0: 7475 616c 203d 2066 7328 736f 7572 6365  tual = fs(source
-000037c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000037d0: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
-000037e0: 2865 7870 6563 7465 642c 2061 6374 7561  (expected, actua
-000037f0: 6c29 0a20 2020 2020 2020 206d 616a 6f72  l).        major
-00003800: 2c20 6d69 6e6f 7220 3d20 7379 732e 7665  , minor = sys.ve
-00003810: 7273 696f 6e5f 696e 666f 5b3a 325d 0a20  rsion_info[:2]. 
-00003820: 2020 2020 2020 2069 6620 6d61 6a6f 7220         if major 
-00003830: 3e20 3320 6f72 2028 6d61 6a6f 7220 3d3d  > 3 or (major ==
-00003840: 2033 2061 6e64 206d 696e 6f72 203e 3d20   3 and minor >= 
-00003850: 3729 3a0a 2020 2020 2020 2020 2020 2020  7):.            
-00003860: 626c 6163 6b2e 6173 7365 7274 5f65 7175  black.assert_equ
-00003870: 6976 616c 656e 7428 736f 7572 6365 2c20  ivalent(source, 
-00003880: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
-00003890: 626c 6163 6b2e 6173 7365 7274 5f73 7461  black.assert_sta
-000038a0: 626c 6528 736f 7572 6365 2c20 6163 7475  ble(source, actu
-000038b0: 616c 2c20 4445 4641 554c 545f 4d4f 4445  al, DEFAULT_MODE
-000038c0: 290a 2020 2020 2020 2020 2320 656e 7375  ).        # ensu
-000038d0: 7265 2062 6c61 636b 2063 616e 2070 6172  re black can par
-000038e0: 7365 2074 6869 7320 7768 656e 2074 6865  se this when the
-000038f0: 2074 6172 6765 7420 6973 2033 2e37 0a20   target is 3.7. 
-00003900: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
-00003910: 6b65 426c 6163 6b28 5b73 7472 2873 6f75  keBlack([str(sou
-00003920: 7263 655f 7061 7468 292c 2022 2d2d 7461  rce_path), "--ta
-00003930: 7267 6574 2d76 6572 7369 6f6e 222c 2022  rget-version", "
-00003940: 7079 3337 225d 290a 2020 2020 2020 2020  py37"]).        
-00003950: 2320 6275 7420 6e6f 7420 6f6e 2033 2e36  # but not on 3.6
-00003960: 2c20 6265 6361 7573 6520 7765 2075 7365  , because we use
-00003970: 2061 7379 6e63 2061 7320 6120 7265 7365   async as a rese
-00003980: 7276 6564 206b 6579 776f 7264 0a20 2020  rved keyword.   
-00003990: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
-000039a0: 426c 6163 6b28 5b73 7472 2873 6f75 7263  Black([str(sourc
-000039b0: 655f 7061 7468 292c 2022 2d2d 7461 7267  e_path), "--targ
-000039c0: 6574 2d76 6572 7369 6f6e 222c 2022 7079  et-version", "py
-000039d0: 3336 225d 2c20 6578 6974 5f63 6f64 653d  36"], exit_code=
-000039e0: 3132 3329 0a0a 2020 2020 6465 6620 7465  123)..    def te
-000039f0: 7374 5f74 6162 5f63 6f6d 6d65 6e74 5f69  st_tab_comment_i
-00003a00: 6e64 656e 7461 7469 6f6e 2873 656c 6629  ndentation(self)
-00003a10: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00003a20: 2020 636f 6e74 656e 7473 5f74 6162 203d    contents_tab =
-00003a30: 2022 6966 2031 3a5c 6e5c 7469 6620 323a   "if 1:\n\tif 2:
-00003a40: 5c6e 5c74 5c74 7061 7373 5c6e 5c74 2320  \n\t\tpass\n\t# 
-00003a50: 636f 6d6d 656e 745c 6e5c 7470 6173 735c  comment\n\tpass\
-00003a60: 6e22 0a20 2020 2020 2020 2063 6f6e 7465  n".        conte
-00003a70: 6e74 735f 7370 6320 3d20 2269 6620 313a  nts_spc = "if 1:
-00003a80: 5c6e 2020 2020 6966 2032 3a5c 6e20 2020  \n    if 2:\n   
-00003a90: 2020 2020 2070 6173 735c 6e20 2020 2023       pass\n    #
-00003aa0: 2063 6f6d 6d65 6e74 5c6e 2020 2020 7061   comment\n    pa
-00003ab0: 7373 5c6e 220a 2020 2020 2020 2020 7365  ss\n".        se
-00003ac0: 6c66 2e61 7373 6572 7446 6f72 6d61 7445  lf.assertFormatE
-00003ad0: 7175 616c 2863 6f6e 7465 6e74 735f 7370  qual(contents_sp
-00003ae0: 632c 2066 7328 636f 6e74 656e 7473 5f73  c, fs(contents_s
-00003af0: 7063 2929 0a20 2020 2020 2020 2073 656c  pc)).        sel
-00003b00: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
-00003b10: 7561 6c28 636f 6e74 656e 7473 5f73 7063  ual(contents_spc
-00003b20: 2c20 6673 2863 6f6e 7465 6e74 735f 7461  , fs(contents_ta
-00003b30: 6229 290a 0a20 2020 2020 2020 2063 6f6e  b))..        con
-00003b40: 7465 6e74 735f 7461 6220 3d20 2269 6620  tents_tab = "if 
-00003b50: 313a 5c6e 5c74 6966 2032 3a5c 6e5c 745c  1:\n\tif 2:\n\t\
-00003b60: 7470 6173 735c 6e5c 745c 7423 2063 6f6d  tpass\n\t\t# com
-00003b70: 6d65 6e74 5c6e 5c74 7061 7373 5c6e 220a  ment\n\tpass\n".
-00003b80: 2020 2020 2020 2020 636f 6e74 656e 7473          contents
-00003b90: 5f73 7063 203d 2022 6966 2031 3a5c 6e20  _spc = "if 1:\n 
-00003ba0: 2020 2069 6620 323a 5c6e 2020 2020 2020     if 2:\n      
-00003bb0: 2020 7061 7373 5c6e 2020 2020 2020 2020    pass\n        
-00003bc0: 2320 636f 6d6d 656e 745c 6e20 2020 2070  # comment\n    p
-00003bd0: 6173 735c 6e22 0a20 2020 2020 2020 2073  ass\n".        s
-00003be0: 656c 662e 6173 7365 7274 466f 726d 6174  elf.assertFormat
-00003bf0: 4571 7561 6c28 636f 6e74 656e 7473 5f73  Equal(contents_s
-00003c00: 7063 2c20 6673 2863 6f6e 7465 6e74 735f  pc, fs(contents_
-00003c10: 7370 6329 290a 2020 2020 2020 2020 7365  spc)).        se
-00003c20: 6c66 2e61 7373 6572 7446 6f72 6d61 7445  lf.assertFormatE
-00003c30: 7175 616c 2863 6f6e 7465 6e74 735f 7370  qual(contents_sp
-00003c40: 632c 2066 7328 636f 6e74 656e 7473 5f74  c, fs(contents_t
-00003c50: 6162 2929 0a0a 2020 2020 2020 2020 2320  ab))..        # 
-00003c60: 6d69 7865 6420 7461 6273 2061 6e64 2073  mixed tabs and s
-00003c70: 7061 6365 7320 2876 616c 6964 2050 7974  paces (valid Pyt
-00003c80: 686f 6e20 3220 636f 6465 290a 2020 2020  hon 2 code).    
-00003c90: 2020 2020 636f 6e74 656e 7473 5f74 6162      contents_tab
-00003ca0: 203d 2022 6966 2031 3a5c 6e20 2020 2020   = "if 1:\n     
-00003cb0: 2020 2069 6620 323a 5c6e 5c74 5c74 7061     if 2:\n\t\tpa
-00003cc0: 7373 5c6e 5c74 2320 636f 6d6d 656e 745c  ss\n\t# comment\
-00003cd0: 6e20 2020 2020 2020 2070 6173 735c 6e22  n        pass\n"
-00003ce0: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
-00003cf0: 735f 7370 6320 3d20 2269 6620 313a 5c6e  s_spc = "if 1:\n
-00003d00: 2020 2020 6966 2032 3a5c 6e20 2020 2020      if 2:\n     
-00003d10: 2020 2070 6173 735c 6e20 2020 2023 2063     pass\n    # c
-00003d20: 6f6d 6d65 6e74 5c6e 2020 2020 7061 7373  omment\n    pass
-00003d30: 5c6e 220a 2020 2020 2020 2020 7365 6c66  \n".        self
-00003d40: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
-00003d50: 616c 2863 6f6e 7465 6e74 735f 7370 632c  al(contents_spc,
-00003d60: 2066 7328 636f 6e74 656e 7473 5f73 7063   fs(contents_spc
-00003d70: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00003d80: 6173 7365 7274 466f 726d 6174 4571 7561  assertFormatEqua
-00003d90: 6c28 636f 6e74 656e 7473 5f73 7063 2c20  l(contents_spc, 
-00003da0: 6673 2863 6f6e 7465 6e74 735f 7461 6229  fs(contents_tab)
-00003db0: 290a 0a20 2020 2020 2020 2063 6f6e 7465  )..        conte
-00003dc0: 6e74 735f 7461 6220 3d20 2269 6620 313a  nts_tab = "if 1:
-00003dd0: 5c6e 2020 2020 2020 2020 6966 2032 3a5c  \n        if 2:\
-00003de0: 6e5c 745c 7470 6173 735c 6e5c 745c 7423  n\t\tpass\n\t\t#
-00003df0: 2063 6f6d 6d65 6e74 5c6e 2020 2020 2020   comment\n      
-00003e00: 2020 7061 7373 5c6e 220a 2020 2020 2020    pass\n".      
-00003e10: 2020 636f 6e74 656e 7473 5f73 7063 203d    contents_spc =
-00003e20: 2022 6966 2031 3a5c 6e20 2020 2069 6620   "if 1:\n    if 
-00003e30: 323a 5c6e 2020 2020 2020 2020 7061 7373  2:\n        pass
-00003e40: 5c6e 2020 2020 2020 2020 2320 636f 6d6d  \n        # comm
-00003e50: 656e 745c 6e20 2020 2070 6173 735c 6e22  ent\n    pass\n"
-00003e60: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00003e70: 7365 7274 466f 726d 6174 4571 7561 6c28  sertFormatEqual(
-00003e80: 636f 6e74 656e 7473 5f73 7063 2c20 6673  contents_spc, fs
-00003e90: 2863 6f6e 7465 6e74 735f 7370 6329 290a  (contents_spc)).
-00003ea0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00003eb0: 6572 7446 6f72 6d61 7445 7175 616c 2863  ertFormatEqual(c
-00003ec0: 6f6e 7465 6e74 735f 7370 632c 2066 7328  ontents_spc, fs(
-00003ed0: 636f 6e74 656e 7473 5f74 6162 2929 0a0a  contents_tab))..
-00003ee0: 2020 2020 6465 6620 7465 7374 5f72 6570      def test_rep
-00003ef0: 6f72 745f 7665 7262 6f73 6528 7365 6c66  ort_verbose(self
-00003f00: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00003f10: 2020 2072 6570 6f72 7420 3d20 5265 706f     report = Repo
-00003f20: 7274 2876 6572 626f 7365 3d54 7275 6529  rt(verbose=True)
-00003f30: 0a20 2020 2020 2020 206f 7574 5f6c 696e  .        out_lin
-00003f40: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
-00003f50: 6572 725f 6c69 6e65 7320 3d20 5b5d 0a0a  err_lines = []..
-00003f60: 2020 2020 2020 2020 6465 6620 6f75 7428          def out(
-00003f70: 6d73 673a 2073 7472 2c20 2a2a 6b77 6172  msg: str, **kwar
-00003f80: 6773 3a20 416e 7929 202d 3e20 4e6f 6e65  gs: Any) -> None
-00003f90: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
-00003fa0: 745f 6c69 6e65 732e 6170 7065 6e64 286d  t_lines.append(m
-00003fb0: 7367 290a 0a20 2020 2020 2020 2064 6566  sg)..        def
-00003fc0: 2065 7272 286d 7367 3a20 7374 722c 202a   err(msg: str, *
-00003fd0: 2a6b 7761 7267 733a 2041 6e79 2920 2d3e  *kwargs: Any) ->
-00003fe0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00003ff0: 2020 2065 7272 5f6c 696e 6573 2e61 7070     err_lines.app
-00004000: 656e 6428 6d73 6729 0a0a 2020 2020 2020  end(msg)..      
-00004010: 2020 7769 7468 2070 6174 6368 2822 626c    with patch("bl
-00004020: 6163 6b2e 6f75 7470 7574 2e5f 6f75 7422  ack.output._out"
-00004030: 2c20 6f75 7429 2c20 7061 7463 6828 2262  , out), patch("b
-00004040: 6c61 636b 2e6f 7574 7075 742e 5f65 7272  lack.output._err
-00004050: 222c 2065 7272 293a 0a20 2020 2020 2020  ", err):.       
-00004060: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
-00004070: 2850 6174 6828 2266 3122 292c 2062 6c61  (Path("f1"), bla
-00004080: 636b 2e43 6861 6e67 6564 2e4e 4f29 0a20  ck.Changed.NO). 
-00004090: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000040a0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-000040b0: 6f75 745f 6c69 6e65 7329 2c20 3129 0a20  out_lines), 1). 
-000040c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000040d0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-000040e0: 6572 725f 6c69 6e65 7329 2c20 3029 0a20  err_lines), 0). 
-000040f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004100: 6173 7365 7274 4571 7561 6c28 6f75 745f  assertEqual(out_
-00004110: 6c69 6e65 735b 2d31 5d2c 2022 6631 2061  lines[-1], "f1 a
-00004120: 6c72 6561 6479 2077 656c 6c20 666f 726d  lready well form
-00004130: 6174 7465 642c 2067 6f6f 6420 6a6f 622e  atted, good job.
-00004140: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-00004150: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00004160: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-00004170: 7274 2929 2c20 2231 2066 696c 6520 6c65  rt)), "1 file le
-00004180: 6674 2075 6e63 6861 6e67 6564 2e22 290a  ft unchanged.").
-00004190: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000041a0: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
-000041b0: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
-000041c0: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
-000041d0: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
-000041e0: 2822 6632 2229 2c20 626c 6163 6b2e 4368  ("f2"), black.Ch
-000041f0: 616e 6765 642e 5945 5329 0a20 2020 2020  anged.YES).     
-00004200: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004210: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00004220: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
-00004230: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004240: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00004250: 6c69 6e65 7329 2c20 3029 0a20 2020 2020  lines), 0).     
-00004260: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004270: 7274 4571 7561 6c28 6f75 745f 6c69 6e65  rtEqual(out_line
-00004280: 735b 2d31 5d2c 2022 7265 666f 726d 6174  s[-1], "reformat
-00004290: 7465 6420 6632 2229 0a20 2020 2020 2020  ted f2").       
-000042a0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000042b0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-000042c0: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-000042d0: 7472 2872 6570 6f72 7429 292c 2022 3120  tr(report)), "1 
-000042e0: 6669 6c65 2072 6566 6f72 6d61 7474 6564  file reformatted
-000042f0: 2c20 3120 6669 6c65 206c 6566 7420 756e  , 1 file left un
-00004300: 6368 616e 6765 642e 220a 2020 2020 2020  changed.".      
-00004310: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00004320: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
-00004330: 5061 7468 2822 6633 2229 2c20 626c 6163  Path("f3"), blac
-00004340: 6b2e 4368 616e 6765 642e 4341 4348 4544  k.Changed.CACHED
-00004350: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00004360: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00004370: 656e 286f 7574 5f6c 696e 6573 292c 2033  en(out_lines), 3
-00004380: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00004390: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-000043a0: 656e 2865 7272 5f6c 696e 6573 292c 2030  en(err_lines), 0
-000043b0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000043c0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043e0: 6f75 745f 6c69 6e65 735b 2d31 5d2c 2022  out_lines[-1], "
-000043f0: 6633 2077 6173 6e27 7420 6d6f 6469 6669  f3 wasn't modifi
-00004400: 6564 206f 6e20 6469 736b 2073 696e 6365  ed on disk since
-00004410: 206c 6173 7420 7275 6e2e 220a 2020 2020   last run.".    
-00004420: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00004430: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00004440: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00004450: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
-00004460: 7374 7228 7265 706f 7274 2929 2c20 2231  str(report)), "1
-00004470: 2066 696c 6520 7265 666f 726d 6174 7465   file reformatte
-00004480: 642c 2032 2066 696c 6573 206c 6566 7420  d, 2 files left 
-00004490: 756e 6368 616e 6765 642e 220a 2020 2020  unchanged.".    
-000044a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000044b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000044c0: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-000044d0: 7475 726e 5f63 6f64 652c 2030 290a 2020  turn_code, 0).  
-000044e0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-000044f0: 2e63 6865 636b 203d 2054 7275 650a 2020  .check = True.  
-00004500: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00004510: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
-00004520: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
-00004530: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00004540: 706f 7274 2e63 6865 636b 203d 2046 616c  port.check = Fal
-00004550: 7365 0a20 2020 2020 2020 2020 2020 2072  se.            r
-00004560: 6570 6f72 742e 6661 696c 6564 2850 6174  eport.failed(Pat
-00004570: 6828 2265 3122 292c 2022 626f 6f6d 2229  h("e1"), "boom")
-00004580: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00004590: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000045a0: 6e28 6f75 745f 6c69 6e65 7329 2c20 3329  n(out_lines), 3)
-000045b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000045c0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000045d0: 6e28 6572 725f 6c69 6e65 7329 2c20 3129  n(err_lines), 1)
-000045e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000045f0: 662e 6173 7365 7274 4571 7561 6c28 6572  f.assertEqual(er
-00004600: 725f 6c69 6e65 735b 2d31 5d2c 2022 6572  r_lines[-1], "er
-00004610: 726f 723a 2063 616e 6e6f 7420 666f 726d  ror: cannot form
-00004620: 6174 2065 313a 2062 6f6f 6d22 290a 2020  at e1: boom").  
-00004630: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00004640: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00004650: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-00004660: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-00004670: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004680: 2020 2231 2066 696c 6520 7265 666f 726d    "1 file reform
-00004690: 6174 7465 642c 2032 2066 696c 6573 206c  atted, 2 files l
-000046a0: 6566 7420 756e 6368 616e 6765 642c 2031  eft unchanged, 1
-000046b0: 2066 696c 6520 6661 696c 6564 2074 6f22   file failed to"
-000046c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000046d0: 2022 2072 6566 6f72 6d61 742e 222c 0a20   " reformat.",. 
-000046e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000046f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00004700: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
-00004710: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
-00004720: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
-00004730: 6570 6f72 742e 646f 6e65 2850 6174 6828  eport.done(Path(
-00004740: 2266 3322 292c 2062 6c61 636b 2e43 6861  "f3"), black.Cha
-00004750: 6e67 6564 2e59 4553 290a 2020 2020 2020  nged.YES).      
-00004760: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00004770: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
-00004780: 696e 6573 292c 2034 290a 2020 2020 2020  ines), 4).      
-00004790: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000047a0: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
-000047b0: 696e 6573 292c 2031 290a 2020 2020 2020  ines), 1).      
-000047c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000047d0: 7445 7175 616c 286f 7574 5f6c 696e 6573  tEqual(out_lines
-000047e0: 5b2d 315d 2c20 2272 6566 6f72 6d61 7474  [-1], "reformatt
-000047f0: 6564 2066 3322 290a 2020 2020 2020 2020  ed f3").        
-00004800: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00004810: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00004820: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-00004830: 7228 7265 706f 7274 2929 2c0a 2020 2020  r(report)),.    
-00004840: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
-00004850: 696c 6573 2072 6566 6f72 6d61 7474 6564  iles reformatted
-00004860: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
-00004870: 6e63 6861 6e67 6564 2c20 3120 6669 6c65  nchanged, 1 file
-00004880: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
-00004890: 2020 2020 2020 2020 2020 2020 2220 7265              " re
-000048a0: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
-000048b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000048c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000048d0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-000048e0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
-000048f0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00004900: 2e66 6169 6c65 6428 5061 7468 2822 6532  .failed(Path("e2
-00004910: 2229 2c20 2262 6f6f 6d22 290a 2020 2020  "), "boom").    
-00004920: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00004930: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
-00004940: 5f6c 696e 6573 292c 2034 290a 2020 2020  _lines), 4).    
-00004950: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00004960: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
-00004970: 5f6c 696e 6573 292c 2032 290a 2020 2020  _lines), 2).    
-00004980: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00004990: 6572 7445 7175 616c 2865 7272 5f6c 696e  ertEqual(err_lin
-000049a0: 6573 5b2d 315d 2c20 2265 7272 6f72 3a20  es[-1], "error: 
-000049b0: 6361 6e6e 6f74 2066 6f72 6d61 7420 6532  cannot format e2
-000049c0: 3a20 626f 6f6d 2229 0a20 2020 2020 2020  : boom").       
-000049d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000049e0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-000049f0: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-00004a00: 7472 2872 6570 6f72 7429 292c 0a20 2020  tr(report)),.   
-00004a10: 2020 2020 2020 2020 2020 2020 2022 3220               "2 
-00004a20: 6669 6c65 7320 7265 666f 726d 6174 7465  files reformatte
-00004a30: 642c 2032 2066 696c 6573 206c 6566 7420  d, 2 files left 
-00004a40: 756e 6368 616e 6765 642c 2032 2066 696c  unchanged, 2 fil
-00004a50: 6573 2066 6169 6c65 6420 746f 220a 2020  es failed to".  
-00004a60: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00004a70: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
-00004a80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00004a90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00004aa0: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-00004ab0: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
-00004ac0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00004ad0: 7274 2e70 6174 685f 6967 6e6f 7265 6428  rt.path_ignored(
-00004ae0: 5061 7468 2822 7761 7422 292c 2022 6e6f  Path("wat"), "no
-00004af0: 206d 6174 6368 2229 0a20 2020 2020 2020   match").       
-00004b00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00004b10: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00004b20: 6e65 7329 2c20 3529 0a20 2020 2020 2020  nes), 5).       
-00004b30: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00004b40: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00004b50: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
-00004b60: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00004b70: 4571 7561 6c28 6f75 745f 6c69 6e65 735b  Equal(out_lines[
-00004b80: 2d31 5d2c 2022 7761 7420 6967 6e6f 7265  -1], "wat ignore
-00004b90: 643a 206e 6f20 6d61 7463 6822 290a 2020  d: no match").  
-00004ba0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00004bb0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00004bc0: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-00004bd0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-00004be0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004bf0: 2020 2232 2066 696c 6573 2072 6566 6f72    "2 files refor
-00004c00: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
-00004c10: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
-00004c20: 3220 6669 6c65 7320 6661 696c 6564 2074  2 files failed t
-00004c30: 6f22 0a20 2020 2020 2020 2020 2020 2020  o".             
-00004c40: 2020 2022 2072 6566 6f72 6d61 742e 222c     " reformat.",
-00004c50: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00004c60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004c70: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
-00004c80: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
-00004c90: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
-00004ca0: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
-00004cb0: 6828 2266 3422 292c 2062 6c61 636b 2e43  h("f4"), black.C
-00004cc0: 6861 6e67 6564 2e4e 4f29 0a20 2020 2020  hanged.NO).     
-00004cd0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004ce0: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
-00004cf0: 6c69 6e65 7329 2c20 3629 0a20 2020 2020  lines), 6).     
-00004d00: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004d10: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
-00004d20: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
-00004d30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004d40: 7274 4571 7561 6c28 6f75 745f 6c69 6e65  rtEqual(out_line
-00004d50: 735b 2d31 5d2c 2022 6634 2061 6c72 6561  s[-1], "f4 alrea
-00004d60: 6479 2077 656c 6c20 666f 726d 6174 7465  dy well formatte
-00004d70: 642c 2067 6f6f 6420 6a6f 622e 2229 0a20  d, good job."). 
-00004d80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004d90: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-00004da0: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
-00004db0: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-00004dc0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00004dd0: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
-00004de0: 726d 6174 7465 642c 2033 2066 696c 6573  rmatted, 3 files
-00004df0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
-00004e00: 2032 2066 696c 6573 2066 6169 6c65 6420   2 files failed 
-00004e10: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
-00004e20: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
-00004e30: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00004e40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00004e50: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
-00004e60: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
-00004e70: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
-00004e80: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
-00004e90: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00004ea0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00004eb0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00004ec0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00004ed0: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00004ee0: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
-00004ef0: 6573 2077 6f75 6c64 2062 6520 7265 666f  es would be refo
-00004f00: 726d 6174 7465 642c 2033 2066 696c 6573  rmatted, 3 files
-00004f10: 2077 6f75 6c64 2062 6520 6c65 6674 2075   would be left u
-00004f20: 6e63 6861 6e67 6564 2c20 3222 0a20 2020  nchanged, 2".   
-00004f30: 2020 2020 2020 2020 2020 2020 2022 2066               " f
-00004f40: 696c 6573 2077 6f75 6c64 2066 6169 6c20  iles would fail 
-00004f50: 746f 2072 6566 6f72 6d61 742e 222c 0a20  to reformat.",. 
-00004f60: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00004f70: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00004f80: 6368 6563 6b20 3d20 4661 6c73 650a 2020  check = False.  
-00004f90: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00004fa0: 2e64 6966 6620 3d20 5472 7565 0a20 2020  .diff = True.   
-00004fb0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00004fc0: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-00004fd0: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
-00004fe0: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
-00004ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005000: 2022 3220 6669 6c65 7320 776f 756c 6420   "2 files would 
-00005010: 6265 2072 6566 6f72 6d61 7474 6564 2c20  be reformatted, 
-00005020: 3320 6669 6c65 7320 776f 756c 6420 6265  3 files would be
-00005030: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
-00005040: 2032 220a 2020 2020 2020 2020 2020 2020   2".            
-00005050: 2020 2020 2220 6669 6c65 7320 776f 756c      " files woul
-00005060: 6420 6661 696c 2074 6f20 7265 666f 726d  d fail to reform
-00005070: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
-00005080: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
-00005090: 745f 7265 706f 7274 5f71 7569 6574 2873  t_report_quiet(s
-000050a0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-000050b0: 2020 2020 2020 7265 706f 7274 203d 2052        report = R
-000050c0: 6570 6f72 7428 7175 6965 743d 5472 7565  eport(quiet=True
-000050d0: 290a 2020 2020 2020 2020 6f75 745f 6c69  ).        out_li
-000050e0: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
-000050f0: 2065 7272 5f6c 696e 6573 203d 205b 5d0a   err_lines = [].
-00005100: 0a20 2020 2020 2020 2064 6566 206f 7574  .        def out
-00005110: 286d 7367 3a20 7374 722c 202a 2a6b 7761  (msg: str, **kwa
-00005120: 7267 733a 2041 6e79 2920 2d3e 204e 6f6e  rgs: Any) -> Non
-00005130: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-00005140: 7574 5f6c 696e 6573 2e61 7070 656e 6428  ut_lines.append(
-00005150: 6d73 6729 0a0a 2020 2020 2020 2020 6465  msg)..        de
-00005160: 6620 6572 7228 6d73 673a 2073 7472 2c20  f err(msg: str, 
-00005170: 2a2a 6b77 6172 6773 3a20 416e 7929 202d  **kwargs: Any) -
-00005180: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00005190: 2020 2020 6572 725f 6c69 6e65 732e 6170      err_lines.ap
-000051a0: 7065 6e64 286d 7367 290a 0a20 2020 2020  pend(msg)..     
-000051b0: 2020 2077 6974 6820 7061 7463 6828 2262     with patch("b
-000051c0: 6c61 636b 2e6f 7574 7075 742e 5f6f 7574  lack.output._out
-000051d0: 222c 206f 7574 292c 2070 6174 6368 2822  ", out), patch("
-000051e0: 626c 6163 6b2e 6f75 7470 7574 2e5f 6572  black.output._er
-000051f0: 7222 2c20 6572 7229 3a0a 2020 2020 2020  r", err):.      
-00005200: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
-00005210: 6528 5061 7468 2822 6631 2229 2c20 626c  e(Path("f1"), bl
-00005220: 6163 6b2e 4368 616e 6765 642e 4e4f 290a  ack.Changed.NO).
-00005230: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005240: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00005250: 286f 7574 5f6c 696e 6573 292c 2030 290a  (out_lines), 0).
-00005260: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005270: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00005280: 2865 7272 5f6c 696e 6573 292c 2030 290a  (err_lines), 0).
-00005290: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000052a0: 2e61 7373 6572 7445 7175 616c 2875 6e73  .assertEqual(uns
-000052b0: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-000052c0: 292c 2022 3120 6669 6c65 206c 6566 7420  ), "1 file left 
-000052d0: 756e 6368 616e 6765 642e 2229 0a20 2020  unchanged.").   
-000052e0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000052f0: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
-00005300: 2e72 6574 7572 6e5f 636f 6465 2c20 3029  .return_code, 0)
-00005310: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00005320: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
-00005330: 3222 292c 2062 6c61 636b 2e43 6861 6e67  2"), black.Chang
-00005340: 6564 2e59 4553 290a 2020 2020 2020 2020  ed.YES).        
-00005350: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005360: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00005370: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-00005380: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005390: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-000053a0: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-000053b0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000053c0: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-000053d0: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-000053e0: 7228 7265 706f 7274 2929 2c20 2231 2066  r(report)), "1 f
-000053f0: 696c 6520 7265 666f 726d 6174 7465 642c  ile reformatted,
-00005400: 2031 2066 696c 6520 6c65 6674 2075 6e63   1 file left unc
-00005410: 6861 6e67 6564 2e22 0a20 2020 2020 2020  hanged.".       
-00005420: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00005430: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
-00005440: 6174 6828 2266 3322 292c 2062 6c61 636b  ath("f3"), black
-00005450: 2e43 6861 6e67 6564 2e43 4143 4845 4429  .Changed.CACHED)
-00005460: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005470: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00005480: 6e28 6f75 745f 6c69 6e65 7329 2c20 3029  n(out_lines), 0)
-00005490: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000054a0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000054b0: 6e28 6572 725f 6c69 6e65 7329 2c20 3029  n(err_lines), 0)
-000054c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000054d0: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-000054e0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-000054f0: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
-00005500: 7429 292c 2022 3120 6669 6c65 2072 6566  t)), "1 file ref
-00005510: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
-00005520: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
-00005530: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
-00005540: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005550: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00005560: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
-00005570: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
-00005580: 2072 6570 6f72 742e 6368 6563 6b20 3d20   report.check = 
-00005590: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-000055a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000055b0: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
-000055c0: 636f 6465 2c20 3129 0a20 2020 2020 2020  code, 1).       
-000055d0: 2020 2020 2072 6570 6f72 742e 6368 6563       report.chec
-000055e0: 6b20 3d20 4661 6c73 650a 2020 2020 2020  k = False.      
-000055f0: 2020 2020 2020 7265 706f 7274 2e66 6169        report.fai
-00005600: 6c65 6428 5061 7468 2822 6531 2229 2c20  led(Path("e1"), 
-00005610: 2262 6f6f 6d22 290a 2020 2020 2020 2020  "boom").        
-00005620: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005630: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00005640: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-00005650: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005660: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-00005670: 6573 292c 2031 290a 2020 2020 2020 2020  es), 1).        
-00005680: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005690: 7175 616c 2865 7272 5f6c 696e 6573 5b2d  qual(err_lines[-
-000056a0: 315d 2c20 2265 7272 6f72 3a20 6361 6e6e  1], "error: cann
-000056b0: 6f74 2066 6f72 6d61 7420 6531 3a20 626f  ot format e1: bo
-000056c0: 6f6d 2229 0a20 2020 2020 2020 2020 2020  om").           
-000056d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000056e0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-000056f0: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
-00005700: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
-00005710: 2020 2020 2020 2020 2022 3120 6669 6c65           "1 file
-00005720: 2072 6566 6f72 6d61 7474 6564 2c20 3220   reformatted, 2 
-00005730: 6669 6c65 7320 6c65 6674 2075 6e63 6861  files left uncha
-00005740: 6e67 6564 2c20 3120 6669 6c65 2066 6169  nged, 1 file fai
-00005750: 6c65 6420 746f 220a 2020 2020 2020 2020  led to".        
-00005760: 2020 2020 2020 2020 2220 7265 666f 726d          " reform
-00005770: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
-00005780: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00005790: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000057a0: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
-000057b0: 6f64 652c 2031 3233 290a 2020 2020 2020  ode, 123).      
-000057c0: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
-000057d0: 6528 5061 7468 2822 6633 2229 2c20 626c  e(Path("f3"), bl
-000057e0: 6163 6b2e 4368 616e 6765 642e 5945 5329  ack.Changed.YES)
-000057f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005800: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00005810: 6e28 6f75 745f 6c69 6e65 7329 2c20 3029  n(out_lines), 0)
-00005820: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005830: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00005840: 6e28 6572 725f 6c69 6e65 7329 2c20 3129  n(err_lines), 1)
-00005850: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005860: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00005870: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00005880: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
-00005890: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
-000058a0: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
-000058b0: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
-000058c0: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
-000058d0: 642c 2031 2066 696c 6520 6661 696c 6564  d, 1 file failed
-000058e0: 2074 6f22 0a20 2020 2020 2020 2020 2020   to".           
-000058f0: 2020 2020 2022 2072 6566 6f72 6d61 742e       " reformat.
-00005900: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
-00005910: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005920: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00005930: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
-00005940: 2c20 3132 3329 0a20 2020 2020 2020 2020  , 123).         
-00005950: 2020 2072 6570 6f72 742e 6661 696c 6564     report.failed
-00005960: 2850 6174 6828 2265 3222 292c 2022 626f  (Path("e2"), "bo
-00005970: 6f6d 2229 0a20 2020 2020 2020 2020 2020  om").           
-00005980: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00005990: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
-000059a0: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
-000059b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000059c0: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
-000059d0: 2c20 3229 0a20 2020 2020 2020 2020 2020  , 2).           
-000059e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000059f0: 6c28 6572 725f 6c69 6e65 735b 2d31 5d2c  l(err_lines[-1],
-00005a00: 2022 6572 726f 723a 2063 616e 6e6f 7420   "error: cannot 
-00005a10: 666f 726d 6174 2065 323a 2062 6f6f 6d22  format e2: boom"
-00005a20: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005a30: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-00005a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a50: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-00005a60: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
-00005a70: 2020 2020 2020 2232 2066 696c 6573 2072        "2 files r
-00005a80: 6566 6f72 6d61 7474 6564 2c20 3220 6669  eformatted, 2 fi
-00005a90: 6c65 7320 6c65 6674 2075 6e63 6861 6e67  les left unchang
-00005aa0: 6564 2c20 3220 6669 6c65 7320 6661 696c  ed, 2 files fail
-00005ab0: 6564 2074 6f22 0a20 2020 2020 2020 2020  ed to".         
-00005ac0: 2020 2020 2020 2022 2072 6566 6f72 6d61         " reforma
-00005ad0: 742e 222c 0a20 2020 2020 2020 2020 2020  t.",.           
-00005ae0: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-00005af0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005b00: 7265 706f 7274 2e72 6574 7572 6e5f 636f  report.return_co
-00005b10: 6465 2c20 3132 3329 0a20 2020 2020 2020  de, 123).       
-00005b20: 2020 2020 2072 6570 6f72 742e 7061 7468       report.path
-00005b30: 5f69 676e 6f72 6564 2850 6174 6828 2277  _ignored(Path("w
-00005b40: 6174 2229 2c20 226e 6f20 6d61 7463 6822  at"), "no match"
-00005b50: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005b60: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00005b70: 656e 286f 7574 5f6c 696e 6573 292c 2030  en(out_lines), 0
-00005b80: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005b90: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00005ba0: 656e 2865 7272 5f6c 696e 6573 292c 2032  en(err_lines), 2
-00005bb0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005bc0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-00005bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005be0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-00005bf0: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
-00005c00: 2020 2020 2020 2232 2066 696c 6573 2072        "2 files r
-00005c10: 6566 6f72 6d61 7474 6564 2c20 3220 6669  eformatted, 2 fi
-00005c20: 6c65 7320 6c65 6674 2075 6e63 6861 6e67  les left unchang
-00005c30: 6564 2c20 3220 6669 6c65 7320 6661 696c  ed, 2 files fail
-00005c40: 6564 2074 6f22 0a20 2020 2020 2020 2020  ed to".         
-00005c50: 2020 2020 2020 2022 2072 6566 6f72 6d61         " reforma
-00005c60: 742e 222c 0a20 2020 2020 2020 2020 2020  t.",.           
-00005c70: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-00005c80: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005c90: 7265 706f 7274 2e72 6574 7572 6e5f 636f  report.return_co
-00005ca0: 6465 2c20 3132 3329 0a20 2020 2020 2020  de, 123).       
-00005cb0: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
-00005cc0: 2850 6174 6828 2266 3422 292c 2062 6c61  (Path("f4"), bla
-00005cd0: 636b 2e43 6861 6e67 6564 2e4e 4f29 0a20  ck.Changed.NO). 
-00005ce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005cf0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00005d00: 6f75 745f 6c69 6e65 7329 2c20 3029 0a20  out_lines), 0). 
-00005d10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005d20: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00005d30: 6572 725f 6c69 6e65 7329 2c20 3229 0a20  err_lines), 2). 
-00005d40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005d50: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-00005d60: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
-00005d70: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
-00005d80: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00005d90: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
-00005da0: 726d 6174 7465 642c 2033 2066 696c 6573  rmatted, 3 files
-00005db0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
-00005dc0: 2032 2066 696c 6573 2066 6169 6c65 6420   2 files failed 
-00005dd0: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
-00005de0: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
-00005df0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00005e00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005e10: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
-00005e20: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
-00005e30: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
-00005e40: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
-00005e50: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00005e60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00005e70: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00005e80: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00005e90: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00005ea0: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
-00005eb0: 6573 2077 6f75 6c64 2062 6520 7265 666f  es would be refo
-00005ec0: 726d 6174 7465 642c 2033 2066 696c 6573  rmatted, 3 files
-00005ed0: 2077 6f75 6c64 2062 6520 6c65 6674 2075   would be left u
-00005ee0: 6e63 6861 6e67 6564 2c20 3222 0a20 2020  nchanged, 2".   
-00005ef0: 2020 2020 2020 2020 2020 2020 2022 2066               " f
-00005f00: 696c 6573 2077 6f75 6c64 2066 6169 6c20  iles would fail 
-00005f10: 746f 2072 6566 6f72 6d61 742e 222c 0a20  to reformat.",. 
-00005f20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00005f30: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00005f40: 6368 6563 6b20 3d20 4661 6c73 650a 2020  check = False.  
-00005f50: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00005f60: 2e64 6966 6620 3d20 5472 7565 0a20 2020  .diff = True.   
-00005f70: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00005f80: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-00005f90: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
-00005fa0: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
-00005fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005fc0: 2022 3220 6669 6c65 7320 776f 756c 6420   "2 files would 
-00005fd0: 6265 2072 6566 6f72 6d61 7474 6564 2c20  be reformatted, 
-00005fe0: 3320 6669 6c65 7320 776f 756c 6420 6265  3 files would be
-00005ff0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
-00006000: 2032 220a 2020 2020 2020 2020 2020 2020   2".            
-00006010: 2020 2020 2220 6669 6c65 7320 776f 756c      " files woul
-00006020: 6420 6661 696c 2074 6f20 7265 666f 726d  d fail to reform
-00006030: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
-00006040: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
-00006050: 745f 7265 706f 7274 5f6e 6f72 6d61 6c28  t_report_normal(
-00006060: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00006070: 2020 2020 2020 2072 6570 6f72 7420 3d20         report = 
-00006080: 626c 6163 6b2e 5265 706f 7274 2829 0a20  black.Report(). 
-00006090: 2020 2020 2020 206f 7574 5f6c 696e 6573         out_lines
-000060a0: 203d 205b 5d0a 2020 2020 2020 2020 6572   = [].        er
-000060b0: 725f 6c69 6e65 7320 3d20 5b5d 0a0a 2020  r_lines = []..  
-000060c0: 2020 2020 2020 6465 6620 6f75 7428 6d73        def out(ms
-000060d0: 673a 2073 7472 2c20 2a2a 6b77 6172 6773  g: str, **kwargs
-000060e0: 3a20 416e 7929 202d 3e20 4e6f 6e65 3a0a  : Any) -> None:.
-000060f0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-00006100: 6c69 6e65 732e 6170 7065 6e64 286d 7367  lines.append(msg
-00006110: 290a 0a20 2020 2020 2020 2064 6566 2065  )..        def e
-00006120: 7272 286d 7367 3a20 7374 722c 202a 2a6b  rr(msg: str, **k
-00006130: 7761 7267 733a 2041 6e79 2920 2d3e 204e  wargs: Any) -> N
-00006140: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00006150: 2065 7272 5f6c 696e 6573 2e61 7070 656e   err_lines.appen
-00006160: 6428 6d73 6729 0a0a 2020 2020 2020 2020  d(msg)..        
-00006170: 7769 7468 2070 6174 6368 2822 626c 6163  with patch("blac
-00006180: 6b2e 6f75 7470 7574 2e5f 6f75 7422 2c20  k.output._out", 
-00006190: 6f75 7429 2c20 7061 7463 6828 2262 6c61  out), patch("bla
-000061a0: 636b 2e6f 7574 7075 742e 5f65 7272 222c  ck.output._err",
-000061b0: 2065 7272 293a 0a20 2020 2020 2020 2020   err):.         
-000061c0: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
-000061d0: 6174 6828 2266 3122 292c 2062 6c61 636b  ath("f1"), black
-000061e0: 2e43 6861 6e67 6564 2e4e 4f29 0a20 2020  .Changed.NO).   
-000061f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006200: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
-00006210: 745f 6c69 6e65 7329 2c20 3029 0a20 2020  t_lines), 0).   
-00006220: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006230: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
-00006240: 725f 6c69 6e65 7329 2c20 3029 0a20 2020  r_lines), 0).   
-00006250: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006260: 7365 7274 4571 7561 6c28 756e 7374 796c  sertEqual(unstyl
-00006270: 6528 7374 7228 7265 706f 7274 2929 2c20  e(str(report)), 
-00006280: 2231 2066 696c 6520 6c65 6674 2075 6e63  "1 file left unc
-00006290: 6861 6e67 6564 2e22 290a 2020 2020 2020  hanged.").      
-000062a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000062b0: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-000062c0: 7475 726e 5f63 6f64 652c 2030 290a 2020  turn_code, 0).  
-000062d0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-000062e0: 2e64 6f6e 6528 5061 7468 2822 6632 2229  .done(Path("f2")
-000062f0: 2c20 626c 6163 6b2e 4368 616e 6765 642e  , black.Changed.
-00006300: 5945 5329 0a20 2020 2020 2020 2020 2020  YES).           
-00006310: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006320: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
-00006330: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
-00006340: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006350: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
-00006360: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
-00006370: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006380: 6c28 6f75 745f 6c69 6e65 735b 2d31 5d2c  l(out_lines[-1],
-00006390: 2022 7265 666f 726d 6174 7465 6420 6632   "reformatted f2
-000063a0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-000063b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000063c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000063d0: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
-000063e0: 6f72 7429 292c 2022 3120 6669 6c65 2072  ort)), "1 file r
-000063f0: 6566 6f72 6d61 7474 6564 2c20 3120 6669  eformatted, 1 fi
-00006400: 6c65 206c 6566 7420 756e 6368 616e 6765  le left unchange
-00006410: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
-00006420: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00006430: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
-00006440: 6633 2229 2c20 626c 6163 6b2e 4368 616e  f3"), black.Chan
-00006450: 6765 642e 4341 4348 4544 290a 2020 2020  ged.CACHED).    
-00006460: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006470: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
-00006480: 5f6c 696e 6573 292c 2031 290a 2020 2020  _lines), 1).    
-00006490: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000064a0: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
-000064b0: 5f6c 696e 6573 292c 2030 290a 2020 2020  _lines), 0).    
-000064c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000064d0: 6572 7445 7175 616c 286f 7574 5f6c 696e  ertEqual(out_lin
-000064e0: 6573 5b2d 315d 2c20 2272 6566 6f72 6d61  es[-1], "reforma
-000064f0: 7474 6564 2066 3222 290a 2020 2020 2020  tted f2").      
-00006500: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006510: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00006520: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
-00006530: 7374 7228 7265 706f 7274 2929 2c20 2231  str(report)), "1
-00006540: 2066 696c 6520 7265 666f 726d 6174 7465   file reformatte
-00006550: 642c 2032 2066 696c 6573 206c 6566 7420  d, 2 files left 
-00006560: 756e 6368 616e 6765 642e 220a 2020 2020  unchanged.".    
-00006570: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00006580: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006590: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-000065a0: 7475 726e 5f63 6f64 652c 2030 290a 2020  turn_code, 0).  
-000065b0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-000065c0: 2e63 6865 636b 203d 2054 7275 650a 2020  .check = True.  
-000065d0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000065e0: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
-000065f0: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
-00006600: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00006610: 706f 7274 2e63 6865 636b 203d 2046 616c  port.check = Fal
-00006620: 7365 0a20 2020 2020 2020 2020 2020 2072  se.            r
-00006630: 6570 6f72 742e 6661 696c 6564 2850 6174  eport.failed(Pat
-00006640: 6828 2265 3122 292c 2022 626f 6f6d 2229  h("e1"), "boom")
-00006650: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006660: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00006670: 6e28 6f75 745f 6c69 6e65 7329 2c20 3129  n(out_lines), 1)
-00006680: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006690: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000066a0: 6e28 6572 725f 6c69 6e65 7329 2c20 3129  n(err_lines), 1)
-000066b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000066c0: 662e 6173 7365 7274 4571 7561 6c28 6572  f.assertEqual(er
-000066d0: 725f 6c69 6e65 735b 2d31 5d2c 2022 6572  r_lines[-1], "er
-000066e0: 726f 723a 2063 616e 6e6f 7420 666f 726d  ror: cannot form
-000066f0: 6174 2065 313a 2062 6f6f 6d22 290a 2020  at e1: boom").  
-00006700: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006710: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00006720: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-00006730: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-00006740: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006750: 2020 2231 2066 696c 6520 7265 666f 726d    "1 file reform
-00006760: 6174 7465 642c 2032 2066 696c 6573 206c  atted, 2 files l
-00006770: 6566 7420 756e 6368 616e 6765 642c 2031  eft unchanged, 1
-00006780: 2066 696c 6520 6661 696c 6564 2074 6f22   file failed to"
-00006790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000067a0: 2022 2072 6566 6f72 6d61 742e 222c 0a20   " reformat.",. 
-000067b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000067c0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000067d0: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
-000067e0: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
-000067f0: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
-00006800: 6570 6f72 742e 646f 6e65 2850 6174 6828  eport.done(Path(
-00006810: 2266 3322 292c 2062 6c61 636b 2e43 6861  "f3"), black.Cha
-00006820: 6e67 6564 2e59 4553 290a 2020 2020 2020  nged.YES).      
-00006830: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006840: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
-00006850: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
-00006860: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006870: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
-00006880: 696e 6573 292c 2031 290a 2020 2020 2020  ines), 1).      
-00006890: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000068a0: 7445 7175 616c 286f 7574 5f6c 696e 6573  tEqual(out_lines
-000068b0: 5b2d 315d 2c20 2272 6566 6f72 6d61 7474  [-1], "reformatt
-000068c0: 6564 2066 3322 290a 2020 2020 2020 2020  ed f3").        
-000068d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000068e0: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-000068f0: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
-00006900: 7228 7265 706f 7274 2929 2c0a 2020 2020  r(report)),.    
-00006910: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
-00006920: 696c 6573 2072 6566 6f72 6d61 7474 6564  iles reformatted
-00006930: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
-00006940: 6e63 6861 6e67 6564 2c20 3120 6669 6c65  nchanged, 1 file
-00006950: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
-00006960: 2020 2020 2020 2020 2020 2020 2220 7265              " re
-00006970: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
-00006980: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006990: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000069a0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-000069b0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
-000069c0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-000069d0: 2e66 6169 6c65 6428 5061 7468 2822 6532  .failed(Path("e2
-000069e0: 2229 2c20 2262 6f6f 6d22 290a 2020 2020  "), "boom").    
-000069f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006a00: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
-00006a10: 5f6c 696e 6573 292c 2032 290a 2020 2020  _lines), 2).    
-00006a20: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006a30: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
-00006a40: 5f6c 696e 6573 292c 2032 290a 2020 2020  _lines), 2).    
-00006a50: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006a60: 6572 7445 7175 616c 2865 7272 5f6c 696e  ertEqual(err_lin
-00006a70: 6573 5b2d 315d 2c20 2265 7272 6f72 3a20  es[-1], "error: 
-00006a80: 6361 6e6e 6f74 2066 6f72 6d61 7420 6532  cannot format e2
-00006a90: 3a20 626f 6f6d 2229 0a20 2020 2020 2020  : boom").       
-00006aa0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006ab0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00006ac0: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-00006ad0: 7472 2872 6570 6f72 7429 292c 0a20 2020  tr(report)),.   
-00006ae0: 2020 2020 2020 2020 2020 2020 2022 3220               "2 
-00006af0: 6669 6c65 7320 7265 666f 726d 6174 7465  files reformatte
-00006b00: 642c 2032 2066 696c 6573 206c 6566 7420  d, 2 files left 
-00006b10: 756e 6368 616e 6765 642c 2032 2066 696c  unchanged, 2 fil
-00006b20: 6573 2066 6169 6c65 6420 746f 220a 2020  es failed to".  
-00006b30: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00006b40: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
-00006b50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00006b60: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006b70: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-00006b80: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
-00006b90: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00006ba0: 7274 2e70 6174 685f 6967 6e6f 7265 6428  rt.path_ignored(
-00006bb0: 5061 7468 2822 7761 7422 292c 2022 6e6f  Path("wat"), "no
-00006bc0: 206d 6174 6368 2229 0a20 2020 2020 2020   match").       
-00006bd0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006be0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00006bf0: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
-00006c00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006c10: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00006c20: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
-00006c30: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006c40: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00006c50: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-00006c60: 7472 2872 6570 6f72 7429 292c 0a20 2020  tr(report)),.   
-00006c70: 2020 2020 2020 2020 2020 2020 2022 3220               "2 
-00006c80: 6669 6c65 7320 7265 666f 726d 6174 7465  files reformatte
-00006c90: 642c 2032 2066 696c 6573 206c 6566 7420  d, 2 files left 
-00006ca0: 756e 6368 616e 6765 642c 2032 2066 696c  unchanged, 2 fil
-00006cb0: 6573 2066 6169 6c65 6420 746f 220a 2020  es failed to".  
-00006cc0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-00006cd0: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
-00006ce0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00006cf0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006d00: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
-00006d10: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
-00006d20: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00006d30: 7274 2e64 6f6e 6528 5061 7468 2822 6634  rt.done(Path("f4
-00006d40: 2229 2c20 626c 6163 6b2e 4368 616e 6765  "), black.Change
-00006d50: 642e 4e4f 290a 2020 2020 2020 2020 2020  d.NO).          
-00006d60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00006d70: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
-00006d80: 292c 2032 290a 2020 2020 2020 2020 2020  ), 2).          
-00006d90: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00006da0: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
-00006db0: 292c 2032 290a 2020 2020 2020 2020 2020  ), 2).          
-00006dc0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00006dd0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00006de0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00006df0: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00006e00: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
-00006e10: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
-00006e20: 3320 6669 6c65 7320 6c65 6674 2075 6e63  3 files left unc
-00006e30: 6861 6e67 6564 2c20 3220 6669 6c65 7320  hanged, 2 files 
-00006e40: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
-00006e50: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
-00006e60: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
-00006e70: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00006e80: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006e90: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
-00006ea0: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
-00006eb0: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00006ec0: 6368 6563 6b20 3d20 5472 7565 0a20 2020  check = True.   
-00006ed0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006ee0: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-00006ef0: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
-00006f00: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
-00006f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006f20: 2022 3220 6669 6c65 7320 776f 756c 6420   "2 files would 
-00006f30: 6265 2072 6566 6f72 6d61 7474 6564 2c20  be reformatted, 
-00006f40: 3320 6669 6c65 7320 776f 756c 6420 6265  3 files would be
-00006f50: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
-00006f60: 2032 220a 2020 2020 2020 2020 2020 2020   2".            
-00006f70: 2020 2020 2220 6669 6c65 7320 776f 756c      " files woul
-00006f80: 6420 6661 696c 2074 6f20 7265 666f 726d  d fail to reform
-00006f90: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
-00006fa0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00006fb0: 7265 706f 7274 2e63 6865 636b 203d 2046  report.check = F
-00006fc0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00006fd0: 2072 6570 6f72 742e 6469 6666 203d 2054   report.diff = T
-00006fe0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00006ff0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007000: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00007010: 2020 756e 7374 796c 6528 7374 7228 7265    unstyle(str(re
-00007020: 706f 7274 2929 2c0a 2020 2020 2020 2020  port)),.        
-00007030: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
-00007040: 2077 6f75 6c64 2062 6520 7265 666f 726d   would be reform
-00007050: 6174 7465 642c 2033 2066 696c 6573 2077  atted, 3 files w
-00007060: 6f75 6c64 2062 6520 6c65 6674 2075 6e63  ould be left unc
-00007070: 6861 6e67 6564 2c20 3222 0a20 2020 2020  hanged, 2".     
-00007080: 2020 2020 2020 2020 2020 2022 2066 696c             " fil
-00007090: 6573 2077 6f75 6c64 2066 6169 6c20 746f  es would fail to
-000070a0: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
-000070b0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-000070c0: 6465 6620 7465 7374 5f6c 6962 3274 6f33  def test_lib2to3
-000070d0: 5f70 6172 7365 2873 656c 6629 202d 3e20  _parse(self) -> 
-000070e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-000070f0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-00007100: 6973 6573 2862 6c61 636b 2e49 6e76 616c  ises(black.Inval
-00007110: 6964 496e 7075 7429 3a0a 2020 2020 2020  idInput):.      
-00007120: 2020 2020 2020 626c 6163 6b2e 6c69 6232        black.lib2
-00007130: 746f 335f 7061 7273 6528 2269 6e76 616c  to3_parse("inval
-00007140: 6964 2073 796e 7461 7822 290a 0a20 2020  id syntax")..   
-00007150: 2020 2020 2073 7472 6164 646c 696e 6720       straddling 
-00007160: 3d20 2278 202b 2079 220a 2020 2020 2020  = "x + y".      
-00007170: 2020 626c 6163 6b2e 6c69 6232 746f 335f    black.lib2to3_
-00007180: 7061 7273 6528 7374 7261 6464 6c69 6e67  parse(straddling
-00007190: 290a 2020 2020 2020 2020 626c 6163 6b2e  ).        black.
-000071a0: 6c69 6232 746f 335f 7061 7273 6528 7374  lib2to3_parse(st
-000071b0: 7261 6464 6c69 6e67 2c20 7b54 6172 6765  raddling, {Targe
-000071c0: 7456 6572 7369 6f6e 2e50 5933 367d 290a  tVersion.PY36}).
-000071d0: 0a20 2020 2020 2020 2070 7932 5f6f 6e6c  .        py2_onl
-000071e0: 7920 3d20 2270 7269 6e74 2078 220a 2020  y = "print x".  
-000071f0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-00007200: 6173 7365 7274 5261 6973 6573 2862 6c61  assertRaises(bla
-00007210: 636b 2e49 6e76 616c 6964 496e 7075 7429  ck.InvalidInput)
-00007220: 3a0a 2020 2020 2020 2020 2020 2020 626c  :.            bl
-00007230: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00007240: 6528 7079 325f 6f6e 6c79 2c20 7b54 6172  e(py2_only, {Tar
-00007250: 6765 7456 6572 7369 6f6e 2e50 5933 367d  getVersion.PY36}
-00007260: 290a 0a20 2020 2020 2020 2070 7933 5f6f  )..        py3_o
-00007270: 6e6c 7920 3d20 2265 7865 6328 782c 2065  nly = "exec(x, e
-00007280: 6e64 3d79 2922 0a20 2020 2020 2020 2062  nd=y)".        b
-00007290: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-000072a0: 7365 2870 7933 5f6f 6e6c 7929 0a20 2020  se(py3_only).   
-000072b0: 2020 2020 2062 6c61 636b 2e6c 6962 3274       black.lib2t
-000072c0: 6f33 5f70 6172 7365 2870 7933 5f6f 6e6c  o3_parse(py3_onl
-000072d0: 792c 207b 5461 7267 6574 5665 7273 696f  y, {TargetVersio
-000072e0: 6e2e 5059 3336 7d29 0a0a 2020 2020 6465  n.PY36})..    de
-000072f0: 6620 7465 7374 5f67 6574 5f66 6561 7475  f test_get_featu
-00007300: 7265 735f 7573 6564 5f64 6563 6f72 6174  res_used_decorat
-00007310: 6f72 2873 656c 6629 202d 3e20 4e6f 6e65  or(self) -> None
-00007320: 3a0a 2020 2020 2020 2020 2320 5465 7374  :.        # Test
-00007330: 2074 6865 2066 6561 7475 7265 2064 6574   the feature det
-00007340: 6563 7469 6f6e 206f 6620 6e65 7720 6465  ection of new de
-00007350: 636f 7261 746f 7220 7379 6e74 6178 0a20  corator syntax. 
-00007360: 2020 2020 2020 2023 2073 696e 6365 2074         # since t
-00007370: 6869 7320 6d61 6b65 7320 736f 6d65 2074  his makes some t
-00007380: 6573 7420 6361 7365 7320 6f66 2074 6573  est cases of tes
-00007390: 745f 6765 745f 6665 6174 7572 6573 5f75  t_get_features_u
-000073a0: 7365 6428 290a 2020 2020 2020 2020 2320  sed().        # 
-000073b0: 6661 696c 7320 6966 2069 7420 6661 696c  fails if it fail
-000073c0: 732c 2074 6869 7320 6973 2074 6573 7465  s, this is teste
-000073d0: 6420 6669 7273 7420 736f 2074 6861 7420  d first so that 
-000073e0: 6120 7573 6566 756c 2063 6173 650a 2020  a useful case.  
-000073f0: 2020 2020 2020 2320 6973 2069 6465 6e74        # is ident
-00007400: 6966 6965 640a 2020 2020 2020 2020 7369  ified.        si
-00007410: 6d70 6c65 732c 2072 656c 6178 6564 203d  mples, relaxed =
-00007420: 2072 6561 645f 6461 7461 2822 6d69 7363   read_data("misc
-00007430: 656c 6c61 6e65 6f75 7322 2c20 2264 6563  ellaneous", "dec
-00007440: 6f72 6174 6f72 7322 290a 2020 2020 2020  orators").      
-00007450: 2020 2320 736b 6970 2065 7870 6c61 6e61    # skip explana
-00007460: 7469 6f6e 2063 6f6d 6d65 6e74 7320 6174  tion comments at
-00007470: 2074 6865 2074 6f70 206f 6620 7468 6520   the top of the 
-00007480: 6669 6c65 0a20 2020 2020 2020 2066 6f72  file.        for
-00007490: 2073 696d 706c 655f 7465 7374 2069 6e20   simple_test in 
-000074a0: 7369 6d70 6c65 732e 7370 6c69 7428 2223  simples.split("#
-000074b0: 2322 295b 313a 5d3a 0a20 2020 2020 2020  #")[1:]:.       
-000074c0: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
-000074d0: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
-000074e0: 7369 6d70 6c65 5f74 6573 7429 0a20 2020  simple_test).   
-000074f0: 2020 2020 2020 2020 2064 6563 6f72 6174           decorat
-00007500: 6f72 203d 2073 7472 286e 6f64 652e 6368  or = str(node.ch
-00007510: 696c 6472 656e 5b30 5d2e 6368 696c 6472  ildren[0].childr
-00007520: 656e 5b30 5d29 2e73 7472 6970 2829 0a20  en[0]).strip(). 
-00007530: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007540: 6173 7365 7274 4e6f 7449 6e28 0a20 2020  assertNotIn(.   
-00007550: 2020 2020 2020 2020 2020 2020 2046 6561               Fea
-00007560: 7475 7265 2e52 454c 4158 4544 5f44 4543  ture.RELAXED_DEC
-00007570: 4f52 4154 4f52 532c 0a20 2020 2020 2020  ORATORS,.       
-00007580: 2020 2020 2020 2020 2062 6c61 636b 2e67           black.g
-00007590: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
-000075a0: 286e 6f64 6529 2c0a 2020 2020 2020 2020  (node),.        
-000075b0: 2020 2020 2020 2020 6d73 673d 280a 2020          msg=(.  
-000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075d0: 2020 6622 6465 636f 7261 746f 7220 277b    f"decorator '{
-000075e0: 6465 636f 7261 746f 727d 2720 666f 6c6c  decorator}' foll
-000075f0: 6f77 7320 7079 7468 6f6e 3c3d 332e 3820  ows python<=3.8 
-00007600: 7379 6e74 6178 220a 2020 2020 2020 2020  syntax".        
-00007610: 2020 2020 2020 2020 2020 2020 2262 7574              "but
-00007620: 2069 7320 6465 7465 6374 6564 2061 7320   is detected as 
-00007630: 332e 392b 220a 2020 2020 2020 2020 2020  3.9+".          
-00007640: 2020 2020 2020 2020 2020 2320 6622 5468            # f"Th
-00007650: 6520 6675 6c6c 206e 6f64 6520 6973 5c6e  e full node is\n
-00007660: 7b6e 6f64 6521 727d 220a 2020 2020 2020  {node!r}".      
-00007670: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-00007680: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00007690: 2020 2023 2073 6b69 7020 7468 6520 2723     # skip the '#
-000076a0: 206f 7574 7075 7427 2063 6f6d 6d65 6e74   output' comment
-000076b0: 2061 7420 7468 6520 746f 7020 6f66 2074   at the top of t
-000076c0: 6865 206f 7574 7075 7420 7061 7274 0a20  he output part. 
-000076d0: 2020 2020 2020 2066 6f72 2072 656c 6178         for relax
-000076e0: 6564 5f74 6573 7420 696e 2072 656c 6178  ed_test in relax
-000076f0: 6564 2e73 706c 6974 2822 2323 2229 5b31  ed.split("##")[1
-00007700: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
-00007710: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
-00007720: 3274 6f33 5f70 6172 7365 2872 656c 6178  2to3_parse(relax
-00007730: 6564 5f74 6573 7429 0a20 2020 2020 2020  ed_test).       
-00007740: 2020 2020 2064 6563 6f72 6174 6f72 203d       decorator =
-00007750: 2073 7472 286e 6f64 652e 6368 696c 6472   str(node.childr
-00007760: 656e 5b30 5d2e 6368 696c 6472 656e 5b30  en[0].children[0
-00007770: 5d29 2e73 7472 6970 2829 0a20 2020 2020  ]).strip().     
-00007780: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007790: 7274 496e 280a 2020 2020 2020 2020 2020  rtIn(.          
-000077a0: 2020 2020 2020 4665 6174 7572 652e 5245        Feature.RE
-000077b0: 4c41 5845 445f 4445 434f 5241 544f 5253  LAXED_DECORATORS
-000077c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000077d0: 2020 626c 6163 6b2e 6765 745f 6665 6174    black.get_feat
-000077e0: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
-000077f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007800: 206d 7367 3d28 0a20 2020 2020 2020 2020   msg=(.         
-00007810: 2020 2020 2020 2020 2020 2066 2264 6563             f"dec
-00007820: 6f72 6174 6f72 2027 7b64 6563 6f72 6174  orator '{decorat
-00007830: 6f72 7d27 2075 7365 7320 7079 7468 6f6e  or}' uses python
-00007840: 332e 392b 2073 796e 7461 7822 0a20 2020  3.9+ syntax".   
-00007850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007860: 2022 6275 7420 6973 2064 6574 6563 7465   "but is detecte
-00007870: 6420 6173 2070 7974 686f 6e3c 3d33 2e38  d as python<=3.8
-00007880: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00007890: 2020 2020 2020 2320 6622 5468 6520 6675        # f"The fu
-000078a0: 6c6c 206e 6f64 6520 6973 5c6e 7b6e 6f64  ll node is\n{nod
-000078b0: 6521 727d 220a 2020 2020 2020 2020 2020  e!r}".          
-000078c0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-000078d0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-000078e0: 7465 7374 5f67 6574 5f66 6561 7475 7265  test_get_feature
-000078f0: 735f 7573 6564 2873 656c 6629 202d 3e20  s_used(self) -> 
-00007900: 4e6f 6e65 3a0a 2020 2020 2020 2020 6e6f  None:.        no
-00007910: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
-00007920: 6f33 5f70 6172 7365 2822 6465 6620 6628  o3_parse("def f(
-00007930: 2a2c 2061 7267 293a 202e 2e2e 5c6e 2229  *, arg): ...\n")
-00007940: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00007950: 7365 7274 4571 7561 6c28 626c 6163 6b2e  sertEqual(black.
-00007960: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
-00007970: 6428 6e6f 6465 292c 2073 6574 2829 290a  d(node), set()).
-00007980: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
-00007990: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-000079a0: 7365 2822 6465 6620 6628 2a2c 2061 7267  se("def f(*, arg
-000079b0: 2c29 3a20 2e2e 2e5c 6e22 290a 2020 2020  ,): ...\n").    
-000079c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000079d0: 7175 616c 2862 6c61 636b 2e67 6574 5f66  qual(black.get_f
-000079e0: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
-000079f0: 6529 2c20 7b46 6561 7475 7265 2e54 5241  e), {Feature.TRA
-00007a00: 494c 494e 475f 434f 4d4d 415f 494e 5f44  ILING_COMMA_IN_D
-00007a10: 4546 7d29 0a20 2020 2020 2020 206e 6f64  EF}).        nod
-00007a20: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
-00007a30: 335f 7061 7273 6528 2266 282a 6172 672c  3_parse("f(*arg,
-00007a40: 295c 6e22 290a 2020 2020 2020 2020 7365  )\n").        se
-00007a50: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-00007a60: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-00007a70: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
-00007a80: 7365 6428 6e6f 6465 292c 207b 4665 6174  sed(node), {Feat
-00007a90: 7572 652e 5452 4149 4c49 4e47 5f43 4f4d  ure.TRAILING_COM
-00007aa0: 4d41 5f49 4e5f 4341 4c4c 7d0a 2020 2020  MA_IN_CALL}.    
-00007ab0: 2020 2020 290a 2020 2020 2020 2020 6e6f      ).        no
-00007ac0: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
-00007ad0: 6f33 5f70 6172 7365 2822 6465 6620 6628  o3_parse("def f(
-00007ae0: 2a2c 2061 7267 293a 2066 2773 7472 696e  *, arg): f'strin
-00007af0: 6727 5c6e 2229 0a20 2020 2020 2020 2073  g'\n").        s
-00007b00: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007b10: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
-00007b20: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
-00007b30: 4665 6174 7572 652e 465f 5354 5249 4e47  Feature.F_STRING
-00007b40: 537d 290a 2020 2020 2020 2020 6e6f 6465  S}).        node
-00007b50: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
-00007b60: 5f70 6172 7365 2822 3132 335f 3435 365c  _parse("123_456\
-00007b70: 6e22 290a 2020 2020 2020 2020 7365 6c66  n").        self
-00007b80: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
-00007b90: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
-00007ba0: 7573 6564 286e 6f64 6529 2c20 7b46 6561  used(node), {Fea
-00007bb0: 7475 7265 2e4e 554d 4552 4943 5f55 4e44  ture.NUMERIC_UND
-00007bc0: 4552 5343 4f52 4553 7d29 0a20 2020 2020  ERSCORES}).     
-00007bd0: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
-00007be0: 6c69 6232 746f 335f 7061 7273 6528 2231  lib2to3_parse("1
-00007bf0: 3233 3435 365c 6e22 290a 2020 2020 2020  23456\n").      
-00007c00: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007c10: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
-00007c20: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
-00007c30: 2c20 7365 7428 2929 0a20 2020 2020 2020  , set()).       
-00007c40: 2073 6f75 7263 652c 2065 7870 6563 7465   source, expecte
-00007c50: 6420 3d20 7265 6164 5f64 6174 6128 2273  d = read_data("s
-00007c60: 696d 706c 655f 6361 7365 7322 2c20 2266  imple_cases", "f
-00007c70: 756e 6374 696f 6e22 290a 2020 2020 2020  unction").      
-00007c80: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
-00007c90: 6962 3274 6f33 5f70 6172 7365 2873 6f75  ib2to3_parse(sou
-00007ca0: 7263 6529 0a20 2020 2020 2020 2065 7870  rce).        exp
-00007cb0: 6563 7465 645f 6665 6174 7572 6573 203d  ected_features =
-00007cc0: 207b 0a20 2020 2020 2020 2020 2020 2046   {.            F
-00007cd0: 6561 7475 7265 2e54 5241 494c 494e 475f  eature.TRAILING_
-00007ce0: 434f 4d4d 415f 494e 5f43 414c 4c2c 0a20  COMMA_IN_CALL,. 
-00007cf0: 2020 2020 2020 2020 2020 2046 6561 7475             Featu
-00007d00: 7265 2e54 5241 494c 494e 475f 434f 4d4d  re.TRAILING_COMM
-00007d10: 415f 494e 5f44 4546 2c0a 2020 2020 2020  A_IN_DEF,.      
-00007d20: 2020 2020 2020 4665 6174 7572 652e 465f        Feature.F_
-00007d30: 5354 5249 4e47 532c 0a20 2020 2020 2020  STRINGS,.       
-00007d40: 207d 0a20 2020 2020 2020 2073 656c 662e   }.        self.
-00007d50: 6173 7365 7274 4571 7561 6c28 626c 6163  assertEqual(blac
-00007d60: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
-00007d70: 7365 6428 6e6f 6465 292c 2065 7870 6563  sed(node), expec
-00007d80: 7465 645f 6665 6174 7572 6573 290a 2020  ted_features).  
-00007d90: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
-00007da0: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
-00007db0: 2865 7870 6563 7465 6429 0a20 2020 2020  (expected).     
-00007dc0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007dd0: 7561 6c28 626c 6163 6b2e 6765 745f 6665  ual(black.get_fe
-00007de0: 6174 7572 6573 5f75 7365 6428 6e6f 6465  atures_used(node
-00007df0: 292c 2065 7870 6563 7465 645f 6665 6174  ), expected_feat
-00007e00: 7572 6573 290a 2020 2020 2020 2020 736f  ures).        so
-00007e10: 7572 6365 2c20 6578 7065 6374 6564 203d  urce, expected =
-00007e20: 2072 6561 645f 6461 7461 2822 7369 6d70   read_data("simp
-00007e30: 6c65 5f63 6173 6573 222c 2022 6578 7072  le_cases", "expr
-00007e40: 6573 7369 6f6e 2229 0a20 2020 2020 2020  ession").       
-00007e50: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-00007e60: 6232 746f 335f 7061 7273 6528 736f 7572  b2to3_parse(sour
-00007e70: 6365 290a 2020 2020 2020 2020 7365 6c66  ce).        self
-00007e80: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
-00007e90: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
-00007ea0: 7573 6564 286e 6f64 6529 2c20 7365 7428  used(node), set(
-00007eb0: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
-00007ec0: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
-00007ed0: 7061 7273 6528 6578 7065 6374 6564 290a  parse(expected).
-00007ee0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00007ef0: 6572 7445 7175 616c 2862 6c61 636b 2e67  ertEqual(black.g
-00007f00: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
-00007f10: 286e 6f64 6529 2c20 7365 7428 2929 0a20  (node), set()). 
-00007f20: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
-00007f30: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00007f40: 6528 226c 616d 6264 6120 612c 202f 2c20  e("lambda a, /, 
-00007f50: 623a 202e 2e2e 2229 0a20 2020 2020 2020  b: ...").       
-00007f60: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00007f70: 6c28 626c 6163 6b2e 6765 745f 6665 6174  l(black.get_feat
-00007f80: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
-00007f90: 207b 4665 6174 7572 652e 504f 535f 4f4e   {Feature.POS_ON
-00007fa0: 4c59 5f41 5247 554d 454e 5453 7d29 0a20  LY_ARGUMENTS}). 
-00007fb0: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
-00007fc0: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00007fd0: 6528 2264 6566 2066 6e28 612c 202f 2c20  e("def fn(a, /, 
-00007fe0: 6229 3a20 2e2e 2e22 290a 2020 2020 2020  b): ...").      
-00007ff0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008000: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
-00008010: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
-00008020: 2c20 7b46 6561 7475 7265 2e50 4f53 5f4f  , {Feature.POS_O
-00008030: 4e4c 595f 4152 4755 4d45 4e54 537d 290a  NLY_ARGUMENTS}).
-00008040: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
-00008050: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-00008060: 7365 2822 6465 6620 666e 2829 3a20 7969  se("def fn(): yi
-00008070: 656c 6420 612c 2062 2229 0a20 2020 2020  eld a, b").     
-00008080: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00008090: 7561 6c28 626c 6163 6b2e 6765 745f 6665  ual(black.get_fe
-000080a0: 6174 7572 6573 5f75 7365 6428 6e6f 6465  atures_used(node
-000080b0: 292c 2073 6574 2829 290a 2020 2020 2020  ), set()).      
-000080c0: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
-000080d0: 6962 3274 6f33 5f70 6172 7365 2822 6465  ib2to3_parse("de
-000080e0: 6620 666e 2829 3a20 7265 7475 726e 2061  f fn(): return a
-000080f0: 2c20 6222 290a 2020 2020 2020 2020 7365  , b").        se
-00008100: 6c66 2e61 7373 6572 7445 7175 616c 2862  lf.assertEqual(b
-00008110: 6c61 636b 2e67 6574 5f66 6561 7475 7265  lack.get_feature
-00008120: 735f 7573 6564 286e 6f64 6529 2c20 7365  s_used(node), se
-00008130: 7428 2929 0a20 2020 2020 2020 206e 6f64  t()).        nod
-00008140: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
-00008150: 335f 7061 7273 6528 2264 6566 2066 6e28  3_parse("def fn(
-00008160: 293a 2079 6965 6c64 202a 622c 2063 2229  ): yield *b, c")
-00008170: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00008180: 7365 7274 4571 7561 6c28 626c 6163 6b2e  sertEqual(black.
-00008190: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
-000081a0: 6428 6e6f 6465 292c 207b 4665 6174 7572  d(node), {Featur
-000081b0: 652e 554e 5041 434b 494e 475f 4f4e 5f46  e.UNPACKING_ON_F
-000081c0: 4c4f 577d 290a 2020 2020 2020 2020 6e6f  LOW}).        no
-000081d0: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
-000081e0: 6f33 5f70 6172 7365 2822 6465 6620 666e  o3_parse("def fn
-000081f0: 2829 3a20 7265 7475 726e 2061 2c20 2a62  (): return a, *b
-00008200: 2c20 6322 290a 2020 2020 2020 2020 7365  , c").        se
-00008210: 6c66 2e61 7373 6572 7445 7175 616c 2862  lf.assertEqual(b
-00008220: 6c61 636b 2e67 6574 5f66 6561 7475 7265  lack.get_feature
-00008230: 735f 7573 6564 286e 6f64 6529 2c20 7b46  s_used(node), {F
-00008240: 6561 7475 7265 2e55 4e50 4143 4b49 4e47  eature.UNPACKING
-00008250: 5f4f 4e5f 464c 4f57 7d29 0a20 2020 2020  _ON_FLOW}).     
-00008260: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
-00008270: 6c69 6232 746f 335f 7061 7273 6528 2278  lib2to3_parse("x
-00008280: 203d 2061 2c20 2a62 2c20 6322 290a 2020   = a, *b, c").  
-00008290: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000082a0: 7445 7175 616c 2862 6c61 636b 2e67 6574  tEqual(black.get
-000082b0: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
-000082c0: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
-000082d0: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
-000082e0: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
-000082f0: 2278 3a20 416e 7920 3d20 7265 6775 6c61  "x: Any = regula
-00008300: 7222 290a 2020 2020 2020 2020 7365 6c66  r").        self
-00008310: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
-00008320: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
-00008330: 7573 6564 286e 6f64 6529 2c20 7365 7428  used(node), set(
-00008340: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
-00008350: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
-00008360: 7061 7273 6528 2278 3a20 416e 7920 3d20  parse("x: Any = 
-00008370: 2872 6567 756c 6172 2c20 7265 6775 6c61  (regular, regula
-00008380: 7229 2229 0a20 2020 2020 2020 2073 656c  r)").        sel
-00008390: 662e 6173 7365 7274 4571 7561 6c28 626c  f.assertEqual(bl
-000083a0: 6163 6b2e 6765 745f 6665 6174 7572 6573  ack.get_features
-000083b0: 5f75 7365 6428 6e6f 6465 292c 2073 6574  _used(node), set
-000083c0: 2829 290a 2020 2020 2020 2020 6e6f 6465  ()).        node
-000083d0: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
-000083e0: 5f70 6172 7365 2822 783a 2041 6e79 203d  _parse("x: Any =
-000083f0: 2043 6f6d 706c 6578 2854 7970 6528 3129   Complex(Type(1)
-00008400: 295b 736f 6d65 7468 696e 675d 2229 0a20  )[something]"). 
-00008410: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00008420: 7274 4571 7561 6c28 626c 6163 6b2e 6765  rtEqual(black.ge
-00008430: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
-00008440: 6e6f 6465 292c 2073 6574 2829 290a 2020  node), set()).  
-00008450: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
-00008460: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
-00008470: 2822 783a 2054 7570 6c65 5b69 6e74 2c20  ("x: Tuple[int, 
-00008480: 2e2e 2e5d 203d 2061 2c20 622c 2063 2229  ...] = a, b, c")
-00008490: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000084a0: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-000084b0: 2020 2020 2020 2062 6c61 636b 2e67 6574         black.get
-000084c0: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
-000084d0: 6f64 6529 2c20 7b46 6561 7475 7265 2e41  ode), {Feature.A
-000084e0: 4e4e 5f41 5353 4947 4e5f 4558 5445 4e44  NN_ASSIGN_EXTEND
-000084f0: 4544 5f52 4853 7d0a 2020 2020 2020 2020  ED_RHS}.        
-00008500: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
-00008510: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
-00008520: 6172 7365 2822 7472 793a 2070 6173 735c  arse("try: pass\
-00008530: 6e65 7863 6570 7420 536f 6d65 7468 696e  nexcept Somethin
-00008540: 673a 2070 6173 7322 290a 2020 2020 2020  g: pass").      
-00008550: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008560: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
-00008570: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
-00008580: 2c20 7365 7428 2929 0a20 2020 2020 2020  , set()).       
-00008590: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-000085a0: 6232 746f 335f 7061 7273 6528 2274 7279  b2to3_parse("try
-000085b0: 3a20 7061 7373 5c6e 6578 6365 7074 2028  : pass\nexcept (
-000085c0: 2a53 6f6d 6574 6869 6e67 2c29 3a20 7061  *Something,): pa
-000085d0: 7373 2229 0a20 2020 2020 2020 2073 656c  ss").        sel
-000085e0: 662e 6173 7365 7274 4571 7561 6c28 626c  f.assertEqual(bl
-000085f0: 6163 6b2e 6765 745f 6665 6174 7572 6573  ack.get_features
-00008600: 5f75 7365 6428 6e6f 6465 292c 2073 6574  _used(node), set
-00008610: 2829 290a 2020 2020 2020 2020 6e6f 6465  ()).        node
-00008620: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
-00008630: 5f70 6172 7365 2822 7472 793a 2070 6173  _parse("try: pas
-00008640: 735c 6e65 7863 6570 7420 2a47 726f 7570  s\nexcept *Group
-00008650: 3a20 7061 7373 2229 0a20 2020 2020 2020  : pass").       
-00008660: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00008670: 6c28 626c 6163 6b2e 6765 745f 6665 6174  l(black.get_feat
-00008680: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
-00008690: 207b 4665 6174 7572 652e 4558 4345 5054   {Feature.EXCEPT
-000086a0: 5f53 5441 527d 290a 2020 2020 2020 2020  _STAR}).        
-000086b0: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
-000086c0: 3274 6f33 5f70 6172 7365 2822 615b 2a62  2to3_parse("a[*b
-000086d0: 5d22 290a 2020 2020 2020 2020 7365 6c66  ]").        self
-000086e0: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
-000086f0: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
-00008700: 7573 6564 286e 6f64 6529 2c20 7b46 6561  used(node), {Fea
-00008710: 7475 7265 2e56 4152 4941 4449 435f 4745  ture.VARIADIC_GE
-00008720: 4e45 5249 4353 7d29 0a20 2020 2020 2020  NERICS}).       
-00008730: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-00008740: 6232 746f 335f 7061 7273 6528 2261 5b78  b2to3_parse("a[x
-00008750: 2c20 2a79 2829 2c20 7a5d 203d 2074 2229  , *y(), z] = t")
-00008760: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00008770: 7365 7274 4571 7561 6c28 626c 6163 6b2e  sertEqual(black.
-00008780: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
-00008790: 6428 6e6f 6465 292c 207b 4665 6174 7572  d(node), {Featur
-000087a0: 652e 5641 5249 4144 4943 5f47 454e 4552  e.VARIADIC_GENER
-000087b0: 4943 537d 290a 2020 2020 2020 2020 6e6f  ICS}).        no
-000087c0: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
-000087d0: 6f33 5f70 6172 7365 2822 6465 6620 666e  o3_parse("def fn
-000087e0: 282a 6172 6773 3a20 2a54 293a 2070 6173  (*args: *T): pas
-000087f0: 7322 290a 2020 2020 2020 2020 7365 6c66  s").        self
-00008800: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
-00008810: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
-00008820: 7573 6564 286e 6f64 6529 2c20 7b46 6561  used(node), {Fea
-00008830: 7475 7265 2e56 4152 4941 4449 435f 4745  ture.VARIADIC_GE
-00008840: 4e45 5249 4353 7d29 0a0a 2020 2020 6465  NERICS})..    de
-00008850: 6620 7465 7374 5f67 6574 5f66 6561 7475  f test_get_featu
-00008860: 7265 735f 7573 6564 5f66 6f72 5f66 7574  res_used_for_fut
-00008870: 7572 655f 666c 6167 7328 7365 6c66 2920  ure_flags(self) 
-00008880: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00008890: 2066 6f72 2073 7263 2c20 6665 6174 7572   for src, featur
-000088a0: 6573 2069 6e20 5b0a 2020 2020 2020 2020  es in [.        
-000088b0: 2020 2020 2822 6672 6f6d 205f 5f66 7574      ("from __fut
-000088c0: 7572 655f 5f20 696d 706f 7274 2061 6e6e  ure__ import ann
-000088d0: 6f74 6174 696f 6e73 222c 207b 4665 6174  otations", {Feat
-000088e0: 7572 652e 4655 5455 5245 5f41 4e4e 4f54  ure.FUTURE_ANNOT
-000088f0: 4154 494f 4e53 7d29 2c0a 2020 2020 2020  ATIONS}),.      
-00008900: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-00008910: 2020 2020 2020 2020 2266 726f 6d20 5f5f          "from __
-00008920: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
-00008930: 286f 7468 6572 2c20 616e 6e6f 7461 7469  (other, annotati
-00008940: 6f6e 7329 222c 0a20 2020 2020 2020 2020  ons)",.         
-00008950: 2020 2020 2020 207b 4665 6174 7572 652e         {Feature.
-00008960: 4655 5455 5245 5f41 4e4e 4f54 4154 494f  FUTURE_ANNOTATIO
-00008970: 4e53 7d2c 0a20 2020 2020 2020 2020 2020  NS},.           
-00008980: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00008990: 2822 6120 3d20 3120 2b20 325c 6e66 726f  ("a = 1 + 2\nfro
-000089a0: 6d20 736f 6d65 7468 696e 6720 696d 706f  m something impo
-000089b0: 7274 2061 6e6e 6f74 6174 696f 6e73 222c  rt annotations",
-000089c0: 2073 6574 2829 292c 0a20 2020 2020 2020   set()),.       
-000089d0: 2020 2020 2028 2266 726f 6d20 5f5f 6675       ("from __fu
-000089e0: 7475 7265 5f5f 2069 6d70 6f72 7420 782c  ture__ import x,
-000089f0: 2079 222c 2073 6574 2829 292c 0a20 2020   y", set()),.   
-00008a00: 2020 2020 205d 3a0a 2020 2020 2020 2020       ]:.        
-00008a10: 2020 2020 7769 7468 2073 656c 662e 7375      with self.su
-00008a20: 6254 6573 7428 7372 633d 7372 632c 2066  bTest(src=src, f
-00008a30: 6561 7475 7265 733d 6665 6174 7572 6573  eatures=features
-00008a40: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00008a50: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
-00008a60: 6c69 6232 746f 335f 7061 7273 6528 7372  lib2to3_parse(sr
-00008a70: 6329 0a20 2020 2020 2020 2020 2020 2020  c).             
-00008a80: 2020 2066 7574 7572 655f 696d 706f 7274     future_import
-00008a90: 7320 3d20 626c 6163 6b2e 6765 745f 6675  s = black.get_fu
-00008aa0: 7475 7265 5f69 6d70 6f72 7473 286e 6f64  ture_imports(nod
-00008ab0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00008ac0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00008ad0: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00008ae0: 2020 2020 2020 2020 2062 6c61 636b 2e67           black.g
-00008af0: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
-00008b00: 286e 6f64 652c 2066 7574 7572 655f 696d  (node, future_im
-00008b10: 706f 7274 733d 6675 7475 7265 5f69 6d70  ports=future_imp
-00008b20: 6f72 7473 292c 0a20 2020 2020 2020 2020  orts),.         
-00008b30: 2020 2020 2020 2020 2020 2066 6561 7475             featu
-00008b40: 7265 732c 0a20 2020 2020 2020 2020 2020  res,.           
-00008b50: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00008b60: 7465 7374 5f67 6574 5f66 7574 7572 655f  test_get_future_
-00008b70: 696d 706f 7274 7328 7365 6c66 2920 2d3e  imports(self) ->
-00008b80: 204e 6f6e 653a 0a20 2020 2020 2020 206e   None:.        n
-00008b90: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
-00008ba0: 746f 335f 7061 7273 6528 225c 6e22 290a  to3_parse("\n").
-00008bb0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00008bc0: 6572 7445 7175 616c 2873 6574 2829 2c20  ertEqual(set(), 
-00008bd0: 626c 6163 6b2e 6765 745f 6675 7475 7265  black.get_future
-00008be0: 5f69 6d70 6f72 7473 286e 6f64 6529 290a  _imports(node)).
-00008bf0: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
-00008c00: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-00008c10: 7365 2822 6672 6f6d 205f 5f66 7574 7572  se("from __futur
-00008c20: 655f 5f20 696d 706f 7274 2062 6c61 636b  e__ import black
-00008c30: 5c6e 2229 0a20 2020 2020 2020 2073 656c  \n").        sel
-00008c40: 662e 6173 7365 7274 4571 7561 6c28 7b22  f.assertEqual({"
-00008c50: 626c 6163 6b22 7d2c 2062 6c61 636b 2e67  black"}, black.g
-00008c60: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
-00008c70: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
-00008c80: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-00008c90: 6232 746f 335f 7061 7273 6528 2266 726f  b2to3_parse("fro
-00008ca0: 6d20 5f5f 6675 7475 7265 5f5f 2069 6d70  m __future__ imp
-00008cb0: 6f72 7420 6d75 6c74 6970 6c65 2c20 696d  ort multiple, im
-00008cc0: 706f 7274 735c 6e22 290a 2020 2020 2020  ports\n").      
-00008cd0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008ce0: 616c 287b 226d 756c 7469 706c 6522 2c20  al({"multiple", 
-00008cf0: 2269 6d70 6f72 7473 227d 2c20 626c 6163  "imports"}, blac
-00008d00: 6b2e 6765 745f 6675 7475 7265 5f69 6d70  k.get_future_imp
-00008d10: 6f72 7473 286e 6f64 6529 290a 2020 2020  orts(node)).    
-00008d20: 2020 2020 6e6f 6465 203d 2062 6c61 636b      node = black
-00008d30: 2e6c 6962 3274 6f33 5f70 6172 7365 2822  .lib2to3_parse("
-00008d40: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
-00008d50: 696d 706f 7274 2028 7061 7265 6e74 6865  import (parenthe
-00008d60: 7369 7a65 642c 2069 6d70 6f72 7473 295c  sized, imports)\
-00008d70: 6e22 290a 2020 2020 2020 2020 7365 6c66  n").        self
-00008d80: 2e61 7373 6572 7445 7175 616c 287b 2270  .assertEqual({"p
-00008d90: 6172 656e 7468 6573 697a 6564 222c 2022  arenthesized", "
-00008da0: 696d 706f 7274 7322 7d2c 2062 6c61 636b  imports"}, black
-00008db0: 2e67 6574 5f66 7574 7572 655f 696d 706f  .get_future_impo
-00008dc0: 7274 7328 6e6f 6465 2929 0a20 2020 2020  rts(node)).     
-00008dd0: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
-00008de0: 6c69 6232 746f 335f 7061 7273 6528 0a20  lib2to3_parse(. 
-00008df0: 2020 2020 2020 2020 2020 2022 6672 6f6d             "from
-00008e00: 205f 5f66 7574 7572 655f 5f20 696d 706f   __future__ impo
-00008e10: 7274 206d 756c 7469 706c 655c 6e66 726f  rt multiple\nfro
-00008e20: 6d20 5f5f 6675 7475 7265 5f5f 2069 6d70  m __future__ imp
-00008e30: 6f72 7420 696d 706f 7274 735c 6e22 0a20  ort imports\n". 
-00008e40: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00008e50: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00008e60: 6c28 7b22 6d75 6c74 6970 6c65 222c 2022  l({"multiple", "
-00008e70: 696d 706f 7274 7322 7d2c 2062 6c61 636b  imports"}, black
-00008e80: 2e67 6574 5f66 7574 7572 655f 696d 706f  .get_future_impo
-00008e90: 7274 7328 6e6f 6465 2929 0a20 2020 2020  rts(node)).     
-00008ea0: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
-00008eb0: 6c69 6232 746f 335f 7061 7273 6528 2223  lib2to3_parse("#
-00008ec0: 2063 6f6d 6d65 6e74 5c6e 6672 6f6d 205f   comment\nfrom _
-00008ed0: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
-00008ee0: 2062 6c61 636b 5c6e 2229 0a20 2020 2020   black\n").     
-00008ef0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00008f00: 7561 6c28 7b22 626c 6163 6b22 7d2c 2062  ual({"black"}, b
-00008f10: 6c61 636b 2e67 6574 5f66 7574 7572 655f  lack.get_future_
-00008f20: 696d 706f 7274 7328 6e6f 6465 2929 0a20  imports(node)). 
-00008f30: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
-00008f40: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00008f50: 6528 2722 2222 646f 6373 7472 696e 6722  e('"""docstring"
-00008f60: 2222 5c6e 6672 6f6d 205f 5f66 7574 7572  ""\nfrom __futur
-00008f70: 655f 5f20 696d 706f 7274 2062 6c61 636b  e__ import black
-00008f80: 5c6e 2729 0a20 2020 2020 2020 2073 656c  \n').        sel
-00008f90: 662e 6173 7365 7274 4571 7561 6c28 7b22  f.assertEqual({"
-00008fa0: 626c 6163 6b22 7d2c 2062 6c61 636b 2e67  black"}, black.g
-00008fb0: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
-00008fc0: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
-00008fd0: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-00008fe0: 6232 746f 335f 7061 7273 6528 2273 6f6d  b2to3_parse("som
-00008ff0: 6528 6f74 6865 722c 2063 6f64 6529 5c6e  e(other, code)\n
-00009000: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
-00009010: 696d 706f 7274 2062 6c61 636b 5c6e 2229  import black\n")
-00009020: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00009030: 7365 7274 4571 7561 6c28 7365 7428 292c  sertEqual(set(),
-00009040: 2062 6c61 636b 2e67 6574 5f66 7574 7572   black.get_futur
-00009050: 655f 696d 706f 7274 7328 6e6f 6465 2929  e_imports(node))
-00009060: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
-00009070: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
-00009080: 7273 6528 2266 726f 6d20 736f 6d65 2e6d  rse("from some.m
-00009090: 6f64 756c 6520 696d 706f 7274 2062 6c61  odule import bla
-000090a0: 636b 5c6e 2229 0a20 2020 2020 2020 2073  ck\n").        s
-000090b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000090c0: 7365 7428 292c 2062 6c61 636b 2e67 6574  set(), black.get
-000090d0: 5f66 7574 7572 655f 696d 706f 7274 7328  _future_imports(
-000090e0: 6e6f 6465 2929 0a20 2020 2020 2020 206e  node)).        n
-000090f0: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
-00009100: 746f 335f 7061 7273 6528 0a20 2020 2020  to3_parse(.     
-00009110: 2020 2020 2020 2022 6672 6f6d 205f 5f66         "from __f
-00009120: 7574 7572 655f 5f20 696d 706f 7274 2075  uture__ import u
-00009130: 6e69 636f 6465 5f6c 6974 6572 616c 7320  nicode_literals 
-00009140: 6173 205f 756e 6963 6f64 655f 6c69 7465  as _unicode_lite
-00009150: 7261 6c73 220a 2020 2020 2020 2020 290a  rals".        ).
-00009160: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00009170: 6572 7445 7175 616c 287b 2275 6e69 636f  ertEqual({"unico
-00009180: 6465 5f6c 6974 6572 616c 7322 7d2c 2062  de_literals"}, b
-00009190: 6c61 636b 2e67 6574 5f66 7574 7572 655f  lack.get_future_
-000091a0: 696d 706f 7274 7328 6e6f 6465 2929 0a20  imports(node)). 
-000091b0: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
-000091c0: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-000091d0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
-000091e0: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
-000091f0: 696d 706f 7274 2075 6e69 636f 6465 5f6c  import unicode_l
-00009200: 6974 6572 616c 7320 6173 205f 6c6f 6c2c  iterals as _lol,
-00009210: 2070 7269 6e74 220a 2020 2020 2020 2020   print".        
-00009220: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00009230: 7373 6572 7445 7175 616c 287b 2275 6e69  ssertEqual({"uni
-00009240: 636f 6465 5f6c 6974 6572 616c 7322 2c20  code_literals", 
-00009250: 2270 7269 6e74 227d 2c20 626c 6163 6b2e  "print"}, black.
-00009260: 6765 745f 6675 7475 7265 5f69 6d70 6f72  get_future_impor
-00009270: 7473 286e 6f64 6529 290a 0a20 2020 2040  ts(node))..    @
-00009280: 7079 7465 7374 2e6d 6172 6b2e 696e 636f  pytest.mark.inco
-00009290: 6d70 6174 6962 6c65 5f77 6974 685f 6d79  mpatible_with_my
-000092a0: 7079 630a 2020 2020 6465 6620 7465 7374  pyc.    def test
-000092b0: 5f64 6562 7567 5f76 6973 6974 6f72 2873  _debug_visitor(s
-000092c0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-000092d0: 2020 2020 2020 736f 7572 6365 2c20 5f20        source, _ 
-000092e0: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
-000092f0: 6365 6c6c 616e 656f 7573 222c 2022 6465  cellaneous", "de
-00009300: 6275 675f 7669 7369 746f 7222 290a 2020  bug_visitor").  
-00009310: 2020 2020 2020 6578 7065 6374 6564 2c20        expected, 
-00009320: 5f20 3d20 7265 6164 5f64 6174 6128 226d  _ = read_data("m
-00009330: 6973 6365 6c6c 616e 656f 7573 222c 2022  iscellaneous", "
-00009340: 6465 6275 675f 7669 7369 746f 722e 6f75  debug_visitor.ou
-00009350: 7422 290a 2020 2020 2020 2020 6f75 745f  t").        out_
-00009360: 6c69 6e65 7320 3d20 5b5d 0a20 2020 2020  lines = [].     
-00009370: 2020 2065 7272 5f6c 696e 6573 203d 205b     err_lines = [
-00009380: 5d0a 0a20 2020 2020 2020 2064 6566 206f  ]..        def o
-00009390: 7574 286d 7367 3a20 7374 722c 202a 2a6b  ut(msg: str, **k
-000093a0: 7761 7267 733a 2041 6e79 2920 2d3e 204e  wargs: Any) -> N
-000093b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000093c0: 206f 7574 5f6c 696e 6573 2e61 7070 656e   out_lines.appen
-000093d0: 6428 6d73 6729 0a0a 2020 2020 2020 2020  d(msg)..        
-000093e0: 6465 6620 6572 7228 6d73 673a 2073 7472  def err(msg: str
-000093f0: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
-00009400: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00009410: 2020 2020 2020 6572 725f 6c69 6e65 732e        err_lines.
-00009420: 6170 7065 6e64 286d 7367 290a 0a20 2020  append(msg)..   
-00009430: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
-00009440: 2262 6c61 636b 2e64 6562 7567 2e6f 7574  "black.debug.out
-00009450: 222c 206f 7574 293a 0a20 2020 2020 2020  ", out):.       
-00009460: 2020 2020 2044 6562 7567 5669 7369 746f       DebugVisito
-00009470: 722e 7368 6f77 2873 6f75 7263 6529 0a20  r.show(source). 
-00009480: 2020 2020 2020 2061 6374 7561 6c20 3d20         actual = 
-00009490: 225c 6e22 2e6a 6f69 6e28 6f75 745f 6c69  "\n".join(out_li
-000094a0: 6e65 7329 202b 2022 5c6e 220a 2020 2020  nes) + "\n".    
-000094b0: 2020 2020 6c6f 675f 6e61 6d65 203d 2022      log_name = "
-000094c0: 220a 2020 2020 2020 2020 6966 2065 7870  ".        if exp
-000094d0: 6563 7465 6420 213d 2061 6374 7561 6c3a  ected != actual:
-000094e0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-000094f0: 5f6e 616d 6520 3d20 626c 6163 6b2e 6475  _name = black.du
-00009500: 6d70 5f74 6f5f 6669 6c65 282a 6f75 745f  mp_to_file(*out_
-00009510: 6c69 6e65 7329 0a20 2020 2020 2020 2073  lines).        s
-00009520: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00009530: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-00009540: 6563 7465 642c 0a20 2020 2020 2020 2020  ected,.         
-00009550: 2020 2061 6374 7561 6c2c 0a20 2020 2020     actual,.     
-00009560: 2020 2020 2020 2066 2241 5354 2070 7269         f"AST pri
-00009570: 6e74 206f 7574 2069 7320 6469 6666 6572  nt out is differ
-00009580: 656e 742e 2041 6374 7561 6c20 7665 7273  ent. Actual vers
-00009590: 696f 6e20 6475 6d70 6564 2074 6f20 7b6c  ion dumped to {l
-000095a0: 6f67 5f6e 616d 657d 222c 0a20 2020 2020  og_name}",.     
-000095b0: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
-000095c0: 7374 5f66 6f72 6d61 745f 6669 6c65 5f63  st_format_file_c
-000095d0: 6f6e 7465 6e74 7328 7365 6c66 2920 2d3e  ontents(self) ->
-000095e0: 204e 6f6e 653a 0a20 2020 2020 2020 2065   None:.        e
-000095f0: 6d70 7479 203d 2022 220a 2020 2020 2020  mpty = "".      
-00009600: 2020 6d6f 6465 203d 2044 4546 4155 4c54    mode = DEFAULT
-00009610: 5f4d 4f44 450a 2020 2020 2020 2020 7769  _MODE.        wi
-00009620: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-00009630: 6973 6573 2862 6c61 636b 2e4e 6f74 6869  ises(black.Nothi
-00009640: 6e67 4368 616e 6765 6429 3a0a 2020 2020  ngChanged):.    
-00009650: 2020 2020 2020 2020 626c 6163 6b2e 666f          black.fo
-00009660: 726d 6174 5f66 696c 655f 636f 6e74 656e  rmat_file_conten
-00009670: 7473 2865 6d70 7479 2c20 6d6f 6465 3d6d  ts(empty, mode=m
-00009680: 6f64 652c 2066 6173 743d 4661 6c73 6529  ode, fast=False)
-00009690: 0a20 2020 2020 2020 206a 7573 745f 6e6c  .        just_nl
-000096a0: 203d 2022 5c6e 220a 2020 2020 2020 2020   = "\n".        
-000096b0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-000096c0: 5261 6973 6573 2862 6c61 636b 2e4e 6f74  Raises(black.Not
-000096d0: 6869 6e67 4368 616e 6765 6429 3a0a 2020  hingChanged):.  
-000096e0: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-000096f0: 666f 726d 6174 5f66 696c 655f 636f 6e74  format_file_cont
-00009700: 656e 7473 286a 7573 745f 6e6c 2c20 6d6f  ents(just_nl, mo
-00009710: 6465 3d6d 6f64 652c 2066 6173 743d 4661  de=mode, fast=Fa
-00009720: 6c73 6529 0a20 2020 2020 2020 2073 616d  lse).        sam
-00009730: 6520 3d20 226a 203d 205b 312c 2032 2c20  e = "j = [1, 2, 
-00009740: 335d 5c6e 220a 2020 2020 2020 2020 7769  3]\n".        wi
-00009750: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-00009760: 6973 6573 2862 6c61 636b 2e4e 6f74 6869  ises(black.Nothi
-00009770: 6e67 4368 616e 6765 6429 3a0a 2020 2020  ngChanged):.    
-00009780: 2020 2020 2020 2020 626c 6163 6b2e 666f          black.fo
-00009790: 726d 6174 5f66 696c 655f 636f 6e74 656e  rmat_file_conten
-000097a0: 7473 2873 616d 652c 206d 6f64 653d 6d6f  ts(same, mode=mo
-000097b0: 6465 2c20 6661 7374 3d46 616c 7365 290a  de, fast=False).
-000097c0: 2020 2020 2020 2020 6469 6666 6572 656e          differen
-000097d0: 7420 3d20 226a 203d 205b 312c 322c 335d  t = "j = [1,2,3]
-000097e0: 220a 2020 2020 2020 2020 6578 7065 6374  ".        expect
-000097f0: 6564 203d 2073 616d 650a 2020 2020 2020  ed = same.      
-00009800: 2020 6163 7475 616c 203d 2062 6c61 636b    actual = black
-00009810: 2e66 6f72 6d61 745f 6669 6c65 5f63 6f6e  .format_file_con
-00009820: 7465 6e74 7328 6469 6666 6572 656e 742c  tents(different,
-00009830: 206d 6f64 653d 6d6f 6465 2c20 6661 7374   mode=mode, fast
-00009840: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-00009850: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00009860: 2865 7870 6563 7465 642c 2061 6374 7561  (expected, actua
-00009870: 6c29 0a20 2020 2020 2020 2069 6e76 616c  l).        inval
-00009880: 6964 203d 2022 7265 7475 726e 2069 6620  id = "return if 
-00009890: 796f 7520 6361 6e22 0a20 2020 2020 2020  you can".       
-000098a0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-000098b0: 7452 6169 7365 7328 626c 6163 6b2e 496e  tRaises(black.In
-000098c0: 7661 6c69 6449 6e70 7574 2920 6173 2065  validInput) as e
-000098d0: 3a0a 2020 2020 2020 2020 2020 2020 626c  :.            bl
-000098e0: 6163 6b2e 666f 726d 6174 5f66 696c 655f  ack.format_file_
-000098f0: 636f 6e74 656e 7473 2869 6e76 616c 6964  contents(invalid
-00009900: 2c20 6d6f 6465 3d6d 6f64 652c 2066 6173  , mode=mode, fas
-00009910: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
-00009920: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00009930: 6c28 7374 7228 652e 6578 6365 7074 696f  l(str(e.exceptio
-00009940: 6e29 2c20 2243 616e 6e6f 7420 7061 7273  n), "Cannot pars
-00009950: 653a 2031 3a37 3a20 7265 7475 726e 2069  e: 1:7: return i
-00009960: 6620 796f 7520 6361 6e22 290a 0a20 2020  f you can")..   
-00009970: 2064 6566 2074 6573 745f 656e 646d 6172   def test_endmar
-00009980: 6b65 7228 7365 6c66 2920 2d3e 204e 6f6e  ker(self) -> Non
-00009990: 653a 0a20 2020 2020 2020 206e 203d 2062  e:.        n = b
-000099a0: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-000099b0: 7365 2822 5c6e 2229 0a20 2020 2020 2020  se("\n").       
-000099c0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000099d0: 6c28 6e2e 7479 7065 2c20 626c 6163 6b2e  l(n.type, black.
-000099e0: 7379 6d73 2e66 696c 655f 696e 7075 7429  syms.file_input)
-000099f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00009a00: 7365 7274 4571 7561 6c28 6c65 6e28 6e2e  sertEqual(len(n.
-00009a10: 6368 696c 6472 656e 292c 2031 290a 2020  children), 1).  
-00009a20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009a30: 7445 7175 616c 286e 2e63 6869 6c64 7265  tEqual(n.childre
-00009a40: 6e5b 305d 2e74 7970 652c 2062 6c61 636b  n[0].type, black
-00009a50: 2e74 6f6b 656e 2e45 4e44 4d41 524b 4552  .token.ENDMARKER
-00009a60: 290a 0a20 2020 2040 7079 7465 7374 2e6d  )..    @pytest.m
-00009a70: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
-00009a80: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
-00009a90: 4075 6e69 7474 6573 742e 736b 6970 4966  @unittest.skipIf
-00009aa0: 286f 732e 656e 7669 726f 6e2e 6765 7428  (os.environ.get(
-00009ab0: 2253 4b49 505f 4153 545f 5052 494e 5422  "SKIP_AST_PRINT"
-00009ac0: 292c 2022 7573 6572 2073 6574 2053 4b49  ), "user set SKI
-00009ad0: 505f 4153 545f 5052 494e 5422 290a 2020  P_AST_PRINT").  
-00009ae0: 2020 6465 6620 7465 7374 5f61 7373 6572    def test_asser
-00009af0: 7446 6f72 6d61 7445 7175 616c 2873 656c  tFormatEqual(sel
-00009b00: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00009b10: 2020 2020 6f75 745f 6c69 6e65 7320 3d20      out_lines = 
-00009b20: 5b5d 0a20 2020 2020 2020 2065 7272 5f6c  [].        err_l
-00009b30: 696e 6573 203d 205b 5d0a 0a20 2020 2020  ines = []..     
-00009b40: 2020 2064 6566 206f 7574 286d 7367 3a20     def out(msg: 
-00009b50: 7374 722c 202a 2a6b 7761 7267 733a 2041  str, **kwargs: A
-00009b60: 6e79 2920 2d3e 204e 6f6e 653a 0a20 2020  ny) -> None:.   
-00009b70: 2020 2020 2020 2020 206f 7574 5f6c 696e           out_lin
-00009b80: 6573 2e61 7070 656e 6428 6d73 6729 0a0a  es.append(msg)..
-00009b90: 2020 2020 2020 2020 6465 6620 6572 7228          def err(
-00009ba0: 6d73 673a 2073 7472 2c20 2a2a 6b77 6172  msg: str, **kwar
-00009bb0: 6773 3a20 416e 7929 202d 3e20 4e6f 6e65  gs: Any) -> None
-00009bc0: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
-00009bd0: 725f 6c69 6e65 732e 6170 7065 6e64 286d  r_lines.append(m
-00009be0: 7367 290a 0a20 2020 2020 2020 2077 6974  sg)..        wit
-00009bf0: 6820 7061 7463 6828 2262 6c61 636b 2e6f  h patch("black.o
-00009c00: 7574 7075 742e 5f6f 7574 222c 206f 7574  utput._out", out
-00009c10: 292c 2070 6174 6368 2822 626c 6163 6b2e  ), patch("black.
-00009c20: 6f75 7470 7574 2e5f 6572 7222 2c20 6572  output._err", er
-00009c30: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00009c40: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-00009c50: 5261 6973 6573 2841 7373 6572 7469 6f6e  Raises(Assertion
-00009c60: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00009c70: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00009c80: 6572 7446 6f72 6d61 7445 7175 616c 2822  ertFormatEqual("
-00009c90: 6a20 3d20 5b31 2c20 322c 2033 5d22 2c20  j = [1, 2, 3]", 
-00009ca0: 226a 203d 205b 312c 2032 2c20 332c 5d22  "j = [1, 2, 3,]"
-00009cb0: 290a 0a20 2020 2020 2020 206f 7574 5f73  )..        out_s
-00009cc0: 7472 203d 2022 222e 6a6f 696e 286f 7574  tr = "".join(out
-00009cd0: 5f6c 696e 6573 290a 2020 2020 2020 2020  _lines).        
-00009ce0: 7365 6c66 2e61 7373 6572 7449 6e28 2245  self.assertIn("E
-00009cf0: 7870 6563 7465 6420 7472 6565 3a22 2c20  xpected tree:", 
-00009d00: 6f75 745f 7374 7229 0a20 2020 2020 2020  out_str).       
-00009d10: 2073 656c 662e 6173 7365 7274 496e 2822   self.assertIn("
-00009d20: 4163 7475 616c 2074 7265 653a 222c 206f  Actual tree:", o
-00009d30: 7574 5f73 7472 290a 2020 2020 2020 2020  ut_str).        
-00009d40: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00009d50: 2822 222e 6a6f 696e 2865 7272 5f6c 696e  ("".join(err_lin
-00009d60: 6573 292c 2022 2229 0a0a 2020 2020 4065  es), "")..    @e
-00009d70: 7665 6e74 5f6c 6f6f 7028 290a 2020 2020  vent_loop().    
-00009d80: 4070 6174 6368 2822 636f 6e63 7572 7265  @patch("concurre
-00009d90: 6e74 2e66 7574 7572 6573 2e50 726f 6365  nt.futures.Proce
-00009da0: 7373 506f 6f6c 4578 6563 7574 6f72 222c  ssPoolExecutor",
-00009db0: 204d 6167 6963 4d6f 636b 2873 6964 655f   MagicMock(side_
-00009dc0: 6566 6665 6374 3d4f 5345 7272 6f72 2929  effect=OSError))
-00009dd0: 0a20 2020 2064 6566 2074 6573 745f 776f  .    def test_wo
-00009de0: 726b 735f 696e 5f6d 6f6e 6f5f 7072 6f63  rks_in_mono_proc
-00009df0: 6573 735f 6f6e 6c79 5f65 6e76 6972 6f6e  ess_only_environ
-00009e00: 6d65 6e74 2873 656c 6629 202d 3e20 4e6f  ment(self) -> No
-00009e10: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
-00009e20: 2063 6163 6865 5f64 6972 2829 2061 7320   cache_dir() as 
-00009e30: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
-00009e40: 2020 2020 2020 2066 6f72 2066 2069 6e20         for f in 
-00009e50: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00009e60: 2020 2877 6f72 6b73 7061 6365 202f 2022    (workspace / "
-00009e70: 6f6e 652e 7079 2229 2e72 6573 6f6c 7665  one.py").resolve
-00009e80: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-00009e90: 2020 2020 2877 6f72 6b73 7061 6365 202f      (workspace /
-00009ea0: 2022 7477 6f2e 7079 2229 2e72 6573 6f6c   "two.py").resol
-00009eb0: 7665 2829 2c0a 2020 2020 2020 2020 2020  ve(),.          
-00009ec0: 2020 5d3a 0a20 2020 2020 2020 2020 2020    ]:.           
-00009ed0: 2020 2020 2066 2e77 7269 7465 5f74 6578       f.write_tex
-00009ee0: 7428 2770 7269 6e74 2822 6865 6c6c 6f22  t('print("hello"
-00009ef0: 295c 6e27 290a 2020 2020 2020 2020 2020  )\n').          
-00009f00: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
-00009f10: 636b 285b 7374 7228 776f 726b 7370 6163  ck([str(workspac
-00009f20: 6529 5d29 0a0a 2020 2020 4065 7665 6e74  e)])..    @event
-00009f30: 5f6c 6f6f 7028 290a 2020 2020 6465 6620  _loop().    def 
-00009f40: 7465 7374 5f63 6865 636b 5f64 6966 665f  test_check_diff_
-00009f50: 7573 655f 746f 6765 7468 6572 2873 656c  use_together(sel
-00009f60: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00009f70: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
-00009f80: 6972 2829 3a0a 2020 2020 2020 2020 2020  ir():.          
-00009f90: 2020 2320 4669 6c65 7320 7768 6963 6820    # Files which 
-00009fa0: 7769 6c6c 2062 6520 7265 666f 726d 6174  will be reformat
-00009fb0: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
-00009fc0: 2073 7263 3120 3d20 6765 745f 6361 7365   src1 = get_case
-00009fd0: 5f70 6174 6828 226d 6973 6365 6c6c 616e  _path("miscellan
-00009fe0: 656f 7573 222c 2022 7374 7269 6e67 5f71  eous", "string_q
-00009ff0: 756f 7465 7322 290a 2020 2020 2020 2020  uotes").        
-0000a000: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
-0000a010: 6c61 636b 285b 7374 7228 7372 6331 292c  lack([str(src1),
-0000a020: 2022 2d2d 6469 6666 222c 2022 2d2d 6368   "--diff", "--ch
-0000a030: 6563 6b22 5d2c 2065 7869 745f 636f 6465  eck"], exit_code
-0000a040: 3d31 290a 2020 2020 2020 2020 2020 2020  =1).            
-0000a050: 2320 4669 6c65 7320 7768 6963 6820 7769  # Files which wi
-0000a060: 6c6c 206e 6f74 2062 6520 7265 666f 726d  ll not be reform
-0000a070: 6174 7465 642e 0a20 2020 2020 2020 2020  atted..         
-0000a080: 2020 2073 7263 3220 3d20 6765 745f 6361     src2 = get_ca
-0000a090: 7365 5f70 6174 6828 2273 696d 706c 655f  se_path("simple_
-0000a0a0: 6361 7365 7322 2c20 2263 6f6d 706f 7369  cases", "composi
-0000a0b0: 7469 6f6e 2229 0a20 2020 2020 2020 2020  tion").         
-0000a0c0: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
-0000a0d0: 6163 6b28 5b73 7472 2873 7263 3229 2c20  ack([str(src2), 
-0000a0e0: 222d 2d64 6966 6622 2c20 222d 2d63 6865  "--diff", "--che
-0000a0f0: 636b 225d 290a 2020 2020 2020 2020 2020  ck"]).          
-0000a100: 2020 2320 4d75 6c74 6920 6669 6c65 2063    # Multi file c
-0000a110: 6f6d 6d61 6e64 2e0a 2020 2020 2020 2020  ommand..        
-0000a120: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
-0000a130: 6c61 636b 285b 7374 7228 7372 6331 292c  lack([str(src1),
-0000a140: 2073 7472 2873 7263 3229 2c20 222d 2d64   str(src2), "--d
-0000a150: 6966 6622 2c20 222d 2d63 6865 636b 225d  iff", "--check"]
-0000a160: 2c20 6578 6974 5f63 6f64 653d 3129 0a0a  , exit_code=1)..
-0000a170: 2020 2020 6465 6620 7465 7374 5f6e 6f5f      def test_no_
-0000a180: 7372 635f 6661 696c 7328 7365 6c66 2920  src_fails(self) 
-0000a190: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000a1a0: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
-0000a1b0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000a1c0: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
-0000a1d0: 5b5d 2c20 6578 6974 5f63 6f64 653d 3129  [], exit_code=1)
-0000a1e0: 0a0a 2020 2020 6465 6620 7465 7374 5f73  ..    def test_s
-0000a1f0: 7263 5f61 6e64 5f63 6f64 655f 6661 696c  rc_and_code_fail
-0000a200: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
-0000a210: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
-0000a220: 6368 655f 6469 7228 293a 0a20 2020 2020  che_dir():.     
-0000a230: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
-0000a240: 6b65 426c 6163 6b28 5b22 2e22 2c20 222d  keBlack([".", "-
-0000a250: 6322 2c20 2230 225d 2c20 6578 6974 5f63  c", "0"], exit_c
-0000a260: 6f64 653d 3129 0a0a 2020 2020 6465 6620  ode=1)..    def 
-0000a270: 7465 7374 5f62 726f 6b65 6e5f 7379 6d6c  test_broken_syml
-0000a280: 696e 6b28 7365 6c66 2920 2d3e 204e 6f6e  ink(self) -> Non
-0000a290: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
-0000a2a0: 6361 6368 655f 6469 7228 2920 6173 2077  cache_dir() as w
-0000a2b0: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
-0000a2c0: 2020 2020 2020 7379 6d6c 696e 6b20 3d20        symlink = 
-0000a2d0: 776f 726b 7370 6163 6520 2f20 2262 726f  workspace / "bro
-0000a2e0: 6b65 6e5f 6c69 6e6b 2e70 7922 0a20 2020  ken_link.py".   
-0000a2f0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000a300: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0000a310: 6d6c 696e 6b2e 7379 6d6c 696e 6b5f 746f  mlink.symlink_to
-0000a320: 2822 6e6f 6e65 7869 7374 656e 742e 7079  ("nonexistent.py
-0000a330: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
-0000a340: 7863 6570 7420 284f 5345 7272 6f72 2c20  xcept (OSError, 
-0000a350: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
-0000a360: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
-0000a370: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000a380: 736b 6970 5465 7374 2866 2243 616e 2774  skipTest(f"Can't
-0000a390: 2063 7265 6174 6520 7379 6d6c 696e 6b73   create symlinks
-0000a3a0: 3a20 7b65 7d22 290a 2020 2020 2020 2020  : {e}").        
-0000a3b0: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
-0000a3c0: 6c61 636b 285b 7374 7228 776f 726b 7370  lack([str(worksp
-0000a3d0: 6163 652e 7265 736f 6c76 6528 2929 5d29  ace.resolve())])
-0000a3e0: 0a0a 2020 2020 6465 6620 7465 7374 5f73  ..    def test_s
-0000a3f0: 696e 676c 655f 6669 6c65 5f66 6f72 6365  ingle_file_force
-0000a400: 5f70 7969 2873 656c 6629 202d 3e20 4e6f  _pyi(self) -> No
-0000a410: 6e65 3a0a 2020 2020 2020 2020 7079 695f  ne:.        pyi_
-0000a420: 6d6f 6465 203d 2072 6570 6c61 6365 2844  mode = replace(D
-0000a430: 4546 4155 4c54 5f4d 4f44 452c 2069 735f  EFAULT_MODE, is_
-0000a440: 7079 693d 5472 7565 290a 2020 2020 2020  pyi=True).      
-0000a450: 2020 636f 6e74 656e 7473 2c20 6578 7065    contents, expe
-0000a460: 6374 6564 203d 2072 6561 645f 6461 7461  cted = read_data
-0000a470: 2822 6d69 7363 656c 6c61 6e65 6f75 7322  ("miscellaneous"
-0000a480: 2c20 2266 6f72 6365 5f70 7969 2229 0a20  , "force_pyi"). 
-0000a490: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
-0000a4a0: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
-0000a4b0: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
-0000a4c0: 2020 7061 7468 203d 2028 776f 726b 7370    path = (worksp
-0000a4d0: 6163 6520 2f20 2266 696c 652e 7079 2229  ace / "file.py")
-0000a4e0: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-0000a4f0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-0000a500: 2870 6174 682c 2022 7722 2920 6173 2066  (path, "w") as f
-0000a510: 683a 0a20 2020 2020 2020 2020 2020 2020  h:.             
-0000a520: 2020 2066 682e 7772 6974 6528 636f 6e74     fh.write(cont
-0000a530: 656e 7473 290a 2020 2020 2020 2020 2020  ents).          
-0000a540: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
-0000a550: 636b 285b 7374 7228 7061 7468 292c 2022  ck([str(path), "
-0000a560: 2d2d 7079 6922 5d29 0a20 2020 2020 2020  --pyi"]).       
-0000a570: 2020 2020 2077 6974 6820 6f70 656e 2870       with open(p
-0000a580: 6174 682c 2022 7222 2920 6173 2066 683a  ath, "r") as fh:
-0000a590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a5a0: 2061 6374 7561 6c20 3d20 6668 2e72 6561   actual = fh.rea
-0000a5b0: 6428 290a 2020 2020 2020 2020 2020 2020  d().            
-0000a5c0: 2320 7665 7269 6679 2063 6163 6865 2077  # verify cache w
-0000a5d0: 6974 6820 2d2d 7079 6920 6973 2073 6570  ith --pyi is sep
-0000a5e0: 6172 6174 650a 2020 2020 2020 2020 2020  arate.          
-0000a5f0: 2020 7079 695f 6361 6368 6520 3d20 626c    pyi_cache = bl
-0000a600: 6163 6b2e 7265 6164 5f63 6163 6865 2870  ack.read_cache(p
-0000a610: 7969 5f6d 6f64 6529 0a20 2020 2020 2020  yi_mode).       
-0000a620: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000a630: 496e 2873 7472 2870 6174 6829 2c20 7079  In(str(path), py
-0000a640: 695f 6361 6368 6529 0a20 2020 2020 2020  i_cache).       
-0000a650: 2020 2020 206e 6f72 6d61 6c5f 6361 6368       normal_cach
-0000a660: 6520 3d20 626c 6163 6b2e 7265 6164 5f63  e = black.read_c
-0000a670: 6163 6865 2844 4546 4155 4c54 5f4d 4f44  ache(DEFAULT_MOD
-0000a680: 4529 0a20 2020 2020 2020 2020 2020 2073  E).            s
-0000a690: 656c 662e 6173 7365 7274 4e6f 7449 6e28  elf.assertNotIn(
-0000a6a0: 7374 7228 7061 7468 292c 206e 6f72 6d61  str(path), norma
-0000a6b0: 6c5f 6361 6368 6529 0a20 2020 2020 2020  l_cache).       
-0000a6c0: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
-0000a6d0: 6174 4571 7561 6c28 6578 7065 6374 6564  atEqual(expected
-0000a6e0: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-0000a6f0: 2020 626c 6163 6b2e 6173 7365 7274 5f65    black.assert_e
-0000a700: 7175 6976 616c 656e 7428 636f 6e74 656e  quivalent(conten
-0000a710: 7473 2c20 6163 7475 616c 290a 2020 2020  ts, actual).    
-0000a720: 2020 2020 626c 6163 6b2e 6173 7365 7274      black.assert
-0000a730: 5f73 7461 626c 6528 636f 6e74 656e 7473  _stable(contents
-0000a740: 2c20 6163 7475 616c 2c20 7079 695f 6d6f  , actual, pyi_mo
-0000a750: 6465 290a 0a20 2020 2040 6576 656e 745f  de)..    @event_
-0000a760: 6c6f 6f70 2829 0a20 2020 2064 6566 2074  loop().    def t
-0000a770: 6573 745f 6d75 6c74 695f 6669 6c65 5f66  est_multi_file_f
-0000a780: 6f72 6365 5f70 7969 2873 656c 6629 202d  orce_pyi(self) -
-0000a790: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000a7a0: 7265 675f 6d6f 6465 203d 2044 4546 4155  reg_mode = DEFAU
-0000a7b0: 4c54 5f4d 4f44 450a 2020 2020 2020 2020  LT_MODE.        
-0000a7c0: 7079 695f 6d6f 6465 203d 2072 6570 6c61  pyi_mode = repla
-0000a7d0: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
-0000a7e0: 2069 735f 7079 693d 5472 7565 290a 2020   is_pyi=True).  
-0000a7f0: 2020 2020 2020 636f 6e74 656e 7473 2c20        contents, 
-0000a800: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
-0000a810: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
-0000a820: 6f75 7322 2c20 2266 6f72 6365 5f70 7969  ous", "force_pyi
-0000a830: 2229 0a20 2020 2020 2020 2077 6974 6820  ").        with 
-0000a840: 6361 6368 655f 6469 7228 2920 6173 2077  cache_dir() as w
-0000a850: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
-0000a860: 2020 2020 2020 7061 7468 7320 3d20 5b0a        paths = [.
-0000a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a880: 2877 6f72 6b73 7061 6365 202f 2022 6669  (workspace / "fi
-0000a890: 6c65 312e 7079 2229 2e72 6573 6f6c 7665  le1.py").resolve
-0000a8a0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-0000a8b0: 2020 2020 2877 6f72 6b73 7061 6365 202f      (workspace /
-0000a8c0: 2022 6669 6c65 322e 7079 2229 2e72 6573   "file2.py").res
-0000a8d0: 6f6c 7665 2829 2c0a 2020 2020 2020 2020  olve(),.        
-0000a8e0: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-0000a8f0: 2020 666f 7220 7061 7468 2069 6e20 7061    for path in pa
-0000a900: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
-0000a910: 2020 2020 2077 6974 6820 6f70 656e 2870       with open(p
-0000a920: 6174 682c 2022 7722 2920 6173 2066 683a  ath, "w") as fh:
-0000a930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a940: 2020 2020 2066 682e 7772 6974 6528 636f       fh.write(co
-0000a950: 6e74 656e 7473 290a 2020 2020 2020 2020  ntents).        
-0000a960: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
-0000a970: 6c61 636b 285b 7374 7228 7029 2066 6f72  lack([str(p) for
-0000a980: 2070 2069 6e20 7061 7468 735d 202b 205b   p in paths] + [
-0000a990: 222d 2d70 7969 225d 290a 2020 2020 2020  "--pyi"]).      
-0000a9a0: 2020 2020 2020 666f 7220 7061 7468 2069        for path i
-0000a9b0: 6e20 7061 7468 733a 0a20 2020 2020 2020  n paths:.       
-0000a9c0: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-0000a9d0: 656e 2870 6174 682c 2022 7222 2920 6173  en(path, "r") as
-0000a9e0: 2066 683a 0a20 2020 2020 2020 2020 2020   fh:.           
-0000a9f0: 2020 2020 2020 2020 2061 6374 7561 6c20           actual 
-0000aa00: 3d20 6668 2e72 6561 6428 290a 2020 2020  = fh.read().    
-0000aa10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000aa20: 2e61 7373 6572 7445 7175 616c 2861 6374  .assertEqual(act
-0000aa30: 7561 6c2c 2065 7870 6563 7465 6429 0a20  ual, expected). 
-0000aa40: 2020 2020 2020 2020 2020 2023 2076 6572             # ver
-0000aa50: 6966 7920 6361 6368 6520 7769 7468 202d  ify cache with -
-0000aa60: 2d70 7969 2069 7320 7365 7061 7261 7465  -pyi is separate
-0000aa70: 0a20 2020 2020 2020 2020 2020 2070 7969  .            pyi
-0000aa80: 5f63 6163 6865 203d 2062 6c61 636b 2e72  _cache = black.r
-0000aa90: 6561 645f 6361 6368 6528 7079 695f 6d6f  ead_cache(pyi_mo
-0000aaa0: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-0000aab0: 6e6f 726d 616c 5f63 6163 6865 203d 2062  normal_cache = b
-0000aac0: 6c61 636b 2e72 6561 645f 6361 6368 6528  lack.read_cache(
-0000aad0: 7265 675f 6d6f 6465 290a 2020 2020 2020  reg_mode).      
-0000aae0: 2020 2020 2020 666f 7220 7061 7468 2069        for path i
-0000aaf0: 6e20 7061 7468 733a 0a20 2020 2020 2020  n paths:.       
-0000ab00: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0000ab10: 7365 7274 496e 2873 7472 2870 6174 6829  sertIn(str(path)
-0000ab20: 2c20 7079 695f 6361 6368 6529 0a20 2020  , pyi_cache).   
-0000ab30: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000ab40: 662e 6173 7365 7274 4e6f 7449 6e28 7374  f.assertNotIn(st
-0000ab50: 7228 7061 7468 292c 206e 6f72 6d61 6c5f  r(path), normal_
-0000ab60: 6361 6368 6529 0a0a 2020 2020 6465 6620  cache)..    def 
-0000ab70: 7465 7374 5f70 6970 655f 666f 7263 655f  test_pipe_force_
-0000ab80: 7079 6928 7365 6c66 2920 2d3e 204e 6f6e  pyi(self) -> Non
-0000ab90: 653a 0a20 2020 2020 2020 2073 6f75 7263  e:.        sourc
-0000aba0: 652c 2065 7870 6563 7465 6420 3d20 7265  e, expected = re
-0000abb0: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
-0000abc0: 616e 656f 7573 222c 2022 666f 7263 655f  aneous", "force_
-0000abd0: 7079 6922 290a 2020 2020 2020 2020 7265  pyi").        re
-0000abe0: 7375 6c74 203d 2043 6c69 5275 6e6e 6572  sult = CliRunner
-0000abf0: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
-0000ac00: 2020 2020 2020 2062 6c61 636b 2e6d 6169         black.mai
-0000ac10: 6e2c 205b 222d 222c 2022 2d71 222c 2022  n, ["-", "-q", "
-0000ac20: 2d2d 7079 6922 5d2c 2069 6e70 7574 3d42  --pyi"], input=B
-0000ac30: 7974 6573 494f 2873 6f75 7263 652e 656e  ytesIO(source.en
-0000ac40: 636f 6465 2822 7574 6638 2229 290a 2020  code("utf8")).  
-0000ac50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000ac60: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000ac70: 2872 6573 756c 742e 6578 6974 5f63 6f64  (result.exit_cod
-0000ac80: 652c 2030 290a 2020 2020 2020 2020 6163  e, 0).        ac
-0000ac90: 7475 616c 203d 2072 6573 756c 742e 6f75  tual = result.ou
-0000aca0: 7470 7574 0a20 2020 2020 2020 2073 656c  tput.        sel
-0000acb0: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
-0000acc0: 7561 6c28 6163 7475 616c 2c20 6578 7065  ual(actual, expe
-0000acd0: 6374 6564 290a 0a20 2020 2064 6566 2074  cted)..    def t
-0000ace0: 6573 745f 7369 6e67 6c65 5f66 696c 655f  est_single_file_
-0000acf0: 666f 7263 655f 7079 3336 2873 656c 6629  force_py36(self)
-0000ad00: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000ad10: 2020 7265 675f 6d6f 6465 203d 2044 4546    reg_mode = DEF
-0000ad20: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
-0000ad30: 2020 7079 3336 5f6d 6f64 6520 3d20 7265    py36_mode = re
-0000ad40: 706c 6163 6528 4445 4641 554c 545f 4d4f  place(DEFAULT_MO
-0000ad50: 4445 2c20 7461 7267 6574 5f76 6572 7369  DE, target_versi
-0000ad60: 6f6e 733d 5059 3336 5f56 4552 5349 4f4e  ons=PY36_VERSION
-0000ad70: 5329 0a20 2020 2020 2020 2073 6f75 7263  S).        sourc
-0000ad80: 652c 2065 7870 6563 7465 6420 3d20 7265  e, expected = re
-0000ad90: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
-0000ada0: 616e 656f 7573 222c 2022 666f 7263 655f  aneous", "force_
-0000adb0: 7079 3336 2229 0a20 2020 2020 2020 2077  py36").        w
-0000adc0: 6974 6820 6361 6368 655f 6469 7228 2920  ith cache_dir() 
-0000add0: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
-0000ade0: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-0000adf0: 2028 776f 726b 7370 6163 6520 2f20 2266   (workspace / "f
-0000ae00: 696c 652e 7079 2229 2e72 6573 6f6c 7665  ile.py").resolve
-0000ae10: 2829 0a20 2020 2020 2020 2020 2020 2077  ().            w
-0000ae20: 6974 6820 6f70 656e 2870 6174 682c 2022  ith open(path, "
-0000ae30: 7722 2920 6173 2066 683a 0a20 2020 2020  w") as fh:.     
-0000ae40: 2020 2020 2020 2020 2020 2066 682e 7772             fh.wr
-0000ae50: 6974 6528 736f 7572 6365 290a 2020 2020  ite(source).    
-0000ae60: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000ae70: 6f6b 6542 6c61 636b 285b 7374 7228 7061  okeBlack([str(pa
-0000ae80: 7468 292c 202a 5059 3336 5f41 5247 535d  th), *PY36_ARGS]
-0000ae90: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-0000aea0: 7468 206f 7065 6e28 7061 7468 2c20 2272  th open(path, "r
-0000aeb0: 2229 2061 7320 6668 3a0a 2020 2020 2020  ") as fh:.      
-0000aec0: 2020 2020 2020 2020 2020 6163 7475 616c            actual
-0000aed0: 203d 2066 682e 7265 6164 2829 0a20 2020   = fh.read().   
-0000aee0: 2020 2020 2020 2020 2023 2076 6572 6966           # verif
-0000aef0: 7920 6361 6368 6520 7769 7468 202d 2d74  y cache with --t
-0000af00: 6172 6765 742d 7665 7273 696f 6e20 6973  arget-version is
-0000af10: 2073 6570 6172 6174 650a 2020 2020 2020   separate.      
-0000af20: 2020 2020 2020 7079 3336 5f63 6163 6865        py36_cache
-0000af30: 203d 2062 6c61 636b 2e72 6561 645f 6361   = black.read_ca
-0000af40: 6368 6528 7079 3336 5f6d 6f64 6529 0a20  che(py36_mode). 
-0000af50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000af60: 6173 7365 7274 496e 2873 7472 2870 6174  assertIn(str(pat
-0000af70: 6829 2c20 7079 3336 5f63 6163 6865 290a  h), py36_cache).
-0000af80: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
-0000af90: 616c 5f63 6163 6865 203d 2062 6c61 636b  al_cache = black
-0000afa0: 2e72 6561 645f 6361 6368 6528 7265 675f  .read_cache(reg_
-0000afb0: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
-0000afc0: 2020 7365 6c66 2e61 7373 6572 744e 6f74    self.assertNot
-0000afd0: 496e 2873 7472 2870 6174 6829 2c20 6e6f  In(str(path), no
-0000afe0: 726d 616c 5f63 6163 6865 290a 2020 2020  rmal_cache).    
-0000aff0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000b000: 7175 616c 2861 6374 7561 6c2c 2065 7870  qual(actual, exp
-0000b010: 6563 7465 6429 0a0a 2020 2020 4065 7665  ected)..    @eve
-0000b020: 6e74 5f6c 6f6f 7028 290a 2020 2020 6465  nt_loop().    de
-0000b030: 6620 7465 7374 5f6d 756c 7469 5f66 696c  f test_multi_fil
-0000b040: 655f 666f 7263 655f 7079 3336 2873 656c  e_force_py36(sel
-0000b050: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000b060: 2020 2020 7265 675f 6d6f 6465 203d 2044      reg_mode = D
-0000b070: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
-0000b080: 2020 2020 7079 3336 5f6d 6f64 6520 3d20      py36_mode = 
-0000b090: 7265 706c 6163 6528 4445 4641 554c 545f  replace(DEFAULT_
-0000b0a0: 4d4f 4445 2c20 7461 7267 6574 5f76 6572  MODE, target_ver
-0000b0b0: 7369 6f6e 733d 5059 3336 5f56 4552 5349  sions=PY36_VERSI
-0000b0c0: 4f4e 5329 0a20 2020 2020 2020 2073 6f75  ONS).        sou
-0000b0d0: 7263 652c 2065 7870 6563 7465 6420 3d20  rce, expected = 
-0000b0e0: 7265 6164 5f64 6174 6128 226d 6973 6365  read_data("misce
-0000b0f0: 6c6c 616e 656f 7573 222c 2022 666f 7263  llaneous", "forc
-0000b100: 655f 7079 3336 2229 0a20 2020 2020 2020  e_py36").       
-0000b110: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
-0000b120: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
-0000b130: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0000b140: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-0000b150: 2020 2020 2020 2877 6f72 6b73 7061 6365        (workspace
-0000b160: 202f 2022 6669 6c65 312e 7079 2229 2e72   / "file1.py").r
-0000b170: 6573 6f6c 7665 2829 2c0a 2020 2020 2020  esolve(),.      
-0000b180: 2020 2020 2020 2020 2020 2877 6f72 6b73            (works
-0000b190: 7061 6365 202f 2022 6669 6c65 322e 7079  pace / "file2.py
-0000b1a0: 2229 2e72 6573 6f6c 7665 2829 2c0a 2020  ").resolve(),.  
-0000b1b0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-0000b1c0: 2020 2020 2020 2020 666f 7220 7061 7468          for path
-0000b1d0: 2069 6e20 7061 7468 733a 0a20 2020 2020   in paths:.     
-0000b1e0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0000b1f0: 6f70 656e 2870 6174 682c 2022 7722 2920  open(path, "w") 
-0000b200: 6173 2066 683a 0a20 2020 2020 2020 2020  as fh:.         
-0000b210: 2020 2020 2020 2020 2020 2066 682e 7772             fh.wr
-0000b220: 6974 6528 736f 7572 6365 290a 2020 2020  ite(source).    
-0000b230: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000b240: 6f6b 6542 6c61 636b 285b 7374 7228 7029  okeBlack([str(p)
-0000b250: 2066 6f72 2070 2069 6e20 7061 7468 735d   for p in paths]
-0000b260: 202b 2050 5933 365f 4152 4753 290a 2020   + PY36_ARGS).  
-0000b270: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
-0000b280: 7468 2069 6e20 7061 7468 733a 0a20 2020  th in paths:.   
-0000b290: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0000b2a0: 6820 6f70 656e 2870 6174 682c 2022 7222  h open(path, "r"
-0000b2b0: 2920 6173 2066 683a 0a20 2020 2020 2020  ) as fh:.       
-0000b2c0: 2020 2020 2020 2020 2020 2020 2061 6374               act
-0000b2d0: 7561 6c20 3d20 6668 2e72 6561 6428 290a  ual = fh.read().
-0000b2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2f0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000b300: 2861 6374 7561 6c2c 2065 7870 6563 7465  (actual, expecte
-0000b310: 6429 0a20 2020 2020 2020 2020 2020 2023  d).            #
-0000b320: 2076 6572 6966 7920 6361 6368 6520 7769   verify cache wi
-0000b330: 7468 202d 2d74 6172 6765 742d 7665 7273  th --target-vers
-0000b340: 696f 6e20 6973 2073 6570 6172 6174 650a  ion is separate.
-0000b350: 2020 2020 2020 2020 2020 2020 7079 695f              pyi_
-0000b360: 6361 6368 6520 3d20 626c 6163 6b2e 7265  cache = black.re
-0000b370: 6164 5f63 6163 6865 2870 7933 365f 6d6f  ad_cache(py36_mo
-0000b380: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-0000b390: 6e6f 726d 616c 5f63 6163 6865 203d 2062  normal_cache = b
-0000b3a0: 6c61 636b 2e72 6561 645f 6361 6368 6528  lack.read_cache(
-0000b3b0: 7265 675f 6d6f 6465 290a 2020 2020 2020  reg_mode).      
-0000b3c0: 2020 2020 2020 666f 7220 7061 7468 2069        for path i
-0000b3d0: 6e20 7061 7468 733a 0a20 2020 2020 2020  n paths:.       
-0000b3e0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0000b3f0: 7365 7274 496e 2873 7472 2870 6174 6829  sertIn(str(path)
-0000b400: 2c20 7079 695f 6361 6368 6529 0a20 2020  , pyi_cache).   
-0000b410: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b420: 662e 6173 7365 7274 4e6f 7449 6e28 7374  f.assertNotIn(st
-0000b430: 7228 7061 7468 292c 206e 6f72 6d61 6c5f  r(path), normal_
-0000b440: 6361 6368 6529 0a0a 2020 2020 6465 6620  cache)..    def 
-0000b450: 7465 7374 5f70 6970 655f 666f 7263 655f  test_pipe_force_
-0000b460: 7079 3336 2873 656c 6629 202d 3e20 4e6f  py36(self) -> No
-0000b470: 6e65 3a0a 2020 2020 2020 2020 736f 7572  ne:.        sour
-0000b480: 6365 2c20 6578 7065 6374 6564 203d 2072  ce, expected = r
-0000b490: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
-0000b4a0: 6c61 6e65 6f75 7322 2c20 2266 6f72 6365  laneous", "force
-0000b4b0: 5f70 7933 3622 290a 2020 2020 2020 2020  _py36").        
-0000b4c0: 7265 7375 6c74 203d 2043 6c69 5275 6e6e  result = CliRunn
-0000b4d0: 6572 2829 2e69 6e76 6f6b 6528 0a20 2020  er().invoke(.   
-0000b4e0: 2020 2020 2020 2020 2062 6c61 636b 2e6d           black.m
-0000b4f0: 6169 6e2c 0a20 2020 2020 2020 2020 2020  ain,.           
-0000b500: 205b 222d 222c 2022 2d71 222c 2022 2d2d   ["-", "-q", "--
-0000b510: 7461 7267 6574 2d76 6572 7369 6f6e 3d70  target-version=p
-0000b520: 7933 3622 5d2c 0a20 2020 2020 2020 2020  y36"],.         
-0000b530: 2020 2069 6e70 7574 3d42 7974 6573 494f     input=BytesIO
-0000b540: 2873 6f75 7263 652e 656e 636f 6465 2822  (source.encode("
-0000b550: 7574 6638 2229 292c 0a20 2020 2020 2020  utf8")),.       
-0000b560: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-0000b570: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-0000b580: 6c74 2e65 7869 745f 636f 6465 2c20 3029  lt.exit_code, 0)
-0000b590: 0a20 2020 2020 2020 2061 6374 7561 6c20  .        actual 
-0000b5a0: 3d20 7265 7375 6c74 2e6f 7574 7075 740a  = result.output.
-0000b5b0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000b5c0: 6572 7446 6f72 6d61 7445 7175 616c 2861  ertFormatEqual(a
-0000b5d0: 6374 7561 6c2c 2065 7870 6563 7465 6429  ctual, expected)
-0000b5e0: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
-0000b5f0: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
-0000b600: 7769 7468 5f6d 7970 7963 0a20 2020 2064  with_mypyc.    d
-0000b610: 6566 2074 6573 745f 7265 666f 726d 6174  ef test_reformat
-0000b620: 5f6f 6e65 5f77 6974 685f 7374 6469 6e28  _one_with_stdin(
-0000b630: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000b640: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
-0000b650: 6828 0a20 2020 2020 2020 2020 2020 2022  h(.            "
-0000b660: 626c 6163 6b2e 666f 726d 6174 5f73 7464  black.format_std
-0000b670: 696e 5f74 6f5f 7374 646f 7574 222c 0a20  in_to_stdout",. 
-0000b680: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000b690: 6e5f 7661 6c75 653d 6c61 6d62 6461 202a  n_value=lambda *
-0000b6a0: 6172 6773 2c20 2a2a 6b77 6172 6773 3a20  args, **kwargs: 
-0000b6b0: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
-0000b6c0: 532c 0a20 2020 2020 2020 2029 2061 7320  S,.        ) as 
-0000b6d0: 6673 7473 3a0a 2020 2020 2020 2020 2020  fsts:.          
-0000b6e0: 2020 7265 706f 7274 203d 204d 6167 6963    report = Magic
-0000b6f0: 4d6f 636b 2829 0a20 2020 2020 2020 2020  Mock().         
-0000b700: 2020 2070 6174 6820 3d20 5061 7468 2822     path = Path("
-0000b710: 2d22 290a 2020 2020 2020 2020 2020 2020  -").            
-0000b720: 626c 6163 6b2e 7265 666f 726d 6174 5f6f  black.reformat_o
-0000b730: 6e65 280a 2020 2020 2020 2020 2020 2020  ne(.            
-0000b740: 2020 2020 7061 7468 2c0a 2020 2020 2020      path,.      
-0000b750: 2020 2020 2020 2020 2020 6661 7374 3d54            fast=T
-0000b760: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-0000b770: 2020 2020 2077 7269 7465 5f62 6163 6b3d       write_back=
-0000b780: 626c 6163 6b2e 5772 6974 6542 6163 6b2e  black.WriteBack.
-0000b790: 5945 532c 0a20 2020 2020 2020 2020 2020  YES,.           
-0000b7a0: 2020 2020 206d 6f64 653d 4445 4641 554c       mode=DEFAUL
-0000b7b0: 545f 4d4f 4445 2c0a 2020 2020 2020 2020  T_MODE,.        
-0000b7c0: 2020 2020 2020 2020 7265 706f 7274 3d72          report=r
-0000b7d0: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
-0000b7e0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000b7f0: 2066 7374 732e 6173 7365 7274 5f63 616c   fsts.assert_cal
-0000b800: 6c65 645f 6f6e 6365 2829 0a20 2020 2020  led_once().     
-0000b810: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
-0000b820: 6e65 2e61 7373 6572 745f 6361 6c6c 6564  ne.assert_called
-0000b830: 5f77 6974 6828 7061 7468 2c20 626c 6163  _with(path, blac
-0000b840: 6b2e 4368 616e 6765 642e 5945 5329 0a0a  k.Changed.YES)..
-0000b850: 2020 2020 4070 7974 6573 742e 6d61 726b      @pytest.mark
-0000b860: 2e69 6e63 6f6d 7061 7469 626c 655f 7769  .incompatible_wi
-0000b870: 7468 5f6d 7970 7963 0a20 2020 2064 6566  th_mypyc.    def
-0000b880: 2074 6573 745f 7265 666f 726d 6174 5f6f   test_reformat_o
-0000b890: 6e65 5f77 6974 685f 7374 6469 6e5f 6669  ne_with_stdin_fi
-0000b8a0: 6c65 6e61 6d65 2873 656c 6629 202d 3e20  lename(self) -> 
-0000b8b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-0000b8c0: 7468 2070 6174 6368 280a 2020 2020 2020  th patch(.      
-0000b8d0: 2020 2020 2020 2262 6c61 636b 2e66 6f72        "black.for
-0000b8e0: 6d61 745f 7374 6469 6e5f 746f 5f73 7464  mat_stdin_to_std
-0000b8f0: 6f75 7422 2c0a 2020 2020 2020 2020 2020  out",.          
-0000b900: 2020 7265 7475 726e 5f76 616c 7565 3d6c    return_value=l
-0000b910: 616d 6264 6120 2a61 7267 732c 202a 2a6b  ambda *args, **k
-0000b920: 7761 7267 733a 2062 6c61 636b 2e43 6861  wargs: black.Cha
-0000b930: 6e67 6564 2e59 4553 2c0a 2020 2020 2020  nged.YES,.      
-0000b940: 2020 2920 6173 2066 7374 733a 0a20 2020    ) as fsts:.   
-0000b950: 2020 2020 2020 2020 2072 6570 6f72 7420           report 
-0000b960: 3d20 4d61 6769 634d 6f63 6b28 290a 2020  = MagicMock().  
-0000b970: 2020 2020 2020 2020 2020 7020 3d20 2266            p = "f
-0000b980: 6f6f 2e70 7922 0a20 2020 2020 2020 2020  oo.py".         
-0000b990: 2020 2070 6174 6820 3d20 5061 7468 2866     path = Path(f
-0000b9a0: 225f 5f42 4c41 434b 5f53 5444 494e 5f46  "__BLACK_STDIN_F
-0000b9b0: 494c 454e 414d 455f 5f7b 707d 2229 0a20  ILENAME__{p}"). 
-0000b9c0: 2020 2020 2020 2020 2020 2065 7870 6563             expec
-0000b9d0: 7465 6420 3d20 5061 7468 2870 290a 2020  ted = Path(p).  
-0000b9e0: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-0000b9f0: 7265 666f 726d 6174 5f6f 6e65 280a 2020  reformat_one(.  
-0000ba00: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0000ba10: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-0000ba20: 2020 2020 6661 7374 3d54 7275 652c 0a20      fast=True,. 
-0000ba30: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000ba40: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
-0000ba50: 5772 6974 6542 6163 6b2e 5945 532c 0a20  WriteBack.YES,. 
-0000ba60: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000ba70: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
-0000ba80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ba90: 2020 7265 706f 7274 3d72 6570 6f72 742c    report=report,
-0000baa0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000bab0: 2020 2020 2020 2020 2020 2066 7374 732e             fsts.
-0000bac0: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
-0000bad0: 6365 5f77 6974 6828 0a20 2020 2020 2020  ce_with(.       
-0000bae0: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
-0000baf0: 7565 2c20 7772 6974 655f 6261 636b 3d62  ue, write_back=b
-0000bb00: 6c61 636b 2e57 7269 7465 4261 636b 2e59  lack.WriteBack.Y
-0000bb10: 4553 2c20 6d6f 6465 3d44 4546 4155 4c54  ES, mode=DEFAULT
-0000bb20: 5f4d 4f44 450a 2020 2020 2020 2020 2020  _MODE.          
-0000bb30: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000bb40: 2320 5f5f 424c 4143 4b5f 5354 4449 4e5f  # __BLACK_STDIN_
-0000bb50: 4649 4c45 4e41 4d45 5f5f 2073 686f 756c  FILENAME__ shoul
-0000bb60: 6420 6861 7665 2062 6565 6e20 7374 7269  d have been stri
-0000bb70: 7070 6564 0a20 2020 2020 2020 2020 2020  pped.           
-0000bb80: 2072 6570 6f72 742e 646f 6e65 2e61 7373   report.done.ass
-0000bb90: 6572 745f 6361 6c6c 6564 5f77 6974 6828  ert_called_with(
-0000bba0: 6578 7065 6374 6564 2c20 626c 6163 6b2e  expected, black.
-0000bbb0: 4368 616e 6765 642e 5945 5329 0a0a 2020  Changed.YES)..  
-0000bbc0: 2020 4070 7974 6573 742e 6d61 726b 2e69    @pytest.mark.i
-0000bbd0: 6e63 6f6d 7061 7469 626c 655f 7769 7468  ncompatible_with
-0000bbe0: 5f6d 7970 7963 0a20 2020 2064 6566 2074  _mypyc.    def t
-0000bbf0: 6573 745f 7265 666f 726d 6174 5f6f 6e65  est_reformat_one
-0000bc00: 5f77 6974 685f 7374 6469 6e5f 6669 6c65  _with_stdin_file
-0000bc10: 6e61 6d65 5f70 7969 2873 656c 6629 202d  name_pyi(self) -
-0000bc20: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000bc30: 7769 7468 2070 6174 6368 280a 2020 2020  with patch(.    
-0000bc40: 2020 2020 2020 2020 2262 6c61 636b 2e66          "black.f
-0000bc50: 6f72 6d61 745f 7374 6469 6e5f 746f 5f73  ormat_stdin_to_s
-0000bc60: 7464 6f75 7422 2c0a 2020 2020 2020 2020  tdout",.        
-0000bc70: 2020 2020 7265 7475 726e 5f76 616c 7565      return_value
-0000bc80: 3d6c 616d 6264 6120 2a61 7267 732c 202a  =lambda *args, *
-0000bc90: 2a6b 7761 7267 733a 2062 6c61 636b 2e43  *kwargs: black.C
-0000bca0: 6861 6e67 6564 2e59 4553 2c0a 2020 2020  hanged.YES,.    
-0000bcb0: 2020 2020 2920 6173 2066 7374 733a 0a20      ) as fsts:. 
-0000bcc0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-0000bcd0: 7420 3d20 4d61 6769 634d 6f63 6b28 290a  t = MagicMock().
-0000bce0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-0000bcf0: 2266 6f6f 2e70 7969 220a 2020 2020 2020  "foo.pyi".      
-0000bd00: 2020 2020 2020 7061 7468 203d 2050 6174        path = Pat
-0000bd10: 6828 6622 5f5f 424c 4143 4b5f 5354 4449  h(f"__BLACK_STDI
-0000bd20: 4e5f 4649 4c45 4e41 4d45 5f5f 7b70 7d22  N_FILENAME__{p}"
-0000bd30: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-0000bd40: 7065 6374 6564 203d 2050 6174 6828 7029  pected = Path(p)
-0000bd50: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-0000bd60: 636b 2e72 6566 6f72 6d61 745f 6f6e 6528  ck.reformat_one(
-0000bd70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bd80: 2070 6174 682c 0a20 2020 2020 2020 2020   path,.         
-0000bd90: 2020 2020 2020 2066 6173 743d 5472 7565         fast=True
-0000bda0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000bdb0: 2020 7772 6974 655f 6261 636b 3d62 6c61    write_back=bla
-0000bdc0: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
-0000bdd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000bde0: 2020 6d6f 6465 3d44 4546 4155 4c54 5f4d    mode=DEFAULT_M
-0000bdf0: 4f44 452c 0a20 2020 2020 2020 2020 2020  ODE,.           
-0000be00: 2020 2020 2072 6570 6f72 743d 7265 706f       report=repo
-0000be10: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-0000be20: 290a 2020 2020 2020 2020 2020 2020 6673  ).            fs
-0000be30: 7473 2e61 7373 6572 745f 6361 6c6c 6564  ts.assert_called
-0000be40: 5f6f 6e63 655f 7769 7468 280a 2020 2020  _once_with(.    
-0000be50: 2020 2020 2020 2020 2020 2020 6661 7374              fast
-0000be60: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-0000be70: 2020 2020 2020 2077 7269 7465 5f62 6163         write_bac
-0000be80: 6b3d 626c 6163 6b2e 5772 6974 6542 6163  k=black.WriteBac
-0000be90: 6b2e 5945 532c 0a20 2020 2020 2020 2020  k.YES,.         
-0000bea0: 2020 2020 2020 206d 6f64 653d 7265 706c         mode=repl
-0000beb0: 6163 6528 4445 4641 554c 545f 4d4f 4445  ace(DEFAULT_MODE
-0000bec0: 2c20 6973 5f70 7969 3d54 7275 6529 2c0a  , is_pyi=True),.
-0000bed0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000bee0: 2020 2020 2020 2020 2020 2320 5f5f 424c            # __BL
-0000bef0: 4143 4b5f 5354 4449 4e5f 4649 4c45 4e41  ACK_STDIN_FILENA
-0000bf00: 4d45 5f5f 2073 686f 756c 6420 6861 7665  ME__ should have
-0000bf10: 2062 6565 6e20 7374 7269 7070 6564 0a20   been stripped. 
-0000bf20: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-0000bf30: 742e 646f 6e65 2e61 7373 6572 745f 6361  t.done.assert_ca
-0000bf40: 6c6c 6564 5f77 6974 6828 6578 7065 6374  lled_with(expect
-0000bf50: 6564 2c20 626c 6163 6b2e 4368 616e 6765  ed, black.Change
-0000bf60: 642e 5945 5329 0a0a 2020 2020 4070 7974  d.YES)..    @pyt
-0000bf70: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
-0000bf80: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
-0000bf90: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
-0000bfa0: 666f 726d 6174 5f6f 6e65 5f77 6974 685f  format_one_with_
-0000bfb0: 7374 6469 6e5f 6669 6c65 6e61 6d65 5f69  stdin_filename_i
-0000bfc0: 7079 6e62 2873 656c 6629 202d 3e20 4e6f  pynb(self) -> No
-0000bfd0: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
-0000bfe0: 2070 6174 6368 280a 2020 2020 2020 2020   patch(.        
-0000bff0: 2020 2020 2262 6c61 636b 2e66 6f72 6d61      "black.forma
-0000c000: 745f 7374 6469 6e5f 746f 5f73 7464 6f75  t_stdin_to_stdou
-0000c010: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-0000c020: 7265 7475 726e 5f76 616c 7565 3d6c 616d  return_value=lam
-0000c030: 6264 6120 2a61 7267 732c 202a 2a6b 7761  bda *args, **kwa
-0000c040: 7267 733a 2062 6c61 636b 2e43 6861 6e67  rgs: black.Chang
-0000c050: 6564 2e59 4553 2c0a 2020 2020 2020 2020  ed.YES,.        
-0000c060: 2920 6173 2066 7374 733a 0a20 2020 2020  ) as fsts:.     
-0000c070: 2020 2020 2020 2072 6570 6f72 7420 3d20         report = 
-0000c080: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
-0000c090: 2020 2020 2020 2020 7020 3d20 2266 6f6f          p = "foo
-0000c0a0: 2e69 7079 6e62 220a 2020 2020 2020 2020  .ipynb".        
-0000c0b0: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
-0000c0c0: 6622 5f5f 424c 4143 4b5f 5354 4449 4e5f  f"__BLACK_STDIN_
-0000c0d0: 4649 4c45 4e41 4d45 5f5f 7b70 7d22 290a  FILENAME__{p}").
-0000c0e0: 2020 2020 2020 2020 2020 2020 6578 7065              expe
-0000c0f0: 6374 6564 203d 2050 6174 6828 7029 0a20  cted = Path(p). 
-0000c100: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-0000c110: 2e72 6566 6f72 6d61 745f 6f6e 6528 0a20  .reformat_one(. 
-0000c120: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000c130: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-0000c140: 2020 2020 2066 6173 743d 5472 7565 2c0a       fast=True,.
-0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c160: 7772 6974 655f 6261 636b 3d62 6c61 636b  write_back=black
-0000c170: 2e57 7269 7465 4261 636b 2e59 4553 2c0a  .WriteBack.YES,.
-0000c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c190: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
-0000c1a0: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
-0000c1b0: 2020 2072 6570 6f72 743d 7265 706f 7274     report=report
-0000c1c0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000c1d0: 2020 2020 2020 2020 2020 2020 6673 7473              fsts
-0000c1e0: 2e61 7373 6572 745f 6361 6c6c 6564 5f6f  .assert_called_o
-0000c1f0: 6e63 655f 7769 7468 280a 2020 2020 2020  nce_with(.      
-0000c200: 2020 2020 2020 2020 2020 6661 7374 3d54            fast=T
-0000c210: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-0000c220: 2020 2020 2077 7269 7465 5f62 6163 6b3d       write_back=
-0000c230: 626c 6163 6b2e 5772 6974 6542 6163 6b2e  black.WriteBack.
-0000c240: 5945 532c 0a20 2020 2020 2020 2020 2020  YES,.           
-0000c250: 2020 2020 206d 6f64 653d 7265 706c 6163       mode=replac
-0000c260: 6528 4445 4641 554c 545f 4d4f 4445 2c20  e(DEFAULT_MODE, 
-0000c270: 6973 5f69 7079 6e62 3d54 7275 6529 2c0a  is_ipynb=True),.
-0000c280: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000c290: 2020 2020 2020 2020 2020 2320 5f5f 424c            # __BL
-0000c2a0: 4143 4b5f 5354 4449 4e5f 4649 4c45 4e41  ACK_STDIN_FILENA
-0000c2b0: 4d45 5f5f 2073 686f 756c 6420 6861 7665  ME__ should have
-0000c2c0: 2062 6565 6e20 7374 7269 7070 6564 0a20   been stripped. 
-0000c2d0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-0000c2e0: 742e 646f 6e65 2e61 7373 6572 745f 6361  t.done.assert_ca
-0000c2f0: 6c6c 6564 5f77 6974 6828 6578 7065 6374  lled_with(expect
-0000c300: 6564 2c20 626c 6163 6b2e 4368 616e 6765  ed, black.Change
-0000c310: 642e 5945 5329 0a0a 2020 2020 4070 7974  d.YES)..    @pyt
-0000c320: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
-0000c330: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
-0000c340: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
-0000c350: 666f 726d 6174 5f6f 6e65 5f77 6974 685f  format_one_with_
-0000c360: 7374 6469 6e5f 616e 645f 6578 6973 7469  stdin_and_existi
-0000c370: 6e67 5f70 6174 6828 7365 6c66 2920 2d3e  ng_path(self) ->
-0000c380: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
-0000c390: 6974 6820 7061 7463 6828 0a20 2020 2020  ith patch(.     
-0000c3a0: 2020 2020 2020 2022 626c 6163 6b2e 666f         "black.fo
-0000c3b0: 726d 6174 5f73 7464 696e 5f74 6f5f 7374  rmat_stdin_to_st
-0000c3c0: 646f 7574 222c 0a20 2020 2020 2020 2020  dout",.         
-0000c3d0: 2020 2072 6574 7572 6e5f 7661 6c75 653d     return_value=
-0000c3e0: 6c61 6d62 6461 202a 6172 6773 2c20 2a2a  lambda *args, **
-0000c3f0: 6b77 6172 6773 3a20 626c 6163 6b2e 4368  kwargs: black.Ch
-0000c400: 616e 6765 642e 5945 532c 0a20 2020 2020  anged.YES,.     
-0000c410: 2020 2029 2061 7320 6673 7473 3a0a 2020     ) as fsts:.  
-0000c420: 2020 2020 2020 2020 2020 7265 706f 7274            report
-0000c430: 203d 204d 6167 6963 4d6f 636b 2829 0a20   = MagicMock(). 
-0000c440: 2020 2020 2020 2020 2020 2023 2045 7665             # Eve
-0000c450: 6e20 7769 7468 2061 6e20 6578 6973 7469  n with an existi
-0000c460: 6e67 2066 696c 652c 2073 696e 6365 2077  ng file, since w
-0000c470: 6520 6172 6520 666f 7263 696e 6720 7374  e are forcing st
-0000c480: 6469 6e2c 2062 6c61 636b 0a20 2020 2020  din, black.     
-0000c490: 2020 2020 2020 2023 2073 686f 756c 6420         # should 
-0000c4a0: 6f75 7470 7574 2074 6f20 7374 646f 7574  output to stdout
-0000c4b0: 2061 6e64 206e 6f74 206d 6f64 6966 7920   and not modify 
-0000c4c0: 7468 6520 6669 6c65 2069 6e70 6c61 6365  the file inplace
-0000c4d0: 0a20 2020 2020 2020 2020 2020 2070 203d  .            p =
-0000c4e0: 2054 4849 535f 4449 5220 2f20 2264 6174   THIS_DIR / "dat
-0000c4f0: 6122 202f 2022 7369 6d70 6c65 5f63 6173  a" / "simple_cas
-0000c500: 6573 2220 2f20 2263 6f6c 6c65 6374 696f  es" / "collectio
-0000c510: 6e73 2e70 7922 0a20 2020 2020 2020 2020  ns.py".         
-0000c520: 2020 2023 204d 616b 6520 7375 7265 2069     # Make sure i
-0000c530: 735f 6669 6c65 2061 6374 7561 6c6c 7920  s_file actually 
-0000c540: 7265 7475 726e 7320 5472 7565 0a20 2020  returns True.   
-0000c550: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0000c560: 7365 7274 5472 7565 2870 2e69 735f 6669  sertTrue(p.is_fi
-0000c570: 6c65 2829 290a 2020 2020 2020 2020 2020  le()).          
-0000c580: 2020 7061 7468 203d 2050 6174 6828 6622    path = Path(f"
-0000c590: 5f5f 424c 4143 4b5f 5354 4449 4e5f 4649  __BLACK_STDIN_FI
-0000c5a0: 4c45 4e41 4d45 5f5f 7b70 7d22 290a 2020  LENAME__{p}").  
-0000c5b0: 2020 2020 2020 2020 2020 6578 7065 6374            expect
-0000c5c0: 6564 203d 2050 6174 6828 7029 0a20 2020  ed = Path(p).   
-0000c5d0: 2020 2020 2020 2020 2062 6c61 636b 2e72           black.r
-0000c5e0: 6566 6f72 6d61 745f 6f6e 6528 0a20 2020  eformat_one(.   
-0000c5f0: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-0000c600: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
-0000c610: 2020 2066 6173 743d 5472 7565 2c0a 2020     fast=True,.  
-0000c620: 2020 2020 2020 2020 2020 2020 2020 7772                wr
-0000c630: 6974 655f 6261 636b 3d62 6c61 636b 2e57  ite_back=black.W
-0000c640: 7269 7465 4261 636b 2e59 4553 2c0a 2020  riteBack.YES,.  
-0000c650: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0000c660: 6465 3d44 4546 4155 4c54 5f4d 4f44 452c  de=DEFAULT_MODE,
-0000c670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c680: 2072 6570 6f72 743d 7265 706f 7274 2c0a   report=report,.
-0000c690: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000c6a0: 2020 2020 2020 2020 2020 6673 7473 2e61            fsts.a
-0000c6b0: 7373 6572 745f 6361 6c6c 6564 5f6f 6e63  ssert_called_onc
-0000c6c0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-0000c6d0: 2320 5f5f 424c 4143 4b5f 5354 4449 4e5f  # __BLACK_STDIN_
-0000c6e0: 4649 4c45 4e41 4d45 5f5f 2073 686f 756c  FILENAME__ shoul
-0000c6f0: 6420 6861 7665 2062 6565 6e20 7374 7269  d have been stri
-0000c700: 7070 6564 0a20 2020 2020 2020 2020 2020  pped.           
-0000c710: 2072 6570 6f72 742e 646f 6e65 2e61 7373   report.done.ass
-0000c720: 6572 745f 6361 6c6c 6564 5f77 6974 6828  ert_called_with(
-0000c730: 6578 7065 6374 6564 2c20 626c 6163 6b2e  expected, black.
-0000c740: 4368 616e 6765 642e 5945 5329 0a0a 2020  Changed.YES)..  
-0000c750: 2020 6465 6620 7465 7374 5f72 6566 6f72    def test_refor
-0000c760: 6d61 745f 6f6e 655f 7769 7468 5f73 7464  mat_one_with_std
-0000c770: 696e 5f65 6d70 7479 2873 656c 6629 202d  in_empty(self) -
-0000c780: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000c790: 6f75 7470 7574 203d 2069 6f2e 5374 7269  output = io.Stri
-0000c7a0: 6e67 494f 2829 0a20 2020 2020 2020 2077  ngIO().        w
-0000c7b0: 6974 6820 7061 7463 6828 2269 6f2e 5465  ith patch("io.Te
-0000c7c0: 7874 494f 5772 6170 7065 7222 2c20 6c61  xtIOWrapper", la
-0000c7d0: 6d62 6461 202a 6172 6773 2c20 2a2a 6b77  mbda *args, **kw
-0000c7e0: 6172 6773 3a20 6f75 7470 7574 293a 0a20  args: output):. 
-0000c7f0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c810: 626c 6163 6b2e 666f 726d 6174 5f73 7464  black.format_std
-0000c820: 696e 5f74 6f5f 7374 646f 7574 280a 2020  in_to_stdout(.  
-0000c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c840: 2020 6661 7374 3d54 7275 652c 0a20 2020    fast=True,.   
-0000c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c860: 2063 6f6e 7465 6e74 3d22 222c 0a20 2020   content="",.   
-0000c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c880: 2077 7269 7465 5f62 6163 6b3d 626c 6163   write_back=blac
-0000c890: 6b2e 5772 6974 6542 6163 6b2e 5945 532c  k.WriteBack.YES,
-0000c8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c8b0: 2020 2020 206d 6f64 653d 4445 4641 554c       mode=DEFAUL
-0000c8c0: 545f 4d4f 4445 2c0a 2020 2020 2020 2020  T_MODE,.        
-0000c8d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000c8e0: 2020 2020 2020 6578 6365 7074 2069 6f2e        except io.
-0000c8f0: 556e 7375 7070 6f72 7465 644f 7065 7261  UnsupportedOpera
-0000c900: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-0000c910: 2020 2020 2020 7061 7373 2020 2320 5374        pass  # St
-0000c920: 7269 6e67 494f 2064 6f65 7320 6e6f 7420  ringIO does not 
-0000c930: 7375 7070 6f72 7420 6465 7461 6368 0a20  support detach. 
-0000c940: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0000c950: 7420 6f75 7470 7574 2e67 6574 7661 6c75  t output.getvalu
-0000c960: 6528 2920 3d3d 2022 220a 0a20 2020 2064  e() == ""..    d
-0000c970: 6566 2074 6573 745f 696e 7661 6c69 645f  ef test_invalid_
-0000c980: 636c 695f 7265 6765 7828 7365 6c66 2920  cli_regex(self) 
-0000c990: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000c9a0: 2066 6f72 206f 7074 696f 6e20 696e 205b   for option in [
-0000c9b0: 222d 2d69 6e63 6c75 6465 222c 2022 2d2d  "--include", "--
-0000c9c0: 6578 636c 7564 6522 2c20 222d 2d65 7874  exclude", "--ext
-0000c9d0: 656e 642d 6578 636c 7564 6522 2c20 222d  end-exclude", "-
-0000c9e0: 2d66 6f72 6365 2d65 7863 6c75 6465 225d  -force-exclude"]
-0000c9f0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000ca00: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
-0000ca10: 222d 222c 206f 7074 696f 6e2c 2022 2a2a  "-", option, "**
-0000ca20: 2829 2821 212a 2922 5d2c 2065 7869 745f  ()(!!*)"], exit_
-0000ca30: 636f 6465 3d32 290a 0a20 2020 2064 6566  code=2)..    def
-0000ca40: 2074 6573 745f 7265 7175 6972 6564 5f76   test_required_v
-0000ca50: 6572 7369 6f6e 5f6d 6174 6368 6573 5f76  ersion_matches_v
-0000ca60: 6572 7369 6f6e 2873 656c 6629 202d 3e20  ersion(self) -> 
-0000ca70: 4e6f 6e65 3a0a 2020 2020 2020 2020 7365  None:.        se
-0000ca80: 6c66 2e69 6e76 6f6b 6542 6c61 636b 280a  lf.invokeBlack(.
-0000ca90: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
-0000caa0: 7265 7175 6972 6564 2d76 6572 7369 6f6e  required-version
-0000cab0: 222c 2062 6c61 636b 2e5f 5f76 6572 7369  ", black.__versi
-0000cac0: 6f6e 5f5f 2c20 222d 6322 2c20 2230 225d  on__, "-c", "0"]
-0000cad0: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
-0000cae0: 6974 5f63 6f64 653d 302c 0a20 2020 2020  it_code=0,.     
-0000caf0: 2020 2020 2020 2069 676e 6f72 655f 636f         ignore_co
-0000cb00: 6e66 6967 3d54 7275 652c 0a20 2020 2020  nfig=True,.     
-0000cb10: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
-0000cb20: 7374 5f72 6571 7569 7265 645f 7665 7273  st_required_vers
-0000cb30: 696f 6e5f 6d61 7463 6865 735f 7061 7274  ion_matches_part
-0000cb40: 6961 6c5f 7665 7273 696f 6e28 7365 6c66  ial_version(self
-0000cb50: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000cb60: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
-0000cb70: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
-0000cb80: 205b 222d 2d72 6571 7569 7265 642d 7665   ["--required-ve
-0000cb90: 7273 696f 6e22 2c20 626c 6163 6b2e 5f5f  rsion", black.__
-0000cba0: 7665 7273 696f 6e5f 5f2e 7370 6c69 7428  version__.split(
-0000cbb0: 222e 2229 5b30 5d2c 2022 2d63 222c 2022  ".")[0], "-c", "
-0000cbc0: 3022 5d2c 0a20 2020 2020 2020 2020 2020  0"],.           
-0000cbd0: 2065 7869 745f 636f 6465 3d30 2c0a 2020   exit_code=0,.  
-0000cbe0: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
-0000cbf0: 5f63 6f6e 6669 673d 5472 7565 2c0a 2020  _config=True,.  
-0000cc00: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-0000cc10: 2074 6573 745f 7265 7175 6972 6564 5f76   test_required_v
-0000cc20: 6572 7369 6f6e 5f64 6f65 735f 6e6f 745f  ersion_does_not_
-0000cc30: 6d61 7463 685f 6f6e 5f6d 696e 6f72 5f76  match_on_minor_v
-0000cc40: 6572 7369 6f6e 2873 656c 6629 202d 3e20  ersion(self) -> 
-0000cc50: 4e6f 6e65 3a0a 2020 2020 2020 2020 7365  None:.        se
-0000cc60: 6c66 2e69 6e76 6f6b 6542 6c61 636b 280a  lf.invokeBlack(.
-0000cc70: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
-0000cc80: 7265 7175 6972 6564 2d76 6572 7369 6f6e  required-version
-0000cc90: 222c 2062 6c61 636b 2e5f 5f76 6572 7369  ", black.__versi
-0000cca0: 6f6e 5f5f 2e73 706c 6974 2822 2e22 295b  on__.split(".")[
-0000ccb0: 305d 202b 2022 2e39 3939 222c 2022 2d63  0] + ".999", "-c
-0000ccc0: 222c 2022 3022 5d2c 0a20 2020 2020 2020  ", "0"],.       
-0000ccd0: 2020 2020 2065 7869 745f 636f 6465 3d31       exit_code=1
-0000cce0: 2c0a 2020 2020 2020 2020 2020 2020 6967  ,.            ig
-0000ccf0: 6e6f 7265 5f63 6f6e 6669 673d 5472 7565  nore_config=True
-0000cd00: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000cd10: 2064 6566 2074 6573 745f 7265 7175 6972   def test_requir
-0000cd20: 6564 5f76 6572 7369 6f6e 5f64 6f65 735f  ed_version_does_
-0000cd30: 6e6f 745f 6d61 7463 685f 7665 7273 696f  not_match_versio
-0000cd40: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
-0000cd50: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-0000cd60: 3d20 426c 6163 6b52 756e 6e65 7228 292e  = BlackRunner().
-0000cd70: 696e 766f 6b65 280a 2020 2020 2020 2020  invoke(.        
-0000cd80: 2020 2020 626c 6163 6b2e 6d61 696e 2c0a      black.main,.
-0000cd90: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
-0000cda0: 7265 7175 6972 6564 2d76 6572 7369 6f6e  required-version
-0000cdb0: 222c 2022 3230 2e39 3962 222c 2022 2d63  ", "20.99b", "-c
-0000cdc0: 222c 2022 3022 5d2c 0a20 2020 2020 2020  ", "0"],.       
-0000cdd0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-0000cde0: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-0000cdf0: 6c74 2e65 7869 745f 636f 6465 2c20 3129  lt.exit_code, 1)
-0000ce00: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000ce10: 7365 7274 496e 2822 7265 7175 6972 6564  sertIn("required
-0000ce20: 2076 6572 7369 6f6e 222c 2072 6573 756c   version", resul
-0000ce30: 742e 7374 6465 7272 290a 0a20 2020 2064  t.stderr)..    d
-0000ce40: 6566 2074 6573 745f 7072 6573 6572 7665  ef test_preserve
-0000ce50: 735f 6c69 6e65 5f65 6e64 696e 6773 2873  s_line_endings(s
-0000ce60: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000ce70: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
-0000ce80: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
-0000ce90: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
-0000cea0: 2020 2020 2020 2020 2020 7465 7374 5f66            test_f
-0000ceb0: 696c 6520 3d20 5061 7468 2877 6f72 6b73  ile = Path(works
-0000cec0: 7061 6365 2920 2f20 2274 6573 742e 7079  pace) / "test.py
-0000ced0: 220a 2020 2020 2020 2020 2020 2020 666f  ".            fo
-0000cee0: 7220 6e6c 2069 6e20 5b22 5c6e 222c 2022  r nl in ["\n", "
-0000cef0: 5c72 5c6e 225d 3a0a 2020 2020 2020 2020  \r\n"]:.        
-0000cf00: 2020 2020 2020 2020 636f 6e74 656e 7473          contents
-0000cf10: 203d 206e 6c2e 6a6f 696e 285b 2264 6566   = nl.join(["def
-0000cf20: 2066 2820 2029 3a22 2c20 2220 2020 2070   f(  ):", "    p
-0000cf30: 6173 7322 5d29 0a20 2020 2020 2020 2020  ass"]).         
-0000cf40: 2020 2020 2020 2074 6573 745f 6669 6c65         test_file
-0000cf50: 2e77 7269 7465 5f62 7974 6573 2863 6f6e  .write_bytes(con
-0000cf60: 7465 6e74 732e 656e 636f 6465 2829 290a  tents.encode()).
-0000cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf80: 6666 2874 6573 745f 6669 6c65 2c20 7772  ff(test_file, wr
-0000cf90: 6974 655f 6261 636b 3d62 6c61 636b 2e57  ite_back=black.W
-0000cfa0: 7269 7465 4261 636b 2e59 4553 290a 2020  riteBack.YES).  
-0000cfb0: 2020 2020 2020 2020 2020 2020 2020 7570                up
-0000cfc0: 6461 7465 645f 636f 6e74 656e 7473 3a20  dated_contents: 
-0000cfd0: 6279 7465 7320 3d20 7465 7374 5f66 696c  bytes = test_fil
-0000cfe0: 652e 7265 6164 5f62 7974 6573 2829 0a20  e.read_bytes(). 
-0000cff0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d000: 656c 662e 6173 7365 7274 496e 286e 6c2e  elf.assertIn(nl.
-0000d010: 656e 636f 6465 2829 2c20 7570 6461 7465  encode(), update
-0000d020: 645f 636f 6e74 656e 7473 290a 2020 2020  d_contents).    
-0000d030: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000d040: 6c20 3d3d 2022 5c6e 223a 0a20 2020 2020  l == "\n":.     
-0000d050: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d060: 656c 662e 6173 7365 7274 4e6f 7449 6e28  elf.assertNotIn(
-0000d070: 6222 5c72 5c6e 222c 2075 7064 6174 6564  b"\r\n", updated
-0000d080: 5f63 6f6e 7465 6e74 7329 0a0a 2020 2020  _contents)..    
-0000d090: 6465 6620 7465 7374 5f70 7265 7365 7276  def test_preserv
-0000d0a0: 6573 5f6c 696e 655f 656e 6469 6e67 735f  es_line_endings_
-0000d0b0: 7669 615f 7374 6469 6e28 7365 6c66 2920  via_stdin(self) 
-0000d0c0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000d0d0: 2066 6f72 206e 6c20 696e 205b 225c 6e22   for nl in ["\n"
-0000d0e0: 2c20 225c 725c 6e22 5d3a 0a20 2020 2020  , "\r\n"]:.     
-0000d0f0: 2020 2020 2020 2063 6f6e 7465 6e74 7320         contents 
-0000d100: 3d20 6e6c 2e6a 6f69 6e28 5b22 6465 6620  = nl.join(["def 
-0000d110: 6628 2020 293a 222c 2022 2020 2020 7061  f(  ):", "    pa
-0000d120: 7373 225d 290a 2020 2020 2020 2020 2020  ss"]).          
-0000d130: 2020 7275 6e6e 6572 203d 2042 6c61 636b    runner = Black
-0000d140: 5275 6e6e 6572 2829 0a20 2020 2020 2020  Runner().       
-0000d150: 2020 2020 2072 6573 756c 7420 3d20 7275       result = ru
-0000d160: 6e6e 6572 2e69 6e76 6f6b 6528 0a20 2020  nner.invoke(.   
-0000d170: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
-0000d180: 636b 2e6d 6169 6e2c 205b 222d 222c 2022  ck.main, ["-", "
-0000d190: 2d2d 6661 7374 225d 2c20 696e 7075 743d  --fast"], input=
-0000d1a0: 4279 7465 7349 4f28 636f 6e74 656e 7473  BytesIO(contents
-0000d1b0: 2e65 6e63 6f64 6528 2275 7466 3822 2929  .encode("utf8"))
-0000d1c0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000d1d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000d1e0: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-0000d1f0: 6c74 2e65 7869 745f 636f 6465 2c20 3029  lt.exit_code, 0)
-0000d200: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0000d210: 7075 7420 3d20 7265 7375 6c74 2e73 7464  put = result.std
-0000d220: 6f75 745f 6279 7465 730a 2020 2020 2020  out_bytes.      
-0000d230: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000d240: 7449 6e28 6e6c 2e65 6e63 6f64 6528 2275  tIn(nl.encode("u
-0000d250: 7466 3822 292c 206f 7574 7075 7429 0a20  tf8"), output). 
-0000d260: 2020 2020 2020 2020 2020 2069 6620 6e6c             if nl
-0000d270: 203d 3d20 225c 6e22 3a0a 2020 2020 2020   == "\n":.      
-0000d280: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000d290: 7373 6572 744e 6f74 496e 2862 225c 725c  ssertNotIn(b"\r\
-0000d2a0: 6e22 2c20 6f75 7470 7574 290a 0a20 2020  n", output)..   
-0000d2b0: 2064 6566 2074 6573 745f 6173 7365 7274   def test_assert
-0000d2c0: 5f65 7175 6976 616c 656e 745f 6469 6666  _equivalent_diff
-0000d2d0: 6572 656e 745f 6173 7473 2873 656c 6629  erent_asts(self)
-0000d2e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000d2f0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0000d300: 7274 5261 6973 6573 2841 7373 6572 7469  rtRaises(Asserti
-0000d310: 6f6e 4572 726f 7229 3a0a 2020 2020 2020  onError):.      
-0000d320: 2020 2020 2020 626c 6163 6b2e 6173 7365        black.asse
-0000d330: 7274 5f65 7175 6976 616c 656e 7428 227b  rt_equivalent("{
-0000d340: 7d22 2c20 224e 6f6e 6522 290a 0a20 2020  }", "None")..   
-0000d350: 2064 6566 2074 6573 745f 7368 6868 5f63   def test_shhh_c
-0000d360: 6c69 636b 2873 656c 6629 202d 3e20 4e6f  lick(self) -> No
-0000d370: 6e65 3a0a 2020 2020 2020 2020 7472 793a  ne:.        try:
-0000d380: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
-0000d390: 6d20 636c 6963 6b20 696d 706f 7274 205f  m click import _
-0000d3a0: 756e 6963 6f64 6566 756e 2020 2320 7479  unicodefun  # ty
-0000d3b0: 7065 3a20 6967 6e6f 7265 0a20 2020 2020  pe: ignore.     
-0000d3c0: 2020 2065 7863 6570 7420 496d 706f 7274     except Import
-0000d3d0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-0000d3e0: 2020 2073 656c 662e 736b 6970 5465 7374     self.skipTest
-0000d3f0: 2822 496e 636f 6d70 6174 6962 6c65 2043  ("Incompatible C
-0000d400: 6c69 636b 2076 6572 7369 6f6e 2229 0a0a  lick version")..
-0000d410: 2020 2020 2020 2020 6966 206e 6f74 2068          if not h
-0000d420: 6173 6174 7472 285f 756e 6963 6f64 6566  asattr(_unicodef
-0000d430: 756e 2c20 225f 7665 7269 6679 5f70 7974  un, "_verify_pyt
-0000d440: 686f 6e5f 656e 7622 293a 0a20 2020 2020  hon_env"):.     
-0000d450: 2020 2020 2020 2073 656c 662e 736b 6970         self.skip
-0000d460: 5465 7374 2822 496e 636f 6d70 6174 6962  Test("Incompatib
-0000d470: 6c65 2043 6c69 636b 2076 6572 7369 6f6e  le Click version
-0000d480: 2229 0a0a 2020 2020 2020 2020 2320 4669  ")..        # Fi
-0000d490: 7273 742c 206c 6574 2773 2073 6565 2069  rst, let's see i
-0000d4a0: 6620 436c 6963 6b20 6973 2063 7261 7368  f Click is crash
-0000d4b0: 696e 6720 7769 7468 2061 2070 7265 6665  ing with a prefe
-0000d4c0: 7272 6564 2041 5343 4949 2063 6861 7273  rred ASCII chars
-0000d4d0: 6574 2e0a 2020 2020 2020 2020 7769 7468  et..        with
-0000d4e0: 2070 6174 6368 2822 6c6f 6361 6c65 2e67   patch("locale.g
-0000d4f0: 6574 7072 6566 6572 7265 6465 6e63 6f64  etpreferredencod
-0000d500: 696e 6722 2920 6173 2067 7065 3a0a 2020  ing") as gpe:.  
-0000d510: 2020 2020 2020 2020 2020 6770 652e 7265            gpe.re
-0000d520: 7475 726e 5f76 616c 7565 203d 2022 4153  turn_value = "AS
-0000d530: 4349 4922 0a20 2020 2020 2020 2020 2020  CII".           
-0000d540: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-0000d550: 7452 6169 7365 7328 5275 6e74 696d 6545  tRaises(RuntimeE
-0000d560: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-0000d570: 2020 2020 2020 205f 756e 6963 6f64 6566         _unicodef
-0000d580: 756e 2e5f 7665 7269 6679 5f70 7974 686f  un._verify_pytho
-0000d590: 6e5f 656e 7628 290a 2020 2020 2020 2020  n_env().        
-0000d5a0: 2320 4e6f 772c 206c 6574 2773 2073 696c  # Now, let's sil
-0000d5b0: 656e 6365 2043 6c69 636b 2e2e 2e0a 2020  ence Click....  
-0000d5c0: 2020 2020 2020 626c 6163 6b2e 7061 7463        black.patc
-0000d5d0: 685f 636c 6963 6b28 290a 2020 2020 2020  h_click().      
-0000d5e0: 2020 2320 2e2e 2e61 6e64 2063 6f6e 6669    # ...and confi
-0000d5f0: 726d 2069 7427 7320 7369 6c65 6e74 2e0a  rm it's silent..
-0000d600: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
-0000d610: 6368 2822 6c6f 6361 6c65 2e67 6574 7072  ch("locale.getpr
-0000d620: 6566 6572 7265 6465 6e63 6f64 696e 6722  eferredencoding"
-0000d630: 2920 6173 2067 7065 3a0a 2020 2020 2020  ) as gpe:.      
-0000d640: 2020 2020 2020 6770 652e 7265 7475 726e        gpe.return
-0000d650: 5f76 616c 7565 203d 2022 4153 4349 4922  _value = "ASCII"
-0000d660: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-0000d670: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d680: 2020 5f75 6e69 636f 6465 6675 6e2e 5f76    _unicodefun._v
-0000d690: 6572 6966 795f 7079 7468 6f6e 5f65 6e76  erify_python_env
-0000d6a0: 2829 0a20 2020 2020 2020 2020 2020 2065  ().            e
-0000d6b0: 7863 6570 7420 5275 6e74 696d 6545 7272  xcept RuntimeErr
-0000d6c0: 6f72 2061 7320 7265 3a0a 2020 2020 2020  or as re:.      
-0000d6d0: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
-0000d6e0: 6169 6c28 6622 6070 6174 6368 5f63 6c69  ail(f"`patch_cli
-0000d6f0: 636b 2829 6020 6661 696c 6564 2c20 6578  ck()` failed, ex
-0000d700: 6365 7074 696f 6e20 7374 696c 6c20 7261  ception still ra
-0000d710: 6973 6564 3a20 7b72 657d 2229 0a0a 2020  ised: {re}")..  
-0000d720: 2020 6465 6620 7465 7374 5f72 6f6f 745f    def test_root_
-0000d730: 6c6f 6767 6572 5f6e 6f74 5f75 7365 645f  logger_not_used_
-0000d740: 6469 7265 6374 6c79 2873 656c 6629 202d  directly(self) -
-0000d750: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000d760: 6465 6620 6661 696c 282a 6172 6773 3a20  def fail(*args: 
-0000d770: 416e 792c 202a 2a6b 7761 7267 733a 2041  Any, **kwargs: A
-0000d780: 6e79 2920 2d3e 204e 6f6e 653a 0a20 2020  ny) -> None:.   
-0000d790: 2020 2020 2020 2020 2073 656c 662e 6661           self.fa
-0000d7a0: 696c 2822 5265 636f 7264 2063 7265 6174  il("Record creat
-0000d7b0: 6564 2077 6974 6820 726f 6f74 206c 6f67  ed with root log
-0000d7c0: 6765 7222 290a 0a20 2020 2020 2020 2077  ger")..        w
-0000d7d0: 6974 6820 7061 7463 682e 6d75 6c74 6970  ith patch.multip
-0000d7e0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-0000d7f0: 6c6f 6767 696e 672e 726f 6f74 2c0a 2020  logging.root,.  
-0000d800: 2020 2020 2020 2020 2020 6465 6275 673d            debug=
-0000d810: 6661 696c 2c0a 2020 2020 2020 2020 2020  fail,.          
-0000d820: 2020 696e 666f 3d66 6169 6c2c 0a20 2020    info=fail,.   
-0000d830: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0000d840: 3d66 6169 6c2c 0a20 2020 2020 2020 2020  =fail,.         
-0000d850: 2020 2065 7272 6f72 3d66 6169 6c2c 0a20     error=fail,. 
-0000d860: 2020 2020 2020 2020 2020 2063 7269 7469             criti
-0000d870: 6361 6c3d 6661 696c 2c0a 2020 2020 2020  cal=fail,.      
-0000d880: 2020 2020 2020 6c6f 673d 6661 696c 2c0a        log=fail,.
-0000d890: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0000d8a0: 2020 2020 2020 2066 6628 5448 4953 5f44         ff(THIS_D
-0000d8b0: 4952 202f 2022 7574 696c 2e70 7922 290a  IR / "util.py").
-0000d8c0: 0a20 2020 2064 6566 2074 6573 745f 696e  .    def test_in
-0000d8d0: 7661 6c69 645f 636f 6e66 6967 5f72 6574  valid_config_ret
-0000d8e0: 7572 6e5f 636f 6465 2873 656c 6629 202d  urn_code(self) -
-0000d8f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000d900: 746d 705f 6669 6c65 203d 2050 6174 6828  tmp_file = Path(
-0000d910: 626c 6163 6b2e 6475 6d70 5f74 6f5f 6669  black.dump_to_fi
-0000d920: 6c65 2829 290a 2020 2020 2020 2020 7472  le()).        tr
-0000d930: 793a 0a20 2020 2020 2020 2020 2020 2074  y:.            t
-0000d940: 6d70 5f63 6f6e 6669 6720 3d20 5061 7468  mp_config = Path
-0000d950: 2862 6c61 636b 2e64 756d 705f 746f 5f66  (black.dump_to_f
-0000d960: 696c 6528 2929 0a20 2020 2020 2020 2020  ile()).         
-0000d970: 2020 2074 6d70 5f63 6f6e 6669 672e 756e     tmp_config.un
-0000d980: 6c69 6e6b 2829 0a20 2020 2020 2020 2020  link().         
-0000d990: 2020 2061 7267 7320 3d20 5b22 2d2d 636f     args = ["--co
-0000d9a0: 6e66 6967 222c 2073 7472 2874 6d70 5f63  nfig", str(tmp_c
-0000d9b0: 6f6e 6669 6729 2c20 7374 7228 746d 705f  onfig), str(tmp_
-0000d9c0: 6669 6c65 295d 0a20 2020 2020 2020 2020  file)].         
-0000d9d0: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
-0000d9e0: 6163 6b28 6172 6773 2c20 6578 6974 5f63  ack(args, exit_c
-0000d9f0: 6f64 653d 322c 2069 676e 6f72 655f 636f  ode=2, ignore_co
-0000da00: 6e66 6967 3d46 616c 7365 290a 2020 2020  nfig=False).    
-0000da10: 2020 2020 6669 6e61 6c6c 793a 0a20 2020      finally:.   
-0000da20: 2020 2020 2020 2020 2074 6d70 5f66 696c           tmp_fil
-0000da30: 652e 756e 6c69 6e6b 2829 0a0a 2020 2020  e.unlink()..    
-0000da40: 6465 6620 7465 7374 5f70 6172 7365 5f70  def test_parse_p
-0000da50: 7970 726f 6a65 6374 5f74 6f6d 6c28 7365  yproject_toml(se
-0000da60: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000da70: 2020 2020 2074 6573 745f 746f 6d6c 5f66       test_toml_f
-0000da80: 696c 6520 3d20 5448 4953 5f44 4952 202f  ile = THIS_DIR /
-0000da90: 2022 7465 7374 2e74 6f6d 6c22 0a20 2020   "test.toml".   
-0000daa0: 2020 2020 2063 6f6e 6669 6720 3d20 626c       config = bl
-0000dab0: 6163 6b2e 7061 7273 655f 7079 7072 6f6a  ack.parse_pyproj
-0000dac0: 6563 745f 746f 6d6c 2873 7472 2874 6573  ect_toml(str(tes
-0000dad0: 745f 746f 6d6c 5f66 696c 6529 290a 2020  t_toml_file)).  
-0000dae0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000daf0: 7445 7175 616c 2863 6f6e 6669 675b 2276  tEqual(config["v
-0000db00: 6572 626f 7365 225d 2c20 3129 0a20 2020  erbose"], 1).   
-0000db10: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000db20: 4571 7561 6c28 636f 6e66 6967 5b22 6368  Equal(config["ch
-0000db30: 6563 6b22 5d2c 2022 6e6f 2229 0a20 2020  eck"], "no").   
-0000db40: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000db50: 4571 7561 6c28 636f 6e66 6967 5b22 6469  Equal(config["di
-0000db60: 6666 225d 2c20 2279 2229 0a20 2020 2020  ff"], "y").     
-0000db70: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000db80: 7561 6c28 636f 6e66 6967 5b22 636f 6c6f  ual(config["colo
-0000db90: 7222 5d2c 2054 7275 6529 0a20 2020 2020  r"], True).     
-0000dba0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000dbb0: 7561 6c28 636f 6e66 6967 5b22 6c69 6e65  ual(config["line
-0000dbc0: 5f6c 656e 6774 6822 5d2c 2037 3929 0a20  _length"], 79). 
-0000dbd0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000dbe0: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
-0000dbf0: 7461 7267 6574 5f76 6572 7369 6f6e 225d  target_version"]
-0000dc00: 2c20 5b22 7079 3336 222c 2022 7079 3337  , ["py36", "py37
-0000dc10: 222c 2022 7079 3338 225d 290a 2020 2020  ", "py38"]).    
-0000dc20: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000dc30: 7175 616c 2863 6f6e 6669 675b 2270 7974  qual(config["pyt
-0000dc40: 686f 6e5f 6365 6c6c 5f6d 6167 6963 7322  hon_cell_magics"
-0000dc50: 5d2c 205b 2263 7573 746f 6d31 222c 2022  ], ["custom1", "
-0000dc60: 6375 7374 6f6d 3222 5d29 0a20 2020 2020  custom2"]).     
-0000dc70: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000dc80: 7561 6c28 636f 6e66 6967 5b22 6578 636c  ual(config["excl
-0000dc90: 7564 6522 5d2c 2072 225c 2e70 7969 3f24  ude"], r"\.pyi?$
-0000dca0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-0000dcb0: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
-0000dcc0: 6967 5b22 696e 636c 7564 6522 5d2c 2072  ig["include"], r
-0000dcd0: 225c 2e70 793f 2422 290a 0a20 2020 2064  "\.py?$")..    d
-0000dce0: 6566 2074 6573 745f 7265 6164 5f70 7970  ef test_read_pyp
-0000dcf0: 726f 6a65 6374 5f74 6f6d 6c28 7365 6c66  roject_toml(self
-0000dd00: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000dd10: 2020 2074 6573 745f 746f 6d6c 5f66 696c     test_toml_fil
-0000dd20: 6520 3d20 5448 4953 5f44 4952 202f 2022  e = THIS_DIR / "
-0000dd30: 7465 7374 2e74 6f6d 6c22 0a20 2020 2020  test.toml".     
-0000dd40: 2020 2066 616b 655f 6374 7820 3d20 4661     fake_ctx = Fa
-0000dd50: 6b65 436f 6e74 6578 7428 290a 2020 2020  keContext().    
-0000dd60: 2020 2020 626c 6163 6b2e 7265 6164 5f70      black.read_p
-0000dd70: 7970 726f 6a65 6374 5f74 6f6d 6c28 6661  yproject_toml(fa
-0000dd80: 6b65 5f63 7478 2c20 4661 6b65 5061 7261  ke_ctx, FakePara
-0000dd90: 6d65 7465 7228 292c 2073 7472 2874 6573  meter(), str(tes
-0000dda0: 745f 746f 6d6c 5f66 696c 6529 290a 2020  t_toml_file)).  
-0000ddb0: 2020 2020 2020 636f 6e66 6967 203d 2066        config = f
-0000ddc0: 616b 655f 6374 782e 6465 6661 756c 745f  ake_ctx.default_
-0000ddd0: 6d61 700a 2020 2020 2020 2020 7365 6c66  map.        self
-0000dde0: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-0000ddf0: 6669 675b 2276 6572 626f 7365 225d 2c20  fig["verbose"], 
-0000de00: 2231 2229 0a20 2020 2020 2020 2073 656c  "1").        sel
-0000de10: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
-0000de20: 6e66 6967 5b22 6368 6563 6b22 5d2c 2022  nfig["check"], "
-0000de30: 6e6f 2229 0a20 2020 2020 2020 2073 656c  no").        sel
-0000de40: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
-0000de50: 6e66 6967 5b22 6469 6666 225d 2c20 2279  nfig["diff"], "y
-0000de60: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-0000de70: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
-0000de80: 6967 5b22 636f 6c6f 7222 5d2c 2022 5472  ig["color"], "Tr
-0000de90: 7565 2229 0a20 2020 2020 2020 2073 656c  ue").        sel
-0000dea0: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
-0000deb0: 6e66 6967 5b22 6c69 6e65 5f6c 656e 6774  nfig["line_lengt
-0000dec0: 6822 5d2c 2022 3739 2229 0a20 2020 2020  h"], "79").     
-0000ded0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000dee0: 7561 6c28 636f 6e66 6967 5b22 7461 7267  ual(config["targ
-0000def0: 6574 5f76 6572 7369 6f6e 225d 2c20 5b22  et_version"], ["
-0000df00: 7079 3336 222c 2022 7079 3337 222c 2022  py36", "py37", "
-0000df10: 7079 3338 225d 290a 2020 2020 2020 2020  py38"]).        
-0000df20: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000df30: 2863 6f6e 6669 675b 2265 7863 6c75 6465  (config["exclude
-0000df40: 225d 2c20 7222 5c2e 7079 693f 2422 290a  "], r"\.pyi?$").
-0000df50: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000df60: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-0000df70: 2269 6e63 6c75 6465 225d 2c20 7222 5c2e  "include"], r"\.
-0000df80: 7079 3f24 2229 0a0a 2020 2020 4070 7974  py?$")..    @pyt
-0000df90: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
-0000dfa0: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
-0000dfb0: 0a20 2020 2064 6566 2074 6573 745f 6669  .    def test_fi
-0000dfc0: 6e64 5f70 726f 6a65 6374 5f72 6f6f 7428  nd_project_root(
-0000dfd0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000dfe0: 2020 2020 2020 2077 6974 6820 5465 6d70         with Temp
-0000dff0: 6f72 6172 7944 6972 6563 746f 7279 2829  oraryDirectory()
-0000e000: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
-0000e010: 2020 2020 2020 2020 2020 2072 6f6f 7420             root 
-0000e020: 3d20 5061 7468 2877 6f72 6b73 7061 6365  = Path(workspace
-0000e030: 290a 2020 2020 2020 2020 2020 2020 7465  ).            te
-0000e040: 7374 5f64 6972 203d 2072 6f6f 7420 2f20  st_dir = root / 
-0000e050: 2274 6573 7422 0a20 2020 2020 2020 2020  "test".         
-0000e060: 2020 2074 6573 745f 6469 722e 6d6b 6469     test_dir.mkdi
-0000e070: 7228 290a 0a20 2020 2020 2020 2020 2020  r()..           
-0000e080: 2073 7263 5f64 6972 203d 2072 6f6f 7420   src_dir = root 
-0000e090: 2f20 2273 7263 220a 2020 2020 2020 2020  / "src".        
-0000e0a0: 2020 2020 7372 635f 6469 722e 6d6b 6469      src_dir.mkdi
-0000e0b0: 7228 290a 0a20 2020 2020 2020 2020 2020  r()..           
-0000e0c0: 2072 6f6f 745f 7079 7072 6f6a 6563 7420   root_pyproject 
-0000e0d0: 3d20 726f 6f74 202f 2022 7079 7072 6f6a  = root / "pyproj
-0000e0e0: 6563 742e 746f 6d6c 220a 2020 2020 2020  ect.toml".      
-0000e0f0: 2020 2020 2020 726f 6f74 5f70 7970 726f        root_pypro
-0000e100: 6a65 6374 2e74 6f75 6368 2829 0a20 2020  ject.touch().   
-0000e110: 2020 2020 2020 2020 2073 7263 5f70 7970           src_pyp
-0000e120: 726f 6a65 6374 203d 2073 7263 5f64 6972  roject = src_dir
-0000e130: 202f 2022 7079 7072 6f6a 6563 742e 746f   / "pyproject.to
-0000e140: 6d6c 220a 2020 2020 2020 2020 2020 2020  ml".            
-0000e150: 7372 635f 7079 7072 6f6a 6563 742e 746f  src_pyproject.to
-0000e160: 7563 6828 290a 2020 2020 2020 2020 2020  uch().          
-0000e170: 2020 7372 635f 7079 7468 6f6e 203d 2073    src_python = s
-0000e180: 7263 5f64 6972 202f 2022 666f 6f2e 7079  rc_dir / "foo.py
-0000e190: 220a 2020 2020 2020 2020 2020 2020 7372  ".            sr
-0000e1a0: 635f 7079 7468 6f6e 2e74 6f75 6368 2829  c_python.touch()
-0000e1b0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000e1c0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-0000e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1e0: 626c 6163 6b2e 6669 6e64 5f70 726f 6a65  black.find_proje
-0000e1f0: 6374 5f72 6f6f 7428 2873 7263 5f64 6972  ct_root((src_dir
-0000e200: 2c20 7465 7374 5f64 6972 2929 2c0a 2020  , test_dir)),.  
-0000e210: 2020 2020 2020 2020 2020 2020 2020 2872                (r
-0000e220: 6f6f 742e 7265 736f 6c76 6528 292c 2022  oot.resolve(), "
-0000e230: 7079 7072 6f6a 6563 742e 746f 6d6c 2229  pyproject.toml")
-0000e240: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000e250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e260: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-0000e270: 2020 2020 2020 2020 2020 2020 2020 626c                bl
-0000e280: 6163 6b2e 6669 6e64 5f70 726f 6a65 6374  ack.find_project
-0000e290: 5f72 6f6f 7428 2873 7263 5f64 6972 2c29  _root((src_dir,)
-0000e2a0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000e2b0: 2020 2028 7372 635f 6469 722e 7265 736f     (src_dir.reso
-0000e2c0: 6c76 6528 292c 2022 7079 7072 6f6a 6563  lve(), "pyprojec
-0000e2d0: 742e 746f 6d6c 2229 2c0a 2020 2020 2020  t.toml"),.      
-0000e2e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000e2f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000e300: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-0000e310: 2020 2020 2020 626c 6163 6b2e 6669 6e64        black.find
-0000e320: 5f70 726f 6a65 6374 5f72 6f6f 7428 2873  _project_root((s
-0000e330: 7263 5f70 7974 686f 6e2c 2929 2c0a 2020  rc_python,)),.  
-0000e340: 2020 2020 2020 2020 2020 2020 2020 2873                (s
-0000e350: 7263 5f64 6972 2e72 6573 6f6c 7665 2829  rc_dir.resolve()
-0000e360: 2c20 2270 7970 726f 6a65 6374 2e74 6f6d  , "pyproject.tom
-0000e370: 6c22 292c 0a20 2020 2020 2020 2020 2020  l"),.           
-0000e380: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-0000e390: 7769 7468 2063 6861 6e67 655f 6469 7265  with change_dire
-0000e3a0: 6374 6f72 7928 7465 7374 5f64 6972 293a  ctory(test_dir):
-0000e3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e3c0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000e3d0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-0000e3e0: 2020 2020 2020 2062 6c61 636b 2e66 696e         black.fin
-0000e3f0: 645f 7072 6f6a 6563 745f 726f 6f74 2828  d_project_root((
-0000e400: 222d 222c 292c 2073 7464 696e 5f66 696c  "-",), stdin_fil
-0000e410: 656e 616d 653d 222e 2e2f 7372 632f 612e  ename="../src/a.
-0000e420: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
-0000e430: 2020 2020 2020 2020 2020 2873 7263 5f64            (src_d
-0000e440: 6972 2e72 6573 6f6c 7665 2829 2c20 2270  ir.resolve(), "p
-0000e450: 7970 726f 6a65 6374 2e74 6f6d 6c22 292c  yproject.toml"),
-0000e460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e470: 2029 0a0a 2020 2020 4070 6174 6368 280a   )..    @patch(.
-0000e480: 2020 2020 2020 2020 2262 6c61 636b 2e66          "black.f
-0000e490: 696c 6573 2e66 696e 645f 7573 6572 5f70  iles.find_user_p
-0000e4a0: 7970 726f 6a65 6374 5f74 6f6d 6c22 2c0a  yproject_toml",.
-0000e4b0: 2020 2020 290a 2020 2020 6465 6620 7465      ).    def te
-0000e4c0: 7374 5f66 696e 645f 7079 7072 6f6a 6563  st_find_pyprojec
-0000e4d0: 745f 746f 6d6c 2873 656c 662c 2066 696e  t_toml(self, fin
-0000e4e0: 645f 7573 6572 5f70 7970 726f 6a65 6374  d_user_pyproject
-0000e4f0: 5f74 6f6d 6c3a 204d 6167 6963 4d6f 636b  _toml: MagicMock
-0000e500: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000e510: 2020 2066 696e 645f 7573 6572 5f70 7970     find_user_pyp
-0000e520: 726f 6a65 6374 5f74 6f6d 6c2e 7369 6465  roject_toml.side
-0000e530: 5f65 6666 6563 7420 3d20 5275 6e74 696d  _effect = Runtim
-0000e540: 6545 7272 6f72 2829 0a0a 2020 2020 2020  eError()..      
-0000e550: 2020 7769 7468 2072 6564 6972 6563 745f    with redirect_
-0000e560: 7374 6465 7272 2869 6f2e 5374 7269 6e67  stderr(io.String
-0000e570: 494f 2829 2920 6173 2073 7464 6572 723a  IO()) as stderr:
-0000e580: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0000e590: 756c 7420 3d20 626c 6163 6b2e 6669 6c65  ult = black.file
-0000e5a0: 732e 6669 6e64 5f70 7970 726f 6a65 6374  s.find_pyproject
-0000e5b0: 5f74 6f6d 6c28 0a20 2020 2020 2020 2020  _toml(.         
-0000e5c0: 2020 2020 2020 2070 6174 685f 7365 6172         path_sear
-0000e5d0: 6368 5f73 7461 7274 3d28 7374 7228 5061  ch_start=(str(Pa
-0000e5e0: 7468 2e63 7764 2829 2e72 6f6f 7429 2c29  th.cwd().root),)
-0000e5f0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0000e600: 2020 2020 2020 2020 6173 7365 7274 2072          assert r
-0000e610: 6573 756c 7420 6973 204e 6f6e 650a 2020  esult is None.  
-0000e620: 2020 2020 2020 6572 7220 3d20 7374 6465        err = stde
-0000e630: 7272 2e67 6574 7661 6c75 6528 290a 2020  rr.getvalue().  
-0000e640: 2020 2020 2020 6173 7365 7274 2022 4967        assert "Ig
-0000e650: 6e6f 7269 6e67 2075 7365 7220 636f 6e66  noring user conf
-0000e660: 6967 7572 6174 696f 6e22 2069 6e20 6572  iguration" in er
-0000e670: 720a 0a20 2020 2040 7061 7463 6828 0a20  r..    @patch(. 
-0000e680: 2020 2020 2020 2022 626c 6163 6b2e 6669         "black.fi
-0000e690: 6c65 732e 6669 6e64 5f75 7365 725f 7079  les.find_user_py
-0000e6a0: 7072 6f6a 6563 745f 746f 6d6c 222c 0a20  project_toml",. 
-0000e6b0: 2020 2020 2020 2062 6c61 636b 2e66 696c         black.fil
-0000e6c0: 6573 2e66 696e 645f 7573 6572 5f70 7970  es.find_user_pyp
-0000e6d0: 726f 6a65 6374 5f74 6f6d 6c2e 5f5f 7772  roject_toml.__wr
-0000e6e0: 6170 7065 645f 5f2c 0a20 2020 2029 0a20  apped__,.    ). 
-0000e6f0: 2020 2064 6566 2074 6573 745f 6669 6e64     def test_find
-0000e700: 5f75 7365 725f 7079 7072 6f6a 6563 745f  _user_pyproject_
-0000e710: 746f 6d6c 5f6c 696e 7578 2873 656c 6629  toml_linux(self)
-0000e720: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000e730: 2020 6966 2073 7973 7465 6d28 2920 3d3d    if system() ==
-0000e740: 2022 5769 6e64 6f77 7322 3a0a 2020 2020   "Windows":.    
-0000e750: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-0000e760: 2020 2020 2020 2020 2320 5465 7374 2069          # Test i
-0000e770: 6620 5844 475f 434f 4e46 4947 5f48 4f4d  f XDG_CONFIG_HOM
-0000e780: 4520 6973 2063 6865 636b 6564 0a20 2020  E is checked.   
-0000e790: 2020 2020 2077 6974 6820 5465 6d70 6f72       with Tempor
-0000e7a0: 6172 7944 6972 6563 746f 7279 2829 2061  aryDirectory() a
-0000e7b0: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
-0000e7c0: 2020 2020 2020 2020 2074 6d70 5f75 7365           tmp_use
-0000e7d0: 725f 636f 6e66 6967 203d 2050 6174 6828  r_config = Path(
-0000e7e0: 776f 726b 7370 6163 6529 202f 2022 626c  workspace) / "bl
-0000e7f0: 6163 6b22 0a20 2020 2020 2020 2020 2020  ack".           
-0000e800: 2077 6974 6820 7061 7463 682e 6469 6374   with patch.dict
-0000e810: 2822 6f73 2e65 6e76 6972 6f6e 222c 207b  ("os.environ", {
-0000e820: 2258 4447 5f43 4f4e 4649 475f 484f 4d45  "XDG_CONFIG_HOME
-0000e830: 223a 2077 6f72 6b73 7061 6365 7d29 3a0a  ": workspace}):.
-0000e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e850: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000e860: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000e870: 2020 2020 2020 626c 6163 6b2e 6669 6c65        black.file
-0000e880: 732e 6669 6e64 5f75 7365 725f 7079 7072  s.find_user_pypr
-0000e890: 6f6a 6563 745f 746f 6d6c 2829 2c20 746d  oject_toml(), tm
-0000e8a0: 705f 7573 6572 5f63 6f6e 6669 672e 7265  p_user_config.re
-0000e8b0: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
-0000e8c0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000e8d0: 2020 2023 2054 6573 7420 6661 6c6c 6261     # Test fallba
-0000e8e0: 636b 2066 6f72 2058 4447 5f43 4f4e 4649  ck for XDG_CONFI
-0000e8f0: 475f 484f 4d45 0a20 2020 2020 2020 2077  G_HOME.        w
-0000e900: 6974 6820 7061 7463 682e 6469 6374 2822  ith patch.dict("
-0000e910: 6f73 2e65 6e76 6972 6f6e 2229 3a0a 2020  os.environ"):.  
-0000e920: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
-0000e930: 6972 6f6e 2e70 6f70 2822 5844 475f 434f  iron.pop("XDG_CO
-0000e940: 4e46 4947 5f48 4f4d 4522 2c20 4e6f 6e65  NFIG_HOME", None
-0000e950: 290a 2020 2020 2020 2020 2020 2020 6661  ).            fa
-0000e960: 6c6c 6261 636b 5f75 7365 725f 636f 6e66  llback_user_conf
-0000e970: 6967 203d 2050 6174 6828 227e 2f2e 636f  ig = Path("~/.co
-0000e980: 6e66 6967 2229 2e65 7870 616e 6475 7365  nfig").expanduse
-0000e990: 7228 2920 2f20 2262 6c61 636b 220a 2020  r() / "black".  
-0000e9a0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000e9b0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-0000e9c0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-0000e9d0: 6b2e 6669 6c65 732e 6669 6e64 5f75 7365  k.files.find_use
-0000e9e0: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
-0000e9f0: 2829 2c20 6661 6c6c 6261 636b 5f75 7365  (), fallback_use
-0000ea00: 725f 636f 6e66 6967 2e72 6573 6f6c 7665  r_config.resolve
-0000ea10: 2829 0a20 2020 2020 2020 2020 2020 2029  ().            )
-0000ea20: 0a0a 2020 2020 6465 6620 7465 7374 5f66  ..    def test_f
-0000ea30: 696e 645f 7573 6572 5f70 7970 726f 6a65  ind_user_pyproje
-0000ea40: 6374 5f74 6f6d 6c5f 7769 6e64 6f77 7328  ct_toml_windows(
-0000ea50: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000ea60: 2020 2020 2020 2069 6620 7379 7374 656d         if system
-0000ea70: 2829 2021 3d20 2257 696e 646f 7773 223a  () != "Windows":
-0000ea80: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000ea90: 7572 6e0a 0a20 2020 2020 2020 2075 7365  urn..        use
-0000eaa0: 725f 636f 6e66 6967 5f70 6174 6820 3d20  r_config_path = 
-0000eab0: 5061 7468 2e68 6f6d 6528 2920 2f20 222e  Path.home() / ".
-0000eac0: 626c 6163 6b22 0a20 2020 2020 2020 2073  black".        s
-0000ead0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000eae0: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-0000eaf0: 636b 2e66 696c 6573 2e66 696e 645f 7573  ck.files.find_us
-0000eb00: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
-0000eb10: 6c28 292c 2075 7365 725f 636f 6e66 6967  l(), user_config
-0000eb20: 5f70 6174 682e 7265 736f 6c76 6528 290a  _path.resolve().
-0000eb30: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-0000eb40: 6566 2074 6573 745f 6270 6f5f 3333 3636  ef test_bpo_3366
-0000eb50: 305f 776f 726b 6172 6f75 6e64 2873 656c  0_workaround(sel
-0000eb60: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000eb70: 2020 2020 6966 2073 7973 7465 6d28 2920      if system() 
-0000eb80: 3d3d 2022 5769 6e64 6f77 7322 3a0a 2020  == "Windows":.  
-0000eb90: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000eba0: 0a0a 2020 2020 2020 2020 2320 6874 7470  ..        # http
-0000ebb0: 733a 2f2f 6275 6773 2e70 7974 686f 6e2e  s://bugs.python.
-0000ebc0: 6f72 672f 6973 7375 6533 3336 3630 0a20  org/issue33660. 
-0000ebd0: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
-0000ebe0: 7468 2822 2f22 290a 2020 2020 2020 2020  th("/").        
-0000ebf0: 7769 7468 2063 6861 6e67 655f 6469 7265  with change_dire
-0000ec00: 6374 6f72 7928 726f 6f74 293a 0a20 2020  ctory(root):.   
-0000ec10: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-0000ec20: 5061 7468 2822 776f 726b 7370 6163 6522  Path("workspace"
-0000ec30: 2920 2f20 2270 726f 6a65 6374 220a 2020  ) / "project".  
-0000ec40: 2020 2020 2020 2020 2020 7265 706f 7274            report
-0000ec50: 203d 2062 6c61 636b 2e52 6570 6f72 7428   = black.Report(
-0000ec60: 7665 7262 6f73 653d 5472 7565 290a 2020  verbose=True).  
-0000ec70: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
-0000ec80: 697a 6564 5f70 6174 6820 3d20 626c 6163  ized_path = blac
-0000ec90: 6b2e 6e6f 726d 616c 697a 655f 7061 7468  k.normalize_path
-0000eca0: 5f6d 6179 6265 5f69 676e 6f72 6528 7061  _maybe_ignore(pa
-0000ecb0: 7468 2c20 726f 6f74 2c20 7265 706f 7274  th, root, report
-0000ecc0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000ecd0: 6c66 2e61 7373 6572 7445 7175 616c 286e  lf.assertEqual(n
-0000ece0: 6f72 6d61 6c69 7a65 645f 7061 7468 2c20  ormalized_path, 
-0000ecf0: 2277 6f72 6b73 7061 6365 2f70 726f 6a65  "workspace/proje
-0000ed00: 6374 2229 0a0a 2020 2020 6465 6620 7465  ct")..    def te
-0000ed10: 7374 5f6e 6f72 6d61 6c69 7a65 5f70 6174  st_normalize_pat
-0000ed20: 685f 6967 6e6f 7265 5f77 696e 646f 7773  h_ignore_windows
-0000ed30: 5f6a 756e 6374 696f 6e73 5f6f 7574 7369  _junctions_outsi
-0000ed40: 6465 5f6f 665f 726f 6f74 2873 656c 6629  de_of_root(self)
-0000ed50: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000ed60: 2020 6966 2073 7973 7465 6d28 2920 213d    if system() !=
-0000ed70: 2022 5769 6e64 6f77 7322 3a0a 2020 2020   "Windows":.    
-0000ed80: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-0000ed90: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
-0000eda0: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
-0000edb0: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
-0000edc0: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-0000edd0: 203d 2050 6174 6828 776f 726b 7370 6163   = Path(workspac
-0000ede0: 6529 0a20 2020 2020 2020 2020 2020 206a  e).            j
-0000edf0: 756e 6374 696f 6e5f 6469 7220 3d20 726f  unction_dir = ro
-0000ee00: 6f74 202f 2022 6a75 6e63 7469 6f6e 220a  ot / "junction".
-0000ee10: 2020 2020 2020 2020 2020 2020 6a75 6e63              junc
-0000ee20: 7469 6f6e 5f74 6172 6765 745f 6f75 7473  tion_target_outs
-0000ee30: 6964 655f 6f66 5f72 6f6f 7420 3d20 726f  ide_of_root = ro
-0000ee40: 6f74 202f 2022 2e2e 220a 2020 2020 2020  ot / "..".      
-0000ee50: 2020 2020 2020 6f73 2e73 7973 7465 6d28        os.system(
-0000ee60: 6622 6d6b 6c69 6e6b 202f 4a20 7b6a 756e  f"mklink /J {jun
-0000ee70: 6374 696f 6e5f 6469 727d 207b 6a75 6e63  ction_dir} {junc
-0000ee80: 7469 6f6e 5f74 6172 6765 745f 6f75 7473  tion_target_outs
-0000ee90: 6964 655f 6f66 5f72 6f6f 747d 2229 0a0a  ide_of_root}")..
-0000eea0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-0000eeb0: 7274 203d 2062 6c61 636b 2e52 6570 6f72  rt = black.Repor
-0000eec0: 7428 7665 7262 6f73 653d 5472 7565 290a  t(verbose=True).
-0000eed0: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
-0000eee0: 616c 697a 6564 5f70 6174 6820 3d20 626c  alized_path = bl
-0000eef0: 6163 6b2e 6e6f 726d 616c 697a 655f 7061  ack.normalize_pa
-0000ef00: 7468 5f6d 6179 6265 5f69 676e 6f72 6528  th_maybe_ignore(
-0000ef10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef20: 206a 756e 6374 696f 6e5f 6469 722c 2072   junction_dir, r
-0000ef30: 6f6f 742c 2072 6570 6f72 740a 2020 2020  oot, report.    
-0000ef40: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000ef50: 2020 2020 2020 2320 4d61 6e75 616c 6c79        # Manually
-0000ef60: 2064 656c 6574 6520 666f 7220 5079 7468   delete for Pyth
-0000ef70: 6f6e 203c 2033 2e38 0a20 2020 2020 2020  on < 3.8.       
-0000ef80: 2020 2020 206f 732e 7379 7374 656d 2866       os.system(f
-0000ef90: 2272 6d64 6972 207b 6a75 6e63 7469 6f6e  "rmdir {junction
-0000efa0: 5f64 6972 7d22 290a 0a20 2020 2020 2020  _dir}")..       
-0000efb0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000efc0: 4571 7561 6c28 6e6f 726d 616c 697a 6564  Equal(normalized
-0000efd0: 5f70 6174 682c 204e 6f6e 6529 0a0a 2020  _path, None)..  
-0000efe0: 2020 6465 6620 7465 7374 5f6e 6577 6c69    def test_newli
-0000eff0: 6e65 5f63 6f6d 6d65 6e74 5f69 6e74 6572  ne_comment_inter
-0000f000: 6163 7469 6f6e 2873 656c 6629 202d 3e20  action(self) -> 
-0000f010: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
-0000f020: 7572 6365 203d 2022 636c 6173 7320 413a  urce = "class A:
-0000f030: 5c5c 5c72 5c6e 2320 7479 7065 3a20 6967  \\\r\n# type: ig
-0000f040: 6e6f 7265 5c6e 2070 6173 735c 6e22 0a20  nore\n pass\n". 
-0000f050: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
-0000f060: 626c 6163 6b2e 666f 726d 6174 5f73 7472  black.format_str
-0000f070: 2873 6f75 7263 652c 206d 6f64 653d 4445  (source, mode=DE
-0000f080: 4641 554c 545f 4d4f 4445 290a 2020 2020  FAULT_MODE).    
-0000f090: 2020 2020 626c 6163 6b2e 6173 7365 7274      black.assert
-0000f0a0: 5f73 7461 626c 6528 736f 7572 6365 2c20  _stable(source, 
-0000f0b0: 6f75 7470 7574 2c20 6d6f 6465 3d44 4546  output, mode=DEF
-0000f0c0: 4155 4c54 5f4d 4f44 4529 0a0a 2020 2020  AULT_MODE)..    
-0000f0d0: 6465 6620 7465 7374 5f62 706f 5f32 3134  def test_bpo_214
-0000f0e0: 325f 776f 726b 6172 6f75 6e64 2873 656c  2_workaround(sel
-0000f0f0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000f100: 2020 2020 2320 6874 7470 733a 2f2f 6275      # https://bu
-0000f110: 6773 2e70 7974 686f 6e2e 6f72 672f 6973  gs.python.org/is
-0000f120: 7375 6532 3134 320a 0a20 2020 2020 2020  sue2142..       
-0000f130: 2073 6f75 7263 652c 205f 203d 2072 6561   source, _ = rea
-0000f140: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
-0000f150: 6e65 6f75 7322 2c20 226d 6973 7369 6e67  neous", "missing
-0000f160: 5f66 696e 616c 5f6e 6577 6c69 6e65 2229  _final_newline")
-0000f170: 0a20 2020 2020 2020 2023 2072 6561 645f  .        # read_
-0000f180: 6461 7461 2061 6464 7320 6120 7472 6169  data adds a trai
-0000f190: 6c69 6e67 206e 6577 6c69 6e65 0a20 2020  ling newline.   
-0000f1a0: 2020 2020 2073 6f75 7263 6520 3d20 736f       source = so
-0000f1b0: 7572 6365 2e72 7374 7269 7028 290a 2020  urce.rstrip().  
-0000f1c0: 2020 2020 2020 6578 7065 6374 6564 2c20        expected, 
-0000f1d0: 5f20 3d20 7265 6164 5f64 6174 6128 226d  _ = read_data("m
-0000f1e0: 6973 6365 6c6c 616e 656f 7573 222c 2022  iscellaneous", "
-0000f1f0: 6d69 7373 696e 675f 6669 6e61 6c5f 6e65  missing_final_ne
-0000f200: 776c 696e 652e 6469 6666 2229 0a20 2020  wline.diff").   
-0000f210: 2020 2020 2074 6d70 5f66 696c 6520 3d20       tmp_file = 
-0000f220: 5061 7468 2862 6c61 636b 2e64 756d 705f  Path(black.dump_
-0000f230: 746f 5f66 696c 6528 736f 7572 6365 2c20  to_file(source, 
-0000f240: 656e 7375 7265 5f66 696e 616c 5f6e 6577  ensure_final_new
-0000f250: 6c69 6e65 3d46 616c 7365 2929 0a20 2020  line=False)).   
-0000f260: 2020 2020 2064 6966 665f 6865 6164 6572       diff_header
-0000f270: 203d 2072 652e 636f 6d70 696c 6528 0a20   = re.compile(. 
-0000f280: 2020 2020 2020 2020 2020 2072 6622 7b72             rf"{r
-0000f290: 652e 6573 6361 7065 2873 7472 2874 6d70  e.escape(str(tmp
-0000f2a0: 5f66 696c 6529 297d 5c74 5c64 5c64 5c64  _file))}\t\d\d\d
-0000f2b0: 5c64 2d5c 645c 642d 5c64 5c64 2022 0a20  \d-\d\d-\d\d ". 
-0000f2c0: 2020 2020 2020 2020 2020 2072 225c 645c             r"\d\
-0000f2d0: 643a 5c64 5c64 3a5c 645c 645c 2e5c 645c  d:\d\d:\d\d\.\d\
-0000f2e0: 645c 645c 645c 645c 6420 5c2b 5c64 5c64  d\d\d\d\d \+\d\d
-0000f2f0: 5c64 5c64 220a 2020 2020 2020 2020 290a  \d\d".        ).
-0000f300: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000f310: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-0000f320: 3d20 426c 6163 6b52 756e 6e65 7228 292e  = BlackRunner().
-0000f330: 696e 766f 6b65 2862 6c61 636b 2e6d 6169  invoke(black.mai
-0000f340: 6e2c 205b 222d 2d64 6966 6622 2c20 7374  n, ["--diff", st
-0000f350: 7228 746d 705f 6669 6c65 295d 290a 2020  r(tmp_file)]).  
-0000f360: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000f370: 7373 6572 7445 7175 616c 2872 6573 756c  ssertEqual(resul
-0000f380: 742e 6578 6974 5f63 6f64 652c 2030 290a  t.exit_code, 0).
-0000f390: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
-0000f3a0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-0000f3b0: 756e 6c69 6e6b 2874 6d70 5f66 696c 6529  unlink(tmp_file)
-0000f3c0: 0a20 2020 2020 2020 2061 6374 7561 6c20  .        actual 
-0000f3d0: 3d20 7265 7375 6c74 2e6f 7574 7075 740a  = result.output.
-0000f3e0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-0000f3f0: 2064 6966 665f 6865 6164 6572 2e73 7562   diff_header.sub
-0000f400: 2844 4554 4552 4d49 4e49 5354 4943 5f48  (DETERMINISTIC_H
-0000f410: 4541 4445 522c 2061 6374 7561 6c29 0a20  EADER, actual). 
-0000f420: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000f430: 7274 4571 7561 6c28 6163 7475 616c 2c20  rtEqual(actual, 
-0000f440: 6578 7065 6374 6564 290a 0a20 2020 2040  expected)..    @
-0000f450: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-0000f460: 2064 6566 2063 6f6d 7061 7265 5f72 6573   def compare_res
-0000f470: 756c 7473 280a 2020 2020 2020 2020 7265  ults(.        re
-0000f480: 7375 6c74 3a20 636c 6963 6b2e 7465 7374  sult: click.test
-0000f490: 696e 672e 5265 7375 6c74 2c20 6578 7065  ing.Result, expe
-0000f4a0: 6374 6564 5f76 616c 7565 3a20 7374 722c  cted_value: str,
-0000f4b0: 2065 7870 6563 7465 645f 6578 6974 5f63   expected_exit_c
-0000f4c0: 6f64 653a 2069 6e74 0a20 2020 2029 202d  ode: int.    ) -
-0000f4d0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000f4e0: 2222 2248 656c 7065 7220 6d65 7468 6f64  """Helper method
-0000f4f0: 2074 6f20 7465 7374 2074 6865 2076 616c   to test the val
-0000f500: 7565 2061 6e64 2065 7869 7420 636f 6465  ue and exit code
-0000f510: 206f 6620 6120 636c 6963 6b20 5265 7375   of a click Resu
-0000f520: 6c74 2e22 2222 0a20 2020 2020 2020 2061  lt.""".        a
-0000f530: 7373 6572 7420 280a 2020 2020 2020 2020  ssert (.        
-0000f540: 2020 2020 7265 7375 6c74 2e6f 7574 7075      result.outpu
-0000f550: 7420 3d3d 2065 7870 6563 7465 645f 7661  t == expected_va
-0000f560: 6c75 650a 2020 2020 2020 2020 292c 2022  lue.        ), "
-0000f570: 5468 6520 6f75 7470 7574 2064 6964 206e  The output did n
-0000f580: 6f74 206d 6174 6368 2074 6865 2065 7870  ot match the exp
-0000f590: 6563 7465 6420 7661 6c75 652e 220a 2020  ected value.".  
-0000f5a0: 2020 2020 2020 6173 7365 7274 2072 6573        assert res
-0000f5b0: 756c 742e 6578 6974 5f63 6f64 6520 3d3d  ult.exit_code ==
-0000f5c0: 2065 7870 6563 7465 645f 6578 6974 5f63   expected_exit_c
-0000f5d0: 6f64 652c 2022 5468 6520 6578 6974 2063  ode, "The exit c
-0000f5e0: 6f64 6520 6973 2069 6e63 6f72 7265 6374  ode is incorrect
-0000f5f0: 2e22 0a0a 2020 2020 6465 6620 7465 7374  ."..    def test
-0000f600: 5f63 6f64 655f 6f70 7469 6f6e 2873 656c  _code_option(sel
-0000f610: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0000f620: 2020 2020 2222 2254 6573 7420 7468 6520      """Test the 
-0000f630: 636f 6465 206f 7074 696f 6e20 7769 7468  code option with
-0000f640: 206e 6f20 6368 616e 6765 732e 2222 220a   no changes.""".
-0000f650: 2020 2020 2020 2020 636f 6465 203d 2027          code = '
-0000f660: 7072 696e 7428 2248 656c 6c6f 2077 6f72  print("Hello wor
-0000f670: 6c64 2229 5c6e 270a 2020 2020 2020 2020  ld")\n'.        
-0000f680: 6172 6773 203d 205b 222d 2d63 6f64 6522  args = ["--code"
-0000f690: 2c20 636f 6465 5d0a 2020 2020 2020 2020  , code].        
-0000f6a0: 7265 7375 6c74 203d 2043 6c69 5275 6e6e  result = CliRunn
-0000f6b0: 6572 2829 2e69 6e76 6f6b 6528 626c 6163  er().invoke(blac
-0000f6c0: 6b2e 6d61 696e 2c20 6172 6773 290a 0a20  k.main, args).. 
-0000f6d0: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
-0000f6e0: 6172 655f 7265 7375 6c74 7328 7265 7375  are_results(resu
-0000f6f0: 6c74 2c20 636f 6465 2c20 3029 0a0a 2020  lt, code, 0)..  
-0000f700: 2020 6465 6620 7465 7374 5f63 6f64 655f    def test_code_
-0000f710: 6f70 7469 6f6e 5f63 6861 6e67 6564 2873  option_changed(s
-0000f720: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000f730: 2020 2020 2020 2222 2254 6573 7420 7468        """Test th
-0000f740: 6520 636f 6465 206f 7074 696f 6e20 7768  e code option wh
-0000f750: 656e 2063 6861 6e67 6573 2061 7265 2072  en changes are r
-0000f760: 6571 7569 7265 642e 2222 220a 2020 2020  equired.""".    
-0000f770: 2020 2020 636f 6465 203d 2022 7072 696e      code = "prin
-0000f780: 7428 2768 656c 6c6f 2077 6f72 6c64 2729  t('hello world')
-0000f790: 220a 2020 2020 2020 2020 666f 726d 6174  ".        format
-0000f7a0: 7465 6420 3d20 626c 6163 6b2e 666f 726d  ted = black.form
-0000f7b0: 6174 5f73 7472 2863 6f64 652c 206d 6f64  at_str(code, mod
-0000f7c0: 653d 4445 4641 554c 545f 4d4f 4445 290a  e=DEFAULT_MODE).
-0000f7d0: 0a20 2020 2020 2020 2061 7267 7320 3d20  .        args = 
-0000f7e0: 5b22 2d2d 636f 6465 222c 2063 6f64 655d  ["--code", code]
-0000f7f0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-0000f800: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
-0000f810: 766f 6b65 2862 6c61 636b 2e6d 6169 6e2c  voke(black.main,
-0000f820: 2061 7267 7329 0a0a 2020 2020 2020 2020   args)..        
-0000f830: 7365 6c66 2e63 6f6d 7061 7265 5f72 6573  self.compare_res
-0000f840: 756c 7473 2872 6573 756c 742c 2066 6f72  ults(result, for
-0000f850: 6d61 7474 6564 2c20 3029 0a0a 2020 2020  matted, 0)..    
-0000f860: 6465 6620 7465 7374 5f63 6f64 655f 6f70  def test_code_op
-0000f870: 7469 6f6e 5f63 6865 636b 2873 656c 6629  tion_check(self)
-0000f880: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000f890: 2020 2222 2254 6573 7420 7468 6520 636f    """Test the co
-0000f8a0: 6465 206f 7074 696f 6e20 7768 656e 2063  de option when c
-0000f8b0: 6865 636b 2069 7320 7061 7373 6564 2e22  heck is passed."
-0000f8c0: 2222 0a20 2020 2020 2020 2061 7267 7320  "".        args 
-0000f8d0: 3d20 5b22 2d2d 6368 6563 6b22 2c20 222d  = ["--check", "-
-0000f8e0: 2d63 6f64 6522 2c20 2770 7269 6e74 2822  -code", 'print("
-0000f8f0: 4865 6c6c 6f20 776f 726c 6422 295c 6e27  Hello world")\n'
-0000f900: 5d0a 2020 2020 2020 2020 7265 7375 6c74  ].        result
-0000f910: 203d 2043 6c69 5275 6e6e 6572 2829 2e69   = CliRunner().i
-0000f920: 6e76 6f6b 6528 626c 6163 6b2e 6d61 696e  nvoke(black.main
-0000f930: 2c20 6172 6773 290a 2020 2020 2020 2020  , args).        
-0000f940: 7365 6c66 2e63 6f6d 7061 7265 5f72 6573  self.compare_res
-0000f950: 756c 7473 2872 6573 756c 742c 2022 222c  ults(result, "",
-0000f960: 2030 290a 0a20 2020 2064 6566 2074 6573   0)..    def tes
-0000f970: 745f 636f 6465 5f6f 7074 696f 6e5f 6368  t_code_option_ch
-0000f980: 6563 6b5f 6368 616e 6765 6428 7365 6c66  eck_changed(self
-0000f990: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000f9a0: 2020 2022 2222 5465 7374 2074 6865 2063     """Test the c
-0000f9b0: 6f64 6520 6f70 7469 6f6e 2077 6865 6e20  ode option when 
-0000f9c0: 6368 616e 6765 7320 6172 6520 7265 7175  changes are requ
-0000f9d0: 6972 6564 2c20 616e 6420 6368 6563 6b20  ired, and check 
-0000f9e0: 6973 2070 6173 7365 642e 2222 220a 2020  is passed.""".  
-0000f9f0: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
-0000fa00: 2d63 6865 636b 222c 2022 2d2d 636f 6465  -check", "--code
-0000fa10: 222c 2022 7072 696e 7428 2768 656c 6c6f  ", "print('hello
-0000fa20: 2077 6f72 6c64 2729 225d 0a20 2020 2020   world')"].     
-0000fa30: 2020 2072 6573 756c 7420 3d20 436c 6952     result = CliR
-0000fa40: 756e 6e65 7228 292e 696e 766f 6b65 2862  unner().invoke(b
-0000fa50: 6c61 636b 2e6d 6169 6e2c 2061 7267 7329  lack.main, args)
-0000fa60: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-0000fa70: 6d70 6172 655f 7265 7375 6c74 7328 7265  mpare_results(re
-0000fa80: 7375 6c74 2c20 2222 2c20 3129 0a0a 2020  sult, "", 1)..  
-0000fa90: 2020 6465 6620 7465 7374 5f63 6f64 655f    def test_code_
-0000faa0: 6f70 7469 6f6e 5f64 6966 6628 7365 6c66  option_diff(self
-0000fab0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000fac0: 2020 2022 2222 5465 7374 2074 6865 2063     """Test the c
-0000fad0: 6f64 6520 6f70 7469 6f6e 2077 6865 6e20  ode option when 
-0000fae0: 6469 6666 2069 7320 7061 7373 6564 2e22  diff is passed."
-0000faf0: 2222 0a20 2020 2020 2020 2063 6f64 6520  "".        code 
-0000fb00: 3d20 2270 7269 6e74 2827 6865 6c6c 6f20  = "print('hello 
-0000fb10: 776f 726c 6427 2922 0a20 2020 2020 2020  world')".       
-0000fb20: 2066 6f72 6d61 7474 6564 203d 2062 6c61   formatted = bla
-0000fb30: 636b 2e66 6f72 6d61 745f 7374 7228 636f  ck.format_str(co
-0000fb40: 6465 2c20 6d6f 6465 3d44 4546 4155 4c54  de, mode=DEFAULT
-0000fb50: 5f4d 4f44 4529 0a20 2020 2020 2020 2072  _MODE).        r
-0000fb60: 6573 756c 745f 6469 6666 203d 2064 6966  esult_diff = dif
-0000fb70: 6628 636f 6465 2c20 666f 726d 6174 7465  f(code, formatte
-0000fb80: 642c 2022 5354 4449 4e22 2c20 2253 5444  d, "STDIN", "STD
-0000fb90: 4f55 5422 290a 0a20 2020 2020 2020 2061  OUT")..        a
-0000fba0: 7267 7320 3d20 5b22 2d2d 6469 6666 222c  rgs = ["--diff",
-0000fbb0: 2022 2d2d 636f 6465 222c 2063 6f64 655d   "--code", code]
-0000fbc0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-0000fbd0: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
-0000fbe0: 766f 6b65 2862 6c61 636b 2e6d 6169 6e2c  voke(black.main,
-0000fbf0: 2061 7267 7329 0a0a 2020 2020 2020 2020   args)..        
-0000fc00: 2320 5265 6d6f 7665 2074 696d 6520 6672  # Remove time fr
-0000fc10: 6f6d 2064 6966 660a 2020 2020 2020 2020  om diff.        
-0000fc20: 6f75 7470 7574 203d 2044 4946 465f 5449  output = DIFF_TI
-0000fc30: 4d45 2e73 7562 2822 222c 2072 6573 756c  ME.sub("", resul
-0000fc40: 742e 6f75 7470 7574 290a 0a20 2020 2020  t.output)..     
-0000fc50: 2020 2061 7373 6572 7420 6f75 7470 7574     assert output
-0000fc60: 203d 3d20 7265 7375 6c74 5f64 6966 662c   == result_diff,
-0000fc70: 2022 5468 6520 6f75 7470 7574 2064 6964   "The output did
-0000fc80: 206e 6f74 206d 6174 6368 2074 6865 2065   not match the e
-0000fc90: 7870 6563 7465 6420 7661 6c75 652e 220a  xpected value.".
-0000fca0: 2020 2020 2020 2020 6173 7365 7274 2072          assert r
-0000fcb0: 6573 756c 742e 6578 6974 5f63 6f64 6520  esult.exit_code 
-0000fcc0: 3d3d 2030 2c20 2254 6865 2065 7869 7420  == 0, "The exit 
-0000fcd0: 636f 6465 2069 7320 696e 636f 7272 6563  code is incorrec
-0000fce0: 742e 220a 0a20 2020 2064 6566 2074 6573  t."..    def tes
-0000fcf0: 745f 636f 6465 5f6f 7074 696f 6e5f 636f  t_code_option_co
-0000fd00: 6c6f 725f 6469 6666 2873 656c 6629 202d  lor_diff(self) -
-0000fd10: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000fd20: 2222 2254 6573 7420 7468 6520 636f 6465  """Test the code
-0000fd30: 206f 7074 696f 6e20 7768 656e 2063 6f6c   option when col
-0000fd40: 6f72 2061 6e64 2064 6966 6620 6172 6520  or and diff are 
-0000fd50: 7061 7373 6564 2e22 2222 0a20 2020 2020  passed.""".     
-0000fd60: 2020 2063 6f64 6520 3d20 2270 7269 6e74     code = "print
-0000fd70: 2827 6865 6c6c 6f20 776f 726c 6427 2922  ('hello world')"
-0000fd80: 0a20 2020 2020 2020 2066 6f72 6d61 7474  .        formatt
-0000fd90: 6564 203d 2062 6c61 636b 2e66 6f72 6d61  ed = black.forma
-0000fda0: 745f 7374 7228 636f 6465 2c20 6d6f 6465  t_str(code, mode
-0000fdb0: 3d44 4546 4155 4c54 5f4d 4f44 4529 0a0a  =DEFAULT_MODE)..
-0000fdc0: 2020 2020 2020 2020 7265 7375 6c74 5f64          result_d
-0000fdd0: 6966 6620 3d20 6469 6666 2863 6f64 652c  iff = diff(code,
-0000fde0: 2066 6f72 6d61 7474 6564 2c20 2253 5444   formatted, "STD
-0000fdf0: 494e 222c 2022 5354 444f 5554 2229 0a20  IN", "STDOUT"). 
-0000fe00: 2020 2020 2020 2072 6573 756c 745f 6469         result_di
-0000fe10: 6666 203d 2063 6f6c 6f72 5f64 6966 6628  ff = color_diff(
-0000fe20: 7265 7375 6c74 5f64 6966 6629 0a0a 2020  result_diff)..  
-0000fe30: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
-0000fe40: 2d64 6966 6622 2c20 222d 2d63 6f6c 6f72  -diff", "--color
-0000fe50: 222c 2022 2d2d 636f 6465 222c 2063 6f64  ", "--code", cod
-0000fe60: 655d 0a20 2020 2020 2020 2072 6573 756c  e].        resul
-0000fe70: 7420 3d20 436c 6952 756e 6e65 7228 292e  t = CliRunner().
-0000fe80: 696e 766f 6b65 2862 6c61 636b 2e6d 6169  invoke(black.mai
-0000fe90: 6e2c 2061 7267 7329 0a0a 2020 2020 2020  n, args)..      
-0000fea0: 2020 2320 5265 6d6f 7665 2074 696d 6520    # Remove time 
-0000feb0: 6672 6f6d 2064 6966 660a 2020 2020 2020  from diff.      
-0000fec0: 2020 6f75 7470 7574 203d 2044 4946 465f    output = DIFF_
-0000fed0: 5449 4d45 2e73 7562 2822 222c 2072 6573  TIME.sub("", res
-0000fee0: 756c 742e 6f75 7470 7574 290a 0a20 2020  ult.output)..   
-0000fef0: 2020 2020 2061 7373 6572 7420 6f75 7470       assert outp
-0000ff00: 7574 203d 3d20 7265 7375 6c74 5f64 6966  ut == result_dif
-0000ff10: 662c 2022 5468 6520 6f75 7470 7574 2064  f, "The output d
-0000ff20: 6964 206e 6f74 206d 6174 6368 2074 6865  id not match the
-0000ff30: 2065 7870 6563 7465 6420 7661 6c75 652e   expected value.
-0000ff40: 220a 2020 2020 2020 2020 6173 7365 7274  ".        assert
-0000ff50: 2072 6573 756c 742e 6578 6974 5f63 6f64   result.exit_cod
-0000ff60: 6520 3d3d 2030 2c20 2254 6865 2065 7869  e == 0, "The exi
-0000ff70: 7420 636f 6465 2069 7320 696e 636f 7272  t code is incorr
-0000ff80: 6563 742e 220a 0a20 2020 2040 7079 7465  ect."..    @pyte
-0000ff90: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
-0000ffa0: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
-0000ffb0: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
-0000ffc0: 655f 6f70 7469 6f6e 5f73 6166 6528 7365  e_option_safe(se
-0000ffd0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000ffe0: 2020 2020 2022 2222 5465 7374 2074 6861       """Test tha
-0000fff0: 7420 7468 6520 636f 6465 206f 7074 696f  t the code optio
-00010000: 6e20 7468 726f 7773 2061 6e20 6572 726f  n throws an erro
-00010010: 7220 7768 656e 2074 6865 2073 616e 6974  r when the sanit
-00010020: 7920 6368 6563 6b73 2066 6169 6c2e 2222  y checks fail.""
-00010030: 220a 2020 2020 2020 2020 2320 5061 7463  ".        # Patc
-00010040: 6820 626c 6163 6b2e 6173 7365 7274 5f65  h black.assert_e
-00010050: 7175 6976 616c 656e 7420 746f 2065 6e73  quivalent to ens
-00010060: 7572 6520 7468 6520 7361 6e69 7479 2063  ure the sanity c
-00010070: 6865 636b 7320 6661 696c 0a20 2020 2020  hecks fail.     
-00010080: 2020 2077 6974 6820 7061 7463 682e 6f62     with patch.ob
-00010090: 6a65 6374 2862 6c61 636b 2c20 2261 7373  ject(black, "ass
-000100a0: 6572 745f 6571 7569 7661 6c65 6e74 222c  ert_equivalent",
-000100b0: 2073 6964 655f 6566 6665 6374 3d41 7373   side_effect=Ass
-000100c0: 6572 7469 6f6e 4572 726f 7229 3a0a 2020  ertionError):.  
-000100d0: 2020 2020 2020 2020 2020 636f 6465 203d            code =
-000100e0: 2027 7072 696e 7428 2248 656c 6c6f 2077   'print("Hello w
-000100f0: 6f72 6c64 2229 270a 2020 2020 2020 2020  orld")'.        
-00010100: 2020 2020 6572 726f 725f 6d73 6720 3d20      error_msg = 
-00010110: 6622 7b63 6f64 657d 5c6e 6572 726f 723a  f"{code}\nerror:
-00010120: 2063 616e 6e6f 7420 666f 726d 6174 203c   cannot format <
-00010130: 7374 7269 6e67 3e3a 205c 6e22 0a0a 2020  string>: \n"..  
-00010140: 2020 2020 2020 2020 2020 6172 6773 203d            args =
-00010150: 205b 222d 2d73 6166 6522 2c20 222d 2d63   ["--safe", "--c
-00010160: 6f64 6522 2c20 636f 6465 5d0a 2020 2020  ode", code].    
-00010170: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00010180: 2043 6c69 5275 6e6e 6572 2829 2e69 6e76   CliRunner().inv
-00010190: 6f6b 6528 626c 6163 6b2e 6d61 696e 2c20  oke(black.main, 
-000101a0: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
-000101b0: 2020 2073 656c 662e 636f 6d70 6172 655f     self.compare_
-000101c0: 7265 7375 6c74 7328 7265 7375 6c74 2c20  results(result, 
-000101d0: 6572 726f 725f 6d73 672c 2031 3233 290a  error_msg, 123).
-000101e0: 0a20 2020 2064 6566 2074 6573 745f 636f  .    def test_co
-000101f0: 6465 5f6f 7074 696f 6e5f 6661 7374 2873  de_option_fast(s
-00010200: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00010210: 2020 2020 2020 2222 2254 6573 7420 7468        """Test th
-00010220: 6174 2074 6865 2063 6f64 6520 6f70 7469  at the code opti
-00010230: 6f6e 2069 676e 6f72 6573 2065 7272 6f72  on ignores error
-00010240: 7320 7768 656e 2074 6865 2073 616e 6974  s when the sanit
-00010250: 7920 6368 6563 6b73 2066 6169 6c2e 2222  y checks fail.""
-00010260: 220a 2020 2020 2020 2020 2320 5061 7463  ".        # Patc
-00010270: 6820 626c 6163 6b2e 6173 7365 7274 5f65  h black.assert_e
-00010280: 7175 6976 616c 656e 7420 746f 2065 6e73  quivalent to ens
-00010290: 7572 6520 7468 6520 7361 6e69 7479 2063  ure the sanity c
-000102a0: 6865 636b 7320 6661 696c 0a20 2020 2020  hecks fail.     
-000102b0: 2020 2077 6974 6820 7061 7463 682e 6f62     with patch.ob
-000102c0: 6a65 6374 2862 6c61 636b 2c20 2261 7373  ject(black, "ass
-000102d0: 6572 745f 6571 7569 7661 6c65 6e74 222c  ert_equivalent",
-000102e0: 2073 6964 655f 6566 6665 6374 3d41 7373   side_effect=Ass
-000102f0: 6572 7469 6f6e 4572 726f 7229 3a0a 2020  ertionError):.  
-00010300: 2020 2020 2020 2020 2020 636f 6465 203d            code =
-00010310: 2027 7072 696e 7428 2248 656c 6c6f 2077   'print("Hello w
-00010320: 6f72 6c64 2229 270a 2020 2020 2020 2020  orld")'.        
-00010330: 2020 2020 666f 726d 6174 7465 6420 3d20      formatted = 
-00010340: 626c 6163 6b2e 666f 726d 6174 5f73 7472  black.format_str
-00010350: 2863 6f64 652c 206d 6f64 653d 4445 4641  (code, mode=DEFA
-00010360: 554c 545f 4d4f 4445 290a 0a20 2020 2020  ULT_MODE)..     
-00010370: 2020 2020 2020 2061 7267 7320 3d20 5b22         args = ["
-00010380: 2d2d 6661 7374 222c 2022 2d2d 636f 6465  --fast", "--code
-00010390: 222c 2063 6f64 655d 0a20 2020 2020 2020  ", code].       
-000103a0: 2020 2020 2072 6573 756c 7420 3d20 436c       result = Cl
-000103b0: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
-000103c0: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
-000103d0: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-000103e0: 7365 6c66 2e63 6f6d 7061 7265 5f72 6573  self.compare_res
-000103f0: 756c 7473 2872 6573 756c 742c 2066 6f72  ults(result, for
-00010400: 6d61 7474 6564 2c20 3029 0a0a 2020 2020  matted, 0)..    
-00010410: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
-00010420: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
-00010430: 7970 7963 0a20 2020 2064 6566 2074 6573  ypyc.    def tes
-00010440: 745f 636f 6465 5f6f 7074 696f 6e5f 636f  t_code_option_co
-00010450: 6e66 6967 2873 656c 6629 202d 3e20 4e6f  nfig(self) -> No
-00010460: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-00010470: 2020 2020 2020 2020 5465 7374 2074 6861          Test tha
-00010480: 7420 7468 6520 636f 6465 206f 7074 696f  t the code optio
-00010490: 6e20 6669 6e64 7320 7468 6520 7079 7072  n finds the pypr
-000104a0: 6f6a 6563 742e 746f 6d6c 2069 6e20 7468  oject.toml in th
-000104b0: 6520 6375 7272 656e 7420 6469 7265 6374  e current direct
-000104c0: 6f72 792e 0a20 2020 2020 2020 2022 2222  ory..        """
-000104d0: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
-000104e0: 7463 682e 6f62 6a65 6374 2862 6c61 636b  tch.object(black
-000104f0: 2c20 2270 6172 7365 5f70 7970 726f 6a65  , "parse_pyproje
-00010500: 6374 5f74 6f6d 6c22 2c20 7265 7475 726e  ct_toml", return
-00010510: 5f76 616c 7565 3d7b 7d29 2061 7320 7061  _value={}) as pa
-00010520: 7273 653a 0a20 2020 2020 2020 2020 2020  rse:.           
-00010530: 2061 7267 7320 3d20 5b22 2d2d 636f 6465   args = ["--code
-00010540: 222c 2022 7072 696e 7422 5d0a 2020 2020  ", "print"].    
-00010550: 2020 2020 2020 2020 2320 5468 6973 2069          # This i
-00010560: 7320 7468 6520 6f6e 6c79 2064 6972 6563  s the only direc
-00010570: 746f 7279 206b 6e6f 776e 2074 6f20 636f  tory known to co
-00010580: 6e74 6169 6e20 6120 7079 7072 6f6a 6563  ntain a pyprojec
-00010590: 742e 746f 6d6c 0a20 2020 2020 2020 2020  t.toml.         
-000105a0: 2020 2077 6974 6820 6368 616e 6765 5f64     with change_d
-000105b0: 6972 6563 746f 7279 2850 524f 4a45 4354  irectory(PROJECT
-000105c0: 5f52 4f4f 5429 3a0a 2020 2020 2020 2020  _ROOT):.        
-000105d0: 2020 2020 2020 2020 436c 6952 756e 6e65          CliRunne
-000105e0: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
-000105f0: 2e6d 6169 6e2c 2061 7267 7329 0a20 2020  .main, args).   
-00010600: 2020 2020 2020 2020 2020 2020 2070 7970               pyp
-00010610: 726f 6a65 6374 5f70 6174 6820 3d20 5061  roject_path = Pa
-00010620: 7468 2850 6174 682e 6377 6428 292c 2022  th(Path.cwd(), "
-00010630: 7079 7072 6f6a 6563 742e 746f 6d6c 2229  pyproject.toml")
-00010640: 2e72 6573 6f6c 7665 2829 0a0a 2020 2020  .resolve()..    
-00010650: 2020 2020 2020 2020 6173 7365 7274 2028          assert (
-00010660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010670: 206c 656e 2870 6172 7365 2e6d 6f63 6b5f   len(parse.mock_
-00010680: 6361 6c6c 7329 203e 3d20 310a 2020 2020  calls) >= 1.    
-00010690: 2020 2020 2020 2020 292c 2022 4578 7065          ), "Expe
-000106a0: 6374 6564 2063 6f6e 6669 6720 7061 7273  cted config pars
-000106b0: 6520 746f 2062 6520 6361 6c6c 6564 2077  e to be called w
-000106c0: 6974 6820 7468 6520 6375 7272 656e 7420  ith the current 
-000106d0: 6469 7265 6374 6f72 792e 220a 0a20 2020  directory."..   
-000106e0: 2020 2020 2020 2020 205f 2c20 6361 6c6c           _, call
-000106f0: 5f61 7267 732c 205f 203d 2070 6172 7365  _args, _ = parse
-00010700: 2e6d 6f63 6b5f 6361 6c6c 735b 305d 0a20  .mock_calls[0]. 
-00010710: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00010720: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
-00010730: 2020 2020 6361 6c6c 5f61 7267 735b 305d      call_args[0]
-00010740: 2e6c 6f77 6572 2829 203d 3d20 7374 7228  .lower() == str(
-00010750: 7079 7072 6f6a 6563 745f 7061 7468 292e  pyproject_path).
-00010760: 6c6f 7765 7228 290a 2020 2020 2020 2020  lower().        
-00010770: 2020 2020 292c 2022 496e 636f 7272 6563      ), "Incorrec
-00010780: 7420 636f 6e66 6967 206c 6f61 6465 642e  t config loaded.
-00010790: 220a 0a20 2020 2040 7079 7465 7374 2e6d  "..    @pytest.m
-000107a0: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
-000107b0: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
-000107c0: 6465 6620 7465 7374 5f63 6f64 655f 6f70  def test_code_op
-000107d0: 7469 6f6e 5f70 6172 656e 745f 636f 6e66  tion_parent_conf
-000107e0: 6967 2873 656c 6629 202d 3e20 4e6f 6e65  ig(self) -> None
-000107f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00010800: 2020 2020 2020 5465 7374 2074 6861 7420        Test that 
-00010810: 7468 6520 636f 6465 206f 7074 696f 6e20  the code option 
-00010820: 6669 6e64 7320 7468 6520 7079 7072 6f6a  finds the pyproj
-00010830: 6563 742e 746f 6d6c 2069 6e20 7468 6520  ect.toml in the 
-00010840: 7061 7265 6e74 2064 6972 6563 746f 7279  parent directory
-00010850: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00010860: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
-00010870: 2e6f 626a 6563 7428 626c 6163 6b2c 2022  .object(black, "
-00010880: 7061 7273 655f 7079 7072 6f6a 6563 745f  parse_pyproject_
-00010890: 746f 6d6c 222c 2072 6574 7572 6e5f 7661  toml", return_va
-000108a0: 6c75 653d 7b7d 2920 6173 2070 6172 7365  lue={}) as parse
-000108b0: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
-000108c0: 7468 2063 6861 6e67 655f 6469 7265 6374  th change_direct
-000108d0: 6f72 7928 5448 4953 5f44 4952 293a 0a20  ory(THIS_DIR):. 
-000108e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000108f0: 7267 7320 3d20 5b22 2d2d 636f 6465 222c  rgs = ["--code",
-00010900: 2022 7072 696e 7422 5d0a 2020 2020 2020   "print"].      
-00010910: 2020 2020 2020 2020 2020 436c 6952 756e            CliRun
-00010920: 6e65 7228 292e 696e 766f 6b65 2862 6c61  ner().invoke(bla
-00010930: 636b 2e6d 6169 6e2c 2061 7267 7329 0a0a  ck.main, args)..
-00010940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010950: 7079 7072 6f6a 6563 745f 7061 7468 203d  pyproject_path =
-00010960: 2050 6174 6828 5061 7468 2829 2e63 7764   Path(Path().cwd
-00010970: 2829 2e70 6172 656e 742c 2022 7079 7072  ().parent, "pypr
-00010980: 6f6a 6563 742e 746f 6d6c 2229 2e72 6573  oject.toml").res
-00010990: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
-000109a0: 2020 2020 2020 2061 7373 6572 7420 280a         assert (.
-000109b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109c0: 2020 2020 6c65 6e28 7061 7273 652e 6d6f      len(parse.mo
-000109d0: 636b 5f63 616c 6c73 2920 3e3d 2031 0a20  ck_calls) >= 1. 
-000109e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000109f0: 2c20 2245 7870 6563 7465 6420 636f 6e66  , "Expected conf
-00010a00: 6967 2070 6172 7365 2074 6f20 6265 2063  ig parse to be c
-00010a10: 616c 6c65 6420 7769 7468 2074 6865 2063  alled with the c
-00010a20: 7572 7265 6e74 2064 6972 6563 746f 7279  urrent directory
-00010a30: 2e22 0a0a 2020 2020 2020 2020 2020 2020  ."..            
-00010a40: 2020 2020 5f2c 2063 616c 6c5f 6172 6773      _, call_args
-00010a50: 2c20 5f20 3d20 7061 7273 652e 6d6f 636b  , _ = parse.mock
-00010a60: 5f63 616c 6c73 5b30 5d0a 2020 2020 2020  _calls[0].      
-00010a70: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00010a80: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00010a90: 2020 2020 2020 2063 616c 6c5f 6172 6773         call_args
-00010aa0: 5b30 5d2e 6c6f 7765 7228 2920 3d3d 2073  [0].lower() == s
-00010ab0: 7472 2870 7970 726f 6a65 6374 5f70 6174  tr(pyproject_pat
-00010ac0: 6829 2e6c 6f77 6572 2829 0a20 2020 2020  h).lower().     
-00010ad0: 2020 2020 2020 2020 2020 2029 2c20 2249             ), "I
-00010ae0: 6e63 6f72 7265 6374 2063 6f6e 6669 6720  ncorrect config 
-00010af0: 6c6f 6164 6564 2e22 0a0a 2020 2020 6465  loaded."..    de
-00010b00: 6620 7465 7374 5f66 6f72 5f68 616e 646c  f test_for_handl
-00010b10: 6564 5f75 6e65 7870 6563 7465 645f 656f  ed_unexpected_eo
-00010b20: 665f 6572 726f 7228 7365 6c66 2920 2d3e  f_error(self) ->
-00010b30: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00010b40: 2222 0a20 2020 2020 2020 2054 6573 7420  "".        Test 
-00010b50: 7468 6174 2061 6e20 756e 6578 7065 6374  that an unexpect
-00010b60: 6564 2045 4f46 2053 796e 7461 7845 7272  ed EOF SyntaxErr
-00010b70: 6f72 2069 7320 6e69 6365 6c79 2070 7265  or is nicely pre
-00010b80: 7365 6e74 6564 2e0a 2020 2020 2020 2020  sented..        
-00010b90: 2222 220a 2020 2020 2020 2020 7769 7468  """.        with
-00010ba0: 2070 7974 6573 742e 7261 6973 6573 2862   pytest.raises(b
-00010bb0: 6c61 636b 2e70 6172 7369 6e67 2e49 6e76  lack.parsing.Inv
-00010bc0: 616c 6964 496e 7075 7429 2061 7320 6578  alidInput) as ex
-00010bd0: 635f 696e 666f 3a0a 2020 2020 2020 2020  c_info:.        
-00010be0: 2020 2020 626c 6163 6b2e 6c69 6232 746f      black.lib2to
-00010bf0: 335f 7061 7273 6528 2270 7269 6e74 2822  3_parse("print("
-00010c00: 2c20 7b7d 290a 0a20 2020 2020 2020 2065  , {})..        e
-00010c10: 7863 5f69 6e66 6f2e 6d61 7463 6828 2243  xc_info.match("C
-00010c20: 616e 6e6f 7420 7061 7273 653a 2032 3a30  annot parse: 2:0
-00010c30: 3a20 454f 4620 696e 206d 756c 7469 2d6c  : EOF in multi-l
-00010c40: 696e 6520 7374 6174 656d 656e 7422 290a  ine statement").
-00010c50: 0a20 2020 2064 6566 2074 6573 745f 6571  .    def test_eq
-00010c60: 7569 7661 6c65 6e63 795f 6173 745f 7061  uivalency_ast_pa
-00010c70: 7273 655f 6661 696c 7572 655f 696e 636c  rse_failure_incl
-00010c80: 7564 6573 5f65 7272 6f72 2873 656c 6629  udes_error(self)
-00010c90: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00010ca0: 2020 7769 7468 2070 7974 6573 742e 7261    with pytest.ra
-00010cb0: 6973 6573 2841 7373 6572 7469 6f6e 4572  ises(AssertionEr
-00010cc0: 726f 7229 2061 7320 6572 723a 0a20 2020  ror) as err:.   
-00010cd0: 2020 2020 2020 2020 2062 6c61 636b 2e61           black.a
-00010ce0: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
-00010cf0: 2822 61c2 abc2 bb61 2020 3d20 3122 2c20  ("a....a  = 1", 
-00010d00: 2261 c2ab c2bb 6120 203d 2031 2229 0a0a  "a....a  = 1")..
-00010d10: 2020 2020 2020 2020 6572 722e 6d61 7463          err.matc
-00010d20: 6828 222d 2d73 6166 6522 290a 2020 2020  h("--safe").    
-00010d30: 2020 2020 2320 556e 666f 7274 756e 6174      # Unfortunat
-00010d40: 656c 7920 7468 6520 5379 6e74 6178 4572  ely the SyntaxEr
-00010d50: 726f 7220 6d65 7373 6167 6520 6861 7320  ror message has 
-00010d60: 6368 616e 6765 6420 696e 206e 6577 6572  changed in newer
-00010d70: 2076 6572 7369 6f6e 7320 736f 2077 650a   versions so we.
-00010d80: 2020 2020 2020 2020 2320 6361 6e27 7420          # can't 
-00010d90: 6d61 7463 6820 6974 2064 6972 6563 746c  match it directl
-00010da0: 792e 0a20 2020 2020 2020 2065 7272 2e6d  y..        err.m
-00010db0: 6174 6368 2822 696e 7661 6c69 6420 6368  atch("invalid ch
-00010dc0: 6172 6163 7465 7222 290a 2020 2020 2020  aracter").      
-00010dd0: 2020 6572 722e 6d61 7463 6828 7222 5c28    err.match(r"\(
-00010de0: 3c75 6e6b 6e6f 776e 3e2c 206c 696e 6520  <unknown>, line 
-00010df0: 315c 2922 290a 0a0a 636c 6173 7320 5465  1\)")...class Te
-00010e00: 7374 4361 6368 696e 673a 0a20 2020 2064  stCaching:.    d
-00010e10: 6566 2074 6573 745f 6765 745f 6361 6368  ef test_get_cach
-00010e20: 655f 6469 7228 0a20 2020 2020 2020 2073  e_dir(.        s
-00010e30: 656c 662c 0a20 2020 2020 2020 2074 6d70  elf,.        tmp
-00010e40: 5f70 6174 683a 2050 6174 682c 0a20 2020  _path: Path,.   
-00010e50: 2020 2020 206d 6f6e 6b65 7970 6174 6368       monkeypatch
-00010e60: 3a20 7079 7465 7374 2e4d 6f6e 6b65 7950  : pytest.MonkeyP
-00010e70: 6174 6368 2c0a 2020 2020 2920 2d3e 204e  atch,.    ) -> N
-00010e80: 6f6e 653a 0a20 2020 2020 2020 2023 2043  one:.        # C
-00010e90: 7265 6174 6520 6d75 6c74 6970 6c65 2063  reate multiple c
-00010ea0: 6163 6865 2064 6972 6563 746f 7269 6573  ache directories
-00010eb0: 0a20 2020 2020 2020 2077 6f72 6b73 7061  .        workspa
-00010ec0: 6365 3120 3d20 746d 705f 7061 7468 202f  ce1 = tmp_path /
-00010ed0: 2022 7773 3122 0a20 2020 2020 2020 2077   "ws1".        w
-00010ee0: 6f72 6b73 7061 6365 312e 6d6b 6469 7228  orkspace1.mkdir(
-00010ef0: 290a 2020 2020 2020 2020 776f 726b 7370  ).        worksp
-00010f00: 6163 6532 203d 2074 6d70 5f70 6174 6820  ace2 = tmp_path 
-00010f10: 2f20 2277 7332 220a 2020 2020 2020 2020  / "ws2".        
-00010f20: 776f 726b 7370 6163 6532 2e6d 6b64 6972  workspace2.mkdir
-00010f30: 2829 0a0a 2020 2020 2020 2020 2320 466f  ()..        # Fo
-00010f40: 7263 6520 7573 6572 5f63 6163 6865 5f64  rce user_cache_d
-00010f50: 6972 2074 6f20 7573 6520 7468 6520 7465  ir to use the te
-00010f60: 6d70 6f72 6172 7920 6469 7265 6374 6f72  mporary director
-00010f70: 7920 666f 7220 6561 7369 6572 2061 7373  y for easier ass
-00010f80: 6572 7469 6f6e 730a 2020 2020 2020 2020  ertions.        
-00010f90: 7061 7463 685f 7573 6572 5f63 6163 6865  patch_user_cache
-00010fa0: 5f64 6972 203d 2070 6174 6368 280a 2020  _dir = patch(.  
-00010fb0: 2020 2020 2020 2020 2020 7461 7267 6574            target
-00010fc0: 3d22 626c 6163 6b2e 6361 6368 652e 7573  ="black.cache.us
-00010fd0: 6572 5f63 6163 6865 5f64 6972 222c 0a20  er_cache_dir",. 
-00010fe0: 2020 2020 2020 2020 2020 2061 7574 6f73             autos
-00010ff0: 7065 633d 5472 7565 2c0a 2020 2020 2020  pec=True,.      
-00011000: 2020 2020 2020 7265 7475 726e 5f76 616c        return_val
-00011010: 7565 3d73 7472 2877 6f72 6b73 7061 6365  ue=str(workspace
-00011020: 3129 2c0a 2020 2020 2020 2020 290a 0a20  1),.        ).. 
-00011030: 2020 2020 2020 2023 2049 6620 424c 4143         # If BLAC
-00011040: 4b5f 4341 4348 455f 4449 5220 6973 206e  K_CACHE_DIR is n
-00011050: 6f74 2073 6574 2c20 7573 6520 7573 6572  ot set, use user
-00011060: 5f63 6163 6865 5f64 6972 0a20 2020 2020  _cache_dir.     
-00011070: 2020 206d 6f6e 6b65 7970 6174 6368 2e64     monkeypatch.d
-00011080: 656c 656e 7628 2242 4c41 434b 5f43 4143  elenv("BLACK_CAC
-00011090: 4845 5f44 4952 222c 2072 6169 7369 6e67  HE_DIR", raising
-000110a0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-000110b0: 7769 7468 2070 6174 6368 5f75 7365 725f  with patch_user_
-000110c0: 6361 6368 655f 6469 723a 0a20 2020 2020  cache_dir:.     
-000110d0: 2020 2020 2020 2061 7373 6572 7420 6765         assert ge
-000110e0: 745f 6361 6368 655f 6469 7228 2920 3d3d  t_cache_dir() ==
-000110f0: 2077 6f72 6b73 7061 6365 310a 0a20 2020   workspace1..   
-00011100: 2020 2020 2023 2049 6620 6974 2069 7320       # If it is 
-00011110: 7365 742c 2075 7365 2074 6865 2070 6174  set, use the pat
-00011120: 6820 7072 6f76 6964 6564 2069 6e20 7468  h provided in th
-00011130: 6520 656e 7620 7661 722e 0a20 2020 2020  e env var..     
-00011140: 2020 206d 6f6e 6b65 7970 6174 6368 2e73     monkeypatch.s
-00011150: 6574 656e 7628 2242 4c41 434b 5f43 4143  etenv("BLACK_CAC
-00011160: 4845 5f44 4952 222c 2073 7472 2877 6f72  HE_DIR", str(wor
-00011170: 6b73 7061 6365 3229 290a 2020 2020 2020  kspace2)).      
-00011180: 2020 6173 7365 7274 2067 6574 5f63 6163    assert get_cac
-00011190: 6865 5f64 6972 2829 203d 3d20 776f 726b  he_dir() == work
-000111a0: 7370 6163 6532 0a0a 2020 2020 6465 6620  space2..    def 
-000111b0: 7465 7374 5f63 6163 6865 5f62 726f 6b65  test_cache_broke
-000111c0: 6e5f 6669 6c65 2873 656c 6629 202d 3e20  n_file(self) -> 
-000111d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d6f  None:.        mo
-000111e0: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
-000111f0: 450a 2020 2020 2020 2020 7769 7468 2063  E.        with c
-00011200: 6163 6865 5f64 6972 2829 2061 7320 776f  ache_dir() as wo
-00011210: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
-00011220: 2020 2020 2063 6163 6865 5f66 696c 6520       cache_file 
-00011230: 3d20 6765 745f 6361 6368 655f 6669 6c65  = get_cache_file
-00011240: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
-00011250: 2020 2063 6163 6865 5f66 696c 652e 7772     cache_file.wr
-00011260: 6974 655f 7465 7874 2822 7468 6973 2069  ite_text("this i
-00011270: 7320 6e6f 7420 6120 7069 636b 6c65 2229  s not a pickle")
-00011280: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00011290: 6572 7420 626c 6163 6b2e 7265 6164 5f63  ert black.read_c
-000112a0: 6163 6865 286d 6f64 6529 203d 3d20 7b7d  ache(mode) == {}
-000112b0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-000112c0: 203d 2028 776f 726b 7370 6163 6520 2f20   = (workspace / 
-000112d0: 2274 6573 742e 7079 2229 2e72 6573 6f6c  "test.py").resol
-000112e0: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
-000112f0: 2073 7263 2e77 7269 7465 5f74 6578 7428   src.write_text(
-00011300: 2270 7269 6e74 2827 6865 6c6c 6f27 2922  "print('hello')"
-00011310: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-00011320: 766f 6b65 426c 6163 6b28 5b73 7472 2873  vokeBlack([str(s
-00011330: 7263 295d 290a 2020 2020 2020 2020 2020  rc)]).          
-00011340: 2020 6361 6368 6520 3d20 626c 6163 6b2e    cache = black.
-00011350: 7265 6164 5f63 6163 6865 286d 6f64 6529  read_cache(mode)
-00011360: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00011370: 6572 7420 7374 7228 7372 6329 2069 6e20  ert str(src) in 
-00011380: 6361 6368 650a 0a20 2020 2064 6566 2074  cache..    def t
-00011390: 6573 745f 6361 6368 655f 7369 6e67 6c65  est_cache_single
-000113a0: 5f66 696c 655f 616c 7265 6164 795f 6361  _file_already_ca
-000113b0: 6368 6564 2873 656c 6629 202d 3e20 4e6f  ched(self) -> No
-000113c0: 6e65 3a0a 2020 2020 2020 2020 6d6f 6465  ne:.        mode
-000113d0: 203d 2044 4546 4155 4c54 5f4d 4f44 450a   = DEFAULT_MODE.
-000113e0: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
-000113f0: 6865 5f64 6972 2829 2061 7320 776f 726b  he_dir() as work
-00011400: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
-00011410: 2020 2073 7263 203d 2028 776f 726b 7370     src = (worksp
-00011420: 6163 6520 2f20 2274 6573 742e 7079 2229  ace / "test.py")
-00011430: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-00011440: 2020 2020 2020 2073 7263 2e77 7269 7465         src.write
-00011450: 5f74 6578 7428 2270 7269 6e74 2827 6865  _text("print('he
-00011460: 6c6c 6f27 2922 290a 2020 2020 2020 2020  llo')").        
-00011470: 2020 2020 626c 6163 6b2e 7772 6974 655f      black.write_
-00011480: 6361 6368 6528 7b7d 2c20 5b73 7263 5d2c  cache({}, [src],
-00011490: 206d 6f64 6529 0a20 2020 2020 2020 2020   mode).         
-000114a0: 2020 2069 6e76 6f6b 6542 6c61 636b 285b     invokeBlack([
-000114b0: 7374 7228 7372 6329 5d29 0a20 2020 2020  str(src)]).     
-000114c0: 2020 2020 2020 2061 7373 6572 7420 7372         assert sr
-000114d0: 632e 7265 6164 5f74 6578 7428 2920 3d3d  c.read_text() ==
-000114e0: 2022 7072 696e 7428 2768 656c 6c6f 2729   "print('hello')
-000114f0: 220a 0a20 2020 2040 6576 656e 745f 6c6f  "..    @event_lo
-00011500: 6f70 2829 0a20 2020 2064 6566 2074 6573  op().    def tes
-00011510: 745f 6361 6368 655f 6d75 6c74 6970 6c65  t_cache_multiple
-00011520: 5f66 696c 6573 2873 656c 6629 202d 3e20  _files(self) -> 
-00011530: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d6f  None:.        mo
-00011540: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
-00011550: 450a 2020 2020 2020 2020 7769 7468 2063  E.        with c
-00011560: 6163 6865 5f64 6972 2829 2061 7320 776f  ache_dir() as wo
-00011570: 726b 7370 6163 652c 2070 6174 6368 280a  rkspace, patch(.
-00011580: 2020 2020 2020 2020 2020 2020 2263 6f6e              "con
-00011590: 6375 7272 656e 742e 6675 7475 7265 732e  current.futures.
-000115a0: 5072 6f63 6573 7350 6f6f 6c45 7865 6375  ProcessPoolExecu
-000115b0: 746f 7222 2c20 6e65 773d 5468 7265 6164  tor", new=Thread
-000115c0: 506f 6f6c 4578 6563 7574 6f72 0a20 2020  PoolExecutor.   
-000115d0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-000115e0: 2020 2020 6f6e 6520 3d20 2877 6f72 6b73      one = (works
-000115f0: 7061 6365 202f 2022 6f6e 652e 7079 2229  pace / "one.py")
-00011600: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-00011610: 2020 2020 2020 2077 6974 6820 6f6e 652e         with one.
-00011620: 6f70 656e 2822 7722 2920 6173 2066 6f62  open("w") as fob
-00011630: 6a3a 0a20 2020 2020 2020 2020 2020 2020  j:.             
-00011640: 2020 2066 6f62 6a2e 7772 6974 6528 2270     fobj.write("p
-00011650: 7269 6e74 2827 6865 6c6c 6f27 2922 290a  rint('hello')").
-00011660: 2020 2020 2020 2020 2020 2020 7477 6f20              two 
-00011670: 3d20 2877 6f72 6b73 7061 6365 202f 2022  = (workspace / "
-00011680: 7477 6f2e 7079 2229 2e72 6573 6f6c 7665  two.py").resolve
-00011690: 2829 0a20 2020 2020 2020 2020 2020 2077  ().            w
-000116a0: 6974 6820 7477 6f2e 6f70 656e 2822 7722  ith two.open("w"
-000116b0: 2920 6173 2066 6f62 6a3a 0a20 2020 2020  ) as fobj:.     
-000116c0: 2020 2020 2020 2020 2020 2066 6f62 6a2e             fobj.
-000116d0: 7772 6974 6528 2270 7269 6e74 2827 6865  write("print('he
-000116e0: 6c6c 6f27 2922 290a 2020 2020 2020 2020  llo')").        
-000116f0: 2020 2020 626c 6163 6b2e 7772 6974 655f      black.write_
-00011700: 6361 6368 6528 7b7d 2c20 5b6f 6e65 5d2c  cache({}, [one],
-00011710: 206d 6f64 6529 0a20 2020 2020 2020 2020   mode).         
-00011720: 2020 2069 6e76 6f6b 6542 6c61 636b 285b     invokeBlack([
-00011730: 7374 7228 776f 726b 7370 6163 6529 5d29  str(workspace)])
-00011740: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00011750: 6820 6f6e 652e 6f70 656e 2822 7222 2920  h one.open("r") 
-00011760: 6173 2066 6f62 6a3a 0a20 2020 2020 2020  as fobj:.       
-00011770: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00011780: 666f 626a 2e72 6561 6428 2920 3d3d 2022  fobj.read() == "
-00011790: 7072 696e 7428 2768 656c 6c6f 2729 220a  print('hello')".
-000117a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-000117b0: 2074 776f 2e6f 7065 6e28 2272 2229 2061   two.open("r") a
-000117c0: 7320 666f 626a 3a0a 2020 2020 2020 2020  s fobj:.        
-000117d0: 2020 2020 2020 2020 6173 7365 7274 2066          assert f
-000117e0: 6f62 6a2e 7265 6164 2829 203d 3d20 2770  obj.read() == 'p
-000117f0: 7269 6e74 2822 6865 6c6c 6f22 295c 6e27  rint("hello")\n'
-00011800: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
-00011810: 6865 203d 2062 6c61 636b 2e72 6561 645f  he = black.read_
-00011820: 6361 6368 6528 6d6f 6465 290a 2020 2020  cache(mode).    
-00011830: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
-00011840: 7472 286f 6e65 2920 696e 2063 6163 6865  tr(one) in cache
-00011850: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00011860: 6572 7420 7374 7228 7477 6f29 2069 6e20  ert str(two) in 
-00011870: 6361 6368 650a 0a20 2020 2040 7079 7465  cache..    @pyte
-00011880: 7374 2e6d 6172 6b2e 7061 7261 6d65 7472  st.mark.parametr
-00011890: 697a 6528 2263 6f6c 6f72 222c 205b 4661  ize("color", [Fa
-000118a0: 6c73 652c 2054 7275 655d 2c20 6964 733d  lse, True], ids=
-000118b0: 5b22 6e6f 2d63 6f6c 6f72 222c 2022 7769  ["no-color", "wi
-000118c0: 7468 2d63 6f6c 6f72 225d 290a 2020 2020  th-color"]).    
-000118d0: 6465 6620 7465 7374 5f6e 6f5f 6361 6368  def test_no_cach
-000118e0: 655f 7768 656e 5f77 7269 7465 6261 636b  e_when_writeback
-000118f0: 5f64 6966 6628 7365 6c66 2c20 636f 6c6f  _diff(self, colo
-00011900: 723a 2062 6f6f 6c29 202d 3e20 4e6f 6e65  r: bool) -> None
-00011910: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
-00011920: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
-00011930: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
-00011940: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
-00011950: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
-00011960: 2073 7263 203d 2028 776f 726b 7370 6163   src = (workspac
-00011970: 6520 2f20 2274 6573 742e 7079 2229 2e72  e / "test.py").r
-00011980: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
-00011990: 2020 2020 2077 6974 6820 7372 632e 6f70       with src.op
-000119a0: 656e 2822 7722 2920 6173 2066 6f62 6a3a  en("w") as fobj:
-000119b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000119c0: 2066 6f62 6a2e 7772 6974 6528 2270 7269   fobj.write("pri
-000119d0: 6e74 2827 6865 6c6c 6f27 2922 290a 2020  nt('hello')").  
-000119e0: 2020 2020 2020 2020 2020 7769 7468 2070            with p
-000119f0: 6174 6368 2822 626c 6163 6b2e 7265 6164  atch("black.read
-00011a00: 5f63 6163 6865 2229 2061 7320 7265 6164  _cache") as read
-00011a10: 5f63 6163 6865 2c20 7061 7463 6828 0a20  _cache, patch(. 
-00011a20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00011a30: 626c 6163 6b2e 7772 6974 655f 6361 6368  black.write_cach
-00011a40: 6522 0a20 2020 2020 2020 2020 2020 2029  e".            )
-00011a50: 2061 7320 7772 6974 655f 6361 6368 653a   as write_cache:
-00011a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011a70: 2063 6d64 203d 205b 7374 7228 7372 6329   cmd = [str(src)
-00011a80: 2c20 222d 2d64 6966 6622 5d0a 2020 2020  , "--diff"].    
-00011a90: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00011aa0: 6f6c 6f72 3a0a 2020 2020 2020 2020 2020  olor:.          
-00011ab0: 2020 2020 2020 2020 2020 636d 642e 6170            cmd.ap
-00011ac0: 7065 6e64 2822 2d2d 636f 6c6f 7222 290a  pend("--color").
-00011ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ae0: 696e 766f 6b65 426c 6163 6b28 636d 6429  invokeBlack(cmd)
-00011af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011b00: 2063 6163 6865 5f66 696c 6520 3d20 6765   cache_file = ge
-00011b10: 745f 6361 6368 655f 6669 6c65 286d 6f64  t_cache_file(mod
-00011b20: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00011b30: 2020 2061 7373 6572 7420 6361 6368 655f     assert cache_
-00011b40: 6669 6c65 2e65 7869 7374 7328 2920 6973  file.exists() is
-00011b50: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00011b60: 2020 2020 2020 2077 7269 7465 5f63 6163         write_cac
-00011b70: 6865 2e61 7373 6572 745f 6e6f 745f 6361  he.assert_not_ca
-00011b80: 6c6c 6564 2829 0a20 2020 2020 2020 2020  lled().         
-00011b90: 2020 2020 2020 2072 6561 645f 6361 6368         read_cach
-00011ba0: 652e 6173 7365 7274 5f6e 6f74 5f63 616c  e.assert_not_cal
-00011bb0: 6c65 6428 290a 0a20 2020 2040 7079 7465  led()..    @pyte
-00011bc0: 7374 2e6d 6172 6b2e 7061 7261 6d65 7472  st.mark.parametr
-00011bd0: 697a 6528 2263 6f6c 6f72 222c 205b 4661  ize("color", [Fa
-00011be0: 6c73 652c 2054 7275 655d 2c20 6964 733d  lse, True], ids=
-00011bf0: 5b22 6e6f 2d63 6f6c 6f72 222c 2022 7769  ["no-color", "wi
-00011c00: 7468 2d63 6f6c 6f72 225d 290a 2020 2020  th-color"]).    
-00011c10: 4065 7665 6e74 5f6c 6f6f 7028 290a 2020  @event_loop().  
-00011c20: 2020 6465 6620 7465 7374 5f6f 7574 7075    def test_outpu
-00011c30: 745f 6c6f 636b 696e 675f 7768 656e 5f77  t_locking_when_w
-00011c40: 7269 7465 6261 636b 5f64 6966 6628 7365  riteback_diff(se
-00011c50: 6c66 2c20 636f 6c6f 723a 2062 6f6f 6c29  lf, color: bool)
-00011c60: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00011c70: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
-00011c80: 2829 2061 7320 776f 726b 7370 6163 653a  () as workspace:
-00011c90: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00011ca0: 2074 6167 2069 6e20 7261 6e67 6528 302c   tag in range(0,
-00011cb0: 2034 293a 0a20 2020 2020 2020 2020 2020   4):.           
-00011cc0: 2020 2020 2073 7263 203d 2028 776f 726b       src = (work
-00011cd0: 7370 6163 6520 2f20 6622 7465 7374 7b74  space / f"test{t
-00011ce0: 6167 7d2e 7079 2229 2e72 6573 6f6c 7665  ag}.py").resolve
-00011cf0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00011d00: 2020 2077 6974 6820 7372 632e 6f70 656e     with src.open
-00011d10: 2822 7722 2920 6173 2066 6f62 6a3a 0a20  ("w") as fobj:. 
-00011d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d30: 2020 2066 6f62 6a2e 7772 6974 6528 2270     fobj.write("p
-00011d40: 7269 6e74 2827 6865 6c6c 6f27 2922 290a  rint('hello')").
-00011d50: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00011d60: 2070 6174 6368 280a 2020 2020 2020 2020   patch(.        
-00011d70: 2020 2020 2020 2020 2262 6c61 636b 2e63          "black.c
-00011d80: 6f6e 6375 7272 656e 6379 2e4d 616e 6167  oncurrency.Manag
-00011d90: 6572 222c 2077 7261 7073 3d6d 756c 7469  er", wraps=multi
-00011da0: 7072 6f63 6573 7369 6e67 2e4d 616e 6167  processing.Manag
-00011db0: 6572 0a20 2020 2020 2020 2020 2020 2029  er.            )
-00011dc0: 2061 7320 6d67 723a 0a20 2020 2020 2020   as mgr:.       
-00011dd0: 2020 2020 2020 2020 2063 6d64 203d 205b           cmd = [
-00011de0: 222d 2d64 6966 6622 2c20 7374 7228 776f  "--diff", str(wo
-00011df0: 726b 7370 6163 6529 5d0a 2020 2020 2020  rkspace)].      
-00011e00: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
-00011e10: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00011e20: 2020 2020 2020 2020 636d 642e 6170 7065          cmd.appe
-00011e30: 6e64 2822 2d2d 636f 6c6f 7222 290a 2020  nd("--color").  
-00011e40: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00011e50: 766f 6b65 426c 6163 6b28 636d 642c 2065  vokeBlack(cmd, e
-00011e60: 7869 745f 636f 6465 3d30 290a 2020 2020  xit_code=0).    
-00011e70: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-00011e80: 6973 2069 736e 2774 2071 7569 7465 2064  is isn't quite d
-00011e90: 6f69 6e67 2077 6861 7420 7765 2077 616e  oing what we wan
-00011ea0: 742c 2062 7574 2069 6620 6974 205f 6973  t, but if it _is
-00011eb0: 6e27 745f 0a20 2020 2020 2020 2020 2020  n't_.           
-00011ec0: 2020 2020 2023 2063 616c 6c65 6420 7468       # called th
-00011ed0: 656e 2077 6520 6361 6e6e 6f74 2062 6520  en we cannot be 
-00011ee0: 7573 696e 6720 7468 6520 6c6f 636b 2069  using the lock i
-00011ef0: 7420 7072 6f76 6964 6573 0a20 2020 2020  t provides.     
-00011f00: 2020 2020 2020 2020 2020 206d 6772 2e61             mgr.a
-00011f10: 7373 6572 745f 6361 6c6c 6564 2829 0a0a  ssert_called()..
-00011f20: 2020 2020 6465 6620 7465 7374 5f6e 6f5f      def test_no_
-00011f30: 6361 6368 655f 7768 656e 5f73 7464 696e  cache_when_stdin
-00011f40: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00011f50: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
-00011f60: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
-00011f70: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
-00011f80: 6972 2829 3a0a 2020 2020 2020 2020 2020  ir():.          
-00011f90: 2020 7265 7375 6c74 203d 2043 6c69 5275    result = CliRu
-00011fa0: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
-00011fb0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00011fc0: 6c61 636b 2e6d 6169 6e2c 205b 222d 225d  lack.main, ["-"]
-00011fd0: 2c20 696e 7075 743d 4279 7465 7349 4f28  , input=BytesIO(
-00011fe0: 6222 7072 696e 7428 2768 656c 6c6f 2729  b"print('hello')
-00011ff0: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
-00012000: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00012010: 6572 7420 6e6f 7420 7265 7375 6c74 2e65  ert not result.e
-00012020: 7869 745f 636f 6465 0a20 2020 2020 2020  xit_code.       
-00012030: 2020 2020 2063 6163 6865 5f66 696c 6520       cache_file 
-00012040: 3d20 6765 745f 6361 6368 655f 6669 6c65  = get_cache_file
-00012050: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
-00012060: 2020 2061 7373 6572 7420 6e6f 7420 6361     assert not ca
-00012070: 6368 655f 6669 6c65 2e65 7869 7374 7328  che_file.exists(
-00012080: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00012090: 7265 6164 5f63 6163 6865 5f6e 6f5f 6361  read_cache_no_ca
-000120a0: 6368 6566 696c 6528 7365 6c66 2920 2d3e  chefile(self) ->
-000120b0: 204e 6f6e 653a 0a20 2020 2020 2020 206d   None:.        m
-000120c0: 6f64 6520 3d20 4445 4641 554c 545f 4d4f  ode = DEFAULT_MO
-000120d0: 4445 0a20 2020 2020 2020 2077 6974 6820  DE.        with 
-000120e0: 6361 6368 655f 6469 7228 293a 0a20 2020  cache_dir():.   
-000120f0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00012100: 626c 6163 6b2e 7265 6164 5f63 6163 6865  black.read_cache
-00012110: 286d 6f64 6529 203d 3d20 7b7d 0a0a 2020  (mode) == {}..  
-00012120: 2020 6465 6620 7465 7374 5f77 7269 7465    def test_write
-00012130: 5f63 6163 6865 5f72 6561 645f 6361 6368  _cache_read_cach
-00012140: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
-00012150: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
-00012160: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
-00012170: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-00012180: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
-00012190: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-000121a0: 7372 6320 3d20 2877 6f72 6b73 7061 6365  src = (workspace
-000121b0: 202f 2022 7465 7374 2e70 7922 292e 7265   / "test.py").re
-000121c0: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
-000121d0: 2020 2020 7372 632e 746f 7563 6828 290a      src.touch().
-000121e0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-000121f0: 6b2e 7772 6974 655f 6361 6368 6528 7b7d  k.write_cache({}
-00012200: 2c20 5b73 7263 5d2c 206d 6f64 6529 0a20  , [src], mode). 
-00012210: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00012220: 203d 2062 6c61 636b 2e72 6561 645f 6361   = black.read_ca
-00012230: 6368 6528 6d6f 6465 290a 2020 2020 2020  che(mode).      
-00012240: 2020 2020 2020 6173 7365 7274 2073 7472        assert str
-00012250: 2873 7263 2920 696e 2063 6163 6865 0a20  (src) in cache. 
-00012260: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00012270: 7420 6361 6368 655b 7374 7228 7372 6329  t cache[str(src)
-00012280: 5d20 3d3d 2062 6c61 636b 2e67 6574 5f63  ] == black.get_c
-00012290: 6163 6865 5f69 6e66 6f28 7372 6329 0a0a  ache_info(src)..
-000122a0: 2020 2020 6465 6620 7465 7374 5f66 696c      def test_fil
-000122b0: 7465 725f 6361 6368 6564 2873 656c 6629  ter_cached(self)
-000122c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000122d0: 2020 7769 7468 2054 656d 706f 7261 7279    with Temporary
-000122e0: 4469 7265 6374 6f72 7928 2920 6173 2077  Directory() as w
-000122f0: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
-00012300: 2020 2020 2020 7061 7468 203d 2050 6174        path = Pat
-00012310: 6828 776f 726b 7370 6163 6529 0a20 2020  h(workspace).   
-00012320: 2020 2020 2020 2020 2075 6e63 6163 6865           uncache
-00012330: 6420 3d20 2870 6174 6820 2f20 2275 6e63  d = (path / "unc
-00012340: 6163 6865 6422 292e 7265 736f 6c76 6528  ached").resolve(
-00012350: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
-00012360: 6368 6564 203d 2028 7061 7468 202f 2022  ched = (path / "
-00012370: 6361 6368 6564 2229 2e72 6573 6f6c 7665  cached").resolve
-00012380: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
-00012390: 6163 6865 645f 6275 745f 6368 616e 6765  ached_but_change
-000123a0: 6420 3d20 2870 6174 6820 2f20 2263 6861  d = (path / "cha
-000123b0: 6e67 6564 2229 2e72 6573 6f6c 7665 2829  nged").resolve()
-000123c0: 0a20 2020 2020 2020 2020 2020 2075 6e63  .            unc
-000123d0: 6163 6865 642e 746f 7563 6828 290a 2020  ached.touch().  
-000123e0: 2020 2020 2020 2020 2020 6361 6368 6564            cached
-000123f0: 2e74 6f75 6368 2829 0a20 2020 2020 2020  .touch().       
-00012400: 2020 2020 2063 6163 6865 645f 6275 745f       cached_but_
-00012410: 6368 616e 6765 642e 746f 7563 6828 290a  changed.touch().
-00012420: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-00012430: 6520 3d20 7b0a 2020 2020 2020 2020 2020  e = {.          
-00012440: 2020 2020 2020 7374 7228 6361 6368 6564        str(cached
-00012450: 293a 2062 6c61 636b 2e67 6574 5f63 6163  ): black.get_cac
-00012460: 6865 5f69 6e66 6f28 6361 6368 6564 292c  he_info(cached),
-00012470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012480: 2073 7472 2863 6163 6865 645f 6275 745f   str(cached_but_
-00012490: 6368 616e 6765 6429 3a20 2830 2e30 2c20  changed): (0.0, 
-000124a0: 3029 2c0a 2020 2020 2020 2020 2020 2020  0),.            
-000124b0: 7d0a 2020 2020 2020 2020 2020 2020 746f  }.            to
-000124c0: 646f 2c20 646f 6e65 203d 2062 6c61 636b  do, done = black
-000124d0: 2e63 6163 6865 2e66 696c 7465 725f 6361  .cache.filter_ca
-000124e0: 6368 6564 280a 2020 2020 2020 2020 2020  ched(.          
-000124f0: 2020 2020 2020 6361 6368 652c 207b 756e        cache, {un
-00012500: 6361 6368 6564 2c20 6361 6368 6564 2c20  cached, cached, 
-00012510: 6361 6368 6564 5f62 7574 5f63 6861 6e67  cached_but_chang
-00012520: 6564 7d0a 2020 2020 2020 2020 2020 2020  ed}.            
-00012530: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00012540: 7365 7274 2074 6f64 6f20 3d3d 207b 756e  sert todo == {un
-00012550: 6361 6368 6564 2c20 6361 6368 6564 5f62  cached, cached_b
-00012560: 7574 5f63 6861 6e67 6564 7d0a 2020 2020  ut_changed}.    
-00012570: 2020 2020 2020 2020 6173 7365 7274 2064          assert d
-00012580: 6f6e 6520 3d3d 207b 6361 6368 6564 7d0a  one == {cached}.
-00012590: 0a20 2020 2064 6566 2074 6573 745f 7772  .    def test_wr
-000125a0: 6974 655f 6361 6368 655f 6372 6561 7465  ite_cache_create
-000125b0: 735f 6469 7265 6374 6f72 795f 6966 5f6e  s_directory_if_n
-000125c0: 6565 6465 6428 7365 6c66 2920 2d3e 204e  eeded(self) -> N
-000125d0: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
-000125e0: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
-000125f0: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
-00012600: 6368 655f 6469 7228 6578 6973 7473 3d46  che_dir(exists=F
-00012610: 616c 7365 2920 6173 2077 6f72 6b73 7061  alse) as workspa
-00012620: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00012630: 6173 7365 7274 206e 6f74 2077 6f72 6b73  assert not works
-00012640: 7061 6365 2e65 7869 7374 7328 290a 2020  pace.exists().  
-00012650: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-00012660: 7772 6974 655f 6361 6368 6528 7b7d 2c20  write_cache({}, 
-00012670: 5b5d 2c20 6d6f 6465 290a 2020 2020 2020  [], mode).      
-00012680: 2020 2020 2020 6173 7365 7274 2077 6f72        assert wor
-00012690: 6b73 7061 6365 2e65 7869 7374 7328 290a  kspace.exists().
-000126a0: 0a20 2020 2040 6576 656e 745f 6c6f 6f70  .    @event_loop
-000126b0: 2829 0a20 2020 2064 6566 2074 6573 745f  ().    def test_
-000126c0: 6661 696c 6564 5f66 6f72 6d61 7474 696e  failed_formattin
-000126d0: 675f 646f 6573 5f6e 6f74 5f67 6574 5f63  g_does_not_get_c
-000126e0: 6163 6865 6428 7365 6c66 2920 2d3e 204e  ached(self) -> N
-000126f0: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
-00012700: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
-00012710: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
-00012720: 6368 655f 6469 7228 2920 6173 2077 6f72  che_dir() as wor
-00012730: 6b73 7061 6365 2c20 7061 7463 6828 0a20  kspace, patch(. 
-00012740: 2020 2020 2020 2020 2020 2022 636f 6e63             "conc
-00012750: 7572 7265 6e74 2e66 7574 7572 6573 2e50  urrent.futures.P
-00012760: 726f 6365 7373 506f 6f6c 4578 6563 7574  rocessPoolExecut
-00012770: 6f72 222c 206e 6577 3d54 6872 6561 6450  or", new=ThreadP
-00012780: 6f6f 6c45 7865 6375 746f 720a 2020 2020  oolExecutor.    
-00012790: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-000127a0: 2020 2066 6169 6c69 6e67 203d 2028 776f     failing = (wo
-000127b0: 726b 7370 6163 6520 2f20 2266 6169 6c69  rkspace / "faili
-000127c0: 6e67 2e70 7922 292e 7265 736f 6c76 6528  ng.py").resolve(
-000127d0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-000127e0: 7468 2066 6169 6c69 6e67 2e6f 7065 6e28  th failing.open(
-000127f0: 2277 2229 2061 7320 666f 626a 3a0a 2020  "w") as fobj:.  
-00012800: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00012810: 626a 2e77 7269 7465 2822 6e6f 7420 6163  bj.write("not ac
-00012820: 7475 616c 6c79 2070 7974 686f 6e22 290a  tually python").
-00012830: 2020 2020 2020 2020 2020 2020 636c 6561              clea
-00012840: 6e20 3d20 2877 6f72 6b73 7061 6365 202f  n = (workspace /
-00012850: 2022 636c 6561 6e2e 7079 2229 2e72 6573   "clean.py").res
-00012860: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
-00012870: 2020 2077 6974 6820 636c 6561 6e2e 6f70     with clean.op
-00012880: 656e 2822 7722 2920 6173 2066 6f62 6a3a  en("w") as fobj:
-00012890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000128a0: 2066 6f62 6a2e 7772 6974 6528 2770 7269   fobj.write('pri
-000128b0: 6e74 2822 6865 6c6c 6f22 295c 6e27 290a  nt("hello")\n').
-000128c0: 2020 2020 2020 2020 2020 2020 696e 766f              invo
-000128d0: 6b65 426c 6163 6b28 5b73 7472 2877 6f72  keBlack([str(wor
-000128e0: 6b73 7061 6365 295d 2c20 6578 6974 5f63  kspace)], exit_c
-000128f0: 6f64 653d 3132 3329 0a20 2020 2020 2020  ode=123).       
-00012900: 2020 2020 2063 6163 6865 203d 2062 6c61       cache = bla
-00012910: 636b 2e72 6561 645f 6361 6368 6528 6d6f  ck.read_cache(mo
-00012920: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-00012930: 6173 7365 7274 2073 7472 2866 6169 6c69  assert str(faili
-00012940: 6e67 2920 6e6f 7420 696e 2063 6163 6865  ng) not in cache
-00012950: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00012960: 6572 7420 7374 7228 636c 6561 6e29 2069  ert str(clean) i
-00012970: 6e20 6361 6368 650a 0a20 2020 2064 6566  n cache..    def
-00012980: 2074 6573 745f 7772 6974 655f 6361 6368   test_write_cach
-00012990: 655f 7772 6974 655f 6661 696c 2873 656c  e_write_fail(sel
-000129a0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000129b0: 2020 2020 6d6f 6465 203d 2044 4546 4155      mode = DEFAU
-000129c0: 4c54 5f4d 4f44 450a 2020 2020 2020 2020  LT_MODE.        
-000129d0: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
-000129e0: 2c20 7061 7463 682e 6f62 6a65 6374 2850  , patch.object(P
-000129f0: 6174 682c 2022 6f70 656e 2229 2061 7320  ath, "open") as 
-00012a00: 6d6f 636b 3a0a 2020 2020 2020 2020 2020  mock:.          
-00012a10: 2020 6d6f 636b 2e73 6964 655f 6566 6665    mock.side_effe
-00012a20: 6374 203d 204f 5345 7272 6f72 0a20 2020  ct = OSError.   
-00012a30: 2020 2020 2020 2020 2062 6c61 636b 2e77           black.w
-00012a40: 7269 7465 5f63 6163 6865 287b 7d2c 205b  rite_cache({}, [
-00012a50: 5d2c 206d 6f64 6529 0a0a 2020 2020 6465  ], mode)..    de
-00012a60: 6620 7465 7374 5f72 6561 645f 6361 6368  f test_read_cach
-00012a70: 655f 6c69 6e65 5f6c 656e 6774 6873 2873  e_line_lengths(s
-00012a80: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00012a90: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
-00012aa0: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
-00012ab0: 2020 7368 6f72 745f 6d6f 6465 203d 2072    short_mode = r
-00012ac0: 6570 6c61 6365 2844 4546 4155 4c54 5f4d  eplace(DEFAULT_M
-00012ad0: 4f44 452c 206c 696e 655f 6c65 6e67 7468  ODE, line_length
-00012ae0: 3d31 290a 2020 2020 2020 2020 7769 7468  =1).        with
-00012af0: 2063 6163 6865 5f64 6972 2829 2061 7320   cache_dir() as 
-00012b00: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
-00012b10: 2020 2020 2020 2070 6174 6820 3d20 2877         path = (w
-00012b20: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
-00012b30: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
-00012b40: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00012b50: 2e74 6f75 6368 2829 0a20 2020 2020 2020  .touch().       
-00012b60: 2020 2020 2062 6c61 636b 2e77 7269 7465       black.write
-00012b70: 5f63 6163 6865 287b 7d2c 205b 7061 7468  _cache({}, [path
-00012b80: 5d2c 206d 6f64 6529 0a20 2020 2020 2020  ], mode).       
-00012b90: 2020 2020 206f 6e65 203d 2062 6c61 636b       one = black
-00012ba0: 2e72 6561 645f 6361 6368 6528 6d6f 6465  .read_cache(mode
-00012bb0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00012bc0: 7365 7274 2073 7472 2870 6174 6829 2069  sert str(path) i
-00012bd0: 6e20 6f6e 650a 2020 2020 2020 2020 2020  n one.          
-00012be0: 2020 7477 6f20 3d20 626c 6163 6b2e 7265    two = black.re
-00012bf0: 6164 5f63 6163 6865 2873 686f 7274 5f6d  ad_cache(short_m
-00012c00: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
-00012c10: 2061 7373 6572 7420 7374 7228 7061 7468   assert str(path
-00012c20: 2920 6e6f 7420 696e 2074 776f 0a0a 0a64  ) not in two...d
-00012c30: 6566 2061 7373 6572 745f 636f 6c6c 6563  ef assert_collec
-00012c40: 7465 645f 736f 7572 6365 7328 0a20 2020  ted_sources(.   
-00012c50: 2073 7263 3a20 5365 7175 656e 6365 5b55   src: Sequence[U
-00012c60: 6e69 6f6e 5b73 7472 2c20 5061 7468 5d5d  nion[str, Path]]
-00012c70: 2c0a 2020 2020 6578 7065 6374 6564 3a20  ,.    expected: 
-00012c80: 5365 7175 656e 6365 5b55 6e69 6f6e 5b73  Sequence[Union[s
-00012c90: 7472 2c20 5061 7468 5d5d 2c0a 2020 2020  tr, Path]],.    
-00012ca0: 2a2c 0a20 2020 2063 7478 3a20 4f70 7469  *,.    ctx: Opti
-00012cb0: 6f6e 616c 5b46 616b 6543 6f6e 7465 7874  onal[FakeContext
-00012cc0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 6578  ] = None,.    ex
-00012cd0: 636c 7564 653a 204f 7074 696f 6e61 6c5b  clude: Optional[
-00012ce0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00012cf0: 2069 6e63 6c75 6465 3a20 4f70 7469 6f6e   include: Option
-00012d00: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00012d10: 2020 2020 6578 7465 6e64 5f65 7863 6c75      extend_exclu
-00012d20: 6465 3a20 4f70 7469 6f6e 616c 5b73 7472  de: Optional[str
-00012d30: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 666f  ] = None,.    fo
-00012d40: 7263 655f 6578 636c 7564 653a 204f 7074  rce_exclude: Opt
-00012d50: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-00012d60: 652c 0a20 2020 2073 7464 696e 5f66 696c  e,.    stdin_fil
-00012d70: 656e 616d 653a 204f 7074 696f 6e61 6c5b  ename: Optional[
-00012d80: 7374 725d 203d 204e 6f6e 652c 0a29 202d  str] = None,.) -
-00012d90: 3e20 4e6f 6e65 3a0a 2020 2020 6773 5f73  > None:.    gs_s
-00012da0: 7263 203d 2074 7570 6c65 2873 7472 2850  rc = tuple(str(P
-00012db0: 6174 6828 7329 2920 666f 7220 7320 696e  ath(s)) for s in
-00012dc0: 2073 7263 290a 2020 2020 6773 5f65 7870   src).    gs_exp
-00012dd0: 6563 7465 6420 3d20 5b50 6174 6828 7329  ected = [Path(s)
-00012de0: 2066 6f72 2073 2069 6e20 6578 7065 6374   for s in expect
-00012df0: 6564 5d0a 2020 2020 6773 5f65 7863 6c75  ed].    gs_exclu
-00012e00: 6465 203d 204e 6f6e 6520 6966 2065 7863  de = None if exc
-00012e10: 6c75 6465 2069 7320 4e6f 6e65 2065 6c73  lude is None els
-00012e20: 6520 636f 6d70 696c 655f 7061 7474 6572  e compile_patter
-00012e30: 6e28 6578 636c 7564 6529 0a20 2020 2067  n(exclude).    g
-00012e40: 735f 696e 636c 7564 6520 3d20 4445 4641  s_include = DEFA
-00012e50: 554c 545f 494e 434c 5544 4520 6966 2069  ULT_INCLUDE if i
-00012e60: 6e63 6c75 6465 2069 7320 4e6f 6e65 2065  nclude is None e
-00012e70: 6c73 6520 636f 6d70 696c 655f 7061 7474  lse compile_patt
-00012e80: 6572 6e28 696e 636c 7564 6529 0a20 2020  ern(include).   
-00012e90: 2067 735f 6578 7465 6e64 5f65 7863 6c75   gs_extend_exclu
-00012ea0: 6465 203d 2028 0a20 2020 2020 2020 204e  de = (.        N
-00012eb0: 6f6e 6520 6966 2065 7874 656e 645f 6578  one if extend_ex
-00012ec0: 636c 7564 6520 6973 204e 6f6e 6520 656c  clude is None el
-00012ed0: 7365 2063 6f6d 7069 6c65 5f70 6174 7465  se compile_patte
-00012ee0: 726e 2865 7874 656e 645f 6578 636c 7564  rn(extend_exclud
-00012ef0: 6529 0a20 2020 2029 0a20 2020 2067 735f  e).    ).    gs_
-00012f00: 666f 7263 655f 6578 636c 7564 6520 3d20  force_exclude = 
-00012f10: 4e6f 6e65 2069 6620 666f 7263 655f 6578  None if force_ex
-00012f20: 636c 7564 6520 6973 204e 6f6e 6520 656c  clude is None el
-00012f30: 7365 2063 6f6d 7069 6c65 5f70 6174 7465  se compile_patte
-00012f40: 726e 2866 6f72 6365 5f65 7863 6c75 6465  rn(force_exclude
-00012f50: 290a 2020 2020 636f 6c6c 6563 7465 6420  ).    collected 
-00012f60: 3d20 626c 6163 6b2e 6765 745f 736f 7572  = black.get_sour
-00012f70: 6365 7328 0a20 2020 2020 2020 2063 7478  ces(.        ctx
-00012f80: 3d63 7478 206f 7220 4661 6b65 436f 6e74  =ctx or FakeCont
-00012f90: 6578 7428 292c 0a20 2020 2020 2020 2073  ext(),.        s
-00012fa0: 7263 3d67 735f 7372 632c 0a20 2020 2020  rc=gs_src,.     
-00012fb0: 2020 2071 7569 6574 3d46 616c 7365 2c0a     quiet=False,.
-00012fc0: 2020 2020 2020 2020 7665 7262 6f73 653d          verbose=
-00012fd0: 4661 6c73 652c 0a20 2020 2020 2020 2069  False,.        i
-00012fe0: 6e63 6c75 6465 3d67 735f 696e 636c 7564  nclude=gs_includ
-00012ff0: 652c 0a20 2020 2020 2020 2065 7863 6c75  e,.        exclu
-00013000: 6465 3d67 735f 6578 636c 7564 652c 0a20  de=gs_exclude,. 
-00013010: 2020 2020 2020 2065 7874 656e 645f 6578         extend_ex
-00013020: 636c 7564 653d 6773 5f65 7874 656e 645f  clude=gs_extend_
-00013030: 6578 636c 7564 652c 0a20 2020 2020 2020  exclude,.       
-00013040: 2066 6f72 6365 5f65 7863 6c75 6465 3d67   force_exclude=g
-00013050: 735f 666f 7263 655f 6578 636c 7564 652c  s_force_exclude,
-00013060: 0a20 2020 2020 2020 2072 6570 6f72 743d  .        report=
-00013070: 626c 6163 6b2e 5265 706f 7274 2829 2c0a  black.Report(),.
-00013080: 2020 2020 2020 2020 7374 6469 6e5f 6669          stdin_fi
-00013090: 6c65 6e61 6d65 3d73 7464 696e 5f66 696c  lename=stdin_fil
-000130a0: 656e 616d 652c 0a20 2020 2029 0a20 2020  ename,.    ).   
-000130b0: 2061 7373 6572 7420 736f 7274 6564 2863   assert sorted(c
-000130c0: 6f6c 6c65 6374 6564 2920 3d3d 2073 6f72  ollected) == sor
-000130d0: 7465 6428 6773 5f65 7870 6563 7465 6429  ted(gs_expected)
-000130e0: 0a0a 0a63 6c61 7373 2054 6573 7446 696c  ...class TestFil
-000130f0: 6543 6f6c 6c65 6374 696f 6e3a 0a20 2020  eCollection:.   
-00013100: 2064 6566 2074 6573 745f 696e 636c 7564   def test_includ
-00013110: 655f 6578 636c 7564 6528 7365 6c66 2920  e_exclude(self) 
-00013120: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00013130: 2070 6174 6820 3d20 5448 4953 5f44 4952   path = THIS_DIR
-00013140: 202f 2022 6461 7461 2220 2f20 2269 6e63   / "data" / "inc
-00013150: 6c75 6465 5f65 7863 6c75 6465 5f74 6573  lude_exclude_tes
-00013160: 7473 220a 2020 2020 2020 2020 7372 6320  ts".        src 
-00013170: 3d20 5b70 6174 685d 0a20 2020 2020 2020  = [path].       
-00013180: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
-00013190: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-000131a0: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-000131b0: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
-000131c0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-000131d0: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
-000131e0: 636c 7564 652f 612e 7079 6922 292c 0a20  clude/a.pyi"),. 
-000131f0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00013200: 2061 7373 6572 745f 636f 6c6c 6563 7465   assert_collecte
-00013210: 645f 736f 7572 6365 7328 0a20 2020 2020  d_sources(.     
-00013220: 2020 2020 2020 2073 7263 2c0a 2020 2020         src,.    
-00013230: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-00013240: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
-00013250: 636c 7564 653d 7222 5c2e 7079 693f 2422  clude=r"\.pyi?$"
-00013260: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
-00013270: 636c 7564 653d 7222 2f65 7863 6c75 6465  clude=r"/exclude
-00013280: 2f7c 2f5c 2e64 6566 696e 6974 656c 795f  /|/\.definitely_
-00013290: 6578 636c 7564 652f 222c 0a20 2020 2020  exclude/",.     
-000132a0: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
-000132b0: 7374 5f67 6974 6967 6e6f 7265 5f75 7365  st_gitignore_use
-000132c0: 645f 6173 5f64 6566 6175 6c74 2873 656c  d_as_default(sel
-000132d0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000132e0: 2020 2020 6261 7365 203d 2050 6174 6828      base = Path(
-000132f0: 4441 5441 5f44 4952 202f 2022 696e 636c  DATA_DIR / "incl
-00013300: 7564 655f 6578 636c 7564 655f 7465 7374  ude_exclude_test
-00013310: 7322 290a 2020 2020 2020 2020 6578 7065  s").        expe
-00013320: 6374 6564 203d 205b 0a20 2020 2020 2020  cted = [.       
-00013330: 2020 2020 2062 6173 6520 2f20 2262 2f2e       base / "b/.
-00013340: 6465 6669 6e69 7465 6c79 5f65 7863 6c75  definitely_exclu
-00013350: 6465 2f61 2e70 7922 2c0a 2020 2020 2020  de/a.py",.      
-00013360: 2020 2020 2020 6261 7365 202f 2022 622f        base / "b/
-00013370: 2e64 6566 696e 6974 656c 795f 6578 636c  .definitely_excl
-00013380: 7564 652f 612e 7079 6922 2c0a 2020 2020  ude/a.pyi",.    
-00013390: 2020 2020 5d0a 2020 2020 2020 2020 7372      ].        sr
-000133a0: 6320 3d20 5b62 6173 6520 2f20 2262 2f22  c = [base / "b/"
-000133b0: 5d0a 2020 2020 2020 2020 6374 7820 3d20  ].        ctx = 
-000133c0: 4661 6b65 436f 6e74 6578 7428 290a 2020  FakeContext().  
-000133d0: 2020 2020 2020 6374 782e 6f62 6a5b 2272        ctx.obj["r
-000133e0: 6f6f 7422 5d20 3d20 6261 7365 0a20 2020  oot"] = base.   
-000133f0: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
-00013400: 6563 7465 645f 736f 7572 6365 7328 7372  ected_sources(sr
-00013410: 632c 2065 7870 6563 7465 642c 2063 7478  c, expected, ctx
-00013420: 3d63 7478 2c20 6578 7465 6e64 5f65 7863  =ctx, extend_exc
-00013430: 6c75 6465 3d72 222f 6578 636c 7564 652f  lude=r"/exclude/
-00013440: 2229 0a0a 2020 2020 4070 6174 6368 2822  ")..    @patch("
-00013450: 626c 6163 6b2e 6669 6e64 5f70 726f 6a65  black.find_proje
-00013460: 6374 5f72 6f6f 7422 2c20 6c61 6d62 6461  ct_root", lambda
-00013470: 202a 6172 6773 3a20 2854 4849 535f 4449   *args: (THIS_DI
-00013480: 522e 7265 736f 6c76 6528 292c 204e 6f6e  R.resolve(), Non
-00013490: 6529 290a 2020 2020 6465 6620 7465 7374  e)).    def test
-000134a0: 5f65 7863 6c75 6465 5f66 6f72 5f69 7373  _exclude_for_iss
-000134b0: 7565 5f31 3537 3228 7365 6c66 2920 2d3e  ue_1572(self) ->
-000134c0: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
-000134d0: 2045 7863 6c75 6465 2073 686f 756c 646e   Exclude shouldn
-000134e0: 2774 2074 6f75 6368 2066 696c 6573 2074  't touch files t
-000134f0: 6861 7420 7765 7265 2065 7870 6c69 6369  hat were explici
-00013500: 746c 7920 6769 7665 6e20 746f 2042 6c61  tly given to Bla
-00013510: 636b 2074 6872 6f75 6768 2074 6865 0a20  ck through the. 
-00013520: 2020 2020 2020 2023 2043 4c49 2e20 4578         # CLI. Ex
-00013530: 636c 7564 6520 6973 2073 7570 706f 7365  clude is suppose
-00013540: 6420 746f 206f 6e6c 7920 6170 706c 7920  d to only apply 
-00013550: 746f 2074 6865 2072 6563 7572 7369 7665  to the recursive
-00013560: 2064 6973 636f 7665 7279 206f 6620 6669   discovery of fi
-00013570: 6c65 732e 0a20 2020 2020 2020 2023 2068  les..        # h
-00013580: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00013590: 6d2f 7073 662f 626c 6163 6b2f 6973 7375  m/psf/black/issu
-000135a0: 6573 2f31 3537 320a 2020 2020 2020 2020  es/1572.        
-000135b0: 7061 7468 203d 2044 4154 415f 4449 5220  path = DATA_DIR 
-000135c0: 2f20 2269 6e63 6c75 6465 5f65 7863 6c75  / "include_exclu
-000135d0: 6465 5f74 6573 7473 220a 2020 2020 2020  de_tests".      
-000135e0: 2020 7372 6320 3d20 5b70 6174 6820 2f20    src = [path / 
-000135f0: 2262 2f65 7863 6c75 6465 2f61 2e70 7922  "b/exclude/a.py"
-00013600: 5d0a 2020 2020 2020 2020 6578 7065 6374  ].        expect
-00013610: 6564 203d 205b 7061 7468 202f 2022 622f  ed = [path / "b/
-00013620: 6578 636c 7564 652f 612e 7079 225d 0a20  exclude/a.py"]. 
-00013630: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
-00013640: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
-00013650: 7372 632c 2065 7870 6563 7465 642c 2069  src, expected, i
-00013660: 6e63 6c75 6465 3d22 222c 2065 7863 6c75  nclude="", exclu
-00013670: 6465 3d72 222f 6578 636c 7564 652f 7c61  de=r"/exclude/|a
-00013680: 5c2e 7079 2229 0a0a 2020 2020 6465 6620  \.py")..    def 
-00013690: 7465 7374 5f67 6974 6967 6e6f 7265 5f65  test_gitignore_e
-000136a0: 7863 6c75 6465 2873 656c 6629 202d 3e20  xclude(self) -> 
-000136b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7061  None:.        pa
-000136c0: 7468 203d 2054 4849 535f 4449 5220 2f20  th = THIS_DIR / 
-000136d0: 2264 6174 6122 202f 2022 696e 636c 7564  "data" / "includ
-000136e0: 655f 6578 636c 7564 655f 7465 7374 7322  e_exclude_tests"
-000136f0: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
-00013700: 203d 2072 652e 636f 6d70 696c 6528 7222   = re.compile(r"
-00013710: 5c2e 7079 693f 2422 290a 2020 2020 2020  \.pyi?$").      
-00013720: 2020 6578 636c 7564 6520 3d20 7265 2e63    exclude = re.c
-00013730: 6f6d 7069 6c65 2872 2222 290a 2020 2020  ompile(r"").    
-00013740: 2020 2020 7265 706f 7274 203d 2062 6c61      report = bla
-00013750: 636b 2e52 6570 6f72 7428 290a 2020 2020  ck.Report().    
-00013760: 2020 2020 6769 7469 676e 6f72 6520 3d20      gitignore = 
-00013770: 5061 7468 5370 6563 2e66 726f 6d5f 6c69  PathSpec.from_li
-00013780: 6e65 7328 0a20 2020 2020 2020 2020 2020  nes(.           
-00013790: 2022 6769 7477 696c 646d 6174 6368 222c   "gitwildmatch",
-000137a0: 205b 2265 7863 6c75 6465 2f22 2c20 222e   ["exclude/", ".
-000137b0: 6465 6669 6e69 7465 6c79 5f65 7863 6c75  definitely_exclu
-000137c0: 6465 225d 0a20 2020 2020 2020 2029 0a20  de"].        ). 
-000137d0: 2020 2020 2020 2073 6f75 7263 6573 3a20         sources: 
-000137e0: 4c69 7374 5b50 6174 685d 203d 205b 5d0a  List[Path] = [].
-000137f0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-00013800: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00013810: 2050 6174 6828 7061 7468 202f 2022 622f   Path(path / "b/
-00013820: 646f 6e74 5f65 7863 6c75 6465 2f61 2e70  dont_exclude/a.p
-00013830: 7922 292c 0a20 2020 2020 2020 2020 2020  y"),.           
-00013840: 2050 6174 6828 7061 7468 202f 2022 622f   Path(path / "b/
-00013850: 646f 6e74 5f65 7863 6c75 6465 2f61 2e70  dont_exclude/a.p
-00013860: 7969 2229 2c0a 2020 2020 2020 2020 5d0a  yi"),.        ].
-00013870: 2020 2020 2020 2020 7468 6973 5f61 6273          this_abs
-00013880: 203d 2054 4849 535f 4449 522e 7265 736f   = THIS_DIR.reso
-00013890: 6c76 6528 290a 2020 2020 2020 2020 736f  lve().        so
-000138a0: 7572 6365 732e 6578 7465 6e64 280a 2020  urces.extend(.  
-000138b0: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-000138c0: 6765 6e5f 7079 7468 6f6e 5f66 696c 6573  gen_python_files
-000138d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000138e0: 2020 7061 7468 2e69 7465 7264 6972 2829    path.iterdir()
-000138f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013900: 2020 7468 6973 5f61 6273 2c0a 2020 2020    this_abs,.    
-00013910: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00013920: 7564 652c 0a20 2020 2020 2020 2020 2020  ude,.           
-00013930: 2020 2020 2065 7863 6c75 6465 2c0a 2020       exclude,.  
-00013940: 2020 2020 2020 2020 2020 2020 2020 4e6f                No
-00013950: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00013960: 2020 2020 4e6f 6e65 2c0a 2020 2020 2020      None,.      
-00013970: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00013980: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013990: 2020 6769 7469 676e 6f72 652c 0a20 2020    gitignore,.   
-000139a0: 2020 2020 2020 2020 2020 2020 2076 6572               ver
-000139b0: 626f 7365 3d46 616c 7365 2c0a 2020 2020  bose=False,.    
-000139c0: 2020 2020 2020 2020 2020 2020 7175 6965              quie
-000139d0: 743d 4661 6c73 652c 0a20 2020 2020 2020  t=False,.       
-000139e0: 2020 2020 2029 0a20 2020 2020 2020 2029       ).        )
-000139f0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00013a00: 736f 7274 6564 2865 7870 6563 7465 6429  sorted(expected)
-00013a10: 203d 3d20 736f 7274 6564 2873 6f75 7263   == sorted(sourc
-00013a20: 6573 290a 0a20 2020 2064 6566 2074 6573  es)..    def tes
-00013a30: 745f 6e65 7374 6564 5f67 6974 6967 6e6f  t_nested_gitigno
-00013a40: 7265 2873 656c 6629 202d 3e20 4e6f 6e65  re(self) -> None
-00013a50: 3a0a 2020 2020 2020 2020 7061 7468 203d  :.        path =
-00013a60: 2050 6174 6828 5448 4953 5f44 4952 202f   Path(THIS_DIR /
-00013a70: 2022 6461 7461 2220 2f20 226e 6573 7465   "data" / "neste
-00013a80: 645f 6769 7469 676e 6f72 655f 7465 7374  d_gitignore_test
-00013a90: 7322 290a 2020 2020 2020 2020 696e 636c  s").        incl
-00013aa0: 7564 6520 3d20 7265 2e63 6f6d 7069 6c65  ude = re.compile
-00013ab0: 2872 225c 2e70 7969 3f24 2229 0a20 2020  (r"\.pyi?$").   
-00013ac0: 2020 2020 2065 7863 6c75 6465 203d 2072       exclude = r
-00013ad0: 652e 636f 6d70 696c 6528 7222 2229 0a20  e.compile(r""). 
-00013ae0: 2020 2020 2020 2072 6f6f 745f 6769 7469         root_giti
-00013af0: 676e 6f72 6520 3d20 626c 6163 6b2e 6669  gnore = black.fi
-00013b00: 6c65 732e 6765 745f 6769 7469 676e 6f72  les.get_gitignor
-00013b10: 6528 7061 7468 290a 2020 2020 2020 2020  e(path).        
-00013b20: 7265 706f 7274 203d 2062 6c61 636b 2e52  report = black.R
-00013b30: 6570 6f72 7428 290a 2020 2020 2020 2020  eport().        
-00013b40: 6578 7065 6374 6564 3a20 4c69 7374 5b50  expected: List[P
-00013b50: 6174 685d 203d 205b 0a20 2020 2020 2020  ath] = [.       
-00013b60: 2020 2020 2050 6174 6828 7061 7468 202f       Path(path /
-00013b70: 2022 782e 7079 2229 2c0a 2020 2020 2020   "x.py"),.      
-00013b80: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
-00013b90: 2f20 2272 6f6f 742f 622e 7079 2229 2c0a  / "root/b.py"),.
-00013ba0: 2020 2020 2020 2020 2020 2020 5061 7468              Path
-00013bb0: 2870 6174 6820 2f20 2272 6f6f 742f 632e  (path / "root/c.
-00013bc0: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
-00013bd0: 2020 5061 7468 2870 6174 6820 2f20 2272    Path(path / "r
-00013be0: 6f6f 742f 6368 696c 642f 632e 7079 2229  oot/child/c.py")
-00013bf0: 2c0a 2020 2020 2020 2020 5d0a 2020 2020  ,.        ].    
-00013c00: 2020 2020 7468 6973 5f61 6273 203d 2054      this_abs = T
-00013c10: 4849 535f 4449 522e 7265 736f 6c76 6528  HIS_DIR.resolve(
-00013c20: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
-00013c30: 7320 3d20 6c69 7374 280a 2020 2020 2020  s = list(.      
-00013c40: 2020 2020 2020 626c 6163 6b2e 6765 6e5f        black.gen_
-00013c50: 7079 7468 6f6e 5f66 696c 6573 280a 2020  python_files(.  
-00013c60: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00013c70: 7468 2e69 7465 7264 6972 2829 2c0a 2020  th.iterdir(),.  
-00013c80: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00013c90: 6973 5f61 6273 2c0a 2020 2020 2020 2020  is_abs,.        
-00013ca0: 2020 2020 2020 2020 696e 636c 7564 652c          include,
-00013cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013cc0: 2065 7863 6c75 6465 2c0a 2020 2020 2020   exclude,.      
-00013cd0: 2020 2020 2020 2020 2020 4e6f 6e65 2c0a            None,.
-00013ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cf0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00013d00: 2020 2020 2020 7265 706f 7274 2c0a 2020        report,.  
-00013d10: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00013d20: 6f74 5f67 6974 6967 6e6f 7265 2c0a 2020  ot_gitignore,.  
-00013d30: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-00013d40: 7262 6f73 653d 4661 6c73 652c 0a20 2020  rbose=False,.   
-00013d50: 2020 2020 2020 2020 2020 2020 2071 7569               qui
-00013d60: 6574 3d46 616c 7365 2c0a 2020 2020 2020  et=False,.      
-00013d70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00013d80: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-00013d90: 2073 6f72 7465 6428 6578 7065 6374 6564   sorted(expected
-00013da0: 2920 3d3d 2073 6f72 7465 6428 736f 7572  ) == sorted(sour
-00013db0: 6365 7329 0a0a 2020 2020 6465 6620 7465  ces)..    def te
-00013dc0: 7374 5f6e 6573 7465 645f 6769 7469 676e  st_nested_gitign
-00013dd0: 6f72 655f 6469 7265 6374 6c79 5f69 6e5f  ore_directly_in_
-00013de0: 736f 7572 6365 5f64 6972 6563 746f 7279  source_directory
-00013df0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00013e00: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
-00013e10: 2f2f 6769 7468 7562 2e63 6f6d 2f70 7366  //github.com/psf
-00013e20: 2f62 6c61 636b 2f69 7373 7565 732f 3235  /black/issues/25
-00013e30: 3938 0a20 2020 2020 2020 2070 6174 6820  98.        path 
-00013e40: 3d20 5061 7468 2844 4154 415f 4449 5220  = Path(DATA_DIR 
-00013e50: 2f20 226e 6573 7465 645f 6769 7469 676e  / "nested_gitign
-00013e60: 6f72 655f 7465 7374 7322 290a 2020 2020  ore_tests").    
-00013e70: 2020 2020 7372 6320 3d20 5061 7468 2870      src = Path(p
-00013e80: 6174 6820 2f20 2272 6f6f 7422 202f 2022  ath / "root" / "
-00013e90: 6368 696c 6422 290a 2020 2020 2020 2020  child").        
-00013ea0: 6578 7065 6374 6564 203d 205b 7372 6320  expected = [src 
-00013eb0: 2f20 2261 2e70 7922 2c20 7372 6320 2f20  / "a.py", src / 
-00013ec0: 2263 2e70 7922 5d0a 2020 2020 2020 2020  "c.py"].        
-00013ed0: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
-00013ee0: 5f73 6f75 7263 6573 285b 7372 635d 2c20  _sources([src], 
-00013ef0: 6578 7065 6374 6564 290a 0a20 2020 2064  expected)..    d
-00013f00: 6566 2074 6573 745f 696e 7661 6c69 645f  ef test_invalid_
-00013f10: 6769 7469 676e 6f72 6528 7365 6c66 2920  gitignore(self) 
-00013f20: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00013f30: 2070 6174 6820 3d20 5448 4953 5f44 4952   path = THIS_DIR
-00013f40: 202f 2022 6461 7461 2220 2f20 2269 6e76   / "data" / "inv
-00013f50: 616c 6964 5f67 6974 6967 6e6f 7265 5f74  alid_gitignore_t
-00013f60: 6573 7473 220a 2020 2020 2020 2020 656d  ests".        em
-00013f70: 7074 795f 636f 6e66 6967 203d 2070 6174  pty_config = pat
-00013f80: 6820 2f20 2270 7970 726f 6a65 6374 2e74  h / "pyproject.t
-00013f90: 6f6d 6c22 0a20 2020 2020 2020 2072 6573  oml".        res
-00013fa0: 756c 7420 3d20 426c 6163 6b52 756e 6e65  ult = BlackRunne
-00013fb0: 7228 292e 696e 766f 6b65 280a 2020 2020  r().invoke(.    
-00013fc0: 2020 2020 2020 2020 626c 6163 6b2e 6d61          black.ma
-00013fd0: 696e 2c20 5b22 2d2d 7665 7262 6f73 6522  in, ["--verbose"
-00013fe0: 2c20 222d 2d63 6f6e 6669 6722 2c20 7374  , "--config", st
-00013ff0: 7228 656d 7074 795f 636f 6e66 6967 292c  r(empty_config),
-00014000: 2073 7472 2870 6174 6829 5d0a 2020 2020   str(path)].    
-00014010: 2020 2020 290a 2020 2020 2020 2020 6173      ).        as
-00014020: 7365 7274 2072 6573 756c 742e 6578 6974  sert result.exit
-00014030: 5f63 6f64 6520 3d3d 2031 0a20 2020 2020  _code == 1.     
-00014040: 2020 2061 7373 6572 7420 7265 7375 6c74     assert result
-00014050: 2e73 7464 6572 725f 6279 7465 7320 6973  .stderr_bytes is
-00014060: 206e 6f74 204e 6f6e 650a 0a20 2020 2020   not None..     
-00014070: 2020 2067 6974 6967 6e6f 7265 203d 2070     gitignore = p
-00014080: 6174 6820 2f20 222e 6769 7469 676e 6f72  ath / ".gitignor
-00014090: 6522 0a20 2020 2020 2020 2061 7373 6572  e".        asser
-000140a0: 7420 6622 436f 756c 6420 6e6f 7420 7061  t f"Could not pa
-000140b0: 7273 6520 7b67 6974 6967 6e6f 7265 7d22  rse {gitignore}"
-000140c0: 2069 6e20 7265 7375 6c74 2e73 7464 6572   in result.stder
-000140d0: 725f 6279 7465 732e 6465 636f 6465 2829  r_bytes.decode()
-000140e0: 0a0a 2020 2020 6465 6620 7465 7374 5f69  ..    def test_i
-000140f0: 6e76 616c 6964 5f6e 6573 7465 645f 6769  nvalid_nested_gi
-00014100: 7469 676e 6f72 6528 7365 6c66 2920 2d3e  tignore(self) ->
-00014110: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
-00014120: 6174 6820 3d20 5448 4953 5f44 4952 202f  ath = THIS_DIR /
-00014130: 2022 6461 7461 2220 2f20 2269 6e76 616c   "data" / "inval
-00014140: 6964 5f6e 6573 7465 645f 6769 7469 676e  id_nested_gitign
-00014150: 6f72 655f 7465 7374 7322 0a20 2020 2020  ore_tests".     
-00014160: 2020 2065 6d70 7479 5f63 6f6e 6669 6720     empty_config 
-00014170: 3d20 7061 7468 202f 2022 7079 7072 6f6a  = path / "pyproj
-00014180: 6563 742e 746f 6d6c 220a 2020 2020 2020  ect.toml".      
-00014190: 2020 7265 7375 6c74 203d 2042 6c61 636b    result = Black
-000141a0: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
-000141b0: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-000141c0: 636b 2e6d 6169 6e2c 205b 222d 2d76 6572  ck.main, ["--ver
-000141d0: 626f 7365 222c 2022 2d2d 636f 6e66 6967  bose", "--config
-000141e0: 222c 2073 7472 2865 6d70 7479 5f63 6f6e  ", str(empty_con
-000141f0: 6669 6729 2c20 7374 7228 7061 7468 295d  fig), str(path)]
-00014200: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00014210: 2020 2061 7373 6572 7420 7265 7375 6c74     assert result
-00014220: 2e65 7869 745f 636f 6465 203d 3d20 310a  .exit_code == 1.
-00014230: 2020 2020 2020 2020 6173 7365 7274 2072          assert r
-00014240: 6573 756c 742e 7374 6465 7272 5f62 7974  esult.stderr_byt
-00014250: 6573 2069 7320 6e6f 7420 4e6f 6e65 0a0a  es is not None..
-00014260: 2020 2020 2020 2020 6769 7469 676e 6f72          gitignor
-00014270: 6520 3d20 7061 7468 202f 2022 6122 202f  e = path / "a" /
-00014280: 2022 2e67 6974 6967 6e6f 7265 220a 2020   ".gitignore".  
-00014290: 2020 2020 2020 6173 7365 7274 2066 2243        assert f"C
-000142a0: 6f75 6c64 206e 6f74 2070 6172 7365 207b  ould not parse {
-000142b0: 6769 7469 676e 6f72 657d 2220 696e 2072  gitignore}" in r
-000142c0: 6573 756c 742e 7374 6465 7272 5f62 7974  esult.stderr_byt
-000142d0: 6573 2e64 6563 6f64 6528 290a 0a20 2020  es.decode()..   
-000142e0: 2064 6566 2074 6573 745f 656d 7074 795f   def test_empty_
-000142f0: 696e 636c 7564 6528 7365 6c66 2920 2d3e  include(self) ->
-00014300: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
-00014310: 6174 6820 3d20 4441 5441 5f44 4952 202f  ath = DATA_DIR /
-00014320: 2022 696e 636c 7564 655f 6578 636c 7564   "include_exclud
-00014330: 655f 7465 7374 7322 0a20 2020 2020 2020  e_tests".       
-00014340: 2073 7263 203d 205b 7061 7468 5d0a 2020   src = [path].  
-00014350: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-00014360: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
-00014370: 6174 6828 7061 7468 202f 2022 622f 6578  ath(path / "b/ex
-00014380: 636c 7564 652f 612e 7069 6522 292c 0a20  clude/a.pie"),. 
-00014390: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-000143a0: 7061 7468 202f 2022 622f 6578 636c 7564  path / "b/exclud
-000143b0: 652f 612e 7079 2229 2c0a 2020 2020 2020  e/a.py"),.      
-000143c0: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
-000143d0: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
-000143e0: 7969 2229 2c0a 2020 2020 2020 2020 2020  yi"),.          
-000143f0: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
-00014400: 2f64 6f6e 745f 6578 636c 7564 652f 612e  /dont_exclude/a.
-00014410: 7069 6522 292c 0a20 2020 2020 2020 2020  pie"),.         
-00014420: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
-00014430: 622f 646f 6e74 5f65 7863 6c75 6465 2f61  b/dont_exclude/a
-00014440: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
-00014450: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
-00014460: 622f 646f 6e74 5f65 7863 6c75 6465 2f61  b/dont_exclude/a
-00014470: 2e70 7969 2229 2c0a 2020 2020 2020 2020  .pyi"),.        
-00014480: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
-00014490: 2262 2f2e 6465 6669 6e69 7465 6c79 5f65  "b/.definitely_e
-000144a0: 7863 6c75 6465 2f61 2e70 6965 2229 2c0a  xclude/a.pie"),.
-000144b0: 2020 2020 2020 2020 2020 2020 5061 7468              Path
-000144c0: 2870 6174 6820 2f20 2262 2f2e 6465 6669  (path / "b/.defi
-000144d0: 6e69 7465 6c79 5f65 7863 6c75 6465 2f61  nitely_exclude/a
-000144e0: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
-000144f0: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
-00014500: 622f 2e64 6566 696e 6974 656c 795f 6578  b/.definitely_ex
-00014510: 636c 7564 652f 612e 7079 6922 292c 0a20  clude/a.pyi"),. 
-00014520: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-00014530: 7061 7468 202f 2022 2e67 6974 6967 6e6f  path / ".gitigno
-00014540: 7265 2229 2c0a 2020 2020 2020 2020 2020  re"),.          
-00014550: 2020 5061 7468 2870 6174 6820 2f20 2270    Path(path / "p
-00014560: 7970 726f 6a65 6374 2e74 6f6d 6c22 292c  yproject.toml"),
-00014570: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-00014580: 2020 2023 2053 6574 7469 6e67 2065 7863     # Setting exc
-00014590: 6c75 6465 2065 7870 6c69 6369 746c 7920  lude explicitly 
-000145a0: 746f 2061 6e20 656d 7074 7920 7374 7269  to an empty stri
-000145b0: 6e67 2074 6f20 626c 6f63 6b20 2e67 6974  ng to block .git
-000145c0: 6967 6e6f 7265 2075 7361 6765 2e0a 2020  ignore usage..  
-000145d0: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
-000145e0: 6c65 6374 6564 5f73 6f75 7263 6573 2873  lected_sources(s
-000145f0: 7263 2c20 6578 7065 6374 6564 2c20 696e  rc, expected, in
-00014600: 636c 7564 653d 2222 2c20 6578 636c 7564  clude="", exclud
-00014610: 653d 2222 290a 0a20 2020 2064 6566 2074  e="")..    def t
-00014620: 6573 745f 6578 7465 6e64 5f65 7863 6c75  est_extend_exclu
-00014630: 6465 2873 656c 6629 202d 3e20 4e6f 6e65  de(self) -> None
-00014640: 3a0a 2020 2020 2020 2020 7061 7468 203d  :.        path =
-00014650: 2044 4154 415f 4449 5220 2f20 2269 6e63   DATA_DIR / "inc
-00014660: 6c75 6465 5f65 7863 6c75 6465 5f74 6573  lude_exclude_tes
-00014670: 7473 220a 2020 2020 2020 2020 7372 6320  ts".        src 
-00014680: 3d20 5b70 6174 685d 0a20 2020 2020 2020  = [path].       
-00014690: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
-000146a0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
-000146b0: 6174 6820 2f20 2262 2f65 7863 6c75 6465  ath / "b/exclude
-000146c0: 2f61 2e70 7922 292c 0a20 2020 2020 2020  /a.py"),.       
-000146d0: 2020 2020 2050 6174 6828 7061 7468 202f       Path(path /
-000146e0: 2022 622f 646f 6e74 5f65 7863 6c75 6465   "b/dont_exclude
-000146f0: 2f61 2e70 7922 292c 0a20 2020 2020 2020  /a.py"),.       
-00014700: 205d 0a20 2020 2020 2020 2061 7373 6572   ].        asser
-00014710: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
-00014720: 6365 7328 0a20 2020 2020 2020 2020 2020  ces(.           
-00014730: 2073 7263 2c20 6578 7065 6374 6564 2c20   src, expected, 
-00014740: 6578 636c 7564 653d 7222 5c2e 7079 6924  exclude=r"\.pyi$
-00014750: 222c 2065 7874 656e 645f 6578 636c 7564  ", extend_exclud
-00014760: 653d 7222 5c2e 6465 6669 6e69 7465 6c79  e=r"\.definitely
-00014770: 5f65 7863 6c75 6465 220a 2020 2020 2020  _exclude".      
-00014780: 2020 290a 0a20 2020 2040 7079 7465 7374    )..    @pytest
-00014790: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
-000147a0: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
-000147b0: 2020 6465 6620 7465 7374 5f73 796d 6c69    def test_symli
-000147c0: 6e6b 5f6f 7574 5f6f 665f 726f 6f74 5f64  nk_out_of_root_d
-000147d0: 6972 6563 746f 7279 2873 656c 6629 202d  irectory(self) -
-000147e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000147f0: 7061 7468 203d 204d 6167 6963 4d6f 636b  path = MagicMock
-00014800: 2829 0a20 2020 2020 2020 2072 6f6f 7420  ().        root 
-00014810: 3d20 5448 4953 5f44 4952 2e72 6573 6f6c  = THIS_DIR.resol
-00014820: 7665 2829 0a20 2020 2020 2020 2063 6869  ve().        chi
-00014830: 6c64 203d 204d 6167 6963 4d6f 636b 2829  ld = MagicMock()
-00014840: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
-00014850: 203d 2072 652e 636f 6d70 696c 6528 626c   = re.compile(bl
-00014860: 6163 6b2e 4445 4641 554c 545f 494e 434c  ack.DEFAULT_INCL
-00014870: 5544 4553 290a 2020 2020 2020 2020 6578  UDES).        ex
-00014880: 636c 7564 6520 3d20 7265 2e63 6f6d 7069  clude = re.compi
-00014890: 6c65 2862 6c61 636b 2e44 4546 4155 4c54  le(black.DEFAULT
-000148a0: 5f45 5843 4c55 4445 5329 0a20 2020 2020  _EXCLUDES).     
-000148b0: 2020 2072 6570 6f72 7420 3d20 626c 6163     report = blac
-000148c0: 6b2e 5265 706f 7274 2829 0a20 2020 2020  k.Report().     
-000148d0: 2020 2067 6974 6967 6e6f 7265 203d 2050     gitignore = P
-000148e0: 6174 6853 7065 632e 6672 6f6d 5f6c 696e  athSpec.from_lin
-000148f0: 6573 2822 6769 7477 696c 646d 6174 6368  es("gitwildmatch
-00014900: 222c 205b 5d29 0a20 2020 2020 2020 2023  ", []).        #
-00014910: 2060 6368 696c 6460 2073 686f 756c 6420   `child` should 
-00014920: 6265 6861 7665 206c 696b 6520 6120 7379  behave like a sy
-00014930: 6d6c 696e 6b20 7768 6963 6820 7265 736f  mlink which reso
-00014940: 6c76 6564 2070 6174 6820 6973 2063 6c65  lved path is cle
-00014950: 6172 6c79 0a20 2020 2020 2020 2023 206f  arly.        # o
-00014960: 7574 7369 6465 206f 6620 7468 6520 6072  utside of the `r
-00014970: 6f6f 7460 2064 6972 6563 746f 7279 2e0a  oot` directory..
-00014980: 2020 2020 2020 2020 7061 7468 2e69 7465          path.ite
-00014990: 7264 6972 2e72 6574 7572 6e5f 7661 6c75  rdir.return_valu
-000149a0: 6520 3d20 5b63 6869 6c64 5d0a 2020 2020  e = [child].    
-000149b0: 2020 2020 6368 696c 642e 7265 736f 6c76      child.resolv
-000149c0: 652e 7265 7475 726e 5f76 616c 7565 203d  e.return_value =
-000149d0: 2050 6174 6828 222f 612f 622f 6322 290a   Path("/a/b/c").
-000149e0: 2020 2020 2020 2020 6368 696c 642e 6173          child.as
-000149f0: 5f70 6f73 6978 2e72 6574 7572 6e5f 7661  _posix.return_va
-00014a00: 6c75 6520 3d20 222f 612f 622f 6322 0a20  lue = "/a/b/c". 
-00014a10: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00014a20: 2020 2020 2020 2020 6c69 7374 280a 2020          list(.  
-00014a30: 2020 2020 2020 2020 2020 2020 2020 626c                bl
-00014a40: 6163 6b2e 6765 6e5f 7079 7468 6f6e 5f66  ack.gen_python_f
-00014a50: 696c 6573 280a 2020 2020 2020 2020 2020  iles(.          
-00014a60: 2020 2020 2020 2020 2020 7061 7468 2e69            path.i
-00014a70: 7465 7264 6972 2829 2c0a 2020 2020 2020  terdir(),.      
-00014a80: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00014a90: 6f74 2c0a 2020 2020 2020 2020 2020 2020  ot,.            
-00014aa0: 2020 2020 2020 2020 696e 636c 7564 652c          include,
-00014ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ac0: 2020 2020 2065 7863 6c75 6465 2c0a 2020       exclude,.  
-00014ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ae0: 2020 4e6f 6e65 2c0a 2020 2020 2020 2020    None,.        
-00014af0: 2020 2020 2020 2020 2020 2020 4e6f 6e65              None
-00014b00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014b10: 2020 2020 2020 7265 706f 7274 2c0a 2020        report,.  
-00014b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b30: 2020 6769 7469 676e 6f72 652c 0a20 2020    gitignore,.   
-00014b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b50: 2076 6572 626f 7365 3d46 616c 7365 2c0a   verbose=False,.
-00014b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b70: 2020 2020 7175 6965 743d 4661 6c73 652c      quiet=False,
-00014b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014b90: 2029 0a20 2020 2020 2020 2020 2020 2029   ).            )
-00014ba0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00014bb0: 5661 6c75 6545 7272 6f72 2061 7320 7665  ValueError as ve
-00014bc0: 3a0a 2020 2020 2020 2020 2020 2020 7079  :.            py
-00014bd0: 7465 7374 2e66 6169 6c28 6622 6067 6574  test.fail(f"`get
-00014be0: 5f70 7974 686f 6e5f 6669 6c65 735f 696e  _python_files_in
-00014bf0: 5f64 6972 2829 6020 6661 696c 6564 3a20  _dir()` failed: 
-00014c00: 7b76 657d 2229 0a20 2020 2020 2020 2070  {ve}").        p
-00014c10: 6174 682e 6974 6572 6469 722e 6173 7365  ath.iterdir.asse
-00014c20: 7274 5f63 616c 6c65 645f 6f6e 6365 2829  rt_called_once()
-00014c30: 0a20 2020 2020 2020 2063 6869 6c64 2e72  .        child.r
-00014c40: 6573 6f6c 7665 2e61 7373 6572 745f 6361  esolve.assert_ca
-00014c50: 6c6c 6564 5f6f 6e63 6528 290a 0a20 2020  lled_once()..   
-00014c60: 2040 7061 7463 6828 2262 6c61 636b 2e66   @patch("black.f
-00014c70: 696e 645f 7072 6f6a 6563 745f 726f 6f74  ind_project_root
-00014c80: 222c 206c 616d 6264 6120 2a61 7267 733a  ", lambda *args:
-00014c90: 2028 5448 4953 5f44 4952 2e72 6573 6f6c   (THIS_DIR.resol
-00014ca0: 7665 2829 2c20 4e6f 6e65 2929 0a20 2020  ve(), None)).   
-00014cb0: 2064 6566 2074 6573 745f 6765 745f 736f   def test_get_so
-00014cc0: 7572 6365 735f 7769 7468 5f73 7464 696e  urces_with_stdin
-00014cd0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00014ce0: 2020 2020 2020 2020 7372 6320 3d20 5b22          src = ["
-00014cf0: 2d22 5d0a 2020 2020 2020 2020 6578 7065  -"].        expe
-00014d00: 6374 6564 203d 205b 222d 225d 0a20 2020  cted = ["-"].   
-00014d10: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
-00014d20: 6563 7465 645f 736f 7572 6365 7328 7372  ected_sources(sr
-00014d30: 632c 2065 7870 6563 7465 642c 2069 6e63  c, expected, inc
-00014d40: 6c75 6465 3d22 222c 2065 7863 6c75 6465  lude="", exclude
-00014d50: 3d72 222f 6578 636c 7564 652f 7c61 5c2e  =r"/exclude/|a\.
-00014d60: 7079 2229 0a0a 2020 2020 4070 6174 6368  py")..    @patch
-00014d70: 2822 626c 6163 6b2e 6669 6e64 5f70 726f  ("black.find_pro
-00014d80: 6a65 6374 5f72 6f6f 7422 2c20 6c61 6d62  ject_root", lamb
-00014d90: 6461 202a 6172 6773 3a20 2854 4849 535f  da *args: (THIS_
-00014da0: 4449 522e 7265 736f 6c76 6528 292c 204e  DIR.resolve(), N
-00014db0: 6f6e 6529 290a 2020 2020 6465 6620 7465  one)).    def te
-00014dc0: 7374 5f67 6574 5f73 6f75 7263 6573 5f77  st_get_sources_w
-00014dd0: 6974 685f 7374 6469 6e5f 6669 6c65 6e61  ith_stdin_filena
-00014de0: 6d65 2873 656c 6629 202d 3e20 4e6f 6e65  me(self) -> None
-00014df0: 3a0a 2020 2020 2020 2020 7372 6320 3d20  :.        src = 
-00014e00: 5b22 2d22 5d0a 2020 2020 2020 2020 7374  ["-"].        st
-00014e10: 6469 6e5f 6669 6c65 6e61 6d65 203d 2073  din_filename = s
-00014e20: 7472 2854 4849 535f 4449 5220 2f20 2264  tr(THIS_DIR / "d
-00014e30: 6174 612f 636f 6c6c 6563 7469 6f6e 732e  ata/collections.
-00014e40: 7079 2229 0a20 2020 2020 2020 2065 7870  py").        exp
-00014e50: 6563 7465 6420 3d20 5b66 225f 5f42 4c41  ected = [f"__BLA
-00014e60: 434b 5f53 5444 494e 5f46 494c 454e 414d  CK_STDIN_FILENAM
-00014e70: 455f 5f7b 7374 6469 6e5f 6669 6c65 6e61  E__{stdin_filena
-00014e80: 6d65 7d22 5d0a 2020 2020 2020 2020 6173  me}"].        as
-00014e90: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
-00014ea0: 6f75 7263 6573 280a 2020 2020 2020 2020  ources(.        
-00014eb0: 2020 2020 7372 632c 0a20 2020 2020 2020      src,.       
-00014ec0: 2020 2020 2065 7870 6563 7465 642c 0a20       expected,. 
-00014ed0: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
-00014ee0: 6465 3d72 222f 6578 636c 7564 652f 615c  de=r"/exclude/a\
-00014ef0: 2e70 7922 2c0a 2020 2020 2020 2020 2020  .py",.          
-00014f00: 2020 7374 6469 6e5f 6669 6c65 6e61 6d65    stdin_filename
-00014f10: 3d73 7464 696e 5f66 696c 656e 616d 652c  =stdin_filename,
-00014f20: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00014f30: 4070 6174 6368 2822 626c 6163 6b2e 6669  @patch("black.fi
-00014f40: 6e64 5f70 726f 6a65 6374 5f72 6f6f 7422  nd_project_root"
-00014f50: 2c20 6c61 6d62 6461 202a 6172 6773 3a20  , lambda *args: 
-00014f60: 2854 4849 535f 4449 522e 7265 736f 6c76  (THIS_DIR.resolv
-00014f70: 6528 292c 204e 6f6e 6529 290a 2020 2020  e(), None)).    
-00014f80: 6465 6620 7465 7374 5f67 6574 5f73 6f75  def test_get_sou
-00014f90: 7263 6573 5f77 6974 685f 7374 6469 6e5f  rces_with_stdin_
-00014fa0: 6669 6c65 6e61 6d65 5f61 6e64 5f65 7863  filename_and_exc
-00014fb0: 6c75 6465 2873 656c 6629 202d 3e20 4e6f  lude(self) -> No
-00014fc0: 6e65 3a0a 2020 2020 2020 2020 2320 4578  ne:.        # Ex
-00014fd0: 636c 7564 6520 7368 6f75 6c64 6e27 7420  clude shouldn't 
-00014fe0: 6578 636c 7564 6520 7374 6469 6e5f 6669  exclude stdin_fi
-00014ff0: 6c65 6e61 6d65 2073 696e 6365 2069 7420  lename since it 
-00015000: 6973 206d 696d 6963 6b69 6e67 2074 6865  is mimicking the
-00015010: 0a20 2020 2020 2020 2023 2066 696c 6520  .        # file 
-00015020: 6265 696e 6720 7061 7373 6564 2064 6972  being passed dir
-00015030: 6563 746c 792e 2054 6869 7320 6973 2074  ectly. This is t
-00015040: 6865 2073 616d 6520 6173 0a20 2020 2020  he same as.     
-00015050: 2020 2023 2074 6573 745f 6578 636c 7564     # test_exclud
-00015060: 655f 666f 725f 6973 7375 655f 3135 3732  e_for_issue_1572
-00015070: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-00015080: 4441 5441 5f44 4952 202f 2022 696e 636c  DATA_DIR / "incl
-00015090: 7564 655f 6578 636c 7564 655f 7465 7374  ude_exclude_test
-000150a0: 7322 0a20 2020 2020 2020 2073 7263 203d  s".        src =
-000150b0: 205b 222d 225d 0a20 2020 2020 2020 2073   ["-"].        s
-000150c0: 7464 696e 5f66 696c 656e 616d 6520 3d20  tdin_filename = 
-000150d0: 7374 7228 7061 7468 202f 2022 622f 6578  str(path / "b/ex
-000150e0: 636c 7564 652f 612e 7079 2229 0a20 2020  clude/a.py").   
-000150f0: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
-00015100: 5b66 225f 5f42 4c41 434b 5f53 5444 494e  [f"__BLACK_STDIN
-00015110: 5f46 494c 454e 414d 455f 5f7b 7374 6469  _FILENAME__{stdi
-00015120: 6e5f 6669 6c65 6e61 6d65 7d22 5d0a 2020  n_filename}"].  
-00015130: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
-00015140: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
-00015150: 2020 2020 2020 2020 2020 2020 7372 632c              src,
-00015160: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-00015170: 6563 7465 642c 0a20 2020 2020 2020 2020  ected,.         
-00015180: 2020 2065 7863 6c75 6465 3d72 222f 6578     exclude=r"/ex
-00015190: 636c 7564 652f 7c61 5c2e 7079 222c 0a20  clude/|a\.py",. 
-000151a0: 2020 2020 2020 2020 2020 2073 7464 696e             stdin
-000151b0: 5f66 696c 656e 616d 653d 7374 6469 6e5f  _filename=stdin_
-000151c0: 6669 6c65 6e61 6d65 2c0a 2020 2020 2020  filename,.      
-000151d0: 2020 290a 0a20 2020 2040 7061 7463 6828    )..    @patch(
-000151e0: 2262 6c61 636b 2e66 696e 645f 7072 6f6a  "black.find_proj
-000151f0: 6563 745f 726f 6f74 222c 206c 616d 6264  ect_root", lambd
-00015200: 6120 2a61 7267 733a 2028 5448 4953 5f44  a *args: (THIS_D
-00015210: 4952 2e72 6573 6f6c 7665 2829 2c20 4e6f  IR.resolve(), No
-00015220: 6e65 2929 0a20 2020 2064 6566 2074 6573  ne)).    def tes
-00015230: 745f 6765 745f 736f 7572 6365 735f 7769  t_get_sources_wi
-00015240: 7468 5f73 7464 696e 5f66 696c 656e 616d  th_stdin_filenam
-00015250: 655f 616e 645f 6578 7465 6e64 5f65 7863  e_and_extend_exc
-00015260: 6c75 6465 2873 656c 6629 202d 3e20 4e6f  lude(self) -> No
-00015270: 6e65 3a0a 2020 2020 2020 2020 2320 4578  ne:.        # Ex
-00015280: 7465 6e64 2065 7863 6c75 6465 2073 686f  tend exclude sho
-00015290: 756c 646e 2774 2065 7863 6c75 6465 2073  uldn't exclude s
-000152a0: 7464 696e 5f66 696c 656e 616d 6520 7369  tdin_filename si
-000152b0: 6e63 6520 6974 2069 7320 6d69 6d69 636b  nce it is mimick
-000152c0: 696e 6720 7468 650a 2020 2020 2020 2020  ing the.        
-000152d0: 2320 6669 6c65 2062 6569 6e67 2070 6173  # file being pas
-000152e0: 7365 6420 6469 7265 6374 6c79 2e20 5468  sed directly. Th
-000152f0: 6973 2069 7320 7468 6520 7361 6d65 2061  is is the same a
-00015300: 730a 2020 2020 2020 2020 2320 7465 7374  s.        # test
-00015310: 5f65 7863 6c75 6465 5f66 6f72 5f69 7373  _exclude_for_iss
-00015320: 7565 5f31 3537 320a 2020 2020 2020 2020  ue_1572.        
-00015330: 7372 6320 3d20 5b22 2d22 5d0a 2020 2020  src = ["-"].    
-00015340: 2020 2020 7061 7468 203d 2054 4849 535f      path = THIS_
-00015350: 4449 5220 2f20 2264 6174 6122 202f 2022  DIR / "data" / "
-00015360: 696e 636c 7564 655f 6578 636c 7564 655f  include_exclude_
-00015370: 7465 7374 7322 0a20 2020 2020 2020 2073  tests".        s
-00015380: 7464 696e 5f66 696c 656e 616d 6520 3d20  tdin_filename = 
-00015390: 7374 7228 7061 7468 202f 2022 622f 6578  str(path / "b/ex
-000153a0: 636c 7564 652f 612e 7079 2229 0a20 2020  clude/a.py").   
-000153b0: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
-000153c0: 5b66 225f 5f42 4c41 434b 5f53 5444 494e  [f"__BLACK_STDIN
-000153d0: 5f46 494c 454e 414d 455f 5f7b 7374 6469  _FILENAME__{stdi
-000153e0: 6e5f 6669 6c65 6e61 6d65 7d22 5d0a 2020  n_filename}"].  
-000153f0: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
-00015400: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
-00015410: 2020 2020 2020 2020 2020 2020 7372 632c              src,
-00015420: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-00015430: 6563 7465 642c 0a20 2020 2020 2020 2020  ected,.         
-00015440: 2020 2065 7874 656e 645f 6578 636c 7564     extend_exclud
-00015450: 653d 7222 2f65 7863 6c75 6465 2f7c 615c  e=r"/exclude/|a\
-00015460: 2e70 7922 2c0a 2020 2020 2020 2020 2020  .py",.          
-00015470: 2020 7374 6469 6e5f 6669 6c65 6e61 6d65    stdin_filename
-00015480: 3d73 7464 696e 5f66 696c 656e 616d 652c  =stdin_filename,
-00015490: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000154a0: 4070 6174 6368 2822 626c 6163 6b2e 6669  @patch("black.fi
-000154b0: 6e64 5f70 726f 6a65 6374 5f72 6f6f 7422  nd_project_root"
-000154c0: 2c20 6c61 6d62 6461 202a 6172 6773 3a20  , lambda *args: 
-000154d0: 2854 4849 535f 4449 522e 7265 736f 6c76  (THIS_DIR.resolv
-000154e0: 6528 292c 204e 6f6e 6529 290a 2020 2020  e(), None)).    
-000154f0: 6465 6620 7465 7374 5f67 6574 5f73 6f75  def test_get_sou
-00015500: 7263 6573 5f77 6974 685f 7374 6469 6e5f  rces_with_stdin_
-00015510: 6669 6c65 6e61 6d65 5f61 6e64 5f66 6f72  filename_and_for
-00015520: 6365 5f65 7863 6c75 6465 2873 656c 6629  ce_exclude(self)
-00015530: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00015540: 2020 2320 466f 7263 6520 6578 636c 7564    # Force exclud
-00015550: 6520 7368 6f75 6c64 2065 7863 6c75 6465  e should exclude
-00015560: 2074 6865 2066 696c 6520 7768 656e 2070   the file when p
-00015570: 6173 7369 6e67 2069 7420 7468 726f 7567  assing it throug
-00015580: 680a 2020 2020 2020 2020 2320 7374 6469  h.        # stdi
-00015590: 6e5f 6669 6c65 6e61 6d65 0a20 2020 2020  n_filename.     
-000155a0: 2020 2070 6174 6820 3d20 5448 4953 5f44     path = THIS_D
-000155b0: 4952 202f 2022 6461 7461 2220 2f20 2269  IR / "data" / "i
-000155c0: 6e63 6c75 6465 5f65 7863 6c75 6465 5f74  nclude_exclude_t
-000155d0: 6573 7473 220a 2020 2020 2020 2020 7374  ests".        st
-000155e0: 6469 6e5f 6669 6c65 6e61 6d65 203d 2073  din_filename = s
-000155f0: 7472 2870 6174 6820 2f20 2262 2f65 7863  tr(path / "b/exc
-00015600: 6c75 6465 2f61 2e70 7922 290a 2020 2020  lude/a.py").    
-00015610: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
-00015620: 6374 6564 5f73 6f75 7263 6573 280a 2020  cted_sources(.  
-00015630: 2020 2020 2020 2020 2020 7372 633d 5b22            src=["
-00015640: 2d22 5d2c 0a20 2020 2020 2020 2020 2020  -"],.           
-00015650: 2065 7870 6563 7465 643d 5b5d 2c0a 2020   expected=[],.  
-00015660: 2020 2020 2020 2020 2020 666f 7263 655f            force_
-00015670: 6578 636c 7564 653d 7222 2f65 7863 6c75  exclude=r"/exclu
-00015680: 6465 2f7c 615c 2e70 7922 2c0a 2020 2020  de/|a\.py",.    
-00015690: 2020 2020 2020 2020 7374 6469 6e5f 6669          stdin_fi
-000156a0: 6c65 6e61 6d65 3d73 7464 696e 5f66 696c  lename=stdin_fil
-000156b0: 656e 616d 652c 0a20 2020 2020 2020 2029  ename,.        )
-000156c0: 0a0a 0a74 7279 3a0a 2020 2020 7769 7468  ...try:.    with
-000156d0: 206f 7065 6e28 626c 6163 6b2e 5f5f 6669   open(black.__fi
-000156e0: 6c65 5f5f 2c20 2272 222c 2065 6e63 6f64  le__, "r", encod
-000156f0: 696e 673d 2275 7466 2d38 2229 2061 7320  ing="utf-8") as 
-00015700: 5f62 663a 0a20 2020 2020 2020 2062 6c61  _bf:.        bla
-00015710: 636b 5f73 6f75 7263 655f 6c69 6e65 7320  ck_source_lines 
-00015720: 3d20 5f62 662e 7265 6164 6c69 6e65 7328  = _bf.readlines(
-00015730: 290a 6578 6365 7074 2055 6e69 636f 6465  ).except Unicode
-00015740: 4465 636f 6465 4572 726f 723a 0a20 2020  DecodeError:.   
-00015750: 2069 6620 6e6f 7420 626c 6163 6b2e 434f   if not black.CO
-00015760: 4d50 494c 4544 3a0a 2020 2020 2020 2020  MPILED:.        
-00015770: 7261 6973 650a 0a0a 6465 6620 7472 6163  raise...def trac
-00015780: 6566 756e 6328 0a20 2020 2066 7261 6d65  efunc(.    frame
-00015790: 3a20 7479 7065 732e 4672 616d 6554 7970  : types.FrameTyp
-000157a0: 652c 2065 7665 6e74 3a20 7374 722c 2061  e, event: str, a
-000157b0: 7267 3a20 416e 790a 2920 2d3e 2043 616c  rg: Any.) -> Cal
-000157c0: 6c61 626c 655b 5b74 7970 6573 2e46 7261  lable[[types.Fra
-000157d0: 6d65 5479 7065 2c20 7374 722c 2041 6e79  meType, str, Any
-000157e0: 5d2c 2041 6e79 5d3a 0a20 2020 2022 2222  ], Any]:.    """
-000157f0: 5368 6f77 2066 756e 6374 696f 6e20 6361  Show function ca
-00015800: 6c6c 7320 6066 726f 6d20 626c 6163 6b2f  lls `from black/
-00015810: 5f5f 696e 6974 5f5f 2e70 7960 2061 7320  __init__.py` as 
-00015820: 7468 6579 2068 6170 7065 6e2e 0a0a 2020  they happen...  
-00015830: 2020 5265 6769 7374 6572 2074 6869 7320    Register this 
-00015840: 7769 7468 2060 7379 732e 7365 7474 7261  with `sys.settra
-00015850: 6365 2829 6020 696e 2061 2074 6573 7420  ce()` in a test 
-00015860: 796f 7527 7265 2064 6562 7567 6769 6e67  you're debugging
-00015870: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
-00015880: 2065 7665 6e74 2021 3d20 2263 616c 6c22   event != "call"
-00015890: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000158a0: 2074 7261 6365 6675 6e63 0a0a 2020 2020   tracefunc..    
-000158b0: 7374 6163 6b20 3d20 6c65 6e28 696e 7370  stack = len(insp
-000158c0: 6563 742e 7374 6163 6b28 2929 202d 2031  ect.stack()) - 1
-000158d0: 390a 2020 2020 7374 6163 6b20 2a3d 2032  9.    stack *= 2
-000158e0: 0a20 2020 2066 696c 656e 616d 6520 3d20  .    filename = 
-000158f0: 6672 616d 652e 665f 636f 6465 2e63 6f5f  frame.f_code.co_
-00015900: 6669 6c65 6e61 6d65 0a20 2020 206c 696e  filename.    lin
-00015910: 656e 6f20 3d20 6672 616d 652e 665f 6c69  eno = frame.f_li
-00015920: 6e65 6e6f 0a20 2020 2066 756e 635f 7369  neno.    func_si
-00015930: 675f 6c69 6e65 6e6f 203d 206c 696e 656e  g_lineno = linen
-00015940: 6f20 2d20 310a 2020 2020 6675 6e63 6e61  o - 1.    funcna
-00015950: 6d65 203d 2062 6c61 636b 5f73 6f75 7263  me = black_sourc
-00015960: 655f 6c69 6e65 735b 6675 6e63 5f73 6967  e_lines[func_sig
-00015970: 5f6c 696e 656e 6f5d 2e73 7472 6970 2829  _lineno].strip()
-00015980: 0a20 2020 2077 6869 6c65 2066 756e 636e  .    while funcn
-00015990: 616d 652e 7374 6172 7473 7769 7468 2822  ame.startswith("
-000159a0: 4022 293a 0a20 2020 2020 2020 2066 756e  @"):.        fun
-000159b0: 635f 7369 675f 6c69 6e65 6e6f 202b 3d20  c_sig_lineno += 
-000159c0: 310a 2020 2020 2020 2020 6675 6e63 6e61  1.        funcna
-000159d0: 6d65 203d 2062 6c61 636b 5f73 6f75 7263  me = black_sourc
-000159e0: 655f 6c69 6e65 735b 6675 6e63 5f73 6967  e_lines[func_sig
-000159f0: 5f6c 696e 656e 6f5d 2e73 7472 6970 2829  _lineno].strip()
-00015a00: 0a20 2020 2069 6620 2262 6c61 636b 2f5f  .    if "black/_
-00015a10: 5f69 6e69 745f 5f2e 7079 2220 696e 2066  _init__.py" in f
-00015a20: 696c 656e 616d 653a 0a20 2020 2020 2020  ilename:.       
-00015a30: 2070 7269 6e74 2866 227b 2720 2720 2a20   print(f"{' ' * 
-00015a40: 7374 6163 6b7d 7b6c 696e 656e 6f7d 3a7b  stack}{lineno}:{
-00015a50: 6675 6e63 6e61 6d65 7d22 290a 2020 2020  funcname}").    
-00015a60: 7265 7475 726e 2074 7261 6365 6675 6e63  return tracefunc
-00015a70: 0a                                       .
+00000210: 652c 0a20 2020 2054 7970 6556 6172 2c0a  e,.    TypeVar,.
+00000220: 2020 2020 556e 696f 6e2c 0a29 0a66 726f      Union,.).fro
+00000230: 6d20 756e 6974 7465 7374 2e6d 6f63 6b20  m unittest.mock 
+00000240: 696d 706f 7274 204d 6167 6963 4d6f 636b  import MagicMock
+00000250: 2c20 7061 7463 680a 0a69 6d70 6f72 7420  , patch..import 
+00000260: 636c 6963 6b0a 696d 706f 7274 2070 7974  click.import pyt
+00000270: 6573 740a 6672 6f6d 2063 6c69 636b 2069  est.from click i
+00000280: 6d70 6f72 7420 756e 7374 796c 650a 6672  mport unstyle.fr
+00000290: 6f6d 2063 6c69 636b 2e74 6573 7469 6e67  om click.testing
+000002a0: 2069 6d70 6f72 7420 436c 6952 756e 6e65   import CliRunne
+000002b0: 720a 6672 6f6d 2070 6174 6873 7065 6320  r.from pathspec 
+000002c0: 696d 706f 7274 2050 6174 6853 7065 630a  import PathSpec.
+000002d0: 0a69 6d70 6f72 7420 626c 6163 6b0a 696d  .import black.im
+000002e0: 706f 7274 2062 6c61 636b 2e66 696c 6573  port black.files
+000002f0: 0a66 726f 6d20 626c 6163 6b20 696d 706f  .from black impo
+00000300: 7274 2046 6561 7475 7265 2c20 5461 7267  rt Feature, Targ
+00000310: 6574 5665 7273 696f 6e0a 6672 6f6d 2062  etVersion.from b
+00000320: 6c61 636b 2069 6d70 6f72 7420 7265 5f63  lack import re_c
+00000330: 6f6d 7069 6c65 5f6d 6179 6265 5f76 6572  ompile_maybe_ver
+00000340: 626f 7365 2061 7320 636f 6d70 696c 655f  bose as compile_
+00000350: 7061 7474 6572 6e0a 6672 6f6d 2062 6c61  pattern.from bla
+00000360: 636b 2e63 6163 6865 2069 6d70 6f72 7420  ck.cache import 
+00000370: 6765 745f 6361 6368 655f 6469 722c 2067  get_cache_dir, g
+00000380: 6574 5f63 6163 6865 5f66 696c 650a 6672  et_cache_file.fr
+00000390: 6f6d 2062 6c61 636b 2e64 6562 7567 2069  om black.debug i
+000003a0: 6d70 6f72 7420 4465 6275 6756 6973 6974  mport DebugVisit
+000003b0: 6f72 0a66 726f 6d20 626c 6163 6b2e 6f75  or.from black.ou
+000003c0: 7470 7574 2069 6d70 6f72 7420 636f 6c6f  tput import colo
+000003d0: 725f 6469 6666 2c20 6469 6666 0a66 726f  r_diff, diff.fro
+000003e0: 6d20 626c 6163 6b2e 7265 706f 7274 2069  m black.report i
+000003f0: 6d70 6f72 7420 5265 706f 7274 0a0a 2320  mport Report..# 
+00000400: 496d 706f 7274 206f 7468 6572 2074 6573  Import other tes
+00000410: 7420 636c 6173 7365 730a 6672 6f6d 2074  t classes.from t
+00000420: 6573 7473 2e75 7469 6c20 696d 706f 7274  ests.util import
+00000430: 2028 0a20 2020 2044 4154 415f 4449 522c   (.    DATA_DIR,
+00000440: 0a20 2020 2044 4546 4155 4c54 5f4d 4f44  .    DEFAULT_MOD
+00000450: 452c 0a20 2020 2044 4554 4552 4d49 4e49  E,.    DETERMINI
+00000460: 5354 4943 5f48 4541 4445 522c 0a20 2020  STIC_HEADER,.   
+00000470: 2050 524f 4a45 4354 5f52 4f4f 542c 0a20   PROJECT_ROOT,. 
+00000480: 2020 2050 5933 365f 5645 5253 494f 4e53     PY36_VERSIONS
+00000490: 2c0a 2020 2020 5448 4953 5f44 4952 2c0a  ,.    THIS_DIR,.
+000004a0: 2020 2020 426c 6163 6b42 6173 6554 6573      BlackBaseTes
+000004b0: 7443 6173 652c 0a20 2020 2061 7373 6572  tCase,.    asser
+000004c0: 745f 666f 726d 6174 2c0a 2020 2020 6368  t_format,.    ch
+000004d0: 616e 6765 5f64 6972 6563 746f 7279 2c0a  ange_directory,.
+000004e0: 2020 2020 6475 6d70 5f74 6f5f 7374 6465      dump_to_stde
+000004f0: 7272 2c0a 2020 2020 6666 2c0a 2020 2020  rr,.    ff,.    
+00000500: 6673 2c0a 2020 2020 6765 745f 6361 7365  fs,.    get_case
+00000510: 5f70 6174 682c 0a20 2020 2072 6561 645f  _path,.    read_
+00000520: 6461 7461 2c0a 2020 2020 7265 6164 5f64  data,.    read_d
+00000530: 6174 615f 6672 6f6d 5f66 696c 652c 0a29  ata_from_file,.)
+00000540: 0a0a 5448 4953 5f46 494c 4520 3d20 5061  ..THIS_FILE = Pa
+00000550: 7468 285f 5f66 696c 655f 5f29 0a45 4d50  th(__file__).EMP
+00000560: 5459 5f43 4f4e 4649 4720 3d20 5448 4953  TY_CONFIG = THIS
+00000570: 5f44 4952 202f 2022 6461 7461 2220 2f20  _DIR / "data" / 
+00000580: 2265 6d70 7479 5f70 7970 726f 6a65 6374  "empty_pyproject
+00000590: 2e74 6f6d 6c22 0a50 5933 365f 4152 4753  .toml".PY36_ARGS
+000005a0: 203d 205b 6622 2d2d 7461 7267 6574 2d76   = [f"--target-v
+000005b0: 6572 7369 6f6e 3d7b 7665 7273 696f 6e2e  ersion={version.
+000005c0: 6e61 6d65 2e6c 6f77 6572 2829 7d22 2066  name.lower()}" f
+000005d0: 6f72 2076 6572 7369 6f6e 2069 6e20 5059  or version in PY
+000005e0: 3336 5f56 4552 5349 4f4e 535d 0a44 4546  36_VERSIONS].DEF
+000005f0: 4155 4c54 5f45 5843 4c55 4445 203d 2062  AULT_EXCLUDE = b
+00000600: 6c61 636b 2e72 655f 636f 6d70 696c 655f  lack.re_compile_
+00000610: 6d61 7962 655f 7665 7262 6f73 6528 626c  maybe_verbose(bl
+00000620: 6163 6b2e 636f 6e73 742e 4445 4641 554c  ack.const.DEFAUL
+00000630: 545f 4558 434c 5544 4553 290a 4445 4641  T_EXCLUDES).DEFA
+00000640: 554c 545f 494e 434c 5544 4520 3d20 626c  ULT_INCLUDE = bl
+00000650: 6163 6b2e 7265 5f63 6f6d 7069 6c65 5f6d  ack.re_compile_m
+00000660: 6179 6265 5f76 6572 626f 7365 2862 6c61  aybe_verbose(bla
+00000670: 636b 2e63 6f6e 7374 2e44 4546 4155 4c54  ck.const.DEFAULT
+00000680: 5f49 4e43 4c55 4445 5329 0a54 203d 2054  _INCLUDES).T = T
+00000690: 7970 6556 6172 2822 5422 290a 5220 3d20  ypeVar("T").R = 
+000006a0: 5479 7065 5661 7228 2252 2229 0a0a 2320  TypeVar("R")..# 
+000006b0: 4d61 7463 6820 7468 6520 7469 6d65 206f  Match the time o
+000006c0: 7574 7075 7420 696e 2061 2064 6966 662c  utput in a diff,
+000006d0: 2062 7574 206e 6f74 6869 6e67 2065 6c73   but nothing els
+000006e0: 650a 4449 4646 5f54 494d 4520 3d20 7265  e.DIFF_TIME = re
+000006f0: 2e63 6f6d 7069 6c65 2872 225c 745b 5c64  .compile(r"\t[\d
+00000700: 5c2d 3a2b 5c2e 205d 2b22 290a 0a0a 4063  \-:+\. ]+")...@c
+00000710: 6f6e 7465 7874 6d61 6e61 6765 720a 6465  ontextmanager.de
+00000720: 6620 6361 6368 655f 6469 7228 6578 6973  f cache_dir(exis
+00000730: 7473 3a20 626f 6f6c 203d 2054 7275 6529  ts: bool = True)
+00000740: 202d 3e20 4974 6572 6174 6f72 5b50 6174   -> Iterator[Pat
+00000750: 685d 3a0a 2020 2020 7769 7468 2054 656d  h]:.    with Tem
+00000760: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
+00000770: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+00000780: 2020 2020 2020 2020 6361 6368 655f 6469          cache_di
+00000790: 7220 3d20 5061 7468 2877 6f72 6b73 7061  r = Path(workspa
+000007a0: 6365 290a 2020 2020 2020 2020 6966 206e  ce).        if n
+000007b0: 6f74 2065 7869 7374 733a 0a20 2020 2020  ot exists:.     
+000007c0: 2020 2020 2020 2063 6163 6865 5f64 6972         cache_dir
+000007d0: 203d 2063 6163 6865 5f64 6972 202f 2022   = cache_dir / "
+000007e0: 6e65 7722 0a20 2020 2020 2020 2077 6974  new".        wit
+000007f0: 6820 7061 7463 6828 2262 6c61 636b 2e63  h patch("black.c
+00000800: 6163 6865 2e43 4143 4845 5f44 4952 222c  ache.CACHE_DIR",
+00000810: 2063 6163 6865 5f64 6972 293a 0a20 2020   cache_dir):.   
+00000820: 2020 2020 2020 2020 2079 6965 6c64 2063           yield c
+00000830: 6163 6865 5f64 6972 0a0a 0a40 636f 6e74  ache_dir...@cont
+00000840: 6578 746d 616e 6167 6572 0a64 6566 2065  extmanager.def e
+00000850: 7665 6e74 5f6c 6f6f 7028 2920 2d3e 2049  vent_loop() -> I
+00000860: 7465 7261 746f 725b 4e6f 6e65 5d3a 0a20  terator[None]:. 
+00000870: 2020 2070 6f6c 6963 7920 3d20 6173 796e     policy = asyn
+00000880: 6369 6f2e 6765 745f 6576 656e 745f 6c6f  cio.get_event_lo
+00000890: 6f70 5f70 6f6c 6963 7928 290a 2020 2020  op_policy().    
+000008a0: 6c6f 6f70 203d 2070 6f6c 6963 792e 6e65  loop = policy.ne
+000008b0: 775f 6576 656e 745f 6c6f 6f70 2829 0a20  w_event_loop(). 
+000008c0: 2020 2061 7379 6e63 696f 2e73 6574 5f65     asyncio.set_e
+000008d0: 7665 6e74 5f6c 6f6f 7028 6c6f 6f70 290a  vent_loop(loop).
+000008e0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000008f0: 2079 6965 6c64 0a0a 2020 2020 6669 6e61   yield..    fina
+00000900: 6c6c 793a 0a20 2020 2020 2020 206c 6f6f  lly:.        loo
+00000910: 702e 636c 6f73 6528 290a 0a0a 636c 6173  p.close()...clas
+00000920: 7320 4661 6b65 436f 6e74 6578 7428 636c  s FakeContext(cl
+00000930: 6963 6b2e 436f 6e74 6578 7429 3a0a 2020  ick.Context):.  
+00000940: 2020 2222 2241 2066 616b 6520 636c 6963    """A fake clic
+00000950: 6b20 436f 6e74 6578 7420 666f 7220 7768  k Context for wh
+00000960: 656e 2063 616c 6c69 6e67 2066 756e 6374  en calling funct
+00000970: 696f 6e73 2074 6861 7420 6e65 6564 2069  ions that need i
+00000980: 742e 2222 220a 0a20 2020 2064 6566 205f  t."""..    def _
+00000990: 5f69 6e69 745f 5f28 7365 6c66 2920 2d3e  _init__(self) ->
+000009a0: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+000009b0: 656c 662e 6465 6661 756c 745f 6d61 703a  elf.default_map:
+000009c0: 2044 6963 745b 7374 722c 2041 6e79 5d20   Dict[str, Any] 
+000009d0: 3d20 7b7d 0a20 2020 2020 2020 2023 2044  = {}.        # D
+000009e0: 756d 6d79 2072 6f6f 742c 2073 696e 6365  ummy root, since
+000009f0: 206d 6f73 7420 6f66 2074 6865 2074 6573   most of the tes
+00000a00: 7473 2064 6f6e 2774 2063 6172 6520 6162  ts don't care ab
+00000a10: 6f75 7420 6974 0a20 2020 2020 2020 2073  out it.        s
+00000a20: 656c 662e 6f62 6a3a 2044 6963 745b 7374  elf.obj: Dict[st
+00000a30: 722c 2041 6e79 5d20 3d20 7b22 726f 6f74  r, Any] = {"root
+00000a40: 223a 2050 524f 4a45 4354 5f52 4f4f 547d  ": PROJECT_ROOT}
+00000a50: 0a0a 0a63 6c61 7373 2046 616b 6550 6172  ...class FakePar
+00000a60: 616d 6574 6572 2863 6c69 636b 2e50 6172  ameter(click.Par
+00000a70: 616d 6574 6572 293a 0a20 2020 2022 2222  ameter):.    """
+00000a80: 4120 6661 6b65 2063 6c69 636b 2050 6172  A fake click Par
+00000a90: 616d 6574 6572 2066 6f72 2077 6865 6e20  ameter for when 
+00000aa0: 6361 6c6c 696e 6720 6675 6e63 7469 6f6e  calling function
+00000ab0: 7320 7468 6174 206e 6565 6420 6974 2e22  s that need it."
+00000ac0: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+00000ad0: 6974 5f5f 2873 656c 6629 202d 3e20 4e6f  it__(self) -> No
+00000ae0: 6e65 3a0a 2020 2020 2020 2020 7061 7373  ne:.        pass
+00000af0: 0a0a 0a63 6c61 7373 2042 6c61 636b 5275  ...class BlackRu
+00000b00: 6e6e 6572 2843 6c69 5275 6e6e 6572 293a  nner(CliRunner):
+00000b10: 0a20 2020 2022 2222 4d61 6b65 2073 7572  .    """Make sur
+00000b20: 6520 5354 444f 5554 2061 6e64 2053 5444  e STDOUT and STD
+00000b30: 4552 5220 6172 6520 6b65 7074 2073 6570  ERR are kept sep
+00000b40: 6172 6174 6520 7768 656e 2074 6573 7469  arate when testi
+00000b50: 6e67 2042 6c61 636b 2076 6961 2069 7473  ng Black via its
+00000b60: 2043 4c49 2e22 2222 0a0a 2020 2020 6465   CLI."""..    de
+00000b70: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
+00000b80: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00000b90: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
+00000ba0: 5f5f 286d 6978 5f73 7464 6572 723d 4661  __(mix_stderr=Fa
+00000bb0: 6c73 6529 0a0a 0a64 6566 2069 6e76 6f6b  lse)...def invok
+00000bc0: 6542 6c61 636b 280a 2020 2020 6172 6773  eBlack(.    args
+00000bd0: 3a20 4c69 7374 5b73 7472 5d2c 2065 7869  : List[str], exi
+00000be0: 745f 636f 6465 3a20 696e 7420 3d20 302c  t_code: int = 0,
+00000bf0: 2069 676e 6f72 655f 636f 6e66 6967 3a20   ignore_config: 
+00000c00: 626f 6f6c 203d 2054 7275 650a 2920 2d3e  bool = True.) ->
+00000c10: 204e 6f6e 653a 0a20 2020 2072 756e 6e65   None:.    runne
+00000c20: 7220 3d20 426c 6163 6b52 756e 6e65 7228  r = BlackRunner(
+00000c30: 290a 2020 2020 6966 2069 676e 6f72 655f  ).    if ignore_
+00000c40: 636f 6e66 6967 3a0a 2020 2020 2020 2020  config:.        
+00000c50: 6172 6773 203d 205b 222d 2d76 6572 626f  args = ["--verbo
+00000c60: 7365 222c 2022 2d2d 636f 6e66 6967 222c  se", "--config",
+00000c70: 2073 7472 2854 4849 535f 4449 5220 2f20   str(THIS_DIR / 
+00000c80: 2265 6d70 7479 2e74 6f6d 6c22 292c 202a  "empty.toml"), *
+00000c90: 6172 6773 5d0a 2020 2020 7265 7375 6c74  args].    result
+00000ca0: 203d 2072 756e 6e65 722e 696e 766f 6b65   = runner.invoke
+00000cb0: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
+00000cc0: 732c 2063 6174 6368 5f65 7863 6570 7469  s, catch_excepti
+00000cd0: 6f6e 733d 4661 6c73 6529 0a20 2020 2061  ons=False).    a
+00000ce0: 7373 6572 7420 7265 7375 6c74 2e73 7464  ssert result.std
+00000cf0: 6f75 745f 6279 7465 7320 6973 206e 6f74  out_bytes is not
+00000d00: 204e 6f6e 650a 2020 2020 6173 7365 7274   None.    assert
+00000d10: 2072 6573 756c 742e 7374 6465 7272 5f62   result.stderr_b
+00000d20: 7974 6573 2069 7320 6e6f 7420 4e6f 6e65  ytes is not None
+00000d30: 0a20 2020 206d 7367 203d 2028 0a20 2020  .    msg = (.   
+00000d40: 2020 2020 2066 2246 6169 6c65 6420 7769       f"Failed wi
+00000d50: 7468 2061 7267 733a 207b 6172 6773 7d5c  th args: {args}\
+00000d60: 6e22 0a20 2020 2020 2020 2066 2273 7464  n".        f"std
+00000d70: 6f75 743a 207b 7265 7375 6c74 2e73 7464  out: {result.std
+00000d80: 6f75 745f 6279 7465 732e 6465 636f 6465  out_bytes.decode
+00000d90: 2829 2172 7d5c 6e22 0a20 2020 2020 2020  ()!r}\n".       
+00000da0: 2066 2273 7464 6572 723a 207b 7265 7375   f"stderr: {resu
+00000db0: 6c74 2e73 7464 6572 725f 6279 7465 732e  lt.stderr_bytes.
+00000dc0: 6465 636f 6465 2829 2172 7d5c 6e22 0a20  decode()!r}\n". 
+00000dd0: 2020 2020 2020 2066 2265 7863 6570 7469         f"excepti
+00000de0: 6f6e 3a20 7b72 6573 756c 742e 6578 6365  on: {result.exce
+00000df0: 7074 696f 6e7d 220a 2020 2020 290a 2020  ption}".    ).  
+00000e00: 2020 6173 7365 7274 2072 6573 756c 742e    assert result.
+00000e10: 6578 6974 5f63 6f64 6520 3d3d 2065 7869  exit_code == exi
+00000e20: 745f 636f 6465 2c20 6d73 670a 0a0a 636c  t_code, msg...cl
+00000e30: 6173 7320 426c 6163 6b54 6573 7443 6173  ass BlackTestCas
+00000e40: 6528 426c 6163 6b42 6173 6554 6573 7443  e(BlackBaseTestC
+00000e50: 6173 6529 3a0a 2020 2020 696e 766f 6b65  ase):.    invoke
+00000e60: 426c 6163 6b20 3d20 7374 6174 6963 6d65  Black = staticme
+00000e70: 7468 6f64 2869 6e76 6f6b 6542 6c61 636b  thod(invokeBlack
+00000e80: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00000e90: 656d 7074 795f 6666 2873 656c 6629 202d  empty_ff(self) -
+00000ea0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00000eb0: 6578 7065 6374 6564 203d 2022 220a 2020  expected = "".  
+00000ec0: 2020 2020 2020 746d 705f 6669 6c65 203d        tmp_file =
+00000ed0: 2050 6174 6828 626c 6163 6b2e 6475 6d70   Path(black.dump
+00000ee0: 5f74 6f5f 6669 6c65 2829 290a 2020 2020  _to_file()).    
+00000ef0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00000f00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00000f10: 4661 6c73 6528 6666 2874 6d70 5f66 696c  False(ff(tmp_fil
+00000f20: 652c 2077 7269 7465 5f62 6163 6b3d 626c  e, write_back=bl
+00000f30: 6163 6b2e 5772 6974 6542 6163 6b2e 5945  ack.WriteBack.YE
+00000f40: 5329 290a 2020 2020 2020 2020 2020 2020  S)).            
+00000f50: 7769 7468 206f 7065 6e28 746d 705f 6669  with open(tmp_fi
+00000f60: 6c65 2c20 656e 636f 6469 6e67 3d22 7574  le, encoding="ut
+00000f70: 6638 2229 2061 7320 663a 0a20 2020 2020  f8") as f:.     
+00000f80: 2020 2020 2020 2020 2020 2061 6374 7561             actua
+00000f90: 6c20 3d20 662e 7265 6164 2829 0a20 2020  l = f.read().   
+00000fa0: 2020 2020 2066 696e 616c 6c79 3a0a 2020       finally:.  
+00000fb0: 2020 2020 2020 2020 2020 6f73 2e75 6e6c            os.unl
+00000fc0: 696e 6b28 746d 705f 6669 6c65 290a 2020  ink(tmp_file).  
+00000fd0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00000fe0: 7446 6f72 6d61 7445 7175 616c 2865 7870  tFormatEqual(exp
+00000ff0: 6563 7465 642c 2061 6374 7561 6c29 0a0a  ected, actual)..
+00001000: 2020 2020 4070 6174 6368 2822 626c 6163      @patch("blac
+00001010: 6b2e 6475 6d70 5f74 6f5f 6669 6c65 222c  k.dump_to_file",
+00001020: 2064 756d 705f 746f 5f73 7464 6572 7229   dump_to_stderr)
+00001030: 0a20 2020 2064 6566 2074 6573 745f 6f6e  .    def test_on
+00001040: 655f 656d 7074 795f 6c69 6e65 2873 656c  e_empty_line(sel
+00001050: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00001060: 2020 2020 6d6f 6465 203d 2062 6c61 636b      mode = black
+00001070: 2e4d 6f64 6528 7072 6576 6965 773d 5472  .Mode(preview=Tr
+00001080: 7565 290a 2020 2020 2020 2020 666f 7220  ue).        for 
+00001090: 6e6c 2069 6e20 5b22 5c6e 222c 2022 5c72  nl in ["\n", "\r
+000010a0: 5c6e 225d 3a0a 2020 2020 2020 2020 2020  \n"]:.          
+000010b0: 2020 736f 7572 6365 203d 2065 7870 6563    source = expec
+000010c0: 7465 6420 3d20 6e6c 0a20 2020 2020 2020  ted = nl.       
+000010d0: 2020 2020 2061 7373 6572 745f 666f 726d       assert_form
+000010e0: 6174 2873 6f75 7263 652c 2065 7870 6563  at(source, expec
+000010f0: 7465 642c 206d 6f64 653d 6d6f 6465 290a  ted, mode=mode).
+00001100: 0a20 2020 2064 6566 2074 6573 745f 6f6e  .    def test_on
+00001110: 655f 656d 7074 795f 6c69 6e65 5f66 6628  e_empty_line_ff(
+00001120: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00001130: 2020 2020 2020 206d 6f64 6520 3d20 626c         mode = bl
+00001140: 6163 6b2e 4d6f 6465 2870 7265 7669 6577  ack.Mode(preview
+00001150: 3d54 7275 6529 0a20 2020 2020 2020 2066  =True).        f
+00001160: 6f72 206e 6c20 696e 205b 225c 6e22 2c20  or nl in ["\n", 
+00001170: 225c 725c 6e22 5d3a 0a20 2020 2020 2020  "\r\n"]:.       
+00001180: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
+00001190: 6e6c 0a20 2020 2020 2020 2020 2020 2074  nl.            t
+000011a0: 6d70 5f66 696c 6520 3d20 5061 7468 2862  mp_file = Path(b
+000011b0: 6c61 636b 2e64 756d 705f 746f 5f66 696c  lack.dump_to_fil
+000011c0: 6528 6e6c 2929 0a20 2020 2020 2020 2020  e(nl)).         
+000011d0: 2020 2069 6620 7379 7374 656d 2829 203d     if system() =
+000011e0: 3d20 2257 696e 646f 7773 223a 0a20 2020  = "Windows":.   
+000011f0: 2020 2020 2020 2020 2020 2020 2023 2057               # W
+00001200: 7269 7469 6e67 2066 696c 6573 2069 6e20  riting files in 
+00001210: 7465 7874 206d 6f64 6520 6175 746f 6d61  text mode automa
+00001220: 7469 6361 6c6c 7920 7573 6573 2074 6865  tically uses the
+00001230: 2073 7973 7465 6d20 6e65 776c 696e 652c   system newline,
+00001240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001250: 2023 2062 7574 2069 6e20 7468 6973 2063   # but in this c
+00001260: 6173 6520 7765 2064 6f6e 2774 2077 616e  ase we don't wan
+00001270: 7420 7468 6973 2066 6f72 2074 6573 7469  t this for testi
+00001280: 6e67 2072 6561 736f 6e73 2e20 5365 653a  ng reasons. See:
+00001290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000012a0: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
+000012b0: 622e 636f 6d2f 7073 662f 626c 6163 6b2f  b.com/psf/black/
+000012c0: 7075 6c6c 2f33 3334 380a 2020 2020 2020  pull/3348.      
+000012d0: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+000012e0: 7065 6e28 746d 705f 6669 6c65 2c20 2277  pen(tmp_file, "w
+000012f0: 6222 2920 6173 2066 3a0a 2020 2020 2020  b") as f:.      
+00001300: 2020 2020 2020 2020 2020 2020 2020 662e                f.
+00001310: 7772 6974 6528 6e6c 2e65 6e63 6f64 6528  write(nl.encode(
+00001320: 2275 7466 2d38 2229 290a 2020 2020 2020  "utf-8")).      
+00001330: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00001340: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00001350: 6173 7365 7274 4661 6c73 6528 0a20 2020  assertFalse(.   
+00001360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001370: 2066 6628 746d 705f 6669 6c65 2c20 6d6f   ff(tmp_file, mo
+00001380: 6465 3d6d 6f64 652c 2077 7269 7465 5f62  de=mode, write_b
+00001390: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
+000013a0: 6163 6b2e 5945 5329 0a20 2020 2020 2020  ack.YES).       
+000013b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000013c0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+000013d0: 6f70 656e 2874 6d70 5f66 696c 652c 2022  open(tmp_file, "
+000013e0: 7262 2229 2061 7320 663a 0a20 2020 2020  rb") as f:.     
+000013f0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00001400: 6374 7561 6c20 3d20 662e 7265 6164 2829  ctual = f.read()
+00001410: 2e64 6563 6f64 6528 2275 7466 3822 290a  .decode("utf8").
+00001420: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
+00001430: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
+00001440: 2020 2020 206f 732e 756e 6c69 6e6b 2874       os.unlink(t
+00001450: 6d70 5f66 696c 6529 0a20 2020 2020 2020  mp_file).       
+00001460: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00001470: 466f 726d 6174 4571 7561 6c28 6578 7065  FormatEqual(expe
+00001480: 6374 6564 2c20 6163 7475 616c 290a 0a20  cted, actual).. 
+00001490: 2020 2064 6566 2074 6573 745f 6578 7065     def test_expe
+000014a0: 7269 6d65 6e74 616c 5f73 7472 696e 675f  rimental_string_
+000014b0: 7072 6f63 6573 7369 6e67 5f77 6172 6e73  processing_warns
+000014c0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000014d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000014e0: 6572 7457 6172 6e73 280a 2020 2020 2020  ertWarns(.      
+000014f0: 2020 2020 2020 626c 6163 6b2e 6d6f 6465        black.mode
+00001500: 2e44 6570 7265 6361 7465 642c 2062 6c61  .Deprecated, bla
+00001510: 636b 2e4d 6f64 652c 2065 7870 6572 696d  ck.Mode, experim
+00001520: 656e 7461 6c5f 7374 7269 6e67 5f70 726f  ental_string_pro
+00001530: 6365 7373 696e 673d 5472 7565 0a20 2020  cessing=True.   
+00001540: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00001550: 7465 7374 5f70 6970 696e 6728 7365 6c66  test_piping(self
+00001560: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00001570: 2020 2073 6f75 7263 652c 2065 7870 6563     source, expec
+00001580: 7465 6420 3d20 7265 6164 5f64 6174 615f  ted = read_data_
+00001590: 6672 6f6d 5f66 696c 6528 5052 4f4a 4543  from_file(PROJEC
+000015a0: 545f 524f 4f54 202f 2022 7372 632f 626c  T_ROOT / "src/bl
+000015b0: 6163 6b2f 5f5f 696e 6974 5f5f 2e70 7922  ack/__init__.py"
+000015c0: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
+000015d0: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
+000015e0: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
+000015f0: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
+00001600: 0a20 2020 2020 2020 2020 2020 205b 0a20  .            [. 
+00001610: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00001620: 2d22 2c0a 2020 2020 2020 2020 2020 2020  -",.            
+00001630: 2020 2020 222d 2d66 6173 7422 2c0a 2020      "--fast",.  
+00001640: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00001650: 2d2d 6c69 6e65 2d6c 656e 6774 683d 7b62  --line-length={b
+00001660: 6c61 636b 2e44 4546 4155 4c54 5f4c 494e  lack.DEFAULT_LIN
+00001670: 455f 4c45 4e47 5448 7d22 2c0a 2020 2020  E_LENGTH}",.    
+00001680: 2020 2020 2020 2020 2020 2020 6622 2d2d              f"--
+00001690: 636f 6e66 6967 3d7b 454d 5054 595f 434f  config={EMPTY_CO
+000016a0: 4e46 4947 7d22 2c0a 2020 2020 2020 2020  NFIG}",.        
+000016b0: 2020 2020 5d2c 0a20 2020 2020 2020 2020      ],.         
+000016c0: 2020 2069 6e70 7574 3d42 7974 6573 494f     input=BytesIO
+000016d0: 2873 6f75 7263 652e 656e 636f 6465 2822  (source.encode("
+000016e0: 7574 6638 2229 292c 0a20 2020 2020 2020  utf8")),.       
+000016f0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
+00001700: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
+00001710: 6c74 2e65 7869 745f 636f 6465 2c20 3029  lt.exit_code, 0)
+00001720: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00001730: 7365 7274 466f 726d 6174 4571 7561 6c28  sertFormatEqual(
+00001740: 6578 7065 6374 6564 2c20 7265 7375 6c74  expected, result
+00001750: 2e6f 7574 7075 7429 0a20 2020 2020 2020  .output).       
+00001760: 2069 6620 736f 7572 6365 2021 3d20 7265   if source != re
+00001770: 7375 6c74 2e6f 7574 7075 743a 0a20 2020  sult.output:.   
+00001780: 2020 2020 2020 2020 2062 6c61 636b 2e61           black.a
+00001790: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
+000017a0: 2873 6f75 7263 652c 2072 6573 756c 742e  (source, result.
+000017b0: 6f75 7470 7574 290a 2020 2020 2020 2020  output).        
+000017c0: 2020 2020 626c 6163 6b2e 6173 7365 7274      black.assert
+000017d0: 5f73 7461 626c 6528 736f 7572 6365 2c20  _stable(source, 
+000017e0: 7265 7375 6c74 2e6f 7574 7075 742c 2044  result.output, D
+000017f0: 4546 4155 4c54 5f4d 4f44 4529 0a0a 2020  EFAULT_MODE)..  
+00001800: 2020 6465 6620 7465 7374 5f70 6970 696e    def test_pipin
+00001810: 675f 6469 6666 2873 656c 6629 202d 3e20  g_diff(self) -> 
+00001820: 4e6f 6e65 3a0a 2020 2020 2020 2020 6469  None:.        di
+00001830: 6666 5f68 6561 6465 7220 3d20 7265 2e63  ff_header = re.c
+00001840: 6f6d 7069 6c65 280a 2020 2020 2020 2020  ompile(.        
+00001850: 2020 2020 7222 2853 5444 494e 7c53 5444      r"(STDIN|STD
+00001860: 4f55 5429 5c74 5c64 5c64 5c64 5c64 2d5c  OUT)\t\d\d\d\d-\
+00001870: 645c 642d 5c64 5c64 205c 645c 643a 5c64  d\d-\d\d \d\d:\d
+00001880: 5c64 3a5c 645c 645c 2e5c 645c 645c 645c  \d:\d\d\.\d\d\d\
+00001890: 645c 645c 6420 220a 2020 2020 2020 2020  d\d\d ".        
+000018a0: 2020 2020 7222 5c2b 5c64 5c64 5c64 5c64      r"\+\d\d\d\d
+000018b0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+000018c0: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
+000018d0: 7265 6164 5f64 6174 6128 2273 696d 706c  read_data("simpl
+000018e0: 655f 6361 7365 7322 2c20 2265 7870 7265  e_cases", "expre
+000018f0: 7373 696f 6e2e 7079 2229 0a20 2020 2020  ssion.py").     
+00001900: 2020 2065 7870 6563 7465 642c 205f 203d     expected, _ =
+00001910: 2072 6561 645f 6461 7461 2822 7369 6d70   read_data("simp
+00001920: 6c65 5f63 6173 6573 222c 2022 6578 7072  le_cases", "expr
+00001930: 6573 7369 6f6e 2e64 6966 6622 290a 2020  ession.diff").  
+00001940: 2020 2020 2020 6172 6773 203d 205b 0a20        args = [. 
+00001950: 2020 2020 2020 2020 2020 2022 2d22 2c0a             "-",.
+00001960: 2020 2020 2020 2020 2020 2020 222d 2d66              "--f
+00001970: 6173 7422 2c0a 2020 2020 2020 2020 2020  ast",.          
+00001980: 2020 6622 2d2d 6c69 6e65 2d6c 656e 6774    f"--line-lengt
+00001990: 683d 7b62 6c61 636b 2e44 4546 4155 4c54  h={black.DEFAULT
+000019a0: 5f4c 494e 455f 4c45 4e47 5448 7d22 2c0a  _LINE_LENGTH}",.
+000019b0: 2020 2020 2020 2020 2020 2020 222d 2d64              "--d
+000019c0: 6966 6622 2c0a 2020 2020 2020 2020 2020  iff",.          
+000019d0: 2020 6622 2d2d 636f 6e66 6967 3d7b 454d    f"--config={EM
+000019e0: 5054 595f 434f 4e46 4947 7d22 2c0a 2020  PTY_CONFIG}",.  
+000019f0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00001a00: 7265 7375 6c74 203d 2042 6c61 636b 5275  result = BlackRu
+00001a10: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
+00001a20: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+00001a30: 2e6d 6169 6e2c 2061 7267 732c 2069 6e70  .main, args, inp
+00001a40: 7574 3d42 7974 6573 494f 2873 6f75 7263  ut=BytesIO(sourc
+00001a50: 652e 656e 636f 6465 2822 7574 6638 2229  e.encode("utf8")
+00001a60: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00001a70: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00001a80: 7175 616c 2872 6573 756c 742e 6578 6974  qual(result.exit
+00001a90: 5f63 6f64 652c 2030 290a 2020 2020 2020  _code, 0).      
+00001aa0: 2020 6163 7475 616c 203d 2064 6966 665f    actual = diff_
+00001ab0: 6865 6164 6572 2e73 7562 2844 4554 4552  header.sub(DETER
+00001ac0: 4d49 4e49 5354 4943 5f48 4541 4445 522c  MINISTIC_HEADER,
+00001ad0: 2072 6573 756c 742e 6f75 7470 7574 290a   result.output).
+00001ae0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
+00001af0: 2061 6374 7561 6c2e 7273 7472 6970 2829   actual.rstrip()
+00001b00: 202b 2022 5c6e 2220 2023 2074 6865 2064   + "\n"  # the d
+00001b10: 6966 6620 6f75 7470 7574 2068 6173 2061  iff output has a
+00001b20: 2074 7261 696c 696e 6720 7370 6163 650a   trailing space.
+00001b30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00001b40: 6572 7445 7175 616c 2865 7870 6563 7465  ertEqual(expecte
+00001b50: 642c 2061 6374 7561 6c29 0a0a 2020 2020  d, actual)..    
+00001b60: 6465 6620 7465 7374 5f70 6970 696e 675f  def test_piping_
+00001b70: 6469 6666 5f77 6974 685f 636f 6c6f 7228  diff_with_color(
+00001b80: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00001b90: 2020 2020 2020 2073 6f75 7263 652c 205f         source, _
+00001ba0: 203d 2072 6561 645f 6461 7461 2822 7369   = read_data("si
+00001bb0: 6d70 6c65 5f63 6173 6573 222c 2022 6578  mple_cases", "ex
+00001bc0: 7072 6573 7369 6f6e 2e70 7922 290a 2020  pression.py").  
+00001bd0: 2020 2020 2020 6172 6773 203d 205b 0a20        args = [. 
+00001be0: 2020 2020 2020 2020 2020 2022 2d22 2c0a             "-",.
+00001bf0: 2020 2020 2020 2020 2020 2020 222d 2d66              "--f
+00001c00: 6173 7422 2c0a 2020 2020 2020 2020 2020  ast",.          
+00001c10: 2020 6622 2d2d 6c69 6e65 2d6c 656e 6774    f"--line-lengt
+00001c20: 683d 7b62 6c61 636b 2e44 4546 4155 4c54  h={black.DEFAULT
+00001c30: 5f4c 494e 455f 4c45 4e47 5448 7d22 2c0a  _LINE_LENGTH}",.
+00001c40: 2020 2020 2020 2020 2020 2020 222d 2d64              "--d
+00001c50: 6966 6622 2c0a 2020 2020 2020 2020 2020  iff",.          
+00001c60: 2020 222d 2d63 6f6c 6f72 222c 0a20 2020    "--color",.   
+00001c70: 2020 2020 2020 2020 2066 222d 2d63 6f6e           f"--con
+00001c80: 6669 673d 7b45 4d50 5459 5f43 4f4e 4649  fig={EMPTY_CONFI
+00001c90: 477d 222c 0a20 2020 2020 2020 205d 0a20  G}",.        ]. 
+00001ca0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00001cb0: 426c 6163 6b52 756e 6e65 7228 292e 696e  BlackRunner().in
+00001cc0: 766f 6b65 280a 2020 2020 2020 2020 2020  voke(.          
+00001cd0: 2020 626c 6163 6b2e 6d61 696e 2c20 6172    black.main, ar
+00001ce0: 6773 2c20 696e 7075 743d 4279 7465 7349  gs, input=BytesI
+00001cf0: 4f28 736f 7572 6365 2e65 6e63 6f64 6528  O(source.encode(
+00001d00: 2275 7466 3822 2929 0a20 2020 2020 2020  "utf8")).       
+00001d10: 2029 0a20 2020 2020 2020 2061 6374 7561   ).        actua
+00001d20: 6c20 3d20 7265 7375 6c74 2e6f 7574 7075  l = result.outpu
+00001d30: 740a 2020 2020 2020 2020 2320 4167 6169  t.        # Agai
+00001d40: 6e2c 2074 6865 2063 6f6e 7465 6e74 7320  n, the contents 
+00001d50: 6172 6520 6368 6563 6b65 6420 696e 2061  are checked in a
+00001d60: 2064 6966 6665 7265 6e74 2074 6573 742c   different test,
+00001d70: 2073 6f20 6f6e 6c79 206c 6f6f 6b20 666f   so only look fo
+00001d80: 7220 636f 6c6f 7273 2e0a 2020 2020 2020  r colors..      
+00001d90: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+00001da0: 225c 3033 335b 316d 222c 2061 6374 7561  "\033[1m", actua
+00001db0: 6c29 0a20 2020 2020 2020 2073 656c 662e  l).        self.
+00001dc0: 6173 7365 7274 496e 2822 5c30 3333 5b33  assertIn("\033[3
+00001dd0: 366d 222c 2061 6374 7561 6c29 0a20 2020  6m", actual).   
+00001de0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00001df0: 496e 2822 5c30 3333 5b33 326d 222c 2061  In("\033[32m", a
+00001e00: 6374 7561 6c29 0a20 2020 2020 2020 2073  ctual).        s
+00001e10: 656c 662e 6173 7365 7274 496e 2822 5c30  elf.assertIn("\0
+00001e20: 3333 5b33 316d 222c 2061 6374 7561 6c29  33[31m", actual)
+00001e30: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00001e40: 7365 7274 496e 2822 5c30 3333 5b30 6d22  sertIn("\033[0m"
+00001e50: 2c20 6163 7475 616c 290a 0a20 2020 2040  , actual)..    @
+00001e60: 7061 7463 6828 2262 6c61 636b 2e64 756d  patch("black.dum
+00001e70: 705f 746f 5f66 696c 6522 2c20 6475 6d70  p_to_file", dump
+00001e80: 5f74 6f5f 7374 6465 7272 290a 2020 2020  _to_stderr).    
+00001e90: 6465 6620 5f74 6573 745f 7769 7028 7365  def _test_wip(se
+00001ea0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00001eb0: 2020 2020 2073 6f75 7263 652c 2065 7870       source, exp
+00001ec0: 6563 7465 6420 3d20 7265 6164 5f64 6174  ected = read_dat
+00001ed0: 6128 226d 6973 6365 6c6c 616e 656f 7573  a("miscellaneous
+00001ee0: 222c 2022 7769 7022 290a 2020 2020 2020  ", "wip").      
+00001ef0: 2020 7379 732e 7365 7474 7261 6365 2874    sys.settrace(t
+00001f00: 7261 6365 6675 6e63 290a 2020 2020 2020  racefunc).      
+00001f10: 2020 6d6f 6465 203d 2072 6570 6c61 6365    mode = replace
+00001f20: 280a 2020 2020 2020 2020 2020 2020 4445  (.            DE
+00001f30: 4641 554c 545f 4d4f 4445 2c0a 2020 2020  FAULT_MODE,.    
+00001f40: 2020 2020 2020 2020 6578 7065 7269 6d65          experime
+00001f50: 6e74 616c 5f73 7472 696e 675f 7072 6f63  ntal_string_proc
+00001f60: 6573 7369 6e67 3d46 616c 7365 2c0a 2020  essing=False,.  
+00001f70: 2020 2020 2020 2020 2020 7461 7267 6574            target
+00001f80: 5f76 6572 7369 6f6e 733d 7b62 6c61 636b  _versions={black
+00001f90: 2e54 6172 6765 7456 6572 7369 6f6e 2e50  .TargetVersion.P
+00001fa0: 5933 387d 2c0a 2020 2020 2020 2020 290a  Y38},.        ).
+00001fb0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
+00001fc0: 2066 7328 736f 7572 6365 2c20 6d6f 6465   fs(source, mode
+00001fd0: 3d6d 6f64 6529 0a20 2020 2020 2020 2073  =mode).        s
+00001fe0: 7973 2e73 6574 7472 6163 6528 4e6f 6e65  ys.settrace(None
+00001ff0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00002000: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
+00002010: 2865 7870 6563 7465 642c 2061 6374 7561  (expected, actua
+00002020: 6c29 0a20 2020 2020 2020 2062 6c61 636b  l).        black
+00002030: 2e61 7373 6572 745f 6571 7569 7661 6c65  .assert_equivale
+00002040: 6e74 2873 6f75 7263 652c 2061 6374 7561  nt(source, actua
+00002050: 6c29 0a20 2020 2020 2020 2062 6c61 636b  l).        black
+00002060: 2e61 7373 6572 745f 7374 6162 6c65 2873  .assert_stable(s
+00002070: 6f75 7263 652c 2061 6374 7561 6c2c 2062  ource, actual, b
+00002080: 6c61 636b 2e46 696c 654d 6f64 6528 2929  lack.FileMode())
+00002090: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
+000020a0: 6570 5f35 3732 5f76 6572 7369 6f6e 5f64  ep_572_version_d
+000020b0: 6574 6563 7469 6f6e 2873 656c 6629 202d  etection(self) -
+000020c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000020d0: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
+000020e0: 5f64 6174 6128 2270 795f 3338 222c 2022  _data("py_38", "
+000020f0: 7065 705f 3537 3222 290a 2020 2020 2020  pep_572").      
+00002100: 2020 726f 6f74 203d 2062 6c61 636b 2e6c    root = black.l
+00002110: 6962 3274 6f33 5f70 6172 7365 2873 6f75  ib2to3_parse(sou
+00002120: 7263 6529 0a20 2020 2020 2020 2066 6561  rce).        fea
+00002130: 7475 7265 7320 3d20 626c 6163 6b2e 6765  tures = black.ge
+00002140: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+00002150: 726f 6f74 290a 2020 2020 2020 2020 7365  root).        se
+00002160: 6c66 2e61 7373 6572 7449 6e28 626c 6163  lf.assertIn(blac
+00002170: 6b2e 4665 6174 7572 652e 4153 5349 474e  k.Feature.ASSIGN
+00002180: 4d45 4e54 5f45 5850 5245 5353 494f 4e53  MENT_EXPRESSIONS
+00002190: 2c20 6665 6174 7572 6573 290a 2020 2020  , features).    
+000021a0: 2020 2020 7665 7273 696f 6e73 203d 2062      versions = b
+000021b0: 6c61 636b 2e64 6574 6563 745f 7461 7267  lack.detect_targ
+000021c0: 6574 5f76 6572 7369 6f6e 7328 726f 6f74  et_versions(root
+000021d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000021e0: 7373 6572 7449 6e28 626c 6163 6b2e 5461  ssertIn(black.Ta
+000021f0: 7267 6574 5665 7273 696f 6e2e 5059 3338  rgetVersion.PY38
+00002200: 2c20 7665 7273 696f 6e73 290a 0a20 2020  , versions)..   
+00002210: 2064 6566 2074 6573 745f 6578 7072 6573   def test_expres
+00002220: 7369 6f6e 5f66 6628 7365 6c66 2920 2d3e  sion_ff(self) ->
+00002230: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+00002240: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
+00002250: 3d20 7265 6164 5f64 6174 6128 2273 696d  = read_data("sim
+00002260: 706c 655f 6361 7365 7322 2c20 2265 7870  ple_cases", "exp
+00002270: 7265 7373 696f 6e2e 7079 2229 0a20 2020  ression.py").   
+00002280: 2020 2020 2074 6d70 5f66 696c 6520 3d20       tmp_file = 
+00002290: 5061 7468 2862 6c61 636b 2e64 756d 705f  Path(black.dump_
+000022a0: 746f 5f66 696c 6528 736f 7572 6365 2929  to_file(source))
+000022b0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000022c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000022d0: 7373 6572 7454 7275 6528 6666 2874 6d70  ssertTrue(ff(tmp
+000022e0: 5f66 696c 652c 2077 7269 7465 5f62 6163  _file, write_bac
+000022f0: 6b3d 626c 6163 6b2e 5772 6974 6542 6163  k=black.WriteBac
+00002300: 6b2e 5945 5329 290a 2020 2020 2020 2020  k.YES)).        
+00002310: 2020 2020 7769 7468 206f 7065 6e28 746d      with open(tm
+00002320: 705f 6669 6c65 2c20 656e 636f 6469 6e67  p_file, encoding
+00002330: 3d22 7574 6638 2229 2061 7320 663a 0a20  ="utf8") as f:. 
+00002340: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00002350: 6374 7561 6c20 3d20 662e 7265 6164 2829  ctual = f.read()
+00002360: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
+00002370: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+00002380: 2e75 6e6c 696e 6b28 746d 705f 6669 6c65  .unlink(tmp_file
+00002390: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000023a0: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
+000023b0: 2865 7870 6563 7465 642c 2061 6374 7561  (expected, actua
+000023c0: 6c29 0a20 2020 2020 2020 2077 6974 6820  l).        with 
+000023d0: 7061 7463 6828 2262 6c61 636b 2e64 756d  patch("black.dum
+000023e0: 705f 746f 5f66 696c 6522 2c20 6475 6d70  p_to_file", dump
+000023f0: 5f74 6f5f 7374 6465 7272 293a 0a20 2020  _to_stderr):.   
+00002400: 2020 2020 2020 2020 2062 6c61 636b 2e61           black.a
+00002410: 7373 6572 745f 6571 7569 7661 6c65 6e74  ssert_equivalent
+00002420: 2873 6f75 7263 652c 2061 6374 7561 6c29  (source, actual)
+00002430: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
+00002440: 636b 2e61 7373 6572 745f 7374 6162 6c65  ck.assert_stable
+00002450: 2873 6f75 7263 652c 2061 6374 7561 6c2c  (source, actual,
+00002460: 2044 4546 4155 4c54 5f4d 4f44 4529 0a0a   DEFAULT_MODE)..
+00002470: 2020 2020 6465 6620 7465 7374 5f65 7870      def test_exp
+00002480: 7265 7373 696f 6e5f 6469 6666 2873 656c  ression_diff(sel
+00002490: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+000024a0: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
+000024b0: 7265 6164 5f64 6174 6128 2273 696d 706c  read_data("simpl
+000024c0: 655f 6361 7365 7322 2c20 2265 7870 7265  e_cases", "expre
+000024d0: 7373 696f 6e2e 7079 2229 0a20 2020 2020  ssion.py").     
+000024e0: 2020 2065 7870 6563 7465 642c 205f 203d     expected, _ =
+000024f0: 2072 6561 645f 6461 7461 2822 7369 6d70   read_data("simp
+00002500: 6c65 5f63 6173 6573 222c 2022 6578 7072  le_cases", "expr
+00002510: 6573 7369 6f6e 2e64 6966 6622 290a 2020  ession.diff").  
+00002520: 2020 2020 2020 746d 705f 6669 6c65 203d        tmp_file =
+00002530: 2050 6174 6828 626c 6163 6b2e 6475 6d70   Path(black.dump
+00002540: 5f74 6f5f 6669 6c65 2873 6f75 7263 6529  _to_file(source)
+00002550: 290a 2020 2020 2020 2020 6469 6666 5f68  ).        diff_h
+00002560: 6561 6465 7220 3d20 7265 2e63 6f6d 7069  eader = re.compi
+00002570: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+00002580: 7266 227b 7265 2e65 7363 6170 6528 7374  rf"{re.escape(st
+00002590: 7228 746d 705f 6669 6c65 2929 7d5c 745c  r(tmp_file))}\t\
+000025a0: 645c 645c 645c 642d 5c64 5c64 2d5c 645c  d\d\d\d-\d\d-\d\
+000025b0: 6420 220a 2020 2020 2020 2020 2020 2020  d ".            
+000025c0: 7222 5c64 5c64 3a5c 645c 643a 5c64 5c64  r"\d\d:\d\d:\d\d
+000025d0: 5c2e 5c64 5c64 5c64 5c64 5c64 5c64 205c  \.\d\d\d\d\d\d \
+000025e0: 2b5c 645c 645c 645c 6422 0a20 2020 2020  +\d\d\d\d".     
+000025f0: 2020 2029 0a20 2020 2020 2020 2074 7279     ).        try
+00002600: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00002610: 7375 6c74 203d 2042 6c61 636b 5275 6e6e  sult = BlackRunn
+00002620: 6572 2829 2e69 6e76 6f6b 6528 0a20 2020  er().invoke(.   
+00002630: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
+00002640: 636b 2e6d 6169 6e2c 205b 222d 2d64 6966  ck.main, ["--dif
+00002650: 6622 2c20 7374 7228 746d 705f 6669 6c65  f", str(tmp_file
+00002660: 292c 2066 222d 2d63 6f6e 6669 673d 7b45  ), f"--config={E
+00002670: 4d50 5459 5f43 4f4e 4649 477d 225d 0a20  MPTY_CONFIG}"]. 
+00002680: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00002690: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000026a0: 7365 7274 4571 7561 6c28 7265 7375 6c74  sertEqual(result
+000026b0: 2e65 7869 745f 636f 6465 2c20 3029 0a20  .exit_code, 0). 
+000026c0: 2020 2020 2020 2066 696e 616c 6c79 3a0a         finally:.
+000026d0: 2020 2020 2020 2020 2020 2020 6f73 2e75              os.u
+000026e0: 6e6c 696e 6b28 746d 705f 6669 6c65 290a  nlink(tmp_file).
+000026f0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
+00002700: 2072 6573 756c 742e 6f75 7470 7574 0a20   result.output. 
+00002710: 2020 2020 2020 2061 6374 7561 6c20 3d20         actual = 
+00002720: 6469 6666 5f68 6561 6465 722e 7375 6228  diff_header.sub(
+00002730: 4445 5445 524d 494e 4953 5449 435f 4845  DETERMINISTIC_HE
+00002740: 4144 4552 2c20 6163 7475 616c 290a 2020  ADER, actual).  
+00002750: 2020 2020 2020 6966 2065 7870 6563 7465        if expecte
+00002760: 6420 213d 2061 6374 7561 6c3a 0a20 2020  d != actual:.   
+00002770: 2020 2020 2020 2020 2064 756d 7020 3d20           dump = 
+00002780: 626c 6163 6b2e 6475 6d70 5f74 6f5f 6669  black.dump_to_fi
+00002790: 6c65 2861 6374 7561 6c29 0a20 2020 2020  le(actual).     
+000027a0: 2020 2020 2020 206d 7367 203d 2028 0a20         msg = (. 
+000027b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000027c0: 4578 7065 6374 6564 2064 6966 6620 6973  Expected diff is
+000027d0: 6e27 7420 6571 7561 6c20 746f 2074 6865  n't equal to the
+000027e0: 2061 6374 7561 6c2e 2049 6620 796f 7520   actual. If you 
+000027f0: 6d61 6465 2063 6861 6e67 6573 2074 6f22  made changes to"
+00002800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002810: 2022 2065 7870 7265 7373 696f 6e2e 7079   " expression.py
+00002820: 2061 6e64 2074 6869 7320 6973 2061 6e20   and this is an 
+00002830: 616e 7469 6369 7061 7465 6420 6469 6666  anticipated diff
+00002840: 6572 656e 6365 2c20 6f76 6572 7772 6974  erence, overwrit
+00002850: 6522 0a20 2020 2020 2020 2020 2020 2020  e".             
+00002860: 2020 2066 2220 7465 7374 732f 6461 7461     f" tests/data
+00002870: 2f65 7870 7265 7373 696f 6e2e 6469 6666  /expression.diff
+00002880: 2077 6974 6820 7b64 756d 707d 220a 2020   with {dump}".  
+00002890: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000028a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000028b0: 6572 7445 7175 616c 2865 7870 6563 7465  ertEqual(expecte
+000028c0: 642c 2061 6374 7561 6c2c 206d 7367 290a  d, actual, msg).
+000028d0: 0a20 2020 2064 6566 2074 6573 745f 6578  .    def test_ex
+000028e0: 7072 6573 7369 6f6e 5f64 6966 665f 7769  pression_diff_wi
+000028f0: 7468 5f63 6f6c 6f72 2873 656c 6629 202d  th_color(self) -
+00002900: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00002910: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
+00002920: 5f64 6174 6128 2273 696d 706c 655f 6361  _data("simple_ca
+00002930: 7365 7322 2c20 2265 7870 7265 7373 696f  ses", "expressio
+00002940: 6e2e 7079 2229 0a20 2020 2020 2020 2065  n.py").        e
+00002950: 7870 6563 7465 642c 205f 203d 2072 6561  xpected, _ = rea
+00002960: 645f 6461 7461 2822 7369 6d70 6c65 5f63  d_data("simple_c
+00002970: 6173 6573 222c 2022 6578 7072 6573 7369  ases", "expressi
+00002980: 6f6e 2e64 6966 6622 290a 2020 2020 2020  on.diff").      
+00002990: 2020 746d 705f 6669 6c65 203d 2050 6174    tmp_file = Pat
+000029a0: 6828 626c 6163 6b2e 6475 6d70 5f74 6f5f  h(black.dump_to_
+000029b0: 6669 6c65 2873 6f75 7263 6529 290a 2020  file(source)).  
+000029c0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000029d0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+000029e0: 426c 6163 6b52 756e 6e65 7228 292e 696e  BlackRunner().in
+000029f0: 766f 6b65 280a 2020 2020 2020 2020 2020  voke(.          
+00002a00: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
+00002a10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002a20: 2020 5b22 2d2d 6469 6666 222c 2022 2d2d    ["--diff", "--
+00002a30: 636f 6c6f 7222 2c20 7374 7228 746d 705f  color", str(tmp_
+00002a40: 6669 6c65 292c 2066 222d 2d63 6f6e 6669  file), f"--confi
+00002a50: 673d 7b45 4d50 5459 5f43 4f4e 4649 477d  g={EMPTY_CONFIG}
+00002a60: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+00002a70: 290a 2020 2020 2020 2020 6669 6e61 6c6c  ).        finall
+00002a80: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
+00002a90: 732e 756e 6c69 6e6b 2874 6d70 5f66 696c  s.unlink(tmp_fil
+00002aa0: 6529 0a20 2020 2020 2020 2061 6374 7561  e).        actua
+00002ab0: 6c20 3d20 7265 7375 6c74 2e6f 7574 7075  l = result.outpu
+00002ac0: 740a 2020 2020 2020 2020 2320 5765 2063  t.        # We c
+00002ad0: 6865 636b 2074 6865 2063 6f6e 7465 6e74  heck the content
+00002ae0: 7320 6f66 2074 6865 2064 6966 6620 696e  s of the diff in
+00002af0: 2060 7465 7374 5f65 7870 7265 7373 696f   `test_expressio
+00002b00: 6e5f 6469 6666 602e 2041 6c6c 0a20 2020  n_diff`. All.   
+00002b10: 2020 2020 2023 2077 6520 6e65 6564 2074       # we need t
+00002b20: 6f20 6368 6563 6b20 6865 7265 2069 7320  o check here is 
+00002b30: 7468 6174 2063 6f6c 6f72 2063 6f64 6573  that color codes
+00002b40: 2065 7869 7374 2069 6e20 7468 6520 7265   exist in the re
+00002b50: 7375 6c74 2e0a 2020 2020 2020 2020 7365  sult..        se
+00002b60: 6c66 2e61 7373 6572 7449 6e28 225c 3033  lf.assertIn("\03
+00002b70: 335b 316d 222c 2061 6374 7561 6c29 0a20  3[1m", actual). 
+00002b80: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00002b90: 7274 496e 2822 5c30 3333 5b33 366d 222c  rtIn("\033[36m",
+00002ba0: 2061 6374 7561 6c29 0a20 2020 2020 2020   actual).       
+00002bb0: 2073 656c 662e 6173 7365 7274 496e 2822   self.assertIn("
+00002bc0: 5c30 3333 5b33 326d 222c 2061 6374 7561  \033[32m", actua
+00002bd0: 6c29 0a20 2020 2020 2020 2073 656c 662e  l).        self.
+00002be0: 6173 7365 7274 496e 2822 5c30 3333 5b33  assertIn("\033[3
+00002bf0: 316d 222c 2061 6374 7561 6c29 0a20 2020  1m", actual).   
+00002c00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00002c10: 496e 2822 5c30 3333 5b30 6d22 2c20 6163  In("\033[0m", ac
+00002c20: 7475 616c 290a 0a20 2020 2064 6566 2074  tual)..    def t
+00002c30: 6573 745f 6465 7465 6374 5f70 6f73 5f6f  est_detect_pos_o
+00002c40: 6e6c 795f 6172 6775 6d65 6e74 7328 7365  nly_arguments(se
+00002c50: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00002c60: 2020 2020 2073 6f75 7263 652c 205f 203d       source, _ =
+00002c70: 2072 6561 645f 6461 7461 2822 7079 5f33   read_data("py_3
+00002c80: 3822 2c20 2270 6570 5f35 3730 2229 0a20  8", "pep_570"). 
+00002c90: 2020 2020 2020 2072 6f6f 7420 3d20 626c         root = bl
+00002ca0: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+00002cb0: 6528 736f 7572 6365 290a 2020 2020 2020  e(source).      
+00002cc0: 2020 6665 6174 7572 6573 203d 2062 6c61    features = bla
+00002cd0: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
+00002ce0: 7573 6564 2872 6f6f 7429 0a20 2020 2020  used(root).     
+00002cf0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00002d00: 2862 6c61 636b 2e46 6561 7475 7265 2e50  (black.Feature.P
+00002d10: 4f53 5f4f 4e4c 595f 4152 4755 4d45 4e54  OS_ONLY_ARGUMENT
+00002d20: 532c 2066 6561 7475 7265 7329 0a20 2020  S, features).   
+00002d30: 2020 2020 2076 6572 7369 6f6e 7320 3d20       versions = 
+00002d40: 626c 6163 6b2e 6465 7465 6374 5f74 6172  black.detect_tar
+00002d50: 6765 745f 7665 7273 696f 6e73 2872 6f6f  get_versions(roo
+00002d60: 7429 0a20 2020 2020 2020 2073 656c 662e  t).        self.
+00002d70: 6173 7365 7274 496e 2862 6c61 636b 2e54  assertIn(black.T
+00002d80: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+00002d90: 382c 2076 6572 7369 6f6e 7329 0a0a 2020  8, versions)..  
+00002da0: 2020 6465 6620 7465 7374 5f64 6574 6563    def test_detec
+00002db0: 745f 6465 6275 675f 665f 7374 7269 6e67  t_debug_f_string
+00002dc0: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
+00002dd0: 0a20 2020 2020 2020 2072 6f6f 7420 3d20  .        root = 
+00002de0: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+00002df0: 7273 6528 2222 2266 227b 783d 7d22 2022  rse("""f"{x=}" "
+00002e00: 2222 290a 2020 2020 2020 2020 6665 6174  "").        feat
+00002e10: 7572 6573 203d 2062 6c61 636b 2e67 6574  ures = black.get
+00002e20: 5f66 6561 7475 7265 735f 7573 6564 2872  _features_used(r
+00002e30: 6f6f 7429 0a20 2020 2020 2020 2073 656c  oot).        sel
+00002e40: 662e 6173 7365 7274 496e 2862 6c61 636b  f.assertIn(black
+00002e50: 2e46 6561 7475 7265 2e44 4542 5547 5f46  .Feature.DEBUG_F
+00002e60: 5f53 5452 494e 4753 2c20 6665 6174 7572  _STRINGS, featur
+00002e70: 6573 290a 2020 2020 2020 2020 7665 7273  es).        vers
+00002e80: 696f 6e73 203d 2062 6c61 636b 2e64 6574  ions = black.det
+00002e90: 6563 745f 7461 7267 6574 5f76 6572 7369  ect_target_versi
+00002ea0: 6f6e 7328 726f 6f74 290a 2020 2020 2020  ons(root).      
+00002eb0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+00002ec0: 626c 6163 6b2e 5461 7267 6574 5665 7273  black.TargetVers
+00002ed0: 696f 6e2e 5059 3338 2c20 7665 7273 696f  ion.PY38, versio
+00002ee0: 6e73 290a 0a20 2020 2020 2020 2072 6f6f  ns)..        roo
+00002ef0: 7420 3d20 626c 6163 6b2e 6c69 6232 746f  t = black.lib2to
+00002f00: 335f 7061 7273 6528 0a20 2020 2020 2020  3_parse(.       
+00002f10: 2020 2020 2022 2222 6622 7b78 7d22 5c6e       """f"{x}"\n
+00002f20: 6627 7b22 3d22 7d27 5c6e 6627 7b28 783a  f'{"="}'\nf'{(x:
+00002f30: 3d35 297d 275c 6e66 277b 6628 613d 2233  =5)}'\nf'{f(a="3
+00002f40: 3d22 297d 275c 6e66 277b 783a 3d31 307d  =")}'\nf'{x:=10}
+00002f50: 275c 6e22 2222 0a20 2020 2020 2020 2029  '\n""".        )
+00002f60: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
+00002f70: 7320 3d20 626c 6163 6b2e 6765 745f 6665  s = black.get_fe
+00002f80: 6174 7572 6573 5f75 7365 6428 726f 6f74  atures_used(root
+00002f90: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00002fa0: 7373 6572 744e 6f74 496e 2862 6c61 636b  ssertNotIn(black
+00002fb0: 2e46 6561 7475 7265 2e44 4542 5547 5f46  .Feature.DEBUG_F
+00002fc0: 5f53 5452 494e 4753 2c20 6665 6174 7572  _STRINGS, featur
+00002fd0: 6573 290a 0a20 2020 2020 2020 2023 2057  es)..        # W
+00002fe0: 6520 646f 6e27 7420 7965 7420 7375 7070  e don't yet supp
+00002ff0: 6f72 7420 6665 6174 7572 6520 7665 7273  ort feature vers
+00003000: 696f 6e20 6465 7465 6374 696f 6e20 696e  ion detection in
+00003010: 206e 6573 7465 6420 662d 7374 7269 6e67   nested f-string
+00003020: 730a 2020 2020 2020 2020 726f 6f74 203d  s.        root =
+00003030: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+00003040: 6172 7365 280a 2020 2020 2020 2020 2020  arse(.          
+00003050: 2020 2222 2266 2268 6561 7264 2061 2072    """f"heard a r
+00003060: 756d 6f75 7220 7468 6174 207b 2066 277b  umour that { f'{
+00003070: 312b 313d 7d27 207d 202e 2e2e 2073 6565  1+1=}' } ... see
+00003080: 6d73 206c 696b 6520 6974 2063 6f75 6c64  ms like it could
+00003090: 2062 6520 7472 7565 2220 2222 220a 2020   be true" """.  
+000030a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000030b0: 6665 6174 7572 6573 203d 2062 6c61 636b  features = black
+000030c0: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+000030d0: 6564 2872 6f6f 7429 0a20 2020 2020 2020  ed(root).       
+000030e0: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
+000030f0: 6e28 626c 6163 6b2e 4665 6174 7572 652e  n(black.Feature.
+00003100: 4445 4255 475f 465f 5354 5249 4e47 532c  DEBUG_F_STRINGS,
+00003110: 2066 6561 7475 7265 7329 0a0a 2020 2020   features)..    
+00003120: 4070 6174 6368 2822 626c 6163 6b2e 6475  @patch("black.du
+00003130: 6d70 5f74 6f5f 6669 6c65 222c 2064 756d  mp_to_file", dum
+00003140: 705f 746f 5f73 7464 6572 7229 0a20 2020  p_to_stderr).   
+00003150: 2064 6566 2074 6573 745f 7374 7269 6e67   def test_string
+00003160: 5f71 756f 7465 7328 7365 6c66 2920 2d3e  _quotes(self) ->
+00003170: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+00003180: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
+00003190: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
+000031a0: 6365 6c6c 616e 656f 7573 222c 2022 7374  cellaneous", "st
+000031b0: 7269 6e67 5f71 756f 7465 7322 290a 2020  ring_quotes").  
+000031c0: 2020 2020 2020 6d6f 6465 203d 2062 6c61        mode = bla
+000031d0: 636b 2e4d 6f64 6528 7072 6576 6965 773d  ck.Mode(preview=
+000031e0: 5472 7565 290a 2020 2020 2020 2020 6173  True).        as
+000031f0: 7365 7274 5f66 6f72 6d61 7428 736f 7572  sert_format(sour
+00003200: 6365 2c20 6578 7065 6374 6564 2c20 6d6f  ce, expected, mo
+00003210: 6465 290a 2020 2020 2020 2020 6d6f 6465  de).        mode
+00003220: 203d 2072 6570 6c61 6365 286d 6f64 652c   = replace(mode,
+00003230: 2073 7472 696e 675f 6e6f 726d 616c 697a   string_normaliz
+00003240: 6174 696f 6e3d 4661 6c73 6529 0a20 2020  ation=False).   
+00003250: 2020 2020 206e 6f74 5f6e 6f72 6d61 6c69       not_normali
+00003260: 7a65 6420 3d20 6673 2873 6f75 7263 652c  zed = fs(source,
+00003270: 206d 6f64 653d 6d6f 6465 290a 2020 2020   mode=mode).    
+00003280: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00003290: 6f72 6d61 7445 7175 616c 2873 6f75 7263  ormatEqual(sourc
+000032a0: 652e 7265 706c 6163 6528 225c 5c5c 6e22  e.replace("\\\n"
+000032b0: 2c20 2222 292c 206e 6f74 5f6e 6f72 6d61  , ""), not_norma
+000032c0: 6c69 7a65 6429 0a20 2020 2020 2020 2062  lized).        b
+000032d0: 6c61 636b 2e61 7373 6572 745f 6571 7569  lack.assert_equi
+000032e0: 7661 6c65 6e74 2873 6f75 7263 652c 206e  valent(source, n
+000032f0: 6f74 5f6e 6f72 6d61 6c69 7a65 6429 0a20  ot_normalized). 
+00003300: 2020 2020 2020 2062 6c61 636b 2e61 7373         black.ass
+00003310: 6572 745f 7374 6162 6c65 2873 6f75 7263  ert_stable(sourc
+00003320: 652c 206e 6f74 5f6e 6f72 6d61 6c69 7a65  e, not_normalize
+00003330: 642c 206d 6f64 653d 6d6f 6465 290a 0a20  d, mode=mode).. 
+00003340: 2020 2064 6566 2074 6573 745f 736b 6970     def test_skip
+00003350: 5f73 6f75 7263 655f 6669 7273 745f 6c69  _source_first_li
+00003360: 6e65 2873 656c 6629 202d 3e20 4e6f 6e65  ne(self) -> None
+00003370: 3a0a 2020 2020 2020 2020 736f 7572 6365  :.        source
+00003380: 2c20 5f20 3d20 7265 6164 5f64 6174 6128  , _ = read_data(
+00003390: 226d 6973 6365 6c6c 616e 656f 7573 222c  "miscellaneous",
+000033a0: 2022 696e 7661 6c69 645f 6865 6164 6572   "invalid_header
+000033b0: 2229 0a20 2020 2020 2020 2074 6d70 5f66  ").        tmp_f
+000033c0: 696c 6520 3d20 5061 7468 2862 6c61 636b  ile = Path(black
+000033d0: 2e64 756d 705f 746f 5f66 696c 6528 736f  .dump_to_file(so
+000033e0: 7572 6365 2929 0a20 2020 2020 2020 2023  urce)).        #
+000033f0: 2046 756c 6c20 736f 7572 6365 2073 686f   Full source sho
+00003400: 756c 6420 6661 696c 2028 696e 7661 6c69  uld fail (invali
+00003410: 6420 7379 6e74 6178 2061 7420 6865 6164  d syntax at head
+00003420: 6572 290a 2020 2020 2020 2020 7365 6c66  er).        self
+00003430: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
+00003440: 7228 746d 705f 6669 6c65 292c 2022 2d2d  r(tmp_file), "--
+00003450: 6469 6666 222c 2022 2d2d 6368 6563 6b22  diff", "--check"
+00003460: 5d2c 2065 7869 745f 636f 6465 3d31 3233  ], exit_code=123
+00003470: 290a 2020 2020 2020 2020 2320 536f 2c20  ).        # So, 
+00003480: 736b 6970 7069 6e67 2074 6865 2066 6972  skipping the fir
+00003490: 7374 206c 696e 6520 7368 6f75 6c64 2077  st line should w
+000034a0: 6f72 6b0a 2020 2020 2020 2020 7265 7375  ork.        resu
+000034b0: 6c74 203d 2042 6c61 636b 5275 6e6e 6572  lt = BlackRunner
+000034c0: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
+000034d0: 2020 2020 2020 2062 6c61 636b 2e6d 6169         black.mai
+000034e0: 6e2c 205b 7374 7228 746d 705f 6669 6c65  n, [str(tmp_file
+000034f0: 292c 2022 2d78 222c 2066 222d 2d63 6f6e  ), "-x", f"--con
+00003500: 6669 673d 7b45 4d50 5459 5f43 4f4e 4649  fig={EMPTY_CONFI
+00003510: 477d 225d 0a20 2020 2020 2020 2029 0a20  G}"].        ). 
+00003520: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00003530: 7274 4571 7561 6c28 7265 7375 6c74 2e65  rtEqual(result.e
+00003540: 7869 745f 636f 6465 2c20 3029 0a20 2020  xit_code, 0).   
+00003550: 2020 2020 2077 6974 6820 6f70 656e 2874       with open(t
+00003560: 6d70 5f66 696c 652c 2065 6e63 6f64 696e  mp_file, encodin
+00003570: 673d 2275 7466 3822 2920 6173 2066 3a0a  g="utf8") as f:.
+00003580: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+00003590: 616c 203d 2066 2e72 6561 6428 290a 2020  al = f.read().  
+000035a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000035b0: 7446 6f72 6d61 7445 7175 616c 2873 6f75  tFormatEqual(sou
+000035c0: 7263 652c 2061 6374 7561 6c29 0a0a 2020  rce, actual)..  
+000035d0: 2020 6465 6620 7465 7374 5f73 6b69 705f    def test_skip_
+000035e0: 736f 7572 6365 5f66 6972 7374 5f6c 696e  source_first_lin
+000035f0: 655f 7768 656e 5f6d 6978 696e 675f 6e65  e_when_mixing_ne
+00003600: 776c 696e 6573 2873 656c 6629 202d 3e20  wlines(self) -> 
+00003610: 4e6f 6e65 3a0a 2020 2020 2020 2020 636f  None:.        co
+00003620: 6465 5f6d 6978 696e 675f 6e65 776c 696e  de_mixing_newlin
+00003630: 6573 203d 2062 2248 6561 6465 7220 7769  es = b"Header wi
+00003640: 6c6c 2062 6520 736b 6970 7065 645c 725c  ll be skipped\r\
+00003650: 6e69 203d 205b 312c 322c 335d 5c6e 6a20  ni = [1,2,3]\nj 
+00003660: 3d20 5b31 2c32 2c33 5d5c 6e22 0a20 2020  = [1,2,3]\n".   
+00003670: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
+00003680: 6222 4865 6164 6572 2077 696c 6c20 6265  b"Header will be
+00003690: 2073 6b69 7070 6564 5c72 5c6e 6920 3d20   skipped\r\ni = 
+000036a0: 5b31 2c20 322c 2033 5d5c 6e6a 203d 205b  [1, 2, 3]\nj = [
+000036b0: 312c 2032 2c20 335d 5c6e 220a 2020 2020  1, 2, 3]\n".    
+000036c0: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
+000036d0: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
+000036e0: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
+000036f0: 2020 2020 2020 2020 7465 7374 5f66 696c          test_fil
+00003700: 6520 3d20 5061 7468 2877 6f72 6b73 7061  e = Path(workspa
+00003710: 6365 2920 2f20 2273 6b69 705f 6865 6164  ce) / "skip_head
+00003720: 6572 2e70 7922 0a20 2020 2020 2020 2020  er.py".         
+00003730: 2020 2074 6573 745f 6669 6c65 2e77 7269     test_file.wri
+00003740: 7465 5f62 7974 6573 2863 6f64 655f 6d69  te_bytes(code_mi
+00003750: 7869 6e67 5f6e 6577 6c69 6e65 7329 0a20  xing_newlines). 
+00003760: 2020 2020 2020 2020 2020 206d 6f64 6520             mode 
+00003770: 3d20 7265 706c 6163 6528 4445 4641 554c  = replace(DEFAUL
+00003780: 545f 4d4f 4445 2c20 736b 6970 5f73 6f75  T_MODE, skip_sou
+00003790: 7263 655f 6669 7273 745f 6c69 6e65 3d54  rce_first_line=T
+000037a0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000037b0: 2066 6628 7465 7374 5f66 696c 652c 206d   ff(test_file, m
+000037c0: 6f64 653d 6d6f 6465 2c20 7772 6974 655f  ode=mode, write_
+000037d0: 6261 636b 3d62 6c61 636b 2e57 7269 7465  back=black.Write
+000037e0: 4261 636b 2e59 4553 290a 2020 2020 2020  Back.YES).      
+000037f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00003800: 7445 7175 616c 2874 6573 745f 6669 6c65  tEqual(test_file
+00003810: 2e72 6561 645f 6279 7465 7328 292c 2065  .read_bytes(), e
+00003820: 7870 6563 7465 6429 0a0a 2020 2020 6465  xpected)..    de
+00003830: 6620 7465 7374 5f73 6b69 705f 6d61 6769  f test_skip_magi
+00003840: 635f 7472 6169 6c69 6e67 5f63 6f6d 6d61  c_trailing_comma
+00003850: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00003860: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
+00003870: 5f20 3d20 7265 6164 5f64 6174 6128 2273  _ = read_data("s
+00003880: 696d 706c 655f 6361 7365 7322 2c20 2265  imple_cases", "e
+00003890: 7870 7265 7373 696f 6e22 290a 2020 2020  xpression").    
+000038a0: 2020 2020 6578 7065 6374 6564 2c20 5f20      expected, _ 
+000038b0: 3d20 7265 6164 5f64 6174 6128 0a20 2020  = read_data(.   
+000038c0: 2020 2020 2020 2020 2022 6d69 7363 656c           "miscel
+000038d0: 6c61 6e65 6f75 7322 2c20 2265 7870 7265  laneous", "expre
+000038e0: 7373 696f 6e5f 736b 6970 5f6d 6167 6963  ssion_skip_magic
+000038f0: 5f74 7261 696c 696e 675f 636f 6d6d 612e  _trailing_comma.
+00003900: 6469 6666 220a 2020 2020 2020 2020 290a  diff".        ).
+00003910: 2020 2020 2020 2020 746d 705f 6669 6c65          tmp_file
+00003920: 203d 2050 6174 6828 626c 6163 6b2e 6475   = Path(black.du
+00003930: 6d70 5f74 6f5f 6669 6c65 2873 6f75 7263  mp_to_file(sourc
+00003940: 6529 290a 2020 2020 2020 2020 6469 6666  e)).        diff
+00003950: 5f68 6561 6465 7220 3d20 7265 2e63 6f6d  _header = re.com
+00003960: 7069 6c65 280a 2020 2020 2020 2020 2020  pile(.          
+00003970: 2020 7266 227b 7265 2e65 7363 6170 6528    rf"{re.escape(
+00003980: 7374 7228 746d 705f 6669 6c65 2929 7d5c  str(tmp_file))}\
+00003990: 745c 645c 645c 645c 642d 5c64 5c64 2d5c  t\d\d\d\d-\d\d-\
+000039a0: 645c 6420 220a 2020 2020 2020 2020 2020  d\d ".          
+000039b0: 2020 7222 5c64 5c64 3a5c 645c 643a 5c64    r"\d\d:\d\d:\d
+000039c0: 5c64 5c2e 5c64 5c64 5c64 5c64 5c64 5c64  \d\.\d\d\d\d\d\d
+000039d0: 205c 2b5c 645c 645c 645c 6422 0a20 2020   \+\d\d\d\d".   
+000039e0: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
+000039f0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00003a00: 7265 7375 6c74 203d 2042 6c61 636b 5275  result = BlackRu
+00003a10: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
+00003a20: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00003a30: 6c61 636b 2e6d 6169 6e2c 205b 222d 4322  lack.main, ["-C"
+00003a40: 2c20 222d 2d64 6966 6622 2c20 7374 7228  , "--diff", str(
+00003a50: 746d 705f 6669 6c65 292c 2066 222d 2d63  tmp_file), f"--c
+00003a60: 6f6e 6669 673d 7b45 4d50 5459 5f43 4f4e  onfig={EMPTY_CON
+00003a70: 4649 477d 225d 0a20 2020 2020 2020 2020  FIG}"].         
+00003a80: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00003a90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00003aa0: 6c28 7265 7375 6c74 2e65 7869 745f 636f  l(result.exit_co
+00003ab0: 6465 2c20 3029 0a20 2020 2020 2020 2066  de, 0).        f
+00003ac0: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
+00003ad0: 2020 2020 6f73 2e75 6e6c 696e 6b28 746d      os.unlink(tm
+00003ae0: 705f 6669 6c65 290a 2020 2020 2020 2020  p_file).        
+00003af0: 6163 7475 616c 203d 2072 6573 756c 742e  actual = result.
+00003b00: 6f75 7470 7574 0a20 2020 2020 2020 2061  output.        a
+00003b10: 6374 7561 6c20 3d20 6469 6666 5f68 6561  ctual = diff_hea
+00003b20: 6465 722e 7375 6228 4445 5445 524d 494e  der.sub(DETERMIN
+00003b30: 4953 5449 435f 4845 4144 4552 2c20 6163  ISTIC_HEADER, ac
+00003b40: 7475 616c 290a 2020 2020 2020 2020 6163  tual).        ac
+00003b50: 7475 616c 203d 2061 6374 7561 6c2e 7273  tual = actual.rs
+00003b60: 7472 6970 2829 202b 2022 5c6e 2220 2023  trip() + "\n"  #
+00003b70: 2074 6865 2064 6966 6620 6f75 7470 7574   the diff output
+00003b80: 2068 6173 2061 2074 7261 696c 696e 6720   has a trailing 
+00003b90: 7370 6163 650a 2020 2020 2020 2020 6966  space.        if
+00003ba0: 2065 7870 6563 7465 6420 213d 2061 6374   expected != act
+00003bb0: 7561 6c3a 0a20 2020 2020 2020 2020 2020  ual:.           
+00003bc0: 2064 756d 7020 3d20 626c 6163 6b2e 6475   dump = black.du
+00003bd0: 6d70 5f74 6f5f 6669 6c65 2861 6374 7561  mp_to_file(actua
+00003be0: 6c29 0a20 2020 2020 2020 2020 2020 206d  l).            m
+00003bf0: 7367 203d 2028 0a20 2020 2020 2020 2020  sg = (.         
+00003c00: 2020 2020 2020 2022 4578 7065 6374 6564         "Expected
+00003c10: 2064 6966 6620 6973 6e27 7420 6571 7561   diff isn't equa
+00003c20: 6c20 746f 2074 6865 2061 6374 7561 6c2e  l to the actual.
+00003c30: 2049 6620 796f 7520 6d61 6465 2063 6861   If you made cha
+00003c40: 6e67 6573 2074 6f22 0a20 2020 2020 2020  nges to".       
+00003c50: 2020 2020 2020 2020 2022 2065 7870 7265           " expre
+00003c60: 7373 696f 6e2e 7079 2061 6e64 2074 6869  ssion.py and thi
+00003c70: 7320 6973 2061 6e20 616e 7469 6369 7061  s is an anticipa
+00003c80: 7465 6420 6469 6666 6572 656e 6365 2c20  ted difference, 
+00003c90: 6f76 6572 7772 6974 6522 0a20 2020 2020  overwrite".     
+00003ca0: 2020 2020 2020 2020 2020 2022 2074 6573             " tes
+00003cb0: 7473 2f64 6174 612f 6d69 7363 656c 6c61  ts/data/miscella
+00003cc0: 6e65 6f75 732f 6578 7072 6573 7369 6f6e  neous/expression
+00003cd0: 5f73 6b69 705f 6d61 6769 635f 7472 6169  _skip_magic_trai
+00003ce0: 6c69 6e67 5f63 6f6d 6d61 2e64 6966 6622  ling_comma.diff"
+00003cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003d00: 2066 2220 7769 7468 207b 6475 6d70 7d22   f" with {dump}"
+00003d10: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00003d20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003d30: 6173 7365 7274 4571 7561 6c28 6578 7065  assertEqual(expe
+00003d40: 6374 6564 2c20 6163 7475 616c 2c20 6d73  cted, actual, ms
+00003d50: 6729 0a0a 2020 2020 4070 6174 6368 2822  g)..    @patch("
+00003d60: 626c 6163 6b2e 6475 6d70 5f74 6f5f 6669  black.dump_to_fi
+00003d70: 6c65 222c 2064 756d 705f 746f 5f73 7464  le", dump_to_std
+00003d80: 6572 7229 0a20 2020 2064 6566 2074 6573  err).    def tes
+00003d90: 745f 6173 796e 635f 6173 5f69 6465 6e74  t_async_as_ident
+00003da0: 6966 6965 7228 7365 6c66 2920 2d3e 204e  ifier(self) -> N
+00003db0: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
+00003dc0: 7263 655f 7061 7468 203d 2067 6574 5f63  rce_path = get_c
+00003dd0: 6173 655f 7061 7468 2822 6d69 7363 656c  ase_path("miscel
+00003de0: 6c61 6e65 6f75 7322 2c20 2261 7379 6e63  laneous", "async
+00003df0: 5f61 735f 6964 656e 7469 6669 6572 2229  _as_identifier")
+00003e00: 0a20 2020 2020 2020 2073 6f75 7263 652c  .        source,
+00003e10: 2065 7870 6563 7465 6420 3d20 7265 6164   expected = read
+00003e20: 5f64 6174 615f 6672 6f6d 5f66 696c 6528  _data_from_file(
+00003e30: 736f 7572 6365 5f70 6174 6829 0a20 2020  source_path).   
+00003e40: 2020 2020 2061 6374 7561 6c20 3d20 6673       actual = fs
+00003e50: 2873 6f75 7263 6529 0a20 2020 2020 2020  (source).       
+00003e60: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
+00003e70: 6174 4571 7561 6c28 6578 7065 6374 6564  atEqual(expected
+00003e80: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
+00003e90: 2020 6d61 6a6f 722c 206d 696e 6f72 203d    major, minor =
+00003ea0: 2073 7973 2e76 6572 7369 6f6e 5f69 6e66   sys.version_inf
+00003eb0: 6f5b 3a32 5d0a 2020 2020 2020 2020 6966  o[:2].        if
+00003ec0: 206d 616a 6f72 203c 2033 206f 7220 286d   major < 3 or (m
+00003ed0: 616a 6f72 203c 3d20 3320 616e 6420 6d69  ajor <= 3 and mi
+00003ee0: 6e6f 7220 3c20 3729 3a0a 2020 2020 2020  nor < 7):.      
+00003ef0: 2020 2020 2020 626c 6163 6b2e 6173 7365        black.asse
+00003f00: 7274 5f65 7175 6976 616c 656e 7428 736f  rt_equivalent(so
+00003f10: 7572 6365 2c20 6163 7475 616c 290a 2020  urce, actual).  
+00003f20: 2020 2020 2020 626c 6163 6b2e 6173 7365        black.asse
+00003f30: 7274 5f73 7461 626c 6528 736f 7572 6365  rt_stable(source
+00003f40: 2c20 6163 7475 616c 2c20 4445 4641 554c  , actual, DEFAUL
+00003f50: 545f 4d4f 4445 290a 2020 2020 2020 2020  T_MODE).        
+00003f60: 2320 656e 7375 7265 2062 6c61 636b 2063  # ensure black c
+00003f70: 616e 2070 6172 7365 2074 6869 7320 7768  an parse this wh
+00003f80: 656e 2074 6865 2074 6172 6765 7420 6973  en the target is
+00003f90: 2033 2e36 0a20 2020 2020 2020 2073 656c   3.6.        sel
+00003fa0: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
+00003fb0: 7472 2873 6f75 7263 655f 7061 7468 292c  tr(source_path),
+00003fc0: 2022 2d2d 7461 7267 6574 2d76 6572 7369   "--target-versi
+00003fd0: 6f6e 222c 2022 7079 3336 225d 290a 2020  on", "py36"]).  
+00003fe0: 2020 2020 2020 2320 6275 7420 6e6f 7420        # but not 
+00003ff0: 6f6e 2033 2e37 2c20 6265 6361 7573 6520  on 3.7, because 
+00004000: 6173 796e 632f 6177 6169 7420 6973 206e  async/await is n
+00004010: 6f20 6c6f 6e67 6572 2061 6e20 6964 656e  o longer an iden
+00004020: 7469 6669 6572 0a20 2020 2020 2020 2073  tifier.        s
+00004030: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
+00004040: 5b73 7472 2873 6f75 7263 655f 7061 7468  [str(source_path
+00004050: 292c 2022 2d2d 7461 7267 6574 2d76 6572  ), "--target-ver
+00004060: 7369 6f6e 222c 2022 7079 3337 225d 2c20  sion", "py37"], 
+00004070: 6578 6974 5f63 6f64 653d 3132 3329 0a0a  exit_code=123)..
+00004080: 2020 2020 4070 6174 6368 2822 626c 6163      @patch("blac
+00004090: 6b2e 6475 6d70 5f74 6f5f 6669 6c65 222c  k.dump_to_file",
+000040a0: 2064 756d 705f 746f 5f73 7464 6572 7229   dump_to_stderr)
+000040b0: 0a20 2020 2064 6566 2074 6573 745f 7079  .    def test_py
+000040c0: 7468 6f6e 3337 2873 656c 6629 202d 3e20  thon37(self) -> 
+000040d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
+000040e0: 7572 6365 5f70 6174 6820 3d20 6765 745f  urce_path = get_
+000040f0: 6361 7365 5f70 6174 6828 2270 795f 3337  case_path("py_37
+00004100: 222c 2022 7079 7468 6f6e 3337 2229 0a20  ", "python37"). 
+00004110: 2020 2020 2020 2073 6f75 7263 652c 2065         source, e
+00004120: 7870 6563 7465 6420 3d20 7265 6164 5f64  xpected = read_d
+00004130: 6174 615f 6672 6f6d 5f66 696c 6528 736f  ata_from_file(so
+00004140: 7572 6365 5f70 6174 6829 0a20 2020 2020  urce_path).     
+00004150: 2020 2061 6374 7561 6c20 3d20 6673 2873     actual = fs(s
+00004160: 6f75 7263 6529 0a20 2020 2020 2020 2073  ource).        s
+00004170: 656c 662e 6173 7365 7274 466f 726d 6174  elf.assertFormat
+00004180: 4571 7561 6c28 6578 7065 6374 6564 2c20  Equal(expected, 
+00004190: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
+000041a0: 6d61 6a6f 722c 206d 696e 6f72 203d 2073  major, minor = s
+000041b0: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f5b  ys.version_info[
+000041c0: 3a32 5d0a 2020 2020 2020 2020 6966 206d  :2].        if m
+000041d0: 616a 6f72 203e 2033 206f 7220 286d 616a  ajor > 3 or (maj
+000041e0: 6f72 203d 3d20 3320 616e 6420 6d69 6e6f  or == 3 and mino
+000041f0: 7220 3e3d 2037 293a 0a20 2020 2020 2020  r >= 7):.       
+00004200: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
+00004210: 745f 6571 7569 7661 6c65 6e74 2873 6f75  t_equivalent(sou
+00004220: 7263 652c 2061 6374 7561 6c29 0a20 2020  rce, actual).   
+00004230: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
+00004240: 745f 7374 6162 6c65 2873 6f75 7263 652c  t_stable(source,
+00004250: 2061 6374 7561 6c2c 2044 4546 4155 4c54   actual, DEFAULT
+00004260: 5f4d 4f44 4529 0a20 2020 2020 2020 2023  _MODE).        #
+00004270: 2065 6e73 7572 6520 626c 6163 6b20 6361   ensure black ca
+00004280: 6e20 7061 7273 6520 7468 6973 2077 6865  n parse this whe
+00004290: 6e20 7468 6520 7461 7267 6574 2069 7320  n the target is 
+000042a0: 332e 370a 2020 2020 2020 2020 7365 6c66  3.7.        self
+000042b0: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
+000042c0: 7228 736f 7572 6365 5f70 6174 6829 2c20  r(source_path), 
+000042d0: 222d 2d74 6172 6765 742d 7665 7273 696f  "--target-versio
+000042e0: 6e22 2c20 2270 7933 3722 5d29 0a20 2020  n", "py37"]).   
+000042f0: 2020 2020 2023 2062 7574 206e 6f74 206f       # but not o
+00004300: 6e20 332e 362c 2062 6563 6175 7365 2077  n 3.6, because w
+00004310: 6520 7573 6520 6173 796e 6320 6173 2061  e use async as a
+00004320: 2072 6573 6572 7665 6420 6b65 7977 6f72   reserved keywor
+00004330: 640a 2020 2020 2020 2020 7365 6c66 2e69  d.        self.i
+00004340: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
+00004350: 736f 7572 6365 5f70 6174 6829 2c20 222d  source_path), "-
+00004360: 2d74 6172 6765 742d 7665 7273 696f 6e22  -target-version"
+00004370: 2c20 2270 7933 3622 5d2c 2065 7869 745f  , "py36"], exit_
+00004380: 636f 6465 3d31 3233 290a 0a20 2020 2064  code=123)..    d
+00004390: 6566 2074 6573 745f 7461 625f 636f 6d6d  ef test_tab_comm
+000043a0: 656e 745f 696e 6465 6e74 6174 696f 6e28  ent_indentation(
+000043b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000043c0: 2020 2020 2020 2063 6f6e 7465 6e74 735f         contents_
+000043d0: 7461 6220 3d20 2269 6620 313a 5c6e 5c74  tab = "if 1:\n\t
+000043e0: 6966 2032 3a5c 6e5c 745c 7470 6173 735c  if 2:\n\t\tpass\
+000043f0: 6e5c 7423 2063 6f6d 6d65 6e74 5c6e 5c74  n\t# comment\n\t
+00004400: 7061 7373 5c6e 220a 2020 2020 2020 2020  pass\n".        
+00004410: 636f 6e74 656e 7473 5f73 7063 203d 2022  contents_spc = "
+00004420: 6966 2031 3a5c 6e20 2020 2069 6620 323a  if 1:\n    if 2:
+00004430: 5c6e 2020 2020 2020 2020 7061 7373 5c6e  \n        pass\n
+00004440: 2020 2020 2320 636f 6d6d 656e 745c 6e20      # comment\n 
+00004450: 2020 2070 6173 735c 6e22 0a20 2020 2020     pass\n".     
+00004460: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
+00004470: 726d 6174 4571 7561 6c28 636f 6e74 656e  rmatEqual(conten
+00004480: 7473 5f73 7063 2c20 6673 2863 6f6e 7465  ts_spc, fs(conte
+00004490: 6e74 735f 7370 6329 290a 2020 2020 2020  nts_spc)).      
+000044a0: 2020 7365 6c66 2e61 7373 6572 7446 6f72    self.assertFor
+000044b0: 6d61 7445 7175 616c 2863 6f6e 7465 6e74  matEqual(content
+000044c0: 735f 7370 632c 2066 7328 636f 6e74 656e  s_spc, fs(conten
+000044d0: 7473 5f74 6162 2929 0a0a 2020 2020 2020  ts_tab))..      
+000044e0: 2020 636f 6e74 656e 7473 5f74 6162 203d    contents_tab =
+000044f0: 2022 6966 2031 3a5c 6e5c 7469 6620 323a   "if 1:\n\tif 2:
+00004500: 5c6e 5c74 5c74 7061 7373 5c6e 5c74 5c74  \n\t\tpass\n\t\t
+00004510: 2320 636f 6d6d 656e 745c 6e5c 7470 6173  # comment\n\tpas
+00004520: 735c 6e22 0a20 2020 2020 2020 2063 6f6e  s\n".        con
+00004530: 7465 6e74 735f 7370 6320 3d20 2269 6620  tents_spc = "if 
+00004540: 313a 5c6e 2020 2020 6966 2032 3a5c 6e20  1:\n    if 2:\n 
+00004550: 2020 2020 2020 2070 6173 735c 6e20 2020         pass\n   
+00004560: 2020 2020 2023 2063 6f6d 6d65 6e74 5c6e       # comment\n
+00004570: 2020 2020 7061 7373 5c6e 220a 2020 2020      pass\n".    
+00004580: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00004590: 6f72 6d61 7445 7175 616c 2863 6f6e 7465  ormatEqual(conte
+000045a0: 6e74 735f 7370 632c 2066 7328 636f 6e74  nts_spc, fs(cont
+000045b0: 656e 7473 5f73 7063 2929 0a20 2020 2020  ents_spc)).     
+000045c0: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
+000045d0: 726d 6174 4571 7561 6c28 636f 6e74 656e  rmatEqual(conten
+000045e0: 7473 5f73 7063 2c20 6673 2863 6f6e 7465  ts_spc, fs(conte
+000045f0: 6e74 735f 7461 6229 290a 0a20 2020 2020  nts_tab))..     
+00004600: 2020 2023 206d 6978 6564 2074 6162 7320     # mixed tabs 
+00004610: 616e 6420 7370 6163 6573 2028 7661 6c69  and spaces (vali
+00004620: 6420 5079 7468 6f6e 2032 2063 6f64 6529  d Python 2 code)
+00004630: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
+00004640: 735f 7461 6220 3d20 2269 6620 313a 5c6e  s_tab = "if 1:\n
+00004650: 2020 2020 2020 2020 6966 2032 3a5c 6e5c          if 2:\n\
+00004660: 745c 7470 6173 735c 6e5c 7423 2063 6f6d  t\tpass\n\t# com
+00004670: 6d65 6e74 5c6e 2020 2020 2020 2020 7061  ment\n        pa
+00004680: 7373 5c6e 220a 2020 2020 2020 2020 636f  ss\n".        co
+00004690: 6e74 656e 7473 5f73 7063 203d 2022 6966  ntents_spc = "if
+000046a0: 2031 3a5c 6e20 2020 2069 6620 323a 5c6e   1:\n    if 2:\n
+000046b0: 2020 2020 2020 2020 7061 7373 5c6e 2020          pass\n  
+000046c0: 2020 2320 636f 6d6d 656e 745c 6e20 2020    # comment\n   
+000046d0: 2070 6173 735c 6e22 0a20 2020 2020 2020   pass\n".       
+000046e0: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
+000046f0: 6174 4571 7561 6c28 636f 6e74 656e 7473  atEqual(contents
+00004700: 5f73 7063 2c20 6673 2863 6f6e 7465 6e74  _spc, fs(content
+00004710: 735f 7370 6329 290a 2020 2020 2020 2020  s_spc)).        
+00004720: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
+00004730: 7445 7175 616c 2863 6f6e 7465 6e74 735f  tEqual(contents_
+00004740: 7370 632c 2066 7328 636f 6e74 656e 7473  spc, fs(contents
+00004750: 5f74 6162 2929 0a0a 2020 2020 2020 2020  _tab))..        
+00004760: 636f 6e74 656e 7473 5f74 6162 203d 2022  contents_tab = "
+00004770: 6966 2031 3a5c 6e20 2020 2020 2020 2069  if 1:\n        i
+00004780: 6620 323a 5c6e 5c74 5c74 7061 7373 5c6e  f 2:\n\t\tpass\n
+00004790: 5c74 5c74 2320 636f 6d6d 656e 745c 6e20  \t\t# comment\n 
+000047a0: 2020 2020 2020 2070 6173 735c 6e22 0a20         pass\n". 
+000047b0: 2020 2020 2020 2063 6f6e 7465 6e74 735f         contents_
+000047c0: 7370 6320 3d20 2269 6620 313a 5c6e 2020  spc = "if 1:\n  
+000047d0: 2020 6966 2032 3a5c 6e20 2020 2020 2020    if 2:\n       
+000047e0: 2070 6173 735c 6e20 2020 2020 2020 2023   pass\n        #
+000047f0: 2063 6f6d 6d65 6e74 5c6e 2020 2020 7061   comment\n    pa
+00004800: 7373 5c6e 220a 2020 2020 2020 2020 7365  ss\n".        se
+00004810: 6c66 2e61 7373 6572 7446 6f72 6d61 7445  lf.assertFormatE
+00004820: 7175 616c 2863 6f6e 7465 6e74 735f 7370  qual(contents_sp
+00004830: 632c 2066 7328 636f 6e74 656e 7473 5f73  c, fs(contents_s
+00004840: 7063 2929 0a20 2020 2020 2020 2073 656c  pc)).        sel
+00004850: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
+00004860: 7561 6c28 636f 6e74 656e 7473 5f73 7063  ual(contents_spc
+00004870: 2c20 6673 2863 6f6e 7465 6e74 735f 7461  , fs(contents_ta
+00004880: 6229 290a 0a20 2020 2064 6566 2074 6573  b))..    def tes
+00004890: 745f 6661 6c73 655f 706f 7369 7469 7665  t_false_positive
+000048a0: 5f73 796d 6c69 6e6b 5f6f 7574 7075 745f  _symlink_output_
+000048b0: 6973 7375 655f 3333 3834 2873 656c 6629  issue_3384(self)
+000048c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+000048d0: 2020 2320 456d 756c 6174 6520 7468 6520    # Emulate the 
+000048e0: 6265 6861 7669 6f72 2077 6865 6e20 7573  behavior when us
+000048f0: 696e 6720 7468 6520 434c 4920 2860 626c  ing the CLI (`bl
+00004900: 6163 6b20 2e2f 6368 696c 6420 202d 2d76  ack ./child  --v
+00004910: 6572 626f 7365 6029 2c20 7768 6963 680a  erbose`), which.
+00004920: 2020 2020 2020 2020 2320 696e 766f 6c76          # involv
+00004930: 6573 2070 6174 6368 696e 6720 736f 6d65  es patching some
+00004940: 2060 7061 7468 6c69 622e 5061 7468 6020   `pathlib.Path` 
+00004950: 6d65 7468 6f64 732e 2049 6e20 7061 7274  methods. In part
+00004960: 6963 756c 6172 2c20 6069 735f 6469 7260  icular, `is_dir`
+00004970: 2069 730a 2020 2020 2020 2020 2320 7061   is.        # pa
+00004980: 7463 6865 6420 6f6e 6c79 206f 6e20 6974  tched only on it
+00004990: 7320 6669 7273 7420 6361 6c6c 3a20 7768  s first call: wh
+000049a0: 656e 2063 6865 636b 696e 6720 6966 2022  en checking if "
+000049b0: 2e2f 6368 696c 6422 2069 7320 6120 6469  ./child" is a di
+000049c0: 7265 6374 6f72 7920 6974 0a20 2020 2020  rectory it.     
+000049d0: 2020 2023 2073 686f 756c 6420 7265 7475     # should retu
+000049e0: 726e 2054 7275 652e 2054 6865 2022 2e2f  rn True. The "./
+000049f0: 6368 696c 6422 2066 6f6c 6465 7220 6578  child" folder ex
+00004a00: 6973 7473 2072 656c 6174 6976 6520 746f  ists relative to
+00004a10: 2074 6865 2063 7764 2077 6865 6e0a 2020   the cwd when.  
+00004a20: 2020 2020 2020 2320 7275 6e6e 696e 6720        # running 
+00004a30: 6672 6f6d 2043 4c49 2c20 6275 7420 6661  from CLI, but fa
+00004a40: 696c 7320 7768 656e 2072 756e 6e69 6e67  ils when running
+00004a50: 2074 6865 2074 6573 7473 2062 6563 6175   the tests becau
+00004a60: 7365 2063 7764 2069 7320 6469 6666 6572  se cwd is differ
+00004a70: 656e 740a 2020 2020 2020 2020 7072 6f6a  ent.        proj
+00004a80: 6563 745f 726f 6f74 203d 2050 6174 6828  ect_root = Path(
+00004a90: 5448 4953 5f44 4952 202f 2022 6461 7461  THIS_DIR / "data
+00004aa0: 2220 2f20 226e 6573 7465 645f 6769 7469  " / "nested_giti
+00004ab0: 676e 6f72 655f 7465 7374 7322 290a 2020  gnore_tests").  
+00004ac0: 2020 2020 2020 776f 726b 696e 675f 6469        working_di
+00004ad0: 7265 6374 6f72 7920 3d20 7072 6f6a 6563  rectory = projec
+00004ae0: 745f 726f 6f74 202f 2022 726f 6f74 220a  t_root / "root".
+00004af0: 2020 2020 2020 2020 7461 7267 6574 5f61          target_a
+00004b00: 6273 7061 7468 203d 2077 6f72 6b69 6e67  bspath = working
+00004b10: 5f64 6972 6563 746f 7279 202f 2022 6368  _directory / "ch
+00004b20: 696c 6422 0a20 2020 2020 2020 2074 6172  ild".        tar
+00004b30: 6765 745f 636f 6e74 656e 7473 203d 2028  get_contents = (
+00004b40: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+00004b50: 2e72 656c 6174 6976 655f 746f 2877 6f72  .relative_to(wor
+00004b60: 6b69 6e67 5f64 6972 6563 746f 7279 2920  king_directory) 
+00004b70: 666f 7220 7372 6320 696e 2074 6172 6765  for src in targe
+00004b80: 745f 6162 7370 6174 682e 6974 6572 6469  t_abspath.iterdi
+00004b90: 7228 290a 2020 2020 2020 2020 290a 0a20  r().        ).. 
+00004ba0: 2020 2020 2020 2064 6566 206d 6f63 6b5f         def mock_
+00004bb0: 6e5f 6361 6c6c 7328 7265 7370 6f6e 7365  n_calls(response
+00004bc0: 733a 204c 6973 745b 626f 6f6c 5d29 202d  s: List[bool]) -
+00004bd0: 3e20 4361 6c6c 6162 6c65 5b5b 5d2c 2062  > Callable[[], b
+00004be0: 6f6f 6c5d 3a0a 2020 2020 2020 2020 2020  ool]:.          
+00004bf0: 2020 6465 6620 5f6d 6f63 6b65 645f 6361    def _mocked_ca
+00004c00: 6c6c 7328 2920 2d3e 2062 6f6f 6c3a 0a20  lls() -> bool:. 
+00004c10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004c20: 6620 7265 7370 6f6e 7365 733a 0a20 2020  f responses:.   
+00004c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c40: 2072 6574 7572 6e20 7265 7370 6f6e 7365   return response
+00004c50: 732e 706f 7028 3029 0a20 2020 2020 2020  s.pop(0).       
+00004c60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00004c70: 4661 6c73 650a 0a20 2020 2020 2020 2020  False..         
+00004c80: 2020 2072 6574 7572 6e20 5f6d 6f63 6b65     return _mocke
+00004c90: 645f 6361 6c6c 730a 0a20 2020 2020 2020  d_calls..       
+00004ca0: 2077 6974 6820 7061 7463 6828 2270 6174   with patch("pat
+00004cb0: 686c 6962 2e50 6174 682e 6974 6572 6469  hlib.Path.iterdi
+00004cc0: 7222 2c20 7265 7475 726e 5f76 616c 7565  r", return_value
+00004cd0: 3d74 6172 6765 745f 636f 6e74 656e 7473  =target_contents
+00004ce0: 292c 2070 6174 6368 280a 2020 2020 2020  ), patch(.      
+00004cf0: 2020 2020 2020 2270 6174 686c 6962 2e50        "pathlib.P
+00004d00: 6174 682e 6377 6422 2c20 7265 7475 726e  ath.cwd", return
+00004d10: 5f76 616c 7565 3d77 6f72 6b69 6e67 5f64  _value=working_d
+00004d20: 6972 6563 746f 7279 0a20 2020 2020 2020  irectory.       
+00004d30: 2029 2c20 7061 7463 6828 2270 6174 686c   ), patch("pathl
+00004d40: 6962 2e50 6174 682e 6973 5f64 6972 222c  ib.Path.is_dir",
+00004d50: 2073 6964 655f 6566 6665 6374 3d6d 6f63   side_effect=moc
+00004d60: 6b5f 6e5f 6361 6c6c 7328 5b54 7275 655d  k_n_calls([True]
+00004d70: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00004d80: 6374 7820 3d20 4661 6b65 436f 6e74 6578  ctx = FakeContex
+00004d90: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00004da0: 6374 782e 6f62 6a5b 2272 6f6f 7422 5d20  ctx.obj["root"] 
+00004db0: 3d20 7072 6f6a 6563 745f 726f 6f74 0a20  = project_root. 
+00004dc0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+00004dd0: 7420 3d20 4d61 6769 634d 6f63 6b28 7665  t = MagicMock(ve
+00004de0: 7262 6f73 653d 5472 7565 290a 2020 2020  rbose=True).    
+00004df0: 2020 2020 2020 2020 626c 6163 6b2e 6765          black.ge
+00004e00: 745f 736f 7572 6365 7328 0a20 2020 2020  t_sources(.     
+00004e10: 2020 2020 2020 2020 2020 2063 7478 3d63             ctx=c
+00004e20: 7478 2c0a 2020 2020 2020 2020 2020 2020  tx,.            
+00004e30: 2020 2020 7372 633d 2822 2e2f 6368 696c      src=("./chil
+00004e40: 6422 2c29 2c0a 2020 2020 2020 2020 2020  d",),.          
+00004e50: 2020 2020 2020 7175 6965 743d 4661 6c73        quiet=Fals
+00004e60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00004e70: 2020 2076 6572 626f 7365 3d54 7275 652c     verbose=True,
+00004e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004e90: 2069 6e63 6c75 6465 3d44 4546 4155 4c54   include=DEFAULT
+00004ea0: 5f49 4e43 4c55 4445 2c0a 2020 2020 2020  _INCLUDE,.      
+00004eb0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00004ec0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00004ed0: 2020 2020 2020 2020 7265 706f 7274 3d72          report=r
+00004ee0: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
+00004ef0: 2020 2020 2020 2065 7874 656e 645f 6578         extend_ex
+00004f00: 636c 7564 653d 4e6f 6e65 2c0a 2020 2020  clude=None,.    
+00004f10: 2020 2020 2020 2020 2020 2020 666f 7263              forc
+00004f20: 655f 6578 636c 7564 653d 4e6f 6e65 2c0a  e_exclude=None,.
+00004f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f40: 7374 6469 6e5f 6669 6c65 6e61 6d65 3d4e  stdin_filename=N
+00004f50: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00004f60: 2029 0a20 2020 2020 2020 2061 7373 6572   ).        asser
+00004f70: 7420 6e6f 7420 616e 7928 0a20 2020 2020  t not any(.     
+00004f80: 2020 2020 2020 206d 6f63 6b5f 6172 6773         mock_args
+00004f90: 5b31 5d2e 7374 6172 7473 7769 7468 2822  [1].startswith("
+00004fa0: 6973 2061 2073 796d 626f 6c69 6320 6c69  is a symbolic li
+00004fb0: 6e6b 2074 6861 7420 706f 696e 7473 206f  nk that points o
+00004fc0: 7574 7369 6465 2229 0a20 2020 2020 2020  utside").       
+00004fd0: 2020 2020 2066 6f72 205f 2c20 6d6f 636b       for _, mock
+00004fe0: 5f61 7267 732c 205f 2069 6e20 7265 706f  _args, _ in repo
+00004ff0: 7274 2e70 6174 685f 6967 6e6f 7265 642e  rt.path_ignored.
+00005000: 6d6f 636b 5f63 616c 6c73 0a20 2020 2020  mock_calls.     
+00005010: 2020 2029 2c20 2241 2073 796d 626f 6c69     ), "A symboli
+00005020: 6320 6c69 6e6b 2077 6173 2072 6570 6f72  c link was repor
+00005030: 7465 642e 220a 2020 2020 2020 2020 7265  ted.".        re
+00005040: 706f 7274 2e70 6174 685f 6967 6e6f 7265  port.path_ignore
+00005050: 642e 6173 7365 7274 5f63 616c 6c65 645f  d.assert_called_
+00005060: 6f6e 6365 5f77 6974 6828 0a20 2020 2020  once_with(.     
+00005070: 2020 2020 2020 2050 6174 6828 2263 6869         Path("chi
+00005080: 6c64 222c 2022 622e 7079 2229 2c20 226d  ld", "b.py"), "m
+00005090: 6174 6368 6573 2061 202e 6769 7469 676e  atches a .gitign
+000050a0: 6f72 6520 6669 6c65 2063 6f6e 7465 6e74  ore file content
+000050b0: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
+000050c0: 2064 6566 2074 6573 745f 7265 706f 7274   def test_report
+000050d0: 5f76 6572 626f 7365 2873 656c 6629 202d  _verbose(self) -
+000050e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000050f0: 7265 706f 7274 203d 2052 6570 6f72 7428  report = Report(
+00005100: 7665 7262 6f73 653d 5472 7565 290a 2020  verbose=True).  
+00005110: 2020 2020 2020 6f75 745f 6c69 6e65 7320        out_lines 
+00005120: 3d20 5b5d 0a20 2020 2020 2020 2065 7272  = [].        err
+00005130: 5f6c 696e 6573 203d 205b 5d0a 0a20 2020  _lines = []..   
+00005140: 2020 2020 2064 6566 206f 7574 286d 7367       def out(msg
+00005150: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
+00005160: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
+00005170: 2020 2020 2020 2020 2020 206f 7574 5f6c             out_l
+00005180: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
+00005190: 0a0a 2020 2020 2020 2020 6465 6620 6572  ..        def er
+000051a0: 7228 6d73 673a 2073 7472 2c20 2a2a 6b77  r(msg: str, **kw
+000051b0: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
+000051c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000051d0: 6572 725f 6c69 6e65 732e 6170 7065 6e64  err_lines.append
+000051e0: 286d 7367 290a 0a20 2020 2020 2020 2077  (msg)..        w
+000051f0: 6974 6820 7061 7463 6828 2262 6c61 636b  ith patch("black
+00005200: 2e6f 7574 7075 742e 5f6f 7574 222c 206f  .output._out", o
+00005210: 7574 292c 2070 6174 6368 2822 626c 6163  ut), patch("blac
+00005220: 6b2e 6f75 7470 7574 2e5f 6572 7222 2c20  k.output._err", 
+00005230: 6572 7229 3a0a 2020 2020 2020 2020 2020  err):.          
+00005240: 2020 7265 706f 7274 2e64 6f6e 6528 5061    report.done(Pa
+00005250: 7468 2822 6631 2229 2c20 626c 6163 6b2e  th("f1"), black.
+00005260: 4368 616e 6765 642e 4e4f 290a 2020 2020  Changed.NO).    
+00005270: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005280: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
+00005290: 5f6c 696e 6573 292c 2031 290a 2020 2020  _lines), 1).    
+000052a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000052b0: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
+000052c0: 5f6c 696e 6573 292c 2030 290a 2020 2020  _lines), 0).    
+000052d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000052e0: 6572 7445 7175 616c 286f 7574 5f6c 696e  ertEqual(out_lin
+000052f0: 6573 5b2d 315d 2c20 2266 3120 616c 7265  es[-1], "f1 alre
+00005300: 6164 7920 7765 6c6c 2066 6f72 6d61 7474  ady well formatt
+00005310: 6564 2c20 676f 6f64 206a 6f62 2e22 290a  ed, good job.").
+00005320: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005330: 2e61 7373 6572 7445 7175 616c 2875 6e73  .assertEqual(uns
+00005340: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00005350: 292c 2022 3120 6669 6c65 206c 6566 7420  ), "1 file left 
+00005360: 756e 6368 616e 6765 642e 2229 0a20 2020  unchanged.").   
+00005370: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00005380: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00005390: 2e72 6574 7572 6e5f 636f 6465 2c20 3029  .return_code, 0)
+000053a0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+000053b0: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
+000053c0: 3222 292c 2062 6c61 636b 2e43 6861 6e67  2"), black.Chang
+000053d0: 6564 2e59 4553 290a 2020 2020 2020 2020  ed.YES).        
+000053e0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000053f0: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
+00005400: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
+00005410: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005420: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
+00005430: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
+00005440: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005450: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
+00005460: 315d 2c20 2272 6566 6f72 6d61 7474 6564  1], "reformatted
+00005470: 2066 3222 290a 2020 2020 2020 2020 2020   f2").          
+00005480: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005490: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+000054a0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+000054b0: 7265 706f 7274 2929 2c20 2231 2066 696c  report)), "1 fil
+000054c0: 6520 7265 666f 726d 6174 7465 642c 2031  e reformatted, 1
+000054d0: 2066 696c 6520 6c65 6674 2075 6e63 6861   file left uncha
+000054e0: 6e67 6564 2e22 0a20 2020 2020 2020 2020  nged.".         
+000054f0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00005500: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
+00005510: 6828 2266 3322 292c 2062 6c61 636b 2e43  h("f3"), black.C
+00005520: 6861 6e67 6564 2e43 4143 4845 4429 0a20  hanged.CACHED). 
+00005530: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005540: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00005550: 6f75 745f 6c69 6e65 7329 2c20 3329 0a20  out_lines), 3). 
+00005560: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005570: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00005580: 6572 725f 6c69 6e65 7329 2c20 3029 0a20  err_lines), 0). 
+00005590: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000055a0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+000055b0: 2020 2020 2020 2020 2020 2020 206f 7574               out
+000055c0: 5f6c 696e 6573 5b2d 315d 2c20 2266 3320  _lines[-1], "f3 
+000055d0: 7761 736e 2774 206d 6f64 6966 6965 6420  wasn't modified 
+000055e0: 6f6e 2064 6973 6b20 7369 6e63 6520 6c61  on disk since la
+000055f0: 7374 2072 756e 2e22 0a20 2020 2020 2020  st run.".       
+00005600: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00005610: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005620: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00005630: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+00005640: 2872 6570 6f72 7429 292c 2022 3120 6669  (report)), "1 fi
+00005650: 6c65 2072 6566 6f72 6d61 7474 6564 2c20  le reformatted, 
+00005660: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
+00005670: 6861 6e67 6564 2e22 0a20 2020 2020 2020  hanged.".       
+00005680: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00005690: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000056a0: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
+000056b0: 6e5f 636f 6465 2c20 3029 0a20 2020 2020  n_code, 0).     
+000056c0: 2020 2020 2020 2072 6570 6f72 742e 6368         report.ch
+000056d0: 6563 6b20 3d20 5472 7565 0a20 2020 2020  eck = True.     
+000056e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000056f0: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
+00005700: 6574 7572 6e5f 636f 6465 2c20 3129 0a20  eturn_code, 1). 
+00005710: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+00005720: 742e 6368 6563 6b20 3d20 4661 6c73 650a  t.check = False.
+00005730: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00005740: 7274 2e66 6169 6c65 6428 5061 7468 2822  rt.failed(Path("
+00005750: 6531 2229 2c20 2262 6f6f 6d22 290a 2020  e1"), "boom").  
+00005760: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00005770: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00005780: 7574 5f6c 696e 6573 292c 2033 290a 2020  ut_lines), 3).  
+00005790: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000057a0: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+000057b0: 7272 5f6c 696e 6573 292c 2031 290a 2020  rr_lines), 1).  
+000057c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000057d0: 7373 6572 7445 7175 616c 2865 7272 5f6c  ssertEqual(err_l
+000057e0: 696e 6573 5b2d 315d 2c20 2265 7272 6f72  ines[-1], "error
+000057f0: 3a20 6361 6e6e 6f74 2066 6f72 6d61 7420  : cannot format 
+00005800: 6531 3a20 626f 6f6d 2229 0a20 2020 2020  e1: boom").     
+00005810: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00005820: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00005830: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+00005840: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+00005850: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00005860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005870: 2020 2020 2022 3120 6669 6c65 2072 6566       "1 file ref
+00005880: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
+00005890: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
+000058a0: 2c20 3120 6669 6c65 2066 6169 6c65 6420  , 1 file failed 
+000058b0: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
+000058c0: 2020 2020 2020 2020 2220 7265 666f 726d          " reform
+000058d0: 6174 2e22 0a20 2020 2020 2020 2020 2020  at.".           
+000058e0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+000058f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00005900: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005910: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
+00005920: 5f63 6f64 652c 2031 3233 290a 2020 2020  _code, 123).    
+00005930: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+00005940: 6f6e 6528 5061 7468 2822 6633 2229 2c20  one(Path("f3"), 
+00005950: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
+00005960: 5329 0a20 2020 2020 2020 2020 2020 2073  S).            s
+00005970: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00005980: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
+00005990: 3429 0a20 2020 2020 2020 2020 2020 2073  4).            s
+000059a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000059b0: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
+000059c0: 3129 0a20 2020 2020 2020 2020 2020 2073  1).            s
+000059d0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000059e0: 6f75 745f 6c69 6e65 735b 2d31 5d2c 2022  out_lines[-1], "
+000059f0: 7265 666f 726d 6174 7465 6420 6633 2229  reformatted f3")
+00005a00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005a10: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00005a20: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00005a30: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+00005a40: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
+00005a50: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+00005a60: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
+00005a70: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
+00005a80: 2032 2066 696c 6573 206c 6566 7420 756e   2 files left un
+00005a90: 6368 616e 6765 642c 2031 2066 696c 6520  changed, 1 file 
+00005aa0: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
+00005ab0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00005ac0: 2072 6566 6f72 6d61 742e 220a 2020 2020   reformat.".    
+00005ad0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+00005ae0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00005af0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00005b00: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00005b10: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
+00005b20: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
+00005b30: 6570 6f72 742e 6661 696c 6564 2850 6174  eport.failed(Pat
+00005b40: 6828 2265 3222 292c 2022 626f 6f6d 2229  h("e2"), "boom")
+00005b50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005b60: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00005b70: 6e28 6f75 745f 6c69 6e65 7329 2c20 3429  n(out_lines), 4)
+00005b80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005b90: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00005ba0: 6e28 6572 725f 6c69 6e65 7329 2c20 3229  n(err_lines), 2)
+00005bb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005bc0: 662e 6173 7365 7274 4571 7561 6c28 6572  f.assertEqual(er
+00005bd0: 725f 6c69 6e65 735b 2d31 5d2c 2022 6572  r_lines[-1], "er
+00005be0: 726f 723a 2063 616e 6e6f 7420 666f 726d  ror: cannot form
+00005bf0: 6174 2065 323a 2062 6f6f 6d22 290a 2020  at e2: boom").  
+00005c00: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00005c10: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00005c20: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00005c30: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00005c40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00005c50: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+00005c60: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
+00005c70: 2072 6566 6f72 6d61 7474 6564 2c20 3220   reformatted, 2 
+00005c80: 6669 6c65 7320 6c65 6674 2075 6e63 6861  files left uncha
+00005c90: 6e67 6564 2c20 3220 6669 6c65 7320 6661  nged, 2 files fa
+00005ca0: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
+00005cb0: 2020 2020 2020 2020 2020 2020 2022 2072               " r
+00005cc0: 6566 6f72 6d61 742e 220a 2020 2020 2020  eformat.".      
+00005cd0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00005ce0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00005cf0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00005d00: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
+00005d10: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
+00005d20: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00005d30: 6f72 742e 7061 7468 5f69 676e 6f72 6564  ort.path_ignored
+00005d40: 2850 6174 6828 2277 6174 2229 2c20 226e  (Path("wat"), "n
+00005d50: 6f20 6d61 7463 6822 290a 2020 2020 2020  o match").      
+00005d60: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005d70: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
+00005d80: 696e 6573 292c 2035 290a 2020 2020 2020  ines), 5).      
+00005d90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005da0: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
+00005db0: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
+00005dc0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005dd0: 7445 7175 616c 286f 7574 5f6c 696e 6573  tEqual(out_lines
+00005de0: 5b2d 315d 2c20 2277 6174 2069 676e 6f72  [-1], "wat ignor
+00005df0: 6564 3a20 6e6f 206d 6174 6368 2229 0a20  ed: no match"). 
+00005e00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005e10: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00005e20: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+00005e30: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00005e40: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00005e50: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
+00005e60: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
+00005e70: 7320 7265 666f 726d 6174 7465 642c 2032  s reformatted, 2
+00005e80: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
+00005e90: 616e 6765 642c 2032 2066 696c 6573 2066  anged, 2 files f
+00005ea0: 6169 6c65 6420 746f 220a 2020 2020 2020  ailed to".      
+00005eb0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+00005ec0: 7265 666f 726d 6174 2e22 0a20 2020 2020  reformat.".     
+00005ed0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00005ee0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00005ef0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005f00: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
+00005f10: 7265 7475 726e 5f63 6f64 652c 2031 3233  return_code, 123
+00005f20: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00005f30: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
+00005f40: 6634 2229 2c20 626c 6163 6b2e 4368 616e  f4"), black.Chan
+00005f50: 6765 642e 4e4f 290a 2020 2020 2020 2020  ged.NO).        
+00005f60: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005f70: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
+00005f80: 6573 292c 2036 290a 2020 2020 2020 2020  es), 6).        
+00005f90: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005fa0: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
+00005fb0: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
+00005fc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005fd0: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
+00005fe0: 315d 2c20 2266 3420 616c 7265 6164 7920  1], "f4 already 
+00005ff0: 7765 6c6c 2066 6f72 6d61 7474 6564 2c20  well formatted, 
+00006000: 676f 6f64 206a 6f62 2e22 290a 2020 2020  good job.").    
+00006010: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00006020: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00006030: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
+00006040: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
+00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006060: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00006070: 2020 2020 2020 2232 2066 696c 6573 2072        "2 files r
+00006080: 6566 6f72 6d61 7474 6564 2c20 3320 6669  eformatted, 3 fi
+00006090: 6c65 7320 6c65 6674 2075 6e63 6861 6e67  les left unchang
+000060a0: 6564 2c20 3220 6669 6c65 7320 6661 696c  ed, 2 files fail
+000060b0: 6564 2074 6f22 0a20 2020 2020 2020 2020  ed to".         
+000060c0: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
+000060d0: 6f72 6d61 742e 220a 2020 2020 2020 2020  ormat.".        
+000060e0: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+000060f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00006100: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006110: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
+00006120: 7572 6e5f 636f 6465 2c20 3132 3329 0a20  urn_code, 123). 
+00006130: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+00006140: 742e 6368 6563 6b20 3d20 5472 7565 0a20  t.check = True. 
+00006150: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006160: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00006170: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+00006180: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00006190: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+000061a0: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
+000061b0: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
+000061c0: 7320 776f 756c 6420 6265 2072 6566 6f72  s would be refor
+000061d0: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
+000061e0: 776f 756c 6420 6265 206c 6566 7420 756e  would be left un
+000061f0: 6368 616e 6765 642c 2032 220a 2020 2020  changed, 2".    
+00006200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006210: 2220 6669 6c65 7320 776f 756c 6420 6661  " files would fa
+00006220: 696c 2074 6f20 7265 666f 726d 6174 2e22  il to reformat."
+00006230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006240: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+00006250: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00006260: 706f 7274 2e63 6865 636b 203d 2046 616c  port.check = Fal
+00006270: 7365 0a20 2020 2020 2020 2020 2020 2072  se.            r
+00006280: 6570 6f72 742e 6469 6666 203d 2054 7275  eport.diff = Tru
+00006290: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+000062a0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+000062b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000062c0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
+000062d0: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
+000062e0: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
+000062f0: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
+00006300: 696c 6573 2077 6f75 6c64 2062 6520 7265  iles would be re
+00006310: 666f 726d 6174 7465 642c 2033 2066 696c  formatted, 3 fil
+00006320: 6573 2077 6f75 6c64 2062 6520 6c65 6674  es would be left
+00006330: 2075 6e63 6861 6e67 6564 2c20 3222 0a20   unchanged, 2". 
+00006340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006350: 2020 2022 2066 696c 6573 2077 6f75 6c64     " files would
+00006360: 2066 6169 6c20 746f 2072 6566 6f72 6d61   fail to reforma
+00006370: 742e 220a 2020 2020 2020 2020 2020 2020  t.".            
+00006380: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+00006390: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
+000063a0: 7374 5f72 6570 6f72 745f 7175 6965 7428  st_report_quiet(
+000063b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000063c0: 2020 2020 2020 2072 6570 6f72 7420 3d20         report = 
+000063d0: 5265 706f 7274 2871 7569 6574 3d54 7275  Report(quiet=Tru
+000063e0: 6529 0a20 2020 2020 2020 206f 7574 5f6c  e).        out_l
+000063f0: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
+00006400: 2020 6572 725f 6c69 6e65 7320 3d20 5b5d    err_lines = []
+00006410: 0a0a 2020 2020 2020 2020 6465 6620 6f75  ..        def ou
+00006420: 7428 6d73 673a 2073 7472 2c20 2a2a 6b77  t(msg: str, **kw
+00006430: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
+00006440: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006450: 6f75 745f 6c69 6e65 732e 6170 7065 6e64  out_lines.append
+00006460: 286d 7367 290a 0a20 2020 2020 2020 2064  (msg)..        d
+00006470: 6566 2065 7272 286d 7367 3a20 7374 722c  ef err(msg: str,
+00006480: 202a 2a6b 7761 7267 733a 2041 6e79 2920   **kwargs: Any) 
+00006490: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+000064a0: 2020 2020 2065 7272 5f6c 696e 6573 2e61       err_lines.a
+000064b0: 7070 656e 6428 6d73 6729 0a0a 2020 2020  ppend(msg)..    
+000064c0: 2020 2020 7769 7468 2070 6174 6368 2822      with patch("
+000064d0: 626c 6163 6b2e 6f75 7470 7574 2e5f 6f75  black.output._ou
+000064e0: 7422 2c20 6f75 7429 2c20 7061 7463 6828  t", out), patch(
+000064f0: 2262 6c61 636b 2e6f 7574 7075 742e 5f65  "black.output._e
+00006500: 7272 222c 2065 7272 293a 0a20 2020 2020  rr", err):.     
+00006510: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
+00006520: 6e65 2850 6174 6828 2266 3122 292c 2062  ne(Path("f1"), b
+00006530: 6c61 636b 2e43 6861 6e67 6564 2e4e 4f29  lack.Changed.NO)
+00006540: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006550: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00006560: 6e28 6f75 745f 6c69 6e65 7329 2c20 3029  n(out_lines), 0)
+00006570: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006580: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00006590: 6e28 6572 725f 6c69 6e65 7329 2c20 3029  n(err_lines), 0)
+000065a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000065b0: 662e 6173 7365 7274 4571 7561 6c28 756e  f.assertEqual(un
+000065c0: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
+000065d0: 2929 2c20 2231 2066 696c 6520 6c65 6674  )), "1 file left
+000065e0: 2075 6e63 6861 6e67 6564 2e22 290a 2020   unchanged.").  
+000065f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006600: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+00006610: 742e 7265 7475 726e 5f63 6f64 652c 2030  t.return_code, 0
+00006620: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00006630: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
+00006640: 6632 2229 2c20 626c 6163 6b2e 4368 616e  f2"), black.Chan
+00006650: 6765 642e 5945 5329 0a20 2020 2020 2020  ged.YES).       
+00006660: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006670: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+00006680: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
+00006690: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000066a0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+000066b0: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
+000066c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000066d0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+000066e0: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
+000066f0: 7472 2872 6570 6f72 7429 292c 2022 3120  tr(report)), "1 
+00006700: 6669 6c65 2072 6566 6f72 6d61 7474 6564  file reformatted
+00006710: 2c20 3120 6669 6c65 206c 6566 7420 756e  , 1 file left un
+00006720: 6368 616e 6765 642e 220a 2020 2020 2020  changed.".      
+00006730: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006740: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
+00006750: 5061 7468 2822 6633 2229 2c20 626c 6163  Path("f3"), blac
+00006760: 6b2e 4368 616e 6765 642e 4341 4348 4544  k.Changed.CACHED
+00006770: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006780: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00006790: 656e 286f 7574 5f6c 696e 6573 292c 2030  en(out_lines), 0
+000067a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000067b0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+000067c0: 656e 2865 7272 5f6c 696e 6573 292c 2030  en(err_lines), 0
+000067d0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000067e0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+000067f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006800: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
+00006810: 7274 2929 2c20 2231 2066 696c 6520 7265  rt)), "1 file re
+00006820: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
+00006830: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+00006840: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
+00006850: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006860: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00006870: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00006880: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
+00006890: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
+000068a0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+000068b0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000068c0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
+000068d0: 5f63 6f64 652c 2031 290a 2020 2020 2020  _code, 1).      
+000068e0: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
+000068f0: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
+00006900: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
+00006910: 696c 6564 2850 6174 6828 2265 3122 292c  iled(Path("e1"),
+00006920: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
+00006930: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006940: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+00006950: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
+00006960: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006970: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00006980: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
+00006990: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000069a0: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
+000069b0: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
+000069c0: 6e6f 7420 666f 726d 6174 2065 313a 2062  not format e1: b
+000069d0: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
+000069e0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000069f0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00006a00: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00006a10: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00006a20: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+00006a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a40: 2231 2066 696c 6520 7265 666f 726d 6174  "1 file reformat
+00006a50: 7465 642c 2032 2066 696c 6573 206c 6566  ted, 2 files lef
+00006a60: 7420 756e 6368 616e 6765 642c 2031 2066  t unchanged, 1 f
+00006a70: 696c 6520 6661 696c 6564 2074 6f22 0a20  ile failed to". 
+00006a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a90: 2020 2022 2072 6566 6f72 6d61 742e 220a     " reformat.".
+00006aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ab0: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+00006ac0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006ad0: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+00006ae0: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
+00006af0: 2c20 3132 3329 0a20 2020 2020 2020 2020  , 123).         
+00006b00: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
+00006b10: 6174 6828 2266 3322 292c 2062 6c61 636b  ath("f3"), black
+00006b20: 2e43 6861 6e67 6564 2e59 4553 290a 2020  .Changed.YES).  
+00006b30: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006b40: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00006b50: 7574 5f6c 696e 6573 292c 2030 290a 2020  ut_lines), 0).  
+00006b60: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006b70: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+00006b80: 7272 5f6c 696e 6573 292c 2031 290a 2020  rr_lines), 1).  
+00006b90: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006ba0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00006bb0: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00006bc0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00006bd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006be0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+00006bf0: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
+00006c00: 2072 6566 6f72 6d61 7474 6564 2c20 3220   reformatted, 2 
+00006c10: 6669 6c65 7320 6c65 6674 2075 6e63 6861  files left uncha
+00006c20: 6e67 6564 2c20 3120 6669 6c65 2066 6169  nged, 1 file fai
+00006c30: 6c65 6420 746f 220a 2020 2020 2020 2020  led to".        
+00006c40: 2020 2020 2020 2020 2020 2020 2220 7265              " re
+00006c50: 666f 726d 6174 2e22 0a20 2020 2020 2020  format.".       
+00006c60: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
+00006c70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00006c80: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006c90: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
+00006ca0: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
+00006cb0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00006cc0: 7274 2e66 6169 6c65 6428 5061 7468 2822  rt.failed(Path("
+00006cd0: 6532 2229 2c20 2262 6f6f 6d22 290a 2020  e2"), "boom").  
+00006ce0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006cf0: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00006d00: 7574 5f6c 696e 6573 292c 2030 290a 2020  ut_lines), 0).  
+00006d10: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006d20: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+00006d30: 7272 5f6c 696e 6573 292c 2032 290a 2020  rr_lines), 2).  
+00006d40: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006d50: 7373 6572 7445 7175 616c 2865 7272 5f6c  ssertEqual(err_l
+00006d60: 696e 6573 5b2d 315d 2c20 2265 7272 6f72  ines[-1], "error
+00006d70: 3a20 6361 6e6e 6f74 2066 6f72 6d61 7420  : cannot format 
+00006d80: 6532 3a20 626f 6f6d 2229 0a20 2020 2020  e2: boom").     
+00006d90: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00006da0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00006db0: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+00006dc0: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+00006dd0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00006de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006df0: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
+00006e00: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
+00006e10: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+00006e20: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
+00006e30: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
+00006e40: 2020 2020 2020 2020 2020 2220 7265 666f            " refo
+00006e50: 726d 6174 2e22 0a20 2020 2020 2020 2020  rmat.".         
+00006e60: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+00006e70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006e80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00006e90: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+00006ea0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
+00006eb0: 2020 2020 2020 2020 2020 7265 706f 7274            report
+00006ec0: 2e70 6174 685f 6967 6e6f 7265 6428 5061  .path_ignored(Pa
+00006ed0: 7468 2822 7761 7422 292c 2022 6e6f 206d  th("wat"), "no m
+00006ee0: 6174 6368 2229 0a20 2020 2020 2020 2020  atch").         
+00006ef0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006f00: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
+00006f10: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
+00006f20: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006f30: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
+00006f40: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
+00006f50: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006f60: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00006f70: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+00006f80: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
+00006f90: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
+00006fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fb0: 2022 3220 6669 6c65 7320 7265 666f 726d   "2 files reform
+00006fc0: 6174 7465 642c 2032 2066 696c 6573 206c  atted, 2 files l
+00006fd0: 6566 7420 756e 6368 616e 6765 642c 2032  eft unchanged, 2
+00006fe0: 2066 696c 6573 2066 6169 6c65 6420 746f   files failed to
+00006ff0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00007000: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
+00007010: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+00007020: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+00007030: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00007040: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007050: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
+00007060: 6f64 652c 2031 3233 290a 2020 2020 2020  ode, 123).      
+00007070: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
+00007080: 6528 5061 7468 2822 6634 2229 2c20 626c  e(Path("f4"), bl
+00007090: 6163 6b2e 4368 616e 6765 642e 4e4f 290a  ack.Changed.NO).
+000070a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000070b0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+000070c0: 286f 7574 5f6c 696e 6573 292c 2030 290a  (out_lines), 0).
+000070d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000070e0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+000070f0: 2865 7272 5f6c 696e 6573 292c 2032 290a  (err_lines), 2).
+00007100: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007110: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+00007120: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00007130: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
+00007140: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00007150: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+00007160: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
+00007170: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
+00007180: 3320 6669 6c65 7320 6c65 6674 2075 6e63  3 files left unc
+00007190: 6861 6e67 6564 2c20 3220 6669 6c65 7320  hanged, 2 files 
+000071a0: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
+000071b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000071c0: 2072 6566 6f72 6d61 742e 220a 2020 2020   reformat.".    
+000071d0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+000071e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000071f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00007200: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00007210: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
+00007220: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
+00007230: 6570 6f72 742e 6368 6563 6b20 3d20 5472  eport.check = Tr
+00007240: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
+00007250: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007270: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
+00007280: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
+00007290: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+000072a0: 2020 2020 2020 2020 2020 2020 2022 3220               "2 
+000072b0: 6669 6c65 7320 776f 756c 6420 6265 2072  files would be r
+000072c0: 6566 6f72 6d61 7474 6564 2c20 3320 6669  eformatted, 3 fi
+000072d0: 6c65 7320 776f 756c 6420 6265 206c 6566  les would be lef
+000072e0: 7420 756e 6368 616e 6765 642c 2032 220a  t unchanged, 2".
+000072f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007300: 2020 2020 2220 6669 6c65 7320 776f 756c      " files woul
+00007310: 6420 6661 696c 2074 6f20 7265 666f 726d  d fail to reform
+00007320: 6174 2e22 0a20 2020 2020 2020 2020 2020  at.".           
+00007330: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+00007340: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00007350: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
+00007360: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+00007370: 2020 2072 6570 6f72 742e 6469 6666 203d     report.diff =
+00007380: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00007390: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000073a0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+000073b0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+000073c0: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+000073d0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+000073e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000073f0: 2232 2066 696c 6573 2077 6f75 6c64 2062  "2 files would b
+00007400: 6520 7265 666f 726d 6174 7465 642c 2033  e reformatted, 3
+00007410: 2066 696c 6573 2077 6f75 6c64 2062 6520   files would be 
+00007420: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
+00007430: 3222 0a20 2020 2020 2020 2020 2020 2020  2".             
+00007440: 2020 2020 2020 2022 2066 696c 6573 2077         " files w
+00007450: 6f75 6c64 2066 6169 6c20 746f 2072 6566  ould fail to ref
+00007460: 6f72 6d61 742e 220a 2020 2020 2020 2020  ormat.".        
+00007470: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00007480: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00007490: 6620 7465 7374 5f72 6570 6f72 745f 6e6f  f test_report_no
+000074a0: 726d 616c 2873 656c 6629 202d 3e20 4e6f  rmal(self) -> No
+000074b0: 6e65 3a0a 2020 2020 2020 2020 7265 706f  ne:.        repo
+000074c0: 7274 203d 2062 6c61 636b 2e52 6570 6f72  rt = black.Repor
+000074d0: 7428 290a 2020 2020 2020 2020 6f75 745f  t().        out_
+000074e0: 6c69 6e65 7320 3d20 5b5d 0a20 2020 2020  lines = [].     
+000074f0: 2020 2065 7272 5f6c 696e 6573 203d 205b     err_lines = [
+00007500: 5d0a 0a20 2020 2020 2020 2064 6566 206f  ]..        def o
+00007510: 7574 286d 7367 3a20 7374 722c 202a 2a6b  ut(msg: str, **k
+00007520: 7761 7267 733a 2041 6e79 2920 2d3e 204e  wargs: Any) -> N
+00007530: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00007540: 206f 7574 5f6c 696e 6573 2e61 7070 656e   out_lines.appen
+00007550: 6428 6d73 6729 0a0a 2020 2020 2020 2020  d(msg)..        
+00007560: 6465 6620 6572 7228 6d73 673a 2073 7472  def err(msg: str
+00007570: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
+00007580: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00007590: 2020 2020 2020 6572 725f 6c69 6e65 732e        err_lines.
+000075a0: 6170 7065 6e64 286d 7367 290a 0a20 2020  append(msg)..   
+000075b0: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
+000075c0: 2262 6c61 636b 2e6f 7574 7075 742e 5f6f  "black.output._o
+000075d0: 7574 222c 206f 7574 292c 2070 6174 6368  ut", out), patch
+000075e0: 2822 626c 6163 6b2e 6f75 7470 7574 2e5f  ("black.output._
+000075f0: 6572 7222 2c20 6572 7229 3a0a 2020 2020  err", err):.    
+00007600: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+00007610: 6f6e 6528 5061 7468 2822 6631 2229 2c20  one(Path("f1"), 
+00007620: 626c 6163 6b2e 4368 616e 6765 642e 4e4f  black.Changed.NO
+00007630: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007640: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00007650: 656e 286f 7574 5f6c 696e 6573 292c 2030  en(out_lines), 0
+00007660: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007670: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00007680: 656e 2865 7272 5f6c 696e 6573 292c 2030  en(err_lines), 0
+00007690: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000076a0: 6c66 2e61 7373 6572 7445 7175 616c 2875  lf.assertEqual(u
+000076b0: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+000076c0: 7429 292c 2022 3120 6669 6c65 206c 6566  t)), "1 file lef
+000076d0: 7420 756e 6368 616e 6765 642e 2229 0a20  t unchanged."). 
+000076e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000076f0: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
+00007700: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
+00007710: 3029 0a20 2020 2020 2020 2020 2020 2072  0).            r
+00007720: 6570 6f72 742e 646f 6e65 2850 6174 6828  eport.done(Path(
+00007730: 2266 3222 292c 2062 6c61 636b 2e43 6861  "f2"), black.Cha
+00007740: 6e67 6564 2e59 4553 290a 2020 2020 2020  nged.YES).      
+00007750: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007760: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
+00007770: 696e 6573 292c 2031 290a 2020 2020 2020  ines), 1).      
+00007780: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007790: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
+000077a0: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
+000077b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000077c0: 7445 7175 616c 286f 7574 5f6c 696e 6573  tEqual(out_lines
+000077d0: 5b2d 315d 2c20 2272 6566 6f72 6d61 7474  [-1], "reformatt
+000077e0: 6564 2066 3222 290a 2020 2020 2020 2020  ed f2").        
+000077f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00007800: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
+00007810: 2020 2020 2020 756e 7374 796c 6528 7374        unstyle(st
+00007820: 7228 7265 706f 7274 2929 2c20 2231 2066  r(report)), "1 f
+00007830: 696c 6520 7265 666f 726d 6174 7465 642c  ile reformatted,
+00007840: 2031 2066 696c 6520 6c65 6674 2075 6e63   1 file left unc
+00007850: 6861 6e67 6564 2e22 0a20 2020 2020 2020  hanged.".       
+00007860: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00007870: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
+00007880: 6174 6828 2266 3322 292c 2062 6c61 636b  ath("f3"), black
+00007890: 2e43 6861 6e67 6564 2e43 4143 4845 4429  .Changed.CACHED)
+000078a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000078b0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+000078c0: 6e28 6f75 745f 6c69 6e65 7329 2c20 3129  n(out_lines), 1)
+000078d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000078e0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+000078f0: 6e28 6572 725f 6c69 6e65 7329 2c20 3029  n(err_lines), 0)
+00007900: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007910: 662e 6173 7365 7274 4571 7561 6c28 6f75  f.assertEqual(ou
+00007920: 745f 6c69 6e65 735b 2d31 5d2c 2022 7265  t_lines[-1], "re
+00007930: 666f 726d 6174 7465 6420 6632 2229 0a20  formatted f2"). 
+00007940: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007950: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00007960: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+00007970: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00007980: 292c 2022 3120 6669 6c65 2072 6566 6f72  ), "1 file refor
+00007990: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
+000079a0: 6c65 6674 2075 6e63 6861 6e67 6564 2e22  left unchanged."
+000079b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000079c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000079d0: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
+000079e0: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
+000079f0: 3029 0a20 2020 2020 2020 2020 2020 2072  0).            r
+00007a00: 6570 6f72 742e 6368 6563 6b20 3d20 5472  eport.check = Tr
+00007a10: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
+00007a20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007a30: 7265 706f 7274 2e72 6574 7572 6e5f 636f  report.return_co
+00007a40: 6465 2c20 3129 0a20 2020 2020 2020 2020  de, 1).         
+00007a50: 2020 2072 6570 6f72 742e 6368 6563 6b20     report.check 
+00007a60: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00007a70: 2020 2020 7265 706f 7274 2e66 6169 6c65      report.faile
+00007a80: 6428 5061 7468 2822 6531 2229 2c20 2262  d(Path("e1"), "b
+00007a90: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
+00007aa0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007ab0: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
+00007ac0: 292c 2031 290a 2020 2020 2020 2020 2020  ), 1).          
+00007ad0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007ae0: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
+00007af0: 292c 2031 290a 2020 2020 2020 2020 2020  ), 1).          
+00007b00: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007b10: 616c 2865 7272 5f6c 696e 6573 5b2d 315d  al(err_lines[-1]
+00007b20: 2c20 2265 7272 6f72 3a20 6361 6e6e 6f74  , "error: cannot
+00007b30: 2066 6f72 6d61 7420 6531 3a20 626f 6f6d   format e1: boom
+00007b40: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00007b50: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007b70: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
+00007b80: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
+00007b90: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+00007ba0: 2020 2020 2020 2020 2020 2020 2022 3120               "1 
+00007bb0: 6669 6c65 2072 6566 6f72 6d61 7474 6564  file reformatted
+00007bc0: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
+00007bd0: 6e63 6861 6e67 6564 2c20 3120 6669 6c65  nchanged, 1 file
+00007be0: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
+00007bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c00: 2220 7265 666f 726d 6174 2e22 0a20 2020  " reformat.".   
+00007c10: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
+00007c20: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00007c30: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007c40: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+00007c50: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
+00007c60: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
+00007c70: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
+00007c80: 2822 6633 2229 2c20 626c 6163 6b2e 4368  ("f3"), black.Ch
+00007c90: 616e 6765 642e 5945 5329 0a20 2020 2020  anged.YES).     
+00007ca0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007cb0: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
+00007cc0: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
+00007cd0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007ce0: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
+00007cf0: 6c69 6e65 7329 2c20 3129 0a20 2020 2020  lines), 1).     
+00007d00: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007d10: 7274 4571 7561 6c28 6f75 745f 6c69 6e65  rtEqual(out_line
+00007d20: 735b 2d31 5d2c 2022 7265 666f 726d 6174  s[-1], "reformat
+00007d30: 7465 6420 6633 2229 0a20 2020 2020 2020  ted f3").       
+00007d40: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007d50: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+00007d60: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
+00007d70: 7472 2872 6570 6f72 7429 292c 0a20 2020  tr(report)),.   
+00007d80: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
+00007d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007da0: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
+00007db0: 726d 6174 7465 642c 2032 2066 696c 6573  rmatted, 2 files
+00007dc0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
+00007dd0: 2031 2066 696c 6520 6661 696c 6564 2074   1 file failed t
+00007de0: 6f22 0a20 2020 2020 2020 2020 2020 2020  o".             
+00007df0: 2020 2020 2020 2022 2072 6566 6f72 6d61         " reforma
+00007e00: 742e 220a 2020 2020 2020 2020 2020 2020  t.".            
+00007e10: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+00007e20: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00007e30: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007e40: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
+00007e50: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
+00007e60: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
+00007e70: 696c 6564 2850 6174 6828 2265 3222 292c  iled(Path("e2"),
+00007e80: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
+00007e90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007ea0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+00007eb0: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
+00007ec0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007ed0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00007ee0: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
+00007ef0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007f00: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
+00007f10: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
+00007f20: 6e6f 7420 666f 726d 6174 2065 323a 2062  not format e2: b
+00007f30: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
+00007f40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007f50: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00007f60: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00007f70: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00007f80: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+00007f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007fa0: 2232 2066 696c 6573 2072 6566 6f72 6d61  "2 files reforma
+00007fb0: 7474 6564 2c20 3220 6669 6c65 7320 6c65  tted, 2 files le
+00007fc0: 6674 2075 6e63 6861 6e67 6564 2c20 3220  ft unchanged, 2 
+00007fd0: 6669 6c65 7320 6661 696c 6564 2074 6f22  files failed to"
+00007fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007ff0: 2020 2020 2022 2072 6566 6f72 6d61 742e       " reformat.
+00008000: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00008010: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00008020: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
+00008030: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00008040: 7265 706f 7274 2e72 6574 7572 6e5f 636f  report.return_co
+00008050: 6465 2c20 3132 3329 0a20 2020 2020 2020  de, 123).       
+00008060: 2020 2020 2072 6570 6f72 742e 7061 7468       report.path
+00008070: 5f69 676e 6f72 6564 2850 6174 6828 2277  _ignored(Path("w
+00008080: 6174 2229 2c20 226e 6f20 6d61 7463 6822  at"), "no match"
+00008090: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000080a0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+000080b0: 656e 286f 7574 5f6c 696e 6573 292c 2032  en(out_lines), 2
+000080c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000080d0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+000080e0: 656e 2865 7272 5f6c 696e 6573 292c 2032  en(err_lines), 2
+000080f0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00008100: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+00008110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008120: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
+00008130: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
+00008140: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
+00008150: 2020 2020 2020 2020 2020 2020 2232 2066              "2 f
+00008160: 696c 6573 2072 6566 6f72 6d61 7474 6564  iles reformatted
+00008170: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
+00008180: 6e63 6861 6e67 6564 2c20 3220 6669 6c65  nchanged, 2 file
+00008190: 7320 6661 696c 6564 2074 6f22 0a20 2020  s failed to".   
+000081a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081b0: 2022 2072 6566 6f72 6d61 742e 220a 2020   " reformat.".  
+000081c0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+000081d0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000081e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000081f0: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
+00008200: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
+00008210: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
+00008220: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
+00008230: 6828 2266 3422 292c 2062 6c61 636b 2e43  h("f4"), black.C
+00008240: 6861 6e67 6564 2e4e 4f29 0a20 2020 2020  hanged.NO).     
+00008250: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00008260: 7274 4571 7561 6c28 6c65 6e28 6f75 745f  rtEqual(len(out_
+00008270: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
+00008280: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00008290: 7274 4571 7561 6c28 6c65 6e28 6572 725f  rtEqual(len(err_
+000082a0: 6c69 6e65 7329 2c20 3229 0a20 2020 2020  lines), 2).     
+000082b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000082c0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+000082d0: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+000082e0: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+000082f0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00008300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008310: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
+00008320: 666f 726d 6174 7465 642c 2033 2066 696c  formatted, 3 fil
+00008330: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+00008340: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
+00008350: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
+00008360: 2020 2020 2020 2020 2020 2220 7265 666f            " refo
+00008370: 726d 6174 2e22 0a20 2020 2020 2020 2020  rmat.".         
+00008380: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+00008390: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000083a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000083b0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
+000083c0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
+000083d0: 2020 2020 2020 2020 2020 7265 706f 7274            report
+000083e0: 2e63 6865 636b 203d 2054 7275 650a 2020  .check = True.  
+000083f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00008400: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00008410: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00008420: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00008430: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008440: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+00008450: 2020 2020 2020 2020 2232 2066 696c 6573          "2 files
+00008460: 2077 6f75 6c64 2062 6520 7265 666f 726d   would be reform
+00008470: 6174 7465 642c 2033 2066 696c 6573 2077  atted, 3 files w
+00008480: 6f75 6c64 2062 6520 6c65 6674 2075 6e63  ould be left unc
+00008490: 6861 6e67 6564 2c20 3222 0a20 2020 2020  hanged, 2".     
+000084a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000084b0: 2066 696c 6573 2077 6f75 6c64 2066 6169   files would fai
+000084c0: 6c20 746f 2072 6566 6f72 6d61 742e 220a  l to reformat.".
+000084d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000084e0: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+000084f0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00008500: 6f72 742e 6368 6563 6b20 3d20 4661 6c73  ort.check = Fals
+00008510: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+00008520: 706f 7274 2e64 6966 6620 3d20 5472 7565  port.diff = True
+00008530: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008540: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00008550: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00008560: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+00008570: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
+00008580: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+00008590: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
+000085a0: 6c65 7320 776f 756c 6420 6265 2072 6566  les would be ref
+000085b0: 6f72 6d61 7474 6564 2c20 3320 6669 6c65  ormatted, 3 file
+000085c0: 7320 776f 756c 6420 6265 206c 6566 7420  s would be left 
+000085d0: 756e 6368 616e 6765 642c 2032 220a 2020  unchanged, 2".  
+000085e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000085f0: 2020 2220 6669 6c65 7320 776f 756c 6420    " files would 
+00008600: 6661 696c 2074 6f20 7265 666f 726d 6174  fail to reformat
+00008610: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+00008620: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+00008630: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
+00008640: 745f 6c69 6232 746f 335f 7061 7273 6528  t_lib2to3_parse(
+00008650: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00008660: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+00008670: 2e61 7373 6572 7452 6169 7365 7328 626c  .assertRaises(bl
+00008680: 6163 6b2e 496e 7661 6c69 6449 6e70 7574  ack.InvalidInput
+00008690: 293a 0a20 2020 2020 2020 2020 2020 2062  ):.            b
+000086a0: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
+000086b0: 7365 2822 696e 7661 6c69 6420 7379 6e74  se("invalid synt
+000086c0: 6178 2229 0a0a 2020 2020 2020 2020 7374  ax")..        st
+000086d0: 7261 6464 6c69 6e67 203d 2022 7820 2b20  raddling = "x + 
+000086e0: 7922 0a20 2020 2020 2020 2062 6c61 636b  y".        black
+000086f0: 2e6c 6962 3274 6f33 5f70 6172 7365 2873  .lib2to3_parse(s
+00008700: 7472 6164 646c 696e 6729 0a20 2020 2020  traddling).     
+00008710: 2020 2062 6c61 636b 2e6c 6962 3274 6f33     black.lib2to3
+00008720: 5f70 6172 7365 2873 7472 6164 646c 696e  _parse(straddlin
+00008730: 672c 207b 5461 7267 6574 5665 7273 696f  g, {TargetVersio
+00008740: 6e2e 5059 3336 7d29 0a0a 2020 2020 2020  n.PY36})..      
+00008750: 2020 7079 325f 6f6e 6c79 203d 2022 7072    py2_only = "pr
+00008760: 696e 7420 7822 0a20 2020 2020 2020 2077  int x".        w
+00008770: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+00008780: 6169 7365 7328 626c 6163 6b2e 496e 7661  aises(black.Inva
+00008790: 6c69 6449 6e70 7574 293a 0a20 2020 2020  lidInput):.     
+000087a0: 2020 2020 2020 2062 6c61 636b 2e6c 6962         black.lib
+000087b0: 3274 6f33 5f70 6172 7365 2870 7932 5f6f  2to3_parse(py2_o
+000087c0: 6e6c 792c 207b 5461 7267 6574 5665 7273  nly, {TargetVers
+000087d0: 696f 6e2e 5059 3336 7d29 0a0a 2020 2020  ion.PY36})..    
+000087e0: 2020 2020 7079 335f 6f6e 6c79 203d 2022      py3_only = "
+000087f0: 6578 6563 2878 2c20 656e 643d 7929 220a  exec(x, end=y)".
+00008800: 2020 2020 2020 2020 626c 6163 6b2e 6c69          black.li
+00008810: 6232 746f 335f 7061 7273 6528 7079 335f  b2to3_parse(py3_
+00008820: 6f6e 6c79 290a 2020 2020 2020 2020 626c  only).        bl
+00008830: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+00008840: 6528 7079 335f 6f6e 6c79 2c20 7b54 6172  e(py3_only, {Tar
+00008850: 6765 7456 6572 7369 6f6e 2e50 5933 367d  getVersion.PY36}
+00008860: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00008870: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00008880: 645f 6465 636f 7261 746f 7228 7365 6c66  d_decorator(self
+00008890: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000088a0: 2020 2023 2054 6573 7420 7468 6520 6665     # Test the fe
+000088b0: 6174 7572 6520 6465 7465 6374 696f 6e20  ature detection 
+000088c0: 6f66 206e 6577 2064 6563 6f72 6174 6f72  of new decorator
+000088d0: 2073 796e 7461 780a 2020 2020 2020 2020   syntax.        
+000088e0: 2320 7369 6e63 6520 7468 6973 206d 616b  # since this mak
+000088f0: 6573 2073 6f6d 6520 7465 7374 2063 6173  es some test cas
+00008900: 6573 206f 6620 7465 7374 5f67 6574 5f66  es of test_get_f
+00008910: 6561 7475 7265 735f 7573 6564 2829 0a20  eatures_used(). 
+00008920: 2020 2020 2020 2023 2066 6169 6c73 2069         # fails i
+00008930: 6620 6974 2066 6169 6c73 2c20 7468 6973  f it fails, this
+00008940: 2069 7320 7465 7374 6564 2066 6972 7374   is tested first
+00008950: 2073 6f20 7468 6174 2061 2075 7365 6675   so that a usefu
+00008960: 6c20 6361 7365 0a20 2020 2020 2020 2023  l case.        #
+00008970: 2069 7320 6964 656e 7469 6669 6564 0a20   is identified. 
+00008980: 2020 2020 2020 2073 696d 706c 6573 2c20         simples, 
+00008990: 7265 6c61 7865 6420 3d20 7265 6164 5f64  relaxed = read_d
+000089a0: 6174 6128 226d 6973 6365 6c6c 616e 656f  ata("miscellaneo
+000089b0: 7573 222c 2022 6465 636f 7261 746f 7273  us", "decorators
+000089c0: 2229 0a20 2020 2020 2020 2023 2073 6b69  ").        # ski
+000089d0: 7020 6578 706c 616e 6174 696f 6e20 636f  p explanation co
+000089e0: 6d6d 656e 7473 2061 7420 7468 6520 746f  mments at the to
+000089f0: 7020 6f66 2074 6865 2066 696c 650a 2020  p of the file.  
+00008a00: 2020 2020 2020 666f 7220 7369 6d70 6c65        for simple
+00008a10: 5f74 6573 7420 696e 2073 696d 706c 6573  _test in simples
+00008a20: 2e73 706c 6974 2822 2323 2229 5b31 3a5d  .split("##")[1:]
+00008a30: 3a0a 2020 2020 2020 2020 2020 2020 6e6f  :.            no
+00008a40: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
+00008a50: 6f33 5f70 6172 7365 2873 696d 706c 655f  o3_parse(simple_
+00008a60: 7465 7374 290a 2020 2020 2020 2020 2020  test).          
+00008a70: 2020 6465 636f 7261 746f 7220 3d20 7374    decorator = st
+00008a80: 7228 6e6f 6465 2e63 6869 6c64 7265 6e5b  r(node.children[
+00008a90: 305d 2e63 6869 6c64 7265 6e5b 305d 292e  0].children[0]).
+00008aa0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+00008ab0: 2020 2020 7365 6c66 2e61 7373 6572 744e      self.assertN
+00008ac0: 6f74 496e 280a 2020 2020 2020 2020 2020  otIn(.          
+00008ad0: 2020 2020 2020 4665 6174 7572 652e 5245        Feature.RE
+00008ae0: 4c41 5845 445f 4445 434f 5241 544f 5253  LAXED_DECORATORS
+00008af0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008b00: 2020 626c 6163 6b2e 6765 745f 6665 6174    black.get_feat
+00008b10: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
+00008b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008b30: 206d 7367 3d28 0a20 2020 2020 2020 2020   msg=(.         
+00008b40: 2020 2020 2020 2020 2020 2066 2264 6563             f"dec
+00008b50: 6f72 6174 6f72 2027 7b64 6563 6f72 6174  orator '{decorat
+00008b60: 6f72 7d27 2066 6f6c 6c6f 7773 2070 7974  or}' follows pyt
+00008b70: 686f 6e3c 3d33 2e38 2073 796e 7461 7822  hon<=3.8 syntax"
+00008b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008b90: 2020 2020 2022 6275 7420 6973 2064 6574       "but is det
+00008ba0: 6563 7465 6420 6173 2033 2e39 2b22 0a20  ected as 3.9+". 
+00008bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008bc0: 2020 2023 2066 2254 6865 2066 756c 6c20     # f"The full 
+00008bd0: 6e6f 6465 2069 735c 6e7b 6e6f 6465 2172  node is\n{node!r
+00008be0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00008bf0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+00008c00: 2020 290a 2020 2020 2020 2020 2320 736b    ).        # sk
+00008c10: 6970 2074 6865 2027 2320 6f75 7470 7574  ip the '# output
+00008c20: 2720 636f 6d6d 656e 7420 6174 2074 6865  ' comment at the
+00008c30: 2074 6f70 206f 6620 7468 6520 6f75 7470   top of the outp
+00008c40: 7574 2070 6172 740a 2020 2020 2020 2020  ut part.        
+00008c50: 666f 7220 7265 6c61 7865 645f 7465 7374  for relaxed_test
+00008c60: 2069 6e20 7265 6c61 7865 642e 7370 6c69   in relaxed.spli
+00008c70: 7428 2223 2322 295b 313a 5d3a 0a20 2020  t("##")[1:]:.   
+00008c80: 2020 2020 2020 2020 206e 6f64 6520 3d20           node = 
+00008c90: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+00008ca0: 7273 6528 7265 6c61 7865 645f 7465 7374  rse(relaxed_test
+00008cb0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00008cc0: 636f 7261 746f 7220 3d20 7374 7228 6e6f  corator = str(no
+00008cd0: 6465 2e63 6869 6c64 7265 6e5b 305d 2e63  de.children[0].c
+00008ce0: 6869 6c64 7265 6e5b 305d 292e 7374 7269  hildren[0]).stri
+00008cf0: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00008d00: 7365 6c66 2e61 7373 6572 7449 6e28 0a20  self.assertIn(. 
+00008d10: 2020 2020 2020 2020 2020 2020 2020 2046                 F
+00008d20: 6561 7475 7265 2e52 454c 4158 4544 5f44  eature.RELAXED_D
+00008d30: 4543 4f52 4154 4f52 532c 0a20 2020 2020  ECORATORS,.     
+00008d40: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+00008d50: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+00008d60: 6564 286e 6f64 6529 2c0a 2020 2020 2020  ed(node),.      
+00008d70: 2020 2020 2020 2020 2020 6d73 673d 280a            msg=(.
+00008d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d90: 2020 2020 6622 6465 636f 7261 746f 7220      f"decorator 
+00008da0: 277b 6465 636f 7261 746f 727d 2720 7573  '{decorator}' us
+00008db0: 6573 2070 7974 686f 6e33 2e39 2b20 7379  es python3.9+ sy
+00008dc0: 6e74 6178 220a 2020 2020 2020 2020 2020  ntax".          
+00008dd0: 2020 2020 2020 2020 2020 2262 7574 2069            "but i
+00008de0: 7320 6465 7465 6374 6564 2061 7320 7079  s detected as py
+00008df0: 7468 6f6e 3c3d 332e 3822 0a20 2020 2020  thon<=3.8".     
+00008e00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00008e10: 2066 2254 6865 2066 756c 6c20 6e6f 6465   f"The full node
+00008e20: 2069 735c 6e7b 6e6f 6465 2172 7d22 0a20   is\n{node!r}". 
+00008e30: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00008e40: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00008e50: 0a20 2020 2064 6566 2074 6573 745f 6765  .    def test_ge
+00008e60: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+00008e70: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00008e80: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
+00008e90: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+00008ea0: 6528 2264 6566 2066 282a 2c20 6172 6729  e("def f(*, arg)
+00008eb0: 3a20 2e2e 2e5c 6e22 290a 2020 2020 2020  : ...\n").      
+00008ec0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00008ed0: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
+00008ee0: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
+00008ef0: 2c20 7365 7428 2929 0a20 2020 2020 2020  , set()).       
+00008f00: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+00008f10: 6232 746f 335f 7061 7273 6528 2264 6566  b2to3_parse("def
+00008f20: 2066 282a 2c20 6172 672c 293a 202e 2e2e   f(*, arg,): ...
+00008f30: 5c6e 2229 0a20 2020 2020 2020 2073 656c  \n").        sel
+00008f40: 662e 6173 7365 7274 4571 7561 6c28 626c  f.assertEqual(bl
+00008f50: 6163 6b2e 6765 745f 6665 6174 7572 6573  ack.get_features
+00008f60: 5f75 7365 6428 6e6f 6465 292c 207b 4665  _used(node), {Fe
+00008f70: 6174 7572 652e 5452 4149 4c49 4e47 5f43  ature.TRAILING_C
+00008f80: 4f4d 4d41 5f49 4e5f 4445 467d 290a 2020  OMMA_IN_DEF}).  
+00008f90: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
+00008fa0: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+00008fb0: 2822 6628 2a61 7267 2c29 5c6e 2229 0a20  ("f(*arg,)\n"). 
+00008fc0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00008fd0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00008fe0: 2020 2020 2062 6c61 636b 2e67 6574 5f66       black.get_f
+00008ff0: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
+00009000: 6529 2c20 7b46 6561 7475 7265 2e54 5241  e), {Feature.TRA
+00009010: 494c 494e 475f 434f 4d4d 415f 494e 5f43  ILING_COMMA_IN_C
+00009020: 414c 4c7d 0a20 2020 2020 2020 2029 0a20  ALL}.        ). 
+00009030: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
+00009040: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+00009050: 6528 2264 6566 2066 282a 2c20 6172 6729  e("def f(*, arg)
+00009060: 3a20 6627 7374 7269 6e67 275c 6e22 290a  : f'string'\n").
+00009070: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00009080: 6572 7445 7175 616c 2862 6c61 636b 2e67  ertEqual(black.g
+00009090: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
+000090a0: 286e 6f64 6529 2c20 7b46 6561 7475 7265  (node), {Feature
+000090b0: 2e46 5f53 5452 494e 4753 7d29 0a20 2020  .F_STRINGS}).   
+000090c0: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
+000090d0: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+000090e0: 2231 3233 5f34 3536 5c6e 2229 0a20 2020  "123_456\n").   
+000090f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009100: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
+00009110: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+00009120: 6465 292c 207b 4665 6174 7572 652e 4e55  de), {Feature.NU
+00009130: 4d45 5249 435f 554e 4445 5253 434f 5245  MERIC_UNDERSCORE
+00009140: 537d 290a 2020 2020 2020 2020 6e6f 6465  S}).        node
+00009150: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+00009160: 5f70 6172 7365 2822 3132 3334 3536 5c6e  _parse("123456\n
+00009170: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00009180: 6173 7365 7274 4571 7561 6c28 626c 6163  assertEqual(blac
+00009190: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
+000091a0: 7365 6428 6e6f 6465 292c 2073 6574 2829  sed(node), set()
+000091b0: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
+000091c0: 2c20 6578 7065 6374 6564 203d 2072 6561  , expected = rea
+000091d0: 645f 6461 7461 2822 7369 6d70 6c65 5f63  d_data("simple_c
+000091e0: 6173 6573 222c 2022 6675 6e63 7469 6f6e  ases", "function
+000091f0: 2229 0a20 2020 2020 2020 206e 6f64 6520  ").        node 
+00009200: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
+00009210: 7061 7273 6528 736f 7572 6365 290a 2020  parse(source).  
+00009220: 2020 2020 2020 6578 7065 6374 6564 5f66        expected_f
+00009230: 6561 7475 7265 7320 3d20 7b0a 2020 2020  eatures = {.    
+00009240: 2020 2020 2020 2020 4665 6174 7572 652e          Feature.
+00009250: 5452 4149 4c49 4e47 5f43 4f4d 4d41 5f49  TRAILING_COMMA_I
+00009260: 4e5f 4341 4c4c 2c0a 2020 2020 2020 2020  N_CALL,.        
+00009270: 2020 2020 4665 6174 7572 652e 5452 4149      Feature.TRAI
+00009280: 4c49 4e47 5f43 4f4d 4d41 5f49 4e5f 4445  LING_COMMA_IN_DE
+00009290: 462c 0a20 2020 2020 2020 2020 2020 2046  F,.            F
+000092a0: 6561 7475 7265 2e46 5f53 5452 494e 4753  eature.F_STRINGS
+000092b0: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
+000092c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000092d0: 7175 616c 2862 6c61 636b 2e67 6574 5f66  qual(black.get_f
+000092e0: 6561 7475 7265 735f 7573 6564 286e 6f64  eatures_used(nod
+000092f0: 6529 2c20 6578 7065 6374 6564 5f66 6561  e), expected_fea
+00009300: 7475 7265 7329 0a20 2020 2020 2020 206e  tures).        n
+00009310: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
+00009320: 746f 335f 7061 7273 6528 6578 7065 6374  to3_parse(expect
+00009330: 6564 290a 2020 2020 2020 2020 7365 6c66  ed).        self
+00009340: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
+00009350: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
+00009360: 7573 6564 286e 6f64 6529 2c20 6578 7065  used(node), expe
+00009370: 6374 6564 5f66 6561 7475 7265 7329 0a20  cted_features). 
+00009380: 2020 2020 2020 2073 6f75 7263 652c 2065         source, e
+00009390: 7870 6563 7465 6420 3d20 7265 6164 5f64  xpected = read_d
+000093a0: 6174 6128 2273 696d 706c 655f 6361 7365  ata("simple_case
+000093b0: 7322 2c20 2265 7870 7265 7373 696f 6e22  s", "expression"
+000093c0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+000093d0: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+000093e0: 6172 7365 2873 6f75 7263 6529 0a20 2020  arse(source).   
+000093f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009400: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
+00009410: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+00009420: 6465 292c 2073 6574 2829 290a 2020 2020  de), set()).    
+00009430: 2020 2020 6e6f 6465 203d 2062 6c61 636b      node = black
+00009440: 2e6c 6962 3274 6f33 5f70 6172 7365 2865  .lib2to3_parse(e
+00009450: 7870 6563 7465 6429 0a20 2020 2020 2020  xpected).       
+00009460: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009470: 6c28 626c 6163 6b2e 6765 745f 6665 6174  l(black.get_feat
+00009480: 7572 6573 5f75 7365 6428 6e6f 6465 292c  ures_used(node),
+00009490: 2073 6574 2829 290a 2020 2020 2020 2020   set()).        
+000094a0: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
+000094b0: 3274 6f33 5f70 6172 7365 2822 6c61 6d62  2to3_parse("lamb
+000094c0: 6461 2061 2c20 2f2c 2062 3a20 2e2e 2e22  da a, /, b: ..."
+000094d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000094e0: 7373 6572 7445 7175 616c 2862 6c61 636b  ssertEqual(black
+000094f0: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+00009500: 6564 286e 6f64 6529 2c20 7b46 6561 7475  ed(node), {Featu
+00009510: 7265 2e50 4f53 5f4f 4e4c 595f 4152 4755  re.POS_ONLY_ARGU
+00009520: 4d45 4e54 537d 290a 2020 2020 2020 2020  MENTS}).        
+00009530: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
+00009540: 3274 6f33 5f70 6172 7365 2822 6465 6620  2to3_parse("def 
+00009550: 666e 2861 2c20 2f2c 2062 293a 202e 2e2e  fn(a, /, b): ...
+00009560: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00009570: 6173 7365 7274 4571 7561 6c28 626c 6163  assertEqual(blac
+00009580: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
+00009590: 7365 6428 6e6f 6465 292c 207b 4665 6174  sed(node), {Feat
+000095a0: 7572 652e 504f 535f 4f4e 4c59 5f41 5247  ure.POS_ONLY_ARG
+000095b0: 554d 454e 5453 7d29 0a20 2020 2020 2020  UMENTS}).       
+000095c0: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+000095d0: 6232 746f 335f 7061 7273 6528 2264 6566  b2to3_parse("def
+000095e0: 2066 6e28 293a 2079 6965 6c64 2061 2c20   fn(): yield a, 
+000095f0: 6222 290a 2020 2020 2020 2020 7365 6c66  b").        self
+00009600: 2e61 7373 6572 7445 7175 616c 2862 6c61  .assertEqual(bla
+00009610: 636b 2e67 6574 5f66 6561 7475 7265 735f  ck.get_features_
+00009620: 7573 6564 286e 6f64 6529 2c20 7365 7428  used(node), set(
+00009630: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
+00009640: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
+00009650: 7061 7273 6528 2264 6566 2066 6e28 293a  parse("def fn():
+00009660: 2072 6574 7572 6e20 612c 2062 2229 0a20   return a, b"). 
+00009670: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009680: 7274 4571 7561 6c28 626c 6163 6b2e 6765  rtEqual(black.ge
+00009690: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+000096a0: 6e6f 6465 292c 2073 6574 2829 290a 2020  node), set()).  
+000096b0: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
+000096c0: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+000096d0: 2822 6465 6620 666e 2829 3a20 7969 656c  ("def fn(): yiel
+000096e0: 6420 2a62 2c20 6322 290a 2020 2020 2020  d *b, c").      
+000096f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00009700: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
+00009710: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
+00009720: 2c20 7b46 6561 7475 7265 2e55 4e50 4143  , {Feature.UNPAC
+00009730: 4b49 4e47 5f4f 4e5f 464c 4f57 7d29 0a20  KING_ON_FLOW}). 
+00009740: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
+00009750: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+00009760: 6528 2264 6566 2066 6e28 293a 2072 6574  e("def fn(): ret
+00009770: 7572 6e20 612c 202a 622c 2063 2229 0a20  urn a, *b, c"). 
+00009780: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009790: 7274 4571 7561 6c28 626c 6163 6b2e 6765  rtEqual(black.ge
+000097a0: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+000097b0: 6e6f 6465 292c 207b 4665 6174 7572 652e  node), {Feature.
+000097c0: 554e 5041 434b 494e 475f 4f4e 5f46 4c4f  UNPACKING_ON_FLO
+000097d0: 577d 290a 2020 2020 2020 2020 6e6f 6465  W}).        node
+000097e0: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+000097f0: 5f70 6172 7365 2822 7820 3d20 612c 202a  _parse("x = a, *
+00009800: 622c 2063 2229 0a20 2020 2020 2020 2073  b, c").        s
+00009810: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00009820: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
+00009830: 6573 5f75 7365 6428 6e6f 6465 292c 2073  es_used(node), s
+00009840: 6574 2829 290a 2020 2020 2020 2020 6e6f  et()).        no
+00009850: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
+00009860: 6f33 5f70 6172 7365 2822 783a 2041 6e79  o3_parse("x: Any
+00009870: 203d 2072 6567 756c 6172 2229 0a20 2020   = regular").   
+00009880: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009890: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
+000098a0: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+000098b0: 6465 292c 2073 6574 2829 290a 2020 2020  de), set()).    
+000098c0: 2020 2020 6e6f 6465 203d 2062 6c61 636b      node = black
+000098d0: 2e6c 6962 3274 6f33 5f70 6172 7365 2822  .lib2to3_parse("
+000098e0: 783a 2041 6e79 203d 2028 7265 6775 6c61  x: Any = (regula
+000098f0: 722c 2072 6567 756c 6172 2922 290a 2020  r, regular)").  
+00009900: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00009910: 7445 7175 616c 2862 6c61 636b 2e67 6574  tEqual(black.get
+00009920: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00009930: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
+00009940: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
+00009950: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+00009960: 2278 3a20 416e 7920 3d20 436f 6d70 6c65  "x: Any = Comple
+00009970: 7828 5479 7065 2831 2929 5b73 6f6d 6574  x(Type(1))[somet
+00009980: 6869 6e67 5d22 290a 2020 2020 2020 2020  hing]").        
+00009990: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000099a0: 2862 6c61 636b 2e67 6574 5f66 6561 7475  (black.get_featu
+000099b0: 7265 735f 7573 6564 286e 6f64 6529 2c20  res_used(node), 
+000099c0: 7365 7428 2929 0a20 2020 2020 2020 206e  set()).        n
+000099d0: 6f64 6520 3d20 626c 6163 6b2e 6c69 6232  ode = black.lib2
+000099e0: 746f 335f 7061 7273 6528 2278 3a20 5475  to3_parse("x: Tu
+000099f0: 706c 655b 696e 742c 202e 2e2e 5d20 3d20  ple[int, ...] = 
+00009a00: 612c 2062 2c20 6322 290a 2020 2020 2020  a, b, c").      
+00009a10: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00009a20: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00009a30: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
+00009a40: 6573 5f75 7365 6428 6e6f 6465 292c 207b  es_used(node), {
+00009a50: 4665 6174 7572 652e 414e 4e5f 4153 5349  Feature.ANN_ASSI
+00009a60: 474e 5f45 5854 454e 4445 445f 5248 537d  GN_EXTENDED_RHS}
+00009a70: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00009a80: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
+00009a90: 6c69 6232 746f 335f 7061 7273 6528 2274  lib2to3_parse("t
+00009aa0: 7279 3a20 7061 7373 5c6e 6578 6365 7074  ry: pass\nexcept
+00009ab0: 2053 6f6d 6574 6869 6e67 3a20 7061 7373   Something: pass
+00009ac0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00009ad0: 6173 7365 7274 4571 7561 6c28 626c 6163  assertEqual(blac
+00009ae0: 6b2e 6765 745f 6665 6174 7572 6573 5f75  k.get_features_u
+00009af0: 7365 6428 6e6f 6465 292c 2073 6574 2829  sed(node), set()
+00009b00: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+00009b10: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+00009b20: 6172 7365 2822 7472 793a 2070 6173 735c  arse("try: pass\
+00009b30: 6e65 7863 6570 7420 282a 536f 6d65 7468  nexcept (*Someth
+00009b40: 696e 672c 293a 2070 6173 7322 290a 2020  ing,): pass").  
+00009b50: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00009b60: 7445 7175 616c 2862 6c61 636b 2e67 6574  tEqual(black.get
+00009b70: 5f66 6561 7475 7265 735f 7573 6564 286e  _features_used(n
+00009b80: 6f64 6529 2c20 7365 7428 2929 0a20 2020  ode), set()).   
+00009b90: 2020 2020 206e 6f64 6520 3d20 626c 6163       node = blac
+00009ba0: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+00009bb0: 2274 7279 3a20 7061 7373 5c6e 6578 6365  "try: pass\nexce
+00009bc0: 7074 202a 4772 6f75 703a 2070 6173 7322  pt *Group: pass"
+00009bd0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009be0: 7373 6572 7445 7175 616c 2862 6c61 636b  ssertEqual(black
+00009bf0: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+00009c00: 6564 286e 6f64 6529 2c20 7b46 6561 7475  ed(node), {Featu
+00009c10: 7265 2e45 5843 4550 545f 5354 4152 7d29  re.EXCEPT_STAR})
+00009c20: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
+00009c30: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+00009c40: 7273 6528 2261 5b2a 625d 2229 0a20 2020  rse("a[*b]").   
+00009c50: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009c60: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
+00009c70: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+00009c80: 6465 292c 207b 4665 6174 7572 652e 5641  de), {Feature.VA
+00009c90: 5249 4144 4943 5f47 454e 4552 4943 537d  RIADIC_GENERICS}
+00009ca0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+00009cb0: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+00009cc0: 6172 7365 2822 615b 782c 202a 7928 292c  arse("a[x, *y(),
+00009cd0: 207a 5d20 3d20 7422 290a 2020 2020 2020   z] = t").      
+00009ce0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00009cf0: 616c 2862 6c61 636b 2e67 6574 5f66 6561  al(black.get_fea
+00009d00: 7475 7265 735f 7573 6564 286e 6f64 6529  tures_used(node)
+00009d10: 2c20 7b46 6561 7475 7265 2e56 4152 4941  , {Feature.VARIA
+00009d20: 4449 435f 4745 4e45 5249 4353 7d29 0a20  DIC_GENERICS}). 
+00009d30: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
+00009d40: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+00009d50: 6528 2264 6566 2066 6e28 2a61 7267 733a  e("def fn(*args:
+00009d60: 202a 5429 3a20 7061 7373 2229 0a20 2020   *T): pass").   
+00009d70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009d80: 4571 7561 6c28 626c 6163 6b2e 6765 745f  Equal(black.get_
+00009d90: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+00009da0: 6465 292c 207b 4665 6174 7572 652e 5641  de), {Feature.VA
+00009db0: 5249 4144 4943 5f47 454e 4552 4943 537d  RIADIC_GENERICS}
+00009dc0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00009dd0: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
+00009de0: 645f 666f 725f 6675 7475 7265 5f66 6c61  d_for_future_fla
+00009df0: 6773 2873 656c 6629 202d 3e20 4e6f 6e65  gs(self) -> None
+00009e00: 3a0a 2020 2020 2020 2020 666f 7220 7372  :.        for sr
+00009e10: 632c 2066 6561 7475 7265 7320 696e 205b  c, features in [
+00009e20: 0a20 2020 2020 2020 2020 2020 2028 2266  .            ("f
+00009e30: 726f 6d20 5f5f 6675 7475 7265 5f5f 2069  rom __future__ i
+00009e40: 6d70 6f72 7420 616e 6e6f 7461 7469 6f6e  mport annotation
+00009e50: 7322 2c20 7b46 6561 7475 7265 2e46 5554  s", {Feature.FUT
+00009e60: 5552 455f 414e 4e4f 5441 5449 4f4e 537d  URE_ANNOTATIONS}
+00009e70: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+00009e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e90: 2022 6672 6f6d 205f 5f66 7574 7572 655f   "from __future_
+00009ea0: 5f20 696d 706f 7274 2028 6f74 6865 722c  _ import (other,
+00009eb0: 2061 6e6e 6f74 6174 696f 6e73 2922 2c0a   annotations)",.
+00009ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ed0: 7b46 6561 7475 7265 2e46 5554 5552 455f  {Feature.FUTURE_
+00009ee0: 414e 4e4f 5441 5449 4f4e 537d 2c0a 2020  ANNOTATIONS},.  
+00009ef0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00009f00: 2020 2020 2020 2020 2028 2261 203d 2031           ("a = 1
+00009f10: 202b 2032 5c6e 6672 6f6d 2073 6f6d 6574   + 2\nfrom somet
+00009f20: 6869 6e67 2069 6d70 6f72 7420 616e 6e6f  hing import anno
+00009f30: 7461 7469 6f6e 7322 2c20 7365 7428 2929  tations", set())
+00009f40: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
+00009f50: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
+00009f60: 696d 706f 7274 2078 2c20 7922 2c20 7365  import x, y", se
+00009f70: 7428 2929 2c0a 2020 2020 2020 2020 5d3a  t()),.        ]:
+00009f80: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00009f90: 6820 7365 6c66 2e73 7562 5465 7374 2873  h self.subTest(s
+00009fa0: 7263 3d73 7263 2c20 6665 6174 7572 6573  rc=src, features
+00009fb0: 3d66 6561 7475 7265 7329 3a0a 2020 2020  =features):.    
+00009fc0: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
+00009fd0: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+00009fe0: 5f70 6172 7365 2873 7263 290a 2020 2020  _parse(src).    
+00009ff0: 2020 2020 2020 2020 2020 2020 6675 7475              futu
+0000a000: 7265 5f69 6d70 6f72 7473 203d 2062 6c61  re_imports = bla
+0000a010: 636b 2e67 6574 5f66 7574 7572 655f 696d  ck.get_future_im
+0000a020: 706f 7274 7328 6e6f 6465 290a 2020 2020  ports(node).    
+0000a030: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000a040: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a060: 2020 626c 6163 6b2e 6765 745f 6665 6174    black.get_feat
+0000a070: 7572 6573 5f75 7365 6428 6e6f 6465 2c20  ures_used(node, 
+0000a080: 6675 7475 7265 5f69 6d70 6f72 7473 3d66  future_imports=f
+0000a090: 7574 7572 655f 696d 706f 7274 7329 2c0a  uture_imports),.
+0000a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0b0: 2020 2020 6665 6174 7572 6573 2c0a 2020      features,.  
+0000a0c0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000a0d0: 0a20 2020 2064 6566 2074 6573 745f 6765  .    def test_ge
+0000a0e0: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
+0000a0f0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000a100: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
+0000a110: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
+0000a120: 7365 2822 5c6e 2229 0a20 2020 2020 2020  se("\n").       
+0000a130: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000a140: 6c28 7365 7428 292c 2062 6c61 636b 2e67  l(set(), black.g
+0000a150: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
+0000a160: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
+0000a170: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
+0000a180: 6232 746f 335f 7061 7273 6528 2266 726f  b2to3_parse("fro
+0000a190: 6d20 5f5f 6675 7475 7265 5f5f 2069 6d70  m __future__ imp
+0000a1a0: 6f72 7420 626c 6163 6b5c 6e22 290a 2020  ort black\n").  
+0000a1b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a1c0: 7445 7175 616c 287b 2262 6c61 636b 227d  tEqual({"black"}
+0000a1d0: 2c20 626c 6163 6b2e 6765 745f 6675 7475  , black.get_futu
+0000a1e0: 7265 5f69 6d70 6f72 7473 286e 6f64 6529  re_imports(node)
+0000a1f0: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+0000a200: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+0000a210: 6172 7365 2822 6672 6f6d 205f 5f66 7574  arse("from __fut
+0000a220: 7572 655f 5f20 696d 706f 7274 206d 756c  ure__ import mul
+0000a230: 7469 706c 652c 2069 6d70 6f72 7473 5c6e  tiple, imports\n
+0000a240: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+0000a250: 6173 7365 7274 4571 7561 6c28 7b22 6d75  assertEqual({"mu
+0000a260: 6c74 6970 6c65 222c 2022 696d 706f 7274  ltiple", "import
+0000a270: 7322 7d2c 2062 6c61 636b 2e67 6574 5f66  s"}, black.get_f
+0000a280: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
+0000a290: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
+0000a2a0: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
+0000a2b0: 335f 7061 7273 6528 2266 726f 6d20 5f5f  3_parse("from __
+0000a2c0: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
+0000a2d0: 2870 6172 656e 7468 6573 697a 6564 2c20  (parenthesized, 
+0000a2e0: 696d 706f 7274 7329 5c6e 2229 0a20 2020  imports)\n").   
+0000a2f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000a300: 4571 7561 6c28 7b22 7061 7265 6e74 6865  Equal({"parenthe
+0000a310: 7369 7a65 6422 2c20 2269 6d70 6f72 7473  sized", "imports
+0000a320: 227d 2c20 626c 6163 6b2e 6765 745f 6675  "}, black.get_fu
+0000a330: 7475 7265 5f69 6d70 6f72 7473 286e 6f64  ture_imports(nod
+0000a340: 6529 290a 2020 2020 2020 2020 6e6f 6465  e)).        node
+0000a350: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+0000a360: 5f70 6172 7365 280a 2020 2020 2020 2020  _parse(.        
+0000a370: 2020 2020 2266 726f 6d20 5f5f 6675 7475      "from __futu
+0000a380: 7265 5f5f 2069 6d70 6f72 7420 6d75 6c74  re__ import mult
+0000a390: 6970 6c65 5c6e 6672 6f6d 205f 5f66 7574  iple\nfrom __fut
+0000a3a0: 7572 655f 5f20 696d 706f 7274 2069 6d70  ure__ import imp
+0000a3b0: 6f72 7473 5c6e 220a 2020 2020 2020 2020  orts\n".        
+0000a3c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000a3d0: 7373 6572 7445 7175 616c 287b 226d 756c  ssertEqual({"mul
+0000a3e0: 7469 706c 6522 2c20 2269 6d70 6f72 7473  tiple", "imports
+0000a3f0: 227d 2c20 626c 6163 6b2e 6765 745f 6675  "}, black.get_fu
+0000a400: 7475 7265 5f69 6d70 6f72 7473 286e 6f64  ture_imports(nod
+0000a410: 6529 290a 2020 2020 2020 2020 6e6f 6465  e)).        node
+0000a420: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+0000a430: 5f70 6172 7365 2822 2320 636f 6d6d 656e  _parse("# commen
+0000a440: 745c 6e66 726f 6d20 5f5f 6675 7475 7265  t\nfrom __future
+0000a450: 5f5f 2069 6d70 6f72 7420 626c 6163 6b5c  __ import black\
+0000a460: 6e22 290a 2020 2020 2020 2020 7365 6c66  n").        self
+0000a470: 2e61 7373 6572 7445 7175 616c 287b 2262  .assertEqual({"b
+0000a480: 6c61 636b 227d 2c20 626c 6163 6b2e 6765  lack"}, black.ge
+0000a490: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
+0000a4a0: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
+0000a4b0: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
+0000a4c0: 3274 6f33 5f70 6172 7365 2827 2222 2264  2to3_parse('"""d
+0000a4d0: 6f63 7374 7269 6e67 2222 225c 6e66 726f  ocstring"""\nfro
+0000a4e0: 6d20 5f5f 6675 7475 7265 5f5f 2069 6d70  m __future__ imp
+0000a4f0: 6f72 7420 626c 6163 6b5c 6e27 290a 2020  ort black\n').  
+0000a500: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a510: 7445 7175 616c 287b 2262 6c61 636b 227d  tEqual({"black"}
+0000a520: 2c20 626c 6163 6b2e 6765 745f 6675 7475  , black.get_futu
+0000a530: 7265 5f69 6d70 6f72 7473 286e 6f64 6529  re_imports(node)
+0000a540: 290a 2020 2020 2020 2020 6e6f 6465 203d  ).        node =
+0000a550: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+0000a560: 6172 7365 2822 736f 6d65 286f 7468 6572  arse("some(other
+0000a570: 2c20 636f 6465 295c 6e66 726f 6d20 5f5f  , code)\nfrom __
+0000a580: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
+0000a590: 626c 6163 6b5c 6e22 290a 2020 2020 2020  black\n").      
+0000a5a0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000a5b0: 616c 2873 6574 2829 2c20 626c 6163 6b2e  al(set(), black.
+0000a5c0: 6765 745f 6675 7475 7265 5f69 6d70 6f72  get_future_impor
+0000a5d0: 7473 286e 6f64 6529 290a 2020 2020 2020  ts(node)).      
+0000a5e0: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
+0000a5f0: 6962 3274 6f33 5f70 6172 7365 2822 6672  ib2to3_parse("fr
+0000a600: 6f6d 2073 6f6d 652e 6d6f 6475 6c65 2069  om some.module i
+0000a610: 6d70 6f72 7420 626c 6163 6b5c 6e22 290a  mport black\n").
+0000a620: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000a630: 6572 7445 7175 616c 2873 6574 2829 2c20  ertEqual(set(), 
+0000a640: 626c 6163 6b2e 6765 745f 6675 7475 7265  black.get_future
+0000a650: 5f69 6d70 6f72 7473 286e 6f64 6529 290a  _imports(node)).
+0000a660: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
+0000a670: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
+0000a680: 7365 280a 2020 2020 2020 2020 2020 2020  se(.            
+0000a690: 2266 726f 6d20 5f5f 6675 7475 7265 5f5f  "from __future__
+0000a6a0: 2069 6d70 6f72 7420 756e 6963 6f64 655f   import unicode_
+0000a6b0: 6c69 7465 7261 6c73 2061 7320 5f75 6e69  literals as _uni
+0000a6c0: 636f 6465 5f6c 6974 6572 616c 7322 0a20  code_literals". 
+0000a6d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000a6e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000a6f0: 6c28 7b22 756e 6963 6f64 655f 6c69 7465  l({"unicode_lite
+0000a700: 7261 6c73 227d 2c20 626c 6163 6b2e 6765  rals"}, black.ge
+0000a710: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
+0000a720: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
+0000a730: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
+0000a740: 3274 6f33 5f70 6172 7365 280a 2020 2020  2to3_parse(.    
+0000a750: 2020 2020 2020 2020 2266 726f 6d20 5f5f          "from __
+0000a760: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
+0000a770: 756e 6963 6f64 655f 6c69 7465 7261 6c73  unicode_literals
+0000a780: 2061 7320 5f6c 6f6c 2c20 7072 696e 7422   as _lol, print"
+0000a790: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0000a7a0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000a7b0: 7561 6c28 7b22 756e 6963 6f64 655f 6c69  ual({"unicode_li
+0000a7c0: 7465 7261 6c73 222c 2022 7072 696e 7422  terals", "print"
+0000a7d0: 7d2c 2062 6c61 636b 2e67 6574 5f66 7574  }, black.get_fut
+0000a7e0: 7572 655f 696d 706f 7274 7328 6e6f 6465  ure_imports(node
+0000a7f0: 2929 0a0a 2020 2020 4070 7974 6573 742e  ))..    @pytest.
+0000a800: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
+0000a810: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
+0000a820: 2064 6566 2074 6573 745f 6465 6275 675f   def test_debug_
+0000a830: 7669 7369 746f 7228 7365 6c66 2920 2d3e  visitor(self) ->
+0000a840: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+0000a850: 6f75 7263 652c 205f 203d 2072 6561 645f  ource, _ = read_
+0000a860: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
+0000a870: 6f75 7322 2c20 2264 6562 7567 5f76 6973  ous", "debug_vis
+0000a880: 6974 6f72 2229 0a20 2020 2020 2020 2065  itor").        e
+0000a890: 7870 6563 7465 642c 205f 203d 2072 6561  xpected, _ = rea
+0000a8a0: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
+0000a8b0: 6e65 6f75 7322 2c20 2264 6562 7567 5f76  neous", "debug_v
+0000a8c0: 6973 6974 6f72 2e6f 7574 2229 0a20 2020  isitor.out").   
+0000a8d0: 2020 2020 206f 7574 5f6c 696e 6573 203d       out_lines =
+0000a8e0: 205b 5d0a 2020 2020 2020 2020 6572 725f   [].        err_
+0000a8f0: 6c69 6e65 7320 3d20 5b5d 0a0a 2020 2020  lines = []..    
+0000a900: 2020 2020 6465 6620 6f75 7428 6d73 673a      def out(msg:
+0000a910: 2073 7472 2c20 2a2a 6b77 6172 6773 3a20   str, **kwargs: 
+0000a920: 416e 7929 202d 3e20 4e6f 6e65 3a0a 2020  Any) -> None:.  
+0000a930: 2020 2020 2020 2020 2020 6f75 745f 6c69            out_li
+0000a940: 6e65 732e 6170 7065 6e64 286d 7367 290a  nes.append(msg).
+0000a950: 0a20 2020 2020 2020 2064 6566 2065 7272  .        def err
+0000a960: 286d 7367 3a20 7374 722c 202a 2a6b 7761  (msg: str, **kwa
+0000a970: 7267 733a 2041 6e79 2920 2d3e 204e 6f6e  rgs: Any) -> Non
+0000a980: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
+0000a990: 7272 5f6c 696e 6573 2e61 7070 656e 6428  rr_lines.append(
+0000a9a0: 6d73 6729 0a0a 2020 2020 2020 2020 7769  msg)..        wi
+0000a9b0: 7468 2070 6174 6368 2822 626c 6163 6b2e  th patch("black.
+0000a9c0: 6465 6275 672e 6f75 7422 2c20 6f75 7429  debug.out", out)
+0000a9d0: 3a0a 2020 2020 2020 2020 2020 2020 4465  :.            De
+0000a9e0: 6275 6756 6973 6974 6f72 2e73 686f 7728  bugVisitor.show(
+0000a9f0: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
+0000aa00: 6163 7475 616c 203d 2022 5c6e 222e 6a6f  actual = "\n".jo
+0000aa10: 696e 286f 7574 5f6c 696e 6573 2920 2b20  in(out_lines) + 
+0000aa20: 225c 6e22 0a20 2020 2020 2020 206c 6f67  "\n".        log
+0000aa30: 5f6e 616d 6520 3d20 2222 0a20 2020 2020  _name = "".     
+0000aa40: 2020 2069 6620 6578 7065 6374 6564 2021     if expected !
+0000aa50: 3d20 6163 7475 616c 3a0a 2020 2020 2020  = actual:.      
+0000aa60: 2020 2020 2020 6c6f 675f 6e61 6d65 203d        log_name =
+0000aa70: 2062 6c61 636b 2e64 756d 705f 746f 5f66   black.dump_to_f
+0000aa80: 696c 6528 2a6f 7574 5f6c 696e 6573 290a  ile(*out_lines).
+0000aa90: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000aaa0: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+0000aab0: 2020 2020 2020 6578 7065 6374 6564 2c0a        expected,.
+0000aac0: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+0000aad0: 616c 2c0a 2020 2020 2020 2020 2020 2020  al,.            
+0000aae0: 6622 4153 5420 7072 696e 7420 6f75 7420  f"AST print out 
+0000aaf0: 6973 2064 6966 6665 7265 6e74 2e20 4163  is different. Ac
+0000ab00: 7475 616c 2076 6572 7369 6f6e 2064 756d  tual version dum
+0000ab10: 7065 6420 746f 207b 6c6f 675f 6e61 6d65  ped to {log_name
+0000ab20: 7d22 2c0a 2020 2020 2020 2020 290a 0a20  }",.        ).. 
+0000ab30: 2020 2064 6566 2074 6573 745f 666f 726d     def test_form
+0000ab40: 6174 5f66 696c 655f 636f 6e74 656e 7473  at_file_contents
+0000ab50: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000ab60: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
+0000ab70: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
+0000ab80: 2020 2020 656d 7074 7920 3d20 2222 0a20      empty = "". 
+0000ab90: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+0000aba0: 2e61 7373 6572 7452 6169 7365 7328 626c  .assertRaises(bl
+0000abb0: 6163 6b2e 4e6f 7468 696e 6743 6861 6e67  ack.NothingChang
+0000abc0: 6564 293a 0a20 2020 2020 2020 2020 2020  ed):.           
+0000abd0: 2062 6c61 636b 2e66 6f72 6d61 745f 6669   black.format_fi
+0000abe0: 6c65 5f63 6f6e 7465 6e74 7328 656d 7074  le_contents(empt
+0000abf0: 792c 206d 6f64 653d 6d6f 6465 2c20 6661  y, mode=mode, fa
+0000ac00: 7374 3d46 616c 7365 290a 2020 2020 2020  st=False).      
+0000ac10: 2020 6a75 7374 5f6e 6c20 3d20 225c 6e22    just_nl = "\n"
+0000ac20: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0000ac30: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0000ac40: 626c 6163 6b2e 4e6f 7468 696e 6743 6861  black.NothingCha
+0000ac50: 6e67 6564 293a 0a20 2020 2020 2020 2020  nged):.         
+0000ac60: 2020 2062 6c61 636b 2e66 6f72 6d61 745f     black.format_
+0000ac70: 6669 6c65 5f63 6f6e 7465 6e74 7328 6a75  file_contents(ju
+0000ac80: 7374 5f6e 6c2c 206d 6f64 653d 6d6f 6465  st_nl, mode=mode
+0000ac90: 2c20 6661 7374 3d46 616c 7365 290a 2020  , fast=False).  
+0000aca0: 2020 2020 2020 7361 6d65 203d 2022 6a20        same = "j 
+0000acb0: 3d20 5b31 2c20 322c 2033 5d5c 6e22 0a20  = [1, 2, 3]\n". 
+0000acc0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+0000acd0: 2e61 7373 6572 7452 6169 7365 7328 626c  .assertRaises(bl
+0000ace0: 6163 6b2e 4e6f 7468 696e 6743 6861 6e67  ack.NothingChang
+0000acf0: 6564 293a 0a20 2020 2020 2020 2020 2020  ed):.           
+0000ad00: 2062 6c61 636b 2e66 6f72 6d61 745f 6669   black.format_fi
+0000ad10: 6c65 5f63 6f6e 7465 6e74 7328 7361 6d65  le_contents(same
+0000ad20: 2c20 6d6f 6465 3d6d 6f64 652c 2066 6173  , mode=mode, fas
+0000ad30: 743d 4661 6c73 6529 0a20 2020 2020 2020  t=False).       
+0000ad40: 2064 6966 6665 7265 6e74 203d 2022 6a20   different = "j 
+0000ad50: 3d20 5b31 2c32 2c33 5d22 0a20 2020 2020  = [1,2,3]".     
+0000ad60: 2020 2065 7870 6563 7465 6420 3d20 7361     expected = sa
+0000ad70: 6d65 0a20 2020 2020 2020 2061 6374 7561  me.        actua
+0000ad80: 6c20 3d20 626c 6163 6b2e 666f 726d 6174  l = black.format
+0000ad90: 5f66 696c 655f 636f 6e74 656e 7473 2864  _file_contents(d
+0000ada0: 6966 6665 7265 6e74 2c20 6d6f 6465 3d6d  ifferent, mode=m
+0000adb0: 6f64 652c 2066 6173 743d 4661 6c73 6529  ode, fast=False)
+0000adc0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000add0: 7365 7274 4571 7561 6c28 6578 7065 6374  sertEqual(expect
+0000ade0: 6564 2c20 6163 7475 616c 290a 2020 2020  ed, actual).    
+0000adf0: 2020 2020 696e 7661 6c69 6420 3d20 2272      invalid = "r
+0000ae00: 6574 7572 6e20 6966 2079 6f75 2063 616e  eturn if you can
+0000ae10: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
+0000ae20: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+0000ae30: 2862 6c61 636b 2e49 6e76 616c 6964 496e  (black.InvalidIn
+0000ae40: 7075 7429 2061 7320 653a 0a20 2020 2020  put) as e:.     
+0000ae50: 2020 2020 2020 2062 6c61 636b 2e66 6f72         black.for
+0000ae60: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
+0000ae70: 7328 696e 7661 6c69 642c 206d 6f64 653d  s(invalid, mode=
+0000ae80: 6d6f 6465 2c20 6661 7374 3d46 616c 7365  mode, fast=False
+0000ae90: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000aea0: 7373 6572 7445 7175 616c 2873 7472 2865  ssertEqual(str(e
+0000aeb0: 2e65 7863 6570 7469 6f6e 292c 2022 4361  .exception), "Ca
+0000aec0: 6e6e 6f74 2070 6172 7365 3a20 313a 373a  nnot parse: 1:7:
+0000aed0: 2072 6574 7572 6e20 6966 2079 6f75 2063   return if you c
+0000aee0: 616e 2229 0a0a 2020 2020 2020 2020 6d6f  an")..        mo
+0000aef0: 6465 203d 2062 6c61 636b 2e4d 6f64 6528  de = black.Mode(
+0000af00: 7072 6576 6965 773d 5472 7565 290a 2020  preview=True).  
+0000af10: 2020 2020 2020 6a75 7374 5f63 726c 6620        just_crlf 
+0000af20: 3d20 225c 725c 6e22 0a20 2020 2020 2020  = "\r\n".       
+0000af30: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+0000af40: 7452 6169 7365 7328 626c 6163 6b2e 4e6f  tRaises(black.No
+0000af50: 7468 696e 6743 6861 6e67 6564 293a 0a20  thingChanged):. 
+0000af60: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0000af70: 2e66 6f72 6d61 745f 6669 6c65 5f63 6f6e  .format_file_con
+0000af80: 7465 6e74 7328 6a75 7374 5f63 726c 662c  tents(just_crlf,
+0000af90: 206d 6f64 653d 6d6f 6465 2c20 6661 7374   mode=mode, fast
+0000afa0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0000afb0: 6a75 7374 5f77 6869 7465 7370 6163 655f  just_whitespace_
+0000afc0: 6e6c 203d 2022 5c6e 5c74 5c6e 205c 6e5c  nl = "\n\t\n \n\
+0000afd0: 7420 5c6e 205c 745c 6e5c 6e22 0a20 2020  t \n \t\n\n".   
+0000afe0: 2020 2020 2061 6374 7561 6c20 3d20 626c       actual = bl
+0000aff0: 6163 6b2e 666f 726d 6174 5f66 696c 655f  ack.format_file_
+0000b000: 636f 6e74 656e 7473 286a 7573 745f 7768  contents(just_wh
+0000b010: 6974 6573 7061 6365 5f6e 6c2c 206d 6f64  itespace_nl, mod
+0000b020: 653d 6d6f 6465 2c20 6661 7374 3d46 616c  e=mode, fast=Fal
+0000b030: 7365 290a 2020 2020 2020 2020 7365 6c66  se).        self
+0000b040: 2e61 7373 6572 7445 7175 616c 2822 5c6e  .assertEqual("\n
+0000b050: 222c 2061 6374 7561 6c29 0a20 2020 2020  ", actual).     
+0000b060: 2020 206a 7573 745f 7768 6974 6573 7061     just_whitespa
+0000b070: 6365 5f63 726c 6620 3d20 225c 725c 6e5c  ce_crlf = "\r\n\
+0000b080: 745c 725c 6e20 5c72 5c6e 5c74 205c 725c  t\r\n \r\n\t \r\
+0000b090: 6e20 5c74 5c72 5c6e 5c72 5c6e 220a 2020  n \t\r\n\r\n".  
+0000b0a0: 2020 2020 2020 6163 7475 616c 203d 2062        actual = b
+0000b0b0: 6c61 636b 2e66 6f72 6d61 745f 6669 6c65  lack.format_file
+0000b0c0: 5f63 6f6e 7465 6e74 7328 6a75 7374 5f77  _contents(just_w
+0000b0d0: 6869 7465 7370 6163 655f 6372 6c66 2c20  hitespace_crlf, 
+0000b0e0: 6d6f 6465 3d6d 6f64 652c 2066 6173 743d  mode=mode, fast=
+0000b0f0: 4661 6c73 6529 0a20 2020 2020 2020 2073  False).        s
+0000b100: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000b110: 225c 725c 6e22 2c20 6163 7475 616c 290a  "\r\n", actual).
+0000b120: 0a20 2020 2064 6566 2074 6573 745f 656e  .    def test_en
+0000b130: 646d 6172 6b65 7228 7365 6c66 2920 2d3e  dmarker(self) ->
+0000b140: 204e 6f6e 653a 0a20 2020 2020 2020 206e   None:.        n
+0000b150: 203d 2062 6c61 636b 2e6c 6962 3274 6f33   = black.lib2to3
+0000b160: 5f70 6172 7365 2822 5c6e 2229 0a20 2020  _parse("\n").   
+0000b170: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000b180: 4571 7561 6c28 6e2e 7479 7065 2c20 626c  Equal(n.type, bl
+0000b190: 6163 6b2e 7379 6d73 2e66 696c 655f 696e  ack.syms.file_in
+0000b1a0: 7075 7429 0a20 2020 2020 2020 2073 656c  put).        sel
+0000b1b0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+0000b1c0: 6e28 6e2e 6368 696c 6472 656e 292c 2031  n(n.children), 1
+0000b1d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000b1e0: 7373 6572 7445 7175 616c 286e 2e63 6869  ssertEqual(n.chi
+0000b1f0: 6c64 7265 6e5b 305d 2e74 7970 652c 2062  ldren[0].type, b
+0000b200: 6c61 636b 2e74 6f6b 656e 2e45 4e44 4d41  lack.token.ENDMA
+0000b210: 524b 4552 290a 0a20 2020 2040 7079 7465  RKER)..    @pyte
+0000b220: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
+0000b230: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
+0000b240: 2020 2020 4075 6e69 7474 6573 742e 736b      @unittest.sk
+0000b250: 6970 4966 286f 732e 656e 7669 726f 6e2e  ipIf(os.environ.
+0000b260: 6765 7428 2253 4b49 505f 4153 545f 5052  get("SKIP_AST_PR
+0000b270: 494e 5422 292c 2022 7573 6572 2073 6574  INT"), "user set
+0000b280: 2053 4b49 505f 4153 545f 5052 494e 5422   SKIP_AST_PRINT"
+0000b290: 290a 2020 2020 6465 6620 7465 7374 5f61  ).    def test_a
+0000b2a0: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
+0000b2b0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000b2c0: 2020 2020 2020 2020 6f75 745f 6c69 6e65          out_line
+0000b2d0: 7320 3d20 5b5d 0a20 2020 2020 2020 2065  s = [].        e
+0000b2e0: 7272 5f6c 696e 6573 203d 205b 5d0a 0a20  rr_lines = [].. 
+0000b2f0: 2020 2020 2020 2064 6566 206f 7574 286d         def out(m
+0000b300: 7367 3a20 7374 722c 202a 2a6b 7761 7267  sg: str, **kwarg
+0000b310: 733a 2041 6e79 2920 2d3e 204e 6f6e 653a  s: Any) -> None:
+0000b320: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0000b330: 5f6c 696e 6573 2e61 7070 656e 6428 6d73  _lines.append(ms
+0000b340: 6729 0a0a 2020 2020 2020 2020 6465 6620  g)..        def 
+0000b350: 6572 7228 6d73 673a 2073 7472 2c20 2a2a  err(msg: str, **
+0000b360: 6b77 6172 6773 3a20 416e 7929 202d 3e20  kwargs: Any) -> 
+0000b370: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000b380: 2020 6572 725f 6c69 6e65 732e 6170 7065    err_lines.appe
+0000b390: 6e64 286d 7367 290a 0a20 2020 2020 2020  nd(msg)..       
+0000b3a0: 2077 6974 6820 7061 7463 6828 2262 6c61   with patch("bla
+0000b3b0: 636b 2e6f 7574 7075 742e 5f6f 7574 222c  ck.output._out",
+0000b3c0: 206f 7574 292c 2070 6174 6368 2822 626c   out), patch("bl
+0000b3d0: 6163 6b2e 6f75 7470 7574 2e5f 6572 7222  ack.output._err"
+0000b3e0: 2c20 6572 7229 3a0a 2020 2020 2020 2020  , err):.        
+0000b3f0: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+0000b400: 7365 7274 5261 6973 6573 2841 7373 6572  sertRaises(Asser
+0000b410: 7469 6f6e 4572 726f 7229 3a0a 2020 2020  tionError):.    
+0000b420: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b430: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
+0000b440: 616c 2822 6a20 3d20 5b31 2c20 322c 2033  al("j = [1, 2, 3
+0000b450: 5d22 2c20 226a 203d 205b 312c 2032 2c20  ]", "j = [1, 2, 
+0000b460: 332c 5d22 290a 0a20 2020 2020 2020 206f  3,]")..        o
+0000b470: 7574 5f73 7472 203d 2022 222e 6a6f 696e  ut_str = "".join
+0000b480: 286f 7574 5f6c 696e 6573 290a 2020 2020  (out_lines).    
+0000b490: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+0000b4a0: 6e28 2245 7870 6563 7465 6420 7472 6565  n("Expected tree
+0000b4b0: 3a22 2c20 6f75 745f 7374 7229 0a20 2020  :", out_str).   
+0000b4c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000b4d0: 496e 2822 4163 7475 616c 2074 7265 653a  In("Actual tree:
+0000b4e0: 222c 206f 7574 5f73 7472 290a 2020 2020  ", out_str).    
+0000b4f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000b500: 7175 616c 2822 222e 6a6f 696e 2865 7272  qual("".join(err
+0000b510: 5f6c 696e 6573 292c 2022 2229 0a0a 2020  _lines), "")..  
+0000b520: 2020 4065 7665 6e74 5f6c 6f6f 7028 290a    @event_loop().
+0000b530: 2020 2020 4070 6174 6368 2822 636f 6e63      @patch("conc
+0000b540: 7572 7265 6e74 2e66 7574 7572 6573 2e50  urrent.futures.P
+0000b550: 726f 6365 7373 506f 6f6c 4578 6563 7574  rocessPoolExecut
+0000b560: 6f72 222c 204d 6167 6963 4d6f 636b 2873  or", MagicMock(s
+0000b570: 6964 655f 6566 6665 6374 3d4f 5345 7272  ide_effect=OSErr
+0000b580: 6f72 2929 0a20 2020 2064 6566 2074 6573  or)).    def tes
+0000b590: 745f 776f 726b 735f 696e 5f6d 6f6e 6f5f  t_works_in_mono_
+0000b5a0: 7072 6f63 6573 735f 6f6e 6c79 5f65 6e76  process_only_env
+0000b5b0: 6972 6f6e 6d65 6e74 2873 656c 6629 202d  ironment(self) -
+0000b5c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000b5d0: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
+0000b5e0: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
+0000b5f0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+0000b600: 2069 6e20 5b0a 2020 2020 2020 2020 2020   in [.          
+0000b610: 2020 2020 2020 2877 6f72 6b73 7061 6365        (workspace
+0000b620: 202f 2022 6f6e 652e 7079 2229 2e72 6573   / "one.py").res
+0000b630: 6f6c 7665 2829 2c0a 2020 2020 2020 2020  olve(),.        
+0000b640: 2020 2020 2020 2020 2877 6f72 6b73 7061          (workspa
+0000b650: 6365 202f 2022 7477 6f2e 7079 2229 2e72  ce / "two.py").r
+0000b660: 6573 6f6c 7665 2829 2c0a 2020 2020 2020  esolve(),.      
+0000b670: 2020 2020 2020 5d3a 0a20 2020 2020 2020        ]:.       
+0000b680: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
+0000b690: 5f74 6578 7428 2770 7269 6e74 2822 6865  _text('print("he
+0000b6a0: 6c6c 6f22 295c 6e27 290a 2020 2020 2020  llo")\n').      
+0000b6b0: 2020 2020 2020 7365 6c66 2e69 6e76 6f6b        self.invok
+0000b6c0: 6542 6c61 636b 285b 7374 7228 776f 726b  eBlack([str(work
+0000b6d0: 7370 6163 6529 5d29 0a0a 2020 2020 4065  space)])..    @e
+0000b6e0: 7665 6e74 5f6c 6f6f 7028 290a 2020 2020  vent_loop().    
+0000b6f0: 6465 6620 7465 7374 5f63 6865 636b 5f64  def test_check_d
+0000b700: 6966 665f 7573 655f 746f 6765 7468 6572  iff_use_together
+0000b710: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000b720: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
+0000b730: 6865 5f64 6972 2829 3a0a 2020 2020 2020  he_dir():.      
+0000b740: 2020 2020 2020 2320 4669 6c65 7320 7768        # Files wh
+0000b750: 6963 6820 7769 6c6c 2062 6520 7265 666f  ich will be refo
+0000b760: 726d 6174 7465 642e 0a20 2020 2020 2020  rmatted..       
+0000b770: 2020 2020 2073 7263 3120 3d20 6765 745f       src1 = get_
+0000b780: 6361 7365 5f70 6174 6828 226d 6973 6365  case_path("misce
+0000b790: 6c6c 616e 656f 7573 222c 2022 7374 7269  llaneous", "stri
+0000b7a0: 6e67 5f71 756f 7465 7322 290a 2020 2020  ng_quotes").    
+0000b7b0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
+0000b7c0: 6f6b 6542 6c61 636b 285b 7374 7228 7372  okeBlack([str(sr
+0000b7d0: 6331 292c 2022 2d2d 6469 6666 222c 2022  c1), "--diff", "
+0000b7e0: 2d2d 6368 6563 6b22 5d2c 2065 7869 745f  --check"], exit_
+0000b7f0: 636f 6465 3d31 290a 2020 2020 2020 2020  code=1).        
+0000b800: 2020 2020 2320 4669 6c65 7320 7768 6963      # Files whic
+0000b810: 6820 7769 6c6c 206e 6f74 2062 6520 7265  h will not be re
+0000b820: 666f 726d 6174 7465 642e 0a20 2020 2020  formatted..     
+0000b830: 2020 2020 2020 2073 7263 3220 3d20 6765         src2 = ge
+0000b840: 745f 6361 7365 5f70 6174 6828 2273 696d  t_case_path("sim
+0000b850: 706c 655f 6361 7365 7322 2c20 2263 6f6d  ple_cases", "com
+0000b860: 706f 7369 7469 6f6e 2229 0a20 2020 2020  position").     
+0000b870: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
+0000b880: 6b65 426c 6163 6b28 5b73 7472 2873 7263  keBlack([str(src
+0000b890: 3229 2c20 222d 2d64 6966 6622 2c20 222d  2), "--diff", "-
+0000b8a0: 2d63 6865 636b 225d 290a 2020 2020 2020  -check"]).      
+0000b8b0: 2020 2020 2020 2320 4d75 6c74 6920 6669        # Multi fi
+0000b8c0: 6c65 2063 6f6d 6d61 6e64 2e0a 2020 2020  le command..    
+0000b8d0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
+0000b8e0: 6f6b 6542 6c61 636b 285b 7374 7228 7372  okeBlack([str(sr
+0000b8f0: 6331 292c 2073 7472 2873 7263 3229 2c20  c1), str(src2), 
+0000b900: 222d 2d64 6966 6622 2c20 222d 2d63 6865  "--diff", "--che
+0000b910: 636b 225d 2c20 6578 6974 5f63 6f64 653d  ck"], exit_code=
+0000b920: 3129 0a0a 2020 2020 6465 6620 7465 7374  1)..    def test
+0000b930: 5f6e 6f5f 7372 635f 6661 696c 7328 7365  _no_src_fails(se
+0000b940: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000b950: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+0000b960: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
+0000b970: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+0000b980: 6163 6b28 5b5d 2c20 6578 6974 5f63 6f64  ack([], exit_cod
+0000b990: 653d 3129 0a0a 2020 2020 6465 6620 7465  e=1)..    def te
+0000b9a0: 7374 5f73 7263 5f61 6e64 5f63 6f64 655f  st_src_and_code_
+0000b9b0: 6661 696c 7328 7365 6c66 2920 2d3e 204e  fails(self) -> N
+0000b9c0: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
+0000b9d0: 6820 6361 6368 655f 6469 7228 293a 0a20  h cache_dir():. 
+0000b9e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b9f0: 696e 766f 6b65 426c 6163 6b28 5b22 2e22  invokeBlack(["."
+0000ba00: 2c20 222d 6322 2c20 2230 225d 2c20 6578  , "-c", "0"], ex
+0000ba10: 6974 5f63 6f64 653d 3129 0a0a 2020 2020  it_code=1)..    
+0000ba20: 6465 6620 7465 7374 5f62 726f 6b65 6e5f  def test_broken_
+0000ba30: 7379 6d6c 696e 6b28 7365 6c66 2920 2d3e  symlink(self) ->
+0000ba40: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
+0000ba50: 6974 6820 6361 6368 655f 6469 7228 2920  ith cache_dir() 
+0000ba60: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
+0000ba70: 2020 2020 2020 2020 2020 7379 6d6c 696e            symlin
+0000ba80: 6b20 3d20 776f 726b 7370 6163 6520 2f20  k = workspace / 
+0000ba90: 2262 726f 6b65 6e5f 6c69 6e6b 2e70 7922  "broken_link.py"
+0000baa0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000bab0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000bac0: 2020 7379 6d6c 696e 6b2e 7379 6d6c 696e    symlink.symlin
+0000bad0: 6b5f 746f 2822 6e6f 6e65 7869 7374 656e  k_to("nonexisten
+0000bae0: 742e 7079 2229 0a20 2020 2020 2020 2020  t.py").         
+0000baf0: 2020 2065 7863 6570 7420 284f 5345 7272     except (OSErr
+0000bb00: 6f72 2c20 4e6f 7449 6d70 6c65 6d65 6e74  or, NotImplement
+0000bb10: 6564 4572 726f 7229 2061 7320 653a 0a20  edError) as e:. 
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000bb30: 656c 662e 736b 6970 5465 7374 2866 2243  elf.skipTest(f"C
+0000bb40: 616e 2774 2063 7265 6174 6520 7379 6d6c  an't create syml
+0000bb50: 696e 6b73 3a20 7b65 7d22 290a 2020 2020  inks: {e}").    
+0000bb60: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
+0000bb70: 6f6b 6542 6c61 636b 285b 7374 7228 776f  okeBlack([str(wo
+0000bb80: 726b 7370 6163 652e 7265 736f 6c76 6528  rkspace.resolve(
+0000bb90: 2929 5d29 0a0a 2020 2020 6465 6620 7465  ))])..    def te
+0000bba0: 7374 5f73 696e 676c 655f 6669 6c65 5f66  st_single_file_f
+0000bbb0: 6f72 6365 5f70 7969 2873 656c 6629 202d  orce_pyi(self) -
+0000bbc0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000bbd0: 7079 695f 6d6f 6465 203d 2072 6570 6c61  pyi_mode = repla
+0000bbe0: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
+0000bbf0: 2069 735f 7079 693d 5472 7565 290a 2020   is_pyi=True).  
+0000bc00: 2020 2020 2020 636f 6e74 656e 7473 2c20        contents, 
+0000bc10: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
+0000bc20: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
+0000bc30: 6f75 7322 2c20 2266 6f72 6365 5f70 7969  ous", "force_pyi
+0000bc40: 2229 0a20 2020 2020 2020 2077 6974 6820  ").        with 
+0000bc50: 6361 6368 655f 6469 7228 2920 6173 2077  cache_dir() as w
+0000bc60: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
+0000bc70: 2020 2020 2020 7061 7468 203d 2028 776f        path = (wo
+0000bc80: 726b 7370 6163 6520 2f20 2266 696c 652e  rkspace / "file.
+0000bc90: 7079 2229 2e72 6573 6f6c 7665 2829 0a20  py").resolve(). 
+0000bca0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0000bcb0: 6f70 656e 2870 6174 682c 2022 7722 2920  open(path, "w") 
+0000bcc0: 6173 2066 683a 0a20 2020 2020 2020 2020  as fh:.         
+0000bcd0: 2020 2020 2020 2066 682e 7772 6974 6528         fh.write(
+0000bce0: 636f 6e74 656e 7473 290a 2020 2020 2020  contents).      
+0000bcf0: 2020 2020 2020 7365 6c66 2e69 6e76 6f6b        self.invok
+0000bd00: 6542 6c61 636b 285b 7374 7228 7061 7468  eBlack([str(path
+0000bd10: 292c 2022 2d2d 7079 6922 5d29 0a20 2020  ), "--pyi"]).   
+0000bd20: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+0000bd30: 656e 2870 6174 682c 2022 7222 2920 6173  en(path, "r") as
+0000bd40: 2066 683a 0a20 2020 2020 2020 2020 2020   fh:.           
+0000bd50: 2020 2020 2061 6374 7561 6c20 3d20 6668       actual = fh
+0000bd60: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
+0000bd70: 2020 2020 2320 7665 7269 6679 2063 6163      # verify cac
+0000bd80: 6865 2077 6974 6820 2d2d 7079 6920 6973  he with --pyi is
+0000bd90: 2073 6570 6172 6174 650a 2020 2020 2020   separate.      
+0000bda0: 2020 2020 2020 7079 695f 6361 6368 6520        pyi_cache 
+0000bdb0: 3d20 626c 6163 6b2e 7265 6164 5f63 6163  = black.read_cac
+0000bdc0: 6865 2870 7969 5f6d 6f64 6529 0a20 2020  he(pyi_mode).   
+0000bdd0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0000bde0: 7365 7274 496e 2873 7472 2870 6174 6829  sertIn(str(path)
+0000bdf0: 2c20 7079 695f 6361 6368 6529 0a20 2020  , pyi_cache).   
+0000be00: 2020 2020 2020 2020 206e 6f72 6d61 6c5f           normal_
+0000be10: 6361 6368 6520 3d20 626c 6163 6b2e 7265  cache = black.re
+0000be20: 6164 5f63 6163 6865 2844 4546 4155 4c54  ad_cache(DEFAULT
+0000be30: 5f4d 4f44 4529 0a20 2020 2020 2020 2020  _MODE).         
+0000be40: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
+0000be50: 7449 6e28 7374 7228 7061 7468 292c 206e  tIn(str(path), n
+0000be60: 6f72 6d61 6c5f 6361 6368 6529 0a20 2020  ormal_cache).   
+0000be70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000be80: 466f 726d 6174 4571 7561 6c28 6578 7065  FormatEqual(expe
+0000be90: 6374 6564 2c20 6163 7475 616c 290a 2020  cted, actual).  
+0000bea0: 2020 2020 2020 626c 6163 6b2e 6173 7365        black.asse
+0000beb0: 7274 5f65 7175 6976 616c 656e 7428 636f  rt_equivalent(co
+0000bec0: 6e74 656e 7473 2c20 6163 7475 616c 290a  ntents, actual).
+0000bed0: 2020 2020 2020 2020 626c 6163 6b2e 6173          black.as
+0000bee0: 7365 7274 5f73 7461 626c 6528 636f 6e74  sert_stable(cont
+0000bef0: 656e 7473 2c20 6163 7475 616c 2c20 7079  ents, actual, py
+0000bf00: 695f 6d6f 6465 290a 0a20 2020 2040 6576  i_mode)..    @ev
+0000bf10: 656e 745f 6c6f 6f70 2829 0a20 2020 2064  ent_loop().    d
+0000bf20: 6566 2074 6573 745f 6d75 6c74 695f 6669  ef test_multi_fi
+0000bf30: 6c65 5f66 6f72 6365 5f70 7969 2873 656c  le_force_pyi(sel
+0000bf40: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000bf50: 2020 2020 7265 675f 6d6f 6465 203d 2044      reg_mode = D
+0000bf60: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
+0000bf70: 2020 2020 7079 695f 6d6f 6465 203d 2072      pyi_mode = r
+0000bf80: 6570 6c61 6365 2844 4546 4155 4c54 5f4d  eplace(DEFAULT_M
+0000bf90: 4f44 452c 2069 735f 7079 693d 5472 7565  ODE, is_pyi=True
+0000bfa0: 290a 2020 2020 2020 2020 636f 6e74 656e  ).        conten
+0000bfb0: 7473 2c20 6578 7065 6374 6564 203d 2072  ts, expected = r
+0000bfc0: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
+0000bfd0: 6c61 6e65 6f75 7322 2c20 2266 6f72 6365  laneous", "force
+0000bfe0: 5f70 7969 2229 0a20 2020 2020 2020 2077  _pyi").        w
+0000bff0: 6974 6820 6361 6368 655f 6469 7228 2920  ith cache_dir() 
+0000c000: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
+0000c010: 2020 2020 2020 2020 2020 7061 7468 7320            paths 
+0000c020: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+0000c030: 2020 2020 2877 6f72 6b73 7061 6365 202f      (workspace /
+0000c040: 2022 6669 6c65 312e 7079 2229 2e72 6573   "file1.py").res
+0000c050: 6f6c 7665 2829 2c0a 2020 2020 2020 2020  olve(),.        
+0000c060: 2020 2020 2020 2020 2877 6f72 6b73 7061          (workspa
+0000c070: 6365 202f 2022 6669 6c65 322e 7079 2229  ce / "file2.py")
+0000c080: 2e72 6573 6f6c 7665 2829 2c0a 2020 2020  .resolve(),.    
+0000c090: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+0000c0a0: 2020 2020 2020 666f 7220 7061 7468 2069        for path i
+0000c0b0: 6e20 7061 7468 733a 0a20 2020 2020 2020  n paths:.       
+0000c0c0: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+0000c0d0: 656e 2870 6174 682c 2022 7722 2920 6173  en(path, "w") as
+0000c0e0: 2066 683a 0a20 2020 2020 2020 2020 2020   fh:.           
+0000c0f0: 2020 2020 2020 2020 2066 682e 7772 6974           fh.writ
+0000c100: 6528 636f 6e74 656e 7473 290a 2020 2020  e(contents).    
+0000c110: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
+0000c120: 6f6b 6542 6c61 636b 285b 7374 7228 7029  okeBlack([str(p)
+0000c130: 2066 6f72 2070 2069 6e20 7061 7468 735d   for p in paths]
+0000c140: 202b 205b 222d 2d70 7969 225d 290a 2020   + ["--pyi"]).  
+0000c150: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
+0000c160: 7468 2069 6e20 7061 7468 733a 0a20 2020  th in paths:.   
+0000c170: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+0000c180: 6820 6f70 656e 2870 6174 682c 2022 7222  h open(path, "r"
+0000c190: 2920 6173 2066 683a 0a20 2020 2020 2020  ) as fh:.       
+0000c1a0: 2020 2020 2020 2020 2020 2020 2061 6374               act
+0000c1b0: 7561 6c20 3d20 6668 2e72 6561 6428 290a  ual = fh.read().
+0000c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1d0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000c1e0: 2861 6374 7561 6c2c 2065 7870 6563 7465  (actual, expecte
+0000c1f0: 6429 0a20 2020 2020 2020 2020 2020 2023  d).            #
+0000c200: 2076 6572 6966 7920 6361 6368 6520 7769   verify cache wi
+0000c210: 7468 202d 2d70 7969 2069 7320 7365 7061  th --pyi is sepa
+0000c220: 7261 7465 0a20 2020 2020 2020 2020 2020  rate.           
+0000c230: 2070 7969 5f63 6163 6865 203d 2062 6c61   pyi_cache = bla
+0000c240: 636b 2e72 6561 645f 6361 6368 6528 7079  ck.read_cache(py
+0000c250: 695f 6d6f 6465 290a 2020 2020 2020 2020  i_mode).        
+0000c260: 2020 2020 6e6f 726d 616c 5f63 6163 6865      normal_cache
+0000c270: 203d 2062 6c61 636b 2e72 6561 645f 6361   = black.read_ca
+0000c280: 6368 6528 7265 675f 6d6f 6465 290a 2020  che(reg_mode).  
+0000c290: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
+0000c2a0: 7468 2069 6e20 7061 7468 733a 0a20 2020  th in paths:.   
+0000c2b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c2c0: 662e 6173 7365 7274 496e 2873 7472 2870  f.assertIn(str(p
+0000c2d0: 6174 6829 2c20 7079 695f 6361 6368 6529  ath), pyi_cache)
+0000c2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c2f0: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
+0000c300: 6e28 7374 7228 7061 7468 292c 206e 6f72  n(str(path), nor
+0000c310: 6d61 6c5f 6361 6368 6529 0a0a 2020 2020  mal_cache)..    
+0000c320: 6465 6620 7465 7374 5f70 6970 655f 666f  def test_pipe_fo
+0000c330: 7263 655f 7079 6928 7365 6c66 2920 2d3e  rce_pyi(self) ->
+0000c340: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+0000c350: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
+0000c360: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
+0000c370: 6365 6c6c 616e 656f 7573 222c 2022 666f  cellaneous", "fo
+0000c380: 7263 655f 7079 6922 290a 2020 2020 2020  rce_pyi").      
+0000c390: 2020 7265 7375 6c74 203d 2043 6c69 5275    result = CliRu
+0000c3a0: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
+0000c3b0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0000c3c0: 2e6d 6169 6e2c 205b 222d 222c 2022 2d71  .main, ["-", "-q
+0000c3d0: 222c 2022 2d2d 7079 6922 5d2c 2069 6e70  ", "--pyi"], inp
+0000c3e0: 7574 3d42 7974 6573 494f 2873 6f75 7263  ut=BytesIO(sourc
+0000c3f0: 652e 656e 636f 6465 2822 7574 6638 2229  e.encode("utf8")
+0000c400: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+0000c410: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000c420: 7175 616c 2872 6573 756c 742e 6578 6974  qual(result.exit
+0000c430: 5f63 6f64 652c 2030 290a 2020 2020 2020  _code, 0).      
+0000c440: 2020 6163 7475 616c 203d 2072 6573 756c    actual = resul
+0000c450: 742e 6f75 7470 7574 0a20 2020 2020 2020  t.output.       
+0000c460: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
+0000c470: 6174 4571 7561 6c28 6163 7475 616c 2c20  atEqual(actual, 
+0000c480: 6578 7065 6374 6564 290a 0a20 2020 2064  expected)..    d
+0000c490: 6566 2074 6573 745f 7369 6e67 6c65 5f66  ef test_single_f
+0000c4a0: 696c 655f 666f 7263 655f 7079 3336 2873  ile_force_py36(s
+0000c4b0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000c4c0: 2020 2020 2020 7265 675f 6d6f 6465 203d        reg_mode =
+0000c4d0: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
+0000c4e0: 2020 2020 2020 7079 3336 5f6d 6f64 6520        py36_mode 
+0000c4f0: 3d20 7265 706c 6163 6528 4445 4641 554c  = replace(DEFAUL
+0000c500: 545f 4d4f 4445 2c20 7461 7267 6574 5f76  T_MODE, target_v
+0000c510: 6572 7369 6f6e 733d 5059 3336 5f56 4552  ersions=PY36_VER
+0000c520: 5349 4f4e 5329 0a20 2020 2020 2020 2073  SIONS).        s
+0000c530: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
+0000c540: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
+0000c550: 6365 6c6c 616e 656f 7573 222c 2022 666f  cellaneous", "fo
+0000c560: 7263 655f 7079 3336 2229 0a20 2020 2020  rce_py36").     
+0000c570: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
+0000c580: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
+0000c590: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+0000c5a0: 7468 203d 2028 776f 726b 7370 6163 6520  th = (workspace 
+0000c5b0: 2f20 2266 696c 652e 7079 2229 2e72 6573  / "file.py").res
+0000c5c0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
+0000c5d0: 2020 2077 6974 6820 6f70 656e 2870 6174     with open(pat
+0000c5e0: 682c 2022 7722 2920 6173 2066 683a 0a20  h, "w") as fh:. 
+0000c5f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000c600: 682e 7772 6974 6528 736f 7572 6365 290a  h.write(source).
+0000c610: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c620: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
+0000c630: 7228 7061 7468 292c 202a 5059 3336 5f41  r(path), *PY36_A
+0000c640: 5247 535d 290a 2020 2020 2020 2020 2020  RGS]).          
+0000c650: 2020 7769 7468 206f 7065 6e28 7061 7468    with open(path
+0000c660: 2c20 2272 2229 2061 7320 6668 3a0a 2020  , "r") as fh:.  
+0000c670: 2020 2020 2020 2020 2020 2020 2020 6163                ac
+0000c680: 7475 616c 203d 2066 682e 7265 6164 2829  tual = fh.read()
+0000c690: 0a20 2020 2020 2020 2020 2020 2023 2076  .            # v
+0000c6a0: 6572 6966 7920 6361 6368 6520 7769 7468  erify cache with
+0000c6b0: 202d 2d74 6172 6765 742d 7665 7273 696f   --target-versio
+0000c6c0: 6e20 6973 2073 6570 6172 6174 650a 2020  n is separate.  
+0000c6d0: 2020 2020 2020 2020 2020 7079 3336 5f63            py36_c
+0000c6e0: 6163 6865 203d 2062 6c61 636b 2e72 6561  ache = black.rea
+0000c6f0: 645f 6361 6368 6528 7079 3336 5f6d 6f64  d_cache(py36_mod
+0000c700: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+0000c710: 656c 662e 6173 7365 7274 496e 2873 7472  elf.assertIn(str
+0000c720: 2870 6174 6829 2c20 7079 3336 5f63 6163  (path), py36_cac
+0000c730: 6865 290a 2020 2020 2020 2020 2020 2020  he).            
+0000c740: 6e6f 726d 616c 5f63 6163 6865 203d 2062  normal_cache = b
+0000c750: 6c61 636b 2e72 6561 645f 6361 6368 6528  lack.read_cache(
+0000c760: 7265 675f 6d6f 6465 290a 2020 2020 2020  reg_mode).      
+0000c770: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000c780: 744e 6f74 496e 2873 7472 2870 6174 6829  tNotIn(str(path)
+0000c790: 2c20 6e6f 726d 616c 5f63 6163 6865 290a  , normal_cache).
+0000c7a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000c7b0: 6572 7445 7175 616c 2861 6374 7561 6c2c  ertEqual(actual,
+0000c7c0: 2065 7870 6563 7465 6429 0a0a 2020 2020   expected)..    
+0000c7d0: 4065 7665 6e74 5f6c 6f6f 7028 290a 2020  @event_loop().  
+0000c7e0: 2020 6465 6620 7465 7374 5f6d 756c 7469    def test_multi
+0000c7f0: 5f66 696c 655f 666f 7263 655f 7079 3336  _file_force_py36
+0000c800: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000c810: 2020 2020 2020 2020 7265 675f 6d6f 6465          reg_mode
+0000c820: 203d 2044 4546 4155 4c54 5f4d 4f44 450a   = DEFAULT_MODE.
+0000c830: 2020 2020 2020 2020 7079 3336 5f6d 6f64          py36_mod
+0000c840: 6520 3d20 7265 706c 6163 6528 4445 4641  e = replace(DEFA
+0000c850: 554c 545f 4d4f 4445 2c20 7461 7267 6574  ULT_MODE, target
+0000c860: 5f76 6572 7369 6f6e 733d 5059 3336 5f56  _versions=PY36_V
+0000c870: 4552 5349 4f4e 5329 0a20 2020 2020 2020  ERSIONS).       
+0000c880: 2073 6f75 7263 652c 2065 7870 6563 7465   source, expecte
+0000c890: 6420 3d20 7265 6164 5f64 6174 6128 226d  d = read_data("m
+0000c8a0: 6973 6365 6c6c 616e 656f 7573 222c 2022  iscellaneous", "
+0000c8b0: 666f 7263 655f 7079 3336 2229 0a20 2020  force_py36").   
+0000c8c0: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+0000c8d0: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
+0000c8e0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0000c8f0: 7061 7468 7320 3d20 5b0a 2020 2020 2020  paths = [.      
+0000c900: 2020 2020 2020 2020 2020 2877 6f72 6b73            (works
+0000c910: 7061 6365 202f 2022 6669 6c65 312e 7079  pace / "file1.py
+0000c920: 2229 2e72 6573 6f6c 7665 2829 2c0a 2020  ").resolve(),.  
+0000c930: 2020 2020 2020 2020 2020 2020 2020 2877                (w
+0000c940: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
+0000c950: 322e 7079 2229 2e72 6573 6f6c 7665 2829  2.py").resolve()
+0000c960: 2c0a 2020 2020 2020 2020 2020 2020 5d0a  ,.            ].
+0000c970: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000c980: 7061 7468 2069 6e20 7061 7468 733a 0a20  path in paths:. 
+0000c990: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000c9a0: 6974 6820 6f70 656e 2870 6174 682c 2022  ith open(path, "
+0000c9b0: 7722 2920 6173 2066 683a 0a20 2020 2020  w") as fh:.     
+0000c9c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000c9d0: 682e 7772 6974 6528 736f 7572 6365 290a  h.write(source).
+0000c9e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c9f0: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
+0000ca00: 7228 7029 2066 6f72 2070 2069 6e20 7061  r(p) for p in pa
+0000ca10: 7468 735d 202b 2050 5933 365f 4152 4753  ths] + PY36_ARGS
+0000ca20: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+0000ca30: 7220 7061 7468 2069 6e20 7061 7468 733a  r path in paths:
+0000ca40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ca50: 2077 6974 6820 6f70 656e 2870 6174 682c   with open(path,
+0000ca60: 2022 7222 2920 6173 2066 683a 0a20 2020   "r") as fh:.   
+0000ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca80: 2061 6374 7561 6c20 3d20 6668 2e72 6561   actual = fh.rea
+0000ca90: 6428 290a 2020 2020 2020 2020 2020 2020  d().            
+0000caa0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000cab0: 7175 616c 2861 6374 7561 6c2c 2065 7870  qual(actual, exp
+0000cac0: 6563 7465 6429 0a20 2020 2020 2020 2020  ected).         
+0000cad0: 2020 2023 2076 6572 6966 7920 6361 6368     # verify cach
+0000cae0: 6520 7769 7468 202d 2d74 6172 6765 742d  e with --target-
+0000caf0: 7665 7273 696f 6e20 6973 2073 6570 6172  version is separ
+0000cb00: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
+0000cb10: 7079 695f 6361 6368 6520 3d20 626c 6163  pyi_cache = blac
+0000cb20: 6b2e 7265 6164 5f63 6163 6865 2870 7933  k.read_cache(py3
+0000cb30: 365f 6d6f 6465 290a 2020 2020 2020 2020  6_mode).        
+0000cb40: 2020 2020 6e6f 726d 616c 5f63 6163 6865      normal_cache
+0000cb50: 203d 2062 6c61 636b 2e72 6561 645f 6361   = black.read_ca
+0000cb60: 6368 6528 7265 675f 6d6f 6465 290a 2020  che(reg_mode).  
+0000cb70: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
+0000cb80: 7468 2069 6e20 7061 7468 733a 0a20 2020  th in paths:.   
+0000cb90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000cba0: 662e 6173 7365 7274 496e 2873 7472 2870  f.assertIn(str(p
+0000cbb0: 6174 6829 2c20 7079 695f 6361 6368 6529  ath), pyi_cache)
+0000cbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cbd0: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
+0000cbe0: 6e28 7374 7228 7061 7468 292c 206e 6f72  n(str(path), nor
+0000cbf0: 6d61 6c5f 6361 6368 6529 0a0a 2020 2020  mal_cache)..    
+0000cc00: 6465 6620 7465 7374 5f70 6970 655f 666f  def test_pipe_fo
+0000cc10: 7263 655f 7079 3336 2873 656c 6629 202d  rce_py36(self) -
+0000cc20: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000cc30: 736f 7572 6365 2c20 6578 7065 6374 6564  source, expected
+0000cc40: 203d 2072 6561 645f 6461 7461 2822 6d69   = read_data("mi
+0000cc50: 7363 656c 6c61 6e65 6f75 7322 2c20 2266  scellaneous", "f
+0000cc60: 6f72 6365 5f70 7933 3622 290a 2020 2020  orce_py36").    
+0000cc70: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
+0000cc80: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
+0000cc90: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
+0000cca0: 636b 2e6d 6169 6e2c 0a20 2020 2020 2020  ck.main,.       
+0000ccb0: 2020 2020 205b 222d 222c 2022 2d71 222c       ["-", "-q",
+0000ccc0: 2022 2d2d 7461 7267 6574 2d76 6572 7369   "--target-versi
+0000ccd0: 6f6e 3d70 7933 3622 5d2c 0a20 2020 2020  on=py36"],.     
+0000cce0: 2020 2020 2020 2069 6e70 7574 3d42 7974         input=Byt
+0000ccf0: 6573 494f 2873 6f75 7263 652e 656e 636f  esIO(source.enco
+0000cd00: 6465 2822 7574 6638 2229 292c 0a20 2020  de("utf8")),.   
+0000cd10: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
+0000cd20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000cd30: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
+0000cd40: 2c20 3029 0a20 2020 2020 2020 2061 6374  , 0).        act
+0000cd50: 7561 6c20 3d20 7265 7375 6c74 2e6f 7574  ual = result.out
+0000cd60: 7075 740a 2020 2020 2020 2020 7365 6c66  put.        self
+0000cd70: 2e61 7373 6572 7446 6f72 6d61 7445 7175  .assertFormatEqu
+0000cd80: 616c 2861 6374 7561 6c2c 2065 7870 6563  al(actual, expec
+0000cd90: 7465 6429 0a0a 2020 2020 4070 7974 6573  ted)..    @pytes
+0000cda0: 742e 6d61 726b 2e69 6e63 6f6d 7061 7469  t.mark.incompati
+0000cdb0: 626c 655f 7769 7468 5f6d 7970 7963 0a20  ble_with_mypyc. 
+0000cdc0: 2020 2064 6566 2074 6573 745f 7265 666f     def test_refo
+0000cdd0: 726d 6174 5f6f 6e65 5f77 6974 685f 7374  rmat_one_with_st
+0000cde0: 6469 6e28 7365 6c66 2920 2d3e 204e 6f6e  din(self) -> Non
+0000cdf0: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
+0000ce00: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
+0000ce10: 2020 2022 626c 6163 6b2e 666f 726d 6174     "black.format
+0000ce20: 5f73 7464 696e 5f74 6f5f 7374 646f 7574  _stdin_to_stdout
+0000ce30: 222c 0a20 2020 2020 2020 2020 2020 2072  ",.            r
+0000ce40: 6574 7572 6e5f 7661 6c75 653d 6c61 6d62  eturn_value=lamb
+0000ce50: 6461 202a 6172 6773 2c20 2a2a 6b77 6172  da *args, **kwar
+0000ce60: 6773 3a20 626c 6163 6b2e 4368 616e 6765  gs: black.Change
+0000ce70: 642e 5945 532c 0a20 2020 2020 2020 2029  d.YES,.        )
+0000ce80: 2061 7320 6673 7473 3a0a 2020 2020 2020   as fsts:.      
+0000ce90: 2020 2020 2020 7265 706f 7274 203d 204d        report = M
+0000cea0: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
+0000ceb0: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
+0000cec0: 7468 2822 2d22 290a 2020 2020 2020 2020  th("-").        
+0000ced0: 2020 2020 626c 6163 6b2e 7265 666f 726d      black.reform
+0000cee0: 6174 5f6f 6e65 280a 2020 2020 2020 2020  at_one(.        
+0000cef0: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
+0000cf00: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+0000cf10: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
+0000cf20: 2020 2020 2020 2020 2077 7269 7465 5f62           write_b
+0000cf30: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
+0000cf40: 6163 6b2e 5945 532c 0a20 2020 2020 2020  ack.YES,.       
+0000cf50: 2020 2020 2020 2020 206d 6f64 653d 4445           mode=DE
+0000cf60: 4641 554c 545f 4d4f 4445 2c0a 2020 2020  FAULT_MODE,.    
+0000cf70: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+0000cf80: 7274 3d72 6570 6f72 742c 0a20 2020 2020  rt=report,.     
+0000cf90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000cfa0: 2020 2020 2066 7374 732e 6173 7365 7274       fsts.assert
+0000cfb0: 5f63 616c 6c65 645f 6f6e 6365 2829 0a20  _called_once(). 
+0000cfc0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+0000cfd0: 742e 646f 6e65 2e61 7373 6572 745f 6361  t.done.assert_ca
+0000cfe0: 6c6c 6564 5f77 6974 6828 7061 7468 2c20  lled_with(path, 
+0000cff0: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
+0000d000: 5329 0a0a 2020 2020 4070 7974 6573 742e  S)..    @pytest.
+0000d010: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
+0000d020: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
+0000d030: 2064 6566 2074 6573 745f 7265 666f 726d   def test_reform
+0000d040: 6174 5f6f 6e65 5f77 6974 685f 7374 6469  at_one_with_stdi
+0000d050: 6e5f 6669 6c65 6e61 6d65 2873 656c 6629  n_filename(self)
+0000d060: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000d070: 2020 7769 7468 2070 6174 6368 280a 2020    with patch(.  
+0000d080: 2020 2020 2020 2020 2020 2262 6c61 636b            "black
+0000d090: 2e66 6f72 6d61 745f 7374 6469 6e5f 746f  .format_stdin_to
+0000d0a0: 5f73 7464 6f75 7422 2c0a 2020 2020 2020  _stdout",.      
+0000d0b0: 2020 2020 2020 7265 7475 726e 5f76 616c        return_val
+0000d0c0: 7565 3d6c 616d 6264 6120 2a61 7267 732c  ue=lambda *args,
+0000d0d0: 202a 2a6b 7761 7267 733a 2062 6c61 636b   **kwargs: black
+0000d0e0: 2e43 6861 6e67 6564 2e59 4553 2c0a 2020  .Changed.YES,.  
+0000d0f0: 2020 2020 2020 2920 6173 2066 7374 733a        ) as fsts:
+0000d100: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+0000d110: 6f72 7420 3d20 4d61 6769 634d 6f63 6b28  ort = MagicMock(
+0000d120: 290a 2020 2020 2020 2020 2020 2020 7020  ).            p 
+0000d130: 3d20 2266 6f6f 2e70 7922 0a20 2020 2020  = "foo.py".     
+0000d140: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
+0000d150: 7468 2866 225f 5f42 4c41 434b 5f53 5444  th(f"__BLACK_STD
+0000d160: 494e 5f46 494c 454e 414d 455f 5f7b 707d  IN_FILENAME__{p}
+0000d170: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
+0000d180: 7870 6563 7465 6420 3d20 5061 7468 2870  xpected = Path(p
+0000d190: 290a 2020 2020 2020 2020 2020 2020 626c  ).            bl
+0000d1a0: 6163 6b2e 7265 666f 726d 6174 5f6f 6e65  ack.reformat_one
+0000d1b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d1c0: 2020 7061 7468 2c0a 2020 2020 2020 2020    path,.        
+0000d1d0: 2020 2020 2020 2020 6661 7374 3d54 7275          fast=Tru
+0000d1e0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000d1f0: 2020 2077 7269 7465 5f62 6163 6b3d 626c     write_back=bl
+0000d200: 6163 6b2e 5772 6974 6542 6163 6b2e 5945  ack.WriteBack.YE
+0000d210: 532c 0a20 2020 2020 2020 2020 2020 2020  S,.             
+0000d220: 2020 206d 6f64 653d 4445 4641 554c 545f     mode=DEFAULT_
+0000d230: 4d4f 4445 2c0a 2020 2020 2020 2020 2020  MODE,.          
+0000d240: 2020 2020 2020 7265 706f 7274 3d72 6570        report=rep
+0000d250: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
+0000d260: 2029 0a20 2020 2020 2020 2020 2020 2066   ).            f
+0000d270: 7374 732e 6173 7365 7274 5f63 616c 6c65  sts.assert_calle
+0000d280: 645f 6f6e 6365 5f77 6974 6828 0a20 2020  d_once_with(.   
+0000d290: 2020 2020 2020 2020 2020 2020 2066 6173               fas
+0000d2a0: 743d 5472 7565 2c20 7772 6974 655f 6261  t=True, write_ba
+0000d2b0: 636b 3d62 6c61 636b 2e57 7269 7465 4261  ck=black.WriteBa
+0000d2c0: 636b 2e59 4553 2c20 6d6f 6465 3d44 4546  ck.YES, mode=DEF
+0000d2d0: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
+0000d2e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000d2f0: 2020 2020 2320 5f5f 424c 4143 4b5f 5354      # __BLACK_ST
+0000d300: 4449 4e5f 4649 4c45 4e41 4d45 5f5f 2073  DIN_FILENAME__ s
+0000d310: 686f 756c 6420 6861 7665 2062 6565 6e20  hould have been 
+0000d320: 7374 7269 7070 6564 0a20 2020 2020 2020  stripped.       
+0000d330: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
+0000d340: 2e61 7373 6572 745f 6361 6c6c 6564 5f77  .assert_called_w
+0000d350: 6974 6828 6578 7065 6374 6564 2c20 626c  ith(expected, bl
+0000d360: 6163 6b2e 4368 616e 6765 642e 5945 5329  ack.Changed.YES)
+0000d370: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
+0000d380: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
+0000d390: 7769 7468 5f6d 7970 7963 0a20 2020 2064  with_mypyc.    d
+0000d3a0: 6566 2074 6573 745f 7265 666f 726d 6174  ef test_reformat
+0000d3b0: 5f6f 6e65 5f77 6974 685f 7374 6469 6e5f  _one_with_stdin_
+0000d3c0: 6669 6c65 6e61 6d65 5f70 7969 2873 656c  filename_pyi(sel
+0000d3d0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000d3e0: 2020 2020 7769 7468 2070 6174 6368 280a      with patch(.
+0000d3f0: 2020 2020 2020 2020 2020 2020 2262 6c61              "bla
+0000d400: 636b 2e66 6f72 6d61 745f 7374 6469 6e5f  ck.format_stdin_
+0000d410: 746f 5f73 7464 6f75 7422 2c0a 2020 2020  to_stdout",.    
+0000d420: 2020 2020 2020 2020 7265 7475 726e 5f76          return_v
+0000d430: 616c 7565 3d6c 616d 6264 6120 2a61 7267  alue=lambda *arg
+0000d440: 732c 202a 2a6b 7761 7267 733a 2062 6c61  s, **kwargs: bla
+0000d450: 636b 2e43 6861 6e67 6564 2e59 4553 2c0a  ck.Changed.YES,.
+0000d460: 2020 2020 2020 2020 2920 6173 2066 7374          ) as fst
+0000d470: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+0000d480: 6570 6f72 7420 3d20 4d61 6769 634d 6f63  eport = MagicMoc
+0000d490: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
+0000d4a0: 7020 3d20 2266 6f6f 2e70 7969 220a 2020  p = "foo.pyi".  
+0000d4b0: 2020 2020 2020 2020 2020 7061 7468 203d            path =
+0000d4c0: 2050 6174 6828 6622 5f5f 424c 4143 4b5f   Path(f"__BLACK_
+0000d4d0: 5354 4449 4e5f 4649 4c45 4e41 4d45 5f5f  STDIN_FILENAME__
+0000d4e0: 7b70 7d22 290a 2020 2020 2020 2020 2020  {p}").          
+0000d4f0: 2020 6578 7065 6374 6564 203d 2050 6174    expected = Pat
+0000d500: 6828 7029 0a20 2020 2020 2020 2020 2020  h(p).           
+0000d510: 2062 6c61 636b 2e72 6566 6f72 6d61 745f   black.reformat_
+0000d520: 6f6e 6528 0a20 2020 2020 2020 2020 2020  one(.           
+0000d530: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
+0000d540: 2020 2020 2020 2020 2020 2066 6173 743d             fast=
+0000d550: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0000d560: 2020 2020 2020 7772 6974 655f 6261 636b        write_back
+0000d570: 3d62 6c61 636b 2e57 7269 7465 4261 636b  =black.WriteBack
+0000d580: 2e59 4553 2c0a 2020 2020 2020 2020 2020  .YES,.          
+0000d590: 2020 2020 2020 6d6f 6465 3d44 4546 4155        mode=DEFAU
+0000d5a0: 4c54 5f4d 4f44 452c 0a20 2020 2020 2020  LT_MODE,.       
+0000d5b0: 2020 2020 2020 2020 2072 6570 6f72 743d           report=
+0000d5c0: 7265 706f 7274 2c0a 2020 2020 2020 2020  report,.        
+0000d5d0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000d5e0: 2020 6673 7473 2e61 7373 6572 745f 6361    fsts.assert_ca
+0000d5f0: 6c6c 6564 5f6f 6e63 655f 7769 7468 280a  lled_once_with(.
+0000d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d610: 6661 7374 3d54 7275 652c 0a20 2020 2020  fast=True,.     
+0000d620: 2020 2020 2020 2020 2020 2077 7269 7465             write
+0000d630: 5f62 6163 6b3d 626c 6163 6b2e 5772 6974  _back=black.Writ
+0000d640: 6542 6163 6b2e 5945 532c 0a20 2020 2020  eBack.YES,.     
+0000d650: 2020 2020 2020 2020 2020 206d 6f64 653d             mode=
+0000d660: 7265 706c 6163 6528 4445 4641 554c 545f  replace(DEFAULT_
+0000d670: 4d4f 4445 2c20 6973 5f70 7969 3d54 7275  MODE, is_pyi=Tru
+0000d680: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+0000d690: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0000d6a0: 5f5f 424c 4143 4b5f 5354 4449 4e5f 4649  __BLACK_STDIN_FI
+0000d6b0: 4c45 4e41 4d45 5f5f 2073 686f 756c 6420  LENAME__ should 
+0000d6c0: 6861 7665 2062 6565 6e20 7374 7269 7070  have been stripp
+0000d6d0: 6564 0a20 2020 2020 2020 2020 2020 2072  ed.            r
+0000d6e0: 6570 6f72 742e 646f 6e65 2e61 7373 6572  eport.done.asser
+0000d6f0: 745f 6361 6c6c 6564 5f77 6974 6828 6578  t_called_with(ex
+0000d700: 7065 6374 6564 2c20 626c 6163 6b2e 4368  pected, black.Ch
+0000d710: 616e 6765 642e 5945 5329 0a0a 2020 2020  anged.YES)..    
+0000d720: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
+0000d730: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
+0000d740: 7970 7963 0a20 2020 2064 6566 2074 6573  ypyc.    def tes
+0000d750: 745f 7265 666f 726d 6174 5f6f 6e65 5f77  t_reformat_one_w
+0000d760: 6974 685f 7374 6469 6e5f 6669 6c65 6e61  ith_stdin_filena
+0000d770: 6d65 5f69 7079 6e62 2873 656c 6629 202d  me_ipynb(self) -
+0000d780: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000d790: 7769 7468 2070 6174 6368 280a 2020 2020  with patch(.    
+0000d7a0: 2020 2020 2020 2020 2262 6c61 636b 2e66          "black.f
+0000d7b0: 6f72 6d61 745f 7374 6469 6e5f 746f 5f73  ormat_stdin_to_s
+0000d7c0: 7464 6f75 7422 2c0a 2020 2020 2020 2020  tdout",.        
+0000d7d0: 2020 2020 7265 7475 726e 5f76 616c 7565      return_value
+0000d7e0: 3d6c 616d 6264 6120 2a61 7267 732c 202a  =lambda *args, *
+0000d7f0: 2a6b 7761 7267 733a 2062 6c61 636b 2e43  *kwargs: black.C
+0000d800: 6861 6e67 6564 2e59 4553 2c0a 2020 2020  hanged.YES,.    
+0000d810: 2020 2020 2920 6173 2066 7374 733a 0a20      ) as fsts:. 
+0000d820: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+0000d830: 7420 3d20 4d61 6769 634d 6f63 6b28 290a  t = MagicMock().
+0000d840: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
+0000d850: 2266 6f6f 2e69 7079 6e62 220a 2020 2020  "foo.ipynb".    
+0000d860: 2020 2020 2020 2020 7061 7468 203d 2050          path = P
+0000d870: 6174 6828 6622 5f5f 424c 4143 4b5f 5354  ath(f"__BLACK_ST
+0000d880: 4449 4e5f 4649 4c45 4e41 4d45 5f5f 7b70  DIN_FILENAME__{p
+0000d890: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000d8a0: 6578 7065 6374 6564 203d 2050 6174 6828  expected = Path(
+0000d8b0: 7029 0a20 2020 2020 2020 2020 2020 2062  p).            b
+0000d8c0: 6c61 636b 2e72 6566 6f72 6d61 745f 6f6e  lack.reformat_on
+0000d8d0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0000d8e0: 2020 2070 6174 682c 0a20 2020 2020 2020     path,.       
+0000d8f0: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
+0000d900: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0000d910: 2020 2020 7772 6974 655f 6261 636b 3d62      write_back=b
+0000d920: 6c61 636b 2e57 7269 7465 4261 636b 2e59  lack.WriteBack.Y
+0000d930: 4553 2c0a 2020 2020 2020 2020 2020 2020  ES,.            
+0000d940: 2020 2020 6d6f 6465 3d44 4546 4155 4c54      mode=DEFAULT
+0000d950: 5f4d 4f44 452c 0a20 2020 2020 2020 2020  _MODE,.         
+0000d960: 2020 2020 2020 2072 6570 6f72 743d 7265         report=re
+0000d970: 706f 7274 2c0a 2020 2020 2020 2020 2020  port,.          
+0000d980: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000d990: 6673 7473 2e61 7373 6572 745f 6361 6c6c  fsts.assert_call
+0000d9a0: 6564 5f6f 6e63 655f 7769 7468 280a 2020  ed_once_with(.  
+0000d9b0: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+0000d9c0: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
+0000d9d0: 2020 2020 2020 2020 2077 7269 7465 5f62           write_b
+0000d9e0: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
+0000d9f0: 6163 6b2e 5945 532c 0a20 2020 2020 2020  ack.YES,.       
+0000da00: 2020 2020 2020 2020 206d 6f64 653d 7265           mode=re
+0000da10: 706c 6163 6528 4445 4641 554c 545f 4d4f  place(DEFAULT_MO
+0000da20: 4445 2c20 6973 5f69 7079 6e62 3d54 7275  DE, is_ipynb=Tru
+0000da30: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+0000da40: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0000da50: 5f5f 424c 4143 4b5f 5354 4449 4e5f 4649  __BLACK_STDIN_FI
+0000da60: 4c45 4e41 4d45 5f5f 2073 686f 756c 6420  LENAME__ should 
+0000da70: 6861 7665 2062 6565 6e20 7374 7269 7070  have been stripp
+0000da80: 6564 0a20 2020 2020 2020 2020 2020 2072  ed.            r
+0000da90: 6570 6f72 742e 646f 6e65 2e61 7373 6572  eport.done.asser
+0000daa0: 745f 6361 6c6c 6564 5f77 6974 6828 6578  t_called_with(ex
+0000dab0: 7065 6374 6564 2c20 626c 6163 6b2e 4368  pected, black.Ch
+0000dac0: 616e 6765 642e 5945 5329 0a0a 2020 2020  anged.YES)..    
+0000dad0: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
+0000dae0: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
+0000daf0: 7970 7963 0a20 2020 2064 6566 2074 6573  ypyc.    def tes
+0000db00: 745f 7265 666f 726d 6174 5f6f 6e65 5f77  t_reformat_one_w
+0000db10: 6974 685f 7374 6469 6e5f 616e 645f 6578  ith_stdin_and_ex
+0000db20: 6973 7469 6e67 5f70 6174 6828 7365 6c66  isting_path(self
+0000db30: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000db40: 2020 2077 6974 6820 7061 7463 6828 0a20     with patch(. 
+0000db50: 2020 2020 2020 2020 2020 2022 626c 6163             "blac
+0000db60: 6b2e 666f 726d 6174 5f73 7464 696e 5f74  k.format_stdin_t
+0000db70: 6f5f 7374 646f 7574 222c 0a20 2020 2020  o_stdout",.     
+0000db80: 2020 2020 2020 2072 6574 7572 6e5f 7661         return_va
+0000db90: 6c75 653d 6c61 6d62 6461 202a 6172 6773  lue=lambda *args
+0000dba0: 2c20 2a2a 6b77 6172 6773 3a20 626c 6163  , **kwargs: blac
+0000dbb0: 6b2e 4368 616e 6765 642e 5945 532c 0a20  k.Changed.YES,. 
+0000dbc0: 2020 2020 2020 2029 2061 7320 6673 7473         ) as fsts
+0000dbd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000dbe0: 706f 7274 203d 204d 6167 6963 4d6f 636b  port = MagicMock
+0000dbf0: 2829 0a20 2020 2020 2020 2020 2020 2023  ().            #
+0000dc00: 2045 7665 6e20 7769 7468 2061 6e20 6578   Even with an ex
+0000dc10: 6973 7469 6e67 2066 696c 652c 2073 696e  isting file, sin
+0000dc20: 6365 2077 6520 6172 6520 666f 7263 696e  ce we are forcin
+0000dc30: 6720 7374 6469 6e2c 2062 6c61 636b 0a20  g stdin, black. 
+0000dc40: 2020 2020 2020 2020 2020 2023 2073 686f             # sho
+0000dc50: 756c 6420 6f75 7470 7574 2074 6f20 7374  uld output to st
+0000dc60: 646f 7574 2061 6e64 206e 6f74 206d 6f64  dout and not mod
+0000dc70: 6966 7920 7468 6520 6669 6c65 2069 6e70  ify the file inp
+0000dc80: 6c61 6365 0a20 2020 2020 2020 2020 2020  lace.           
+0000dc90: 2070 203d 2054 4849 535f 4449 5220 2f20   p = THIS_DIR / 
+0000dca0: 2264 6174 6122 202f 2022 7369 6d70 6c65  "data" / "simple
+0000dcb0: 5f63 6173 6573 2220 2f20 2263 6f6c 6c65  _cases" / "colle
+0000dcc0: 6374 696f 6e73 2e70 7922 0a20 2020 2020  ctions.py".     
+0000dcd0: 2020 2020 2020 2023 204d 616b 6520 7375         # Make su
+0000dce0: 7265 2069 735f 6669 6c65 2061 6374 7561  re is_file actua
+0000dcf0: 6c6c 7920 7265 7475 726e 7320 5472 7565  lly returns True
+0000dd00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000dd10: 662e 6173 7365 7274 5472 7565 2870 2e69  f.assertTrue(p.i
+0000dd20: 735f 6669 6c65 2829 290a 2020 2020 2020  s_file()).      
+0000dd30: 2020 2020 2020 7061 7468 203d 2050 6174        path = Pat
+0000dd40: 6828 6622 5f5f 424c 4143 4b5f 5354 4449  h(f"__BLACK_STDI
+0000dd50: 4e5f 4649 4c45 4e41 4d45 5f5f 7b70 7d22  N_FILENAME__{p}"
+0000dd60: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+0000dd70: 7065 6374 6564 203d 2050 6174 6828 7029  pected = Path(p)
+0000dd80: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
+0000dd90: 636b 2e72 6566 6f72 6d61 745f 6f6e 6528  ck.reformat_one(
+0000dda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ddb0: 2070 6174 682c 0a20 2020 2020 2020 2020   path,.         
+0000ddc0: 2020 2020 2020 2066 6173 743d 5472 7565         fast=True
+0000ddd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000dde0: 2020 7772 6974 655f 6261 636b 3d62 6c61    write_back=bla
+0000ddf0: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
+0000de00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000de10: 2020 6d6f 6465 3d44 4546 4155 4c54 5f4d    mode=DEFAULT_M
+0000de20: 4f44 452c 0a20 2020 2020 2020 2020 2020  ODE,.           
+0000de30: 2020 2020 2072 6570 6f72 743d 7265 706f       report=repo
+0000de40: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
+0000de50: 290a 2020 2020 2020 2020 2020 2020 6673  ).            fs
+0000de60: 7473 2e61 7373 6572 745f 6361 6c6c 6564  ts.assert_called
+0000de70: 5f6f 6e63 6528 290a 2020 2020 2020 2020  _once().        
+0000de80: 2020 2020 2320 5f5f 424c 4143 4b5f 5354      # __BLACK_ST
+0000de90: 4449 4e5f 4649 4c45 4e41 4d45 5f5f 2073  DIN_FILENAME__ s
+0000dea0: 686f 756c 6420 6861 7665 2062 6565 6e20  hould have been 
+0000deb0: 7374 7269 7070 6564 0a20 2020 2020 2020  stripped.       
+0000dec0: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
+0000ded0: 2e61 7373 6572 745f 6361 6c6c 6564 5f77  .assert_called_w
+0000dee0: 6974 6828 6578 7065 6374 6564 2c20 626c  ith(expected, bl
+0000def0: 6163 6b2e 4368 616e 6765 642e 5945 5329  ack.Changed.YES)
+0000df00: 0a0a 2020 2020 6465 6620 7465 7374 5f72  ..    def test_r
+0000df10: 6566 6f72 6d61 745f 6f6e 655f 7769 7468  eformat_one_with
+0000df20: 5f73 7464 696e 5f65 6d70 7479 2873 656c  _stdin_empty(sel
+0000df30: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000df40: 2020 2020 6361 7365 7320 3d20 5b0a 2020      cases = [.  
+0000df50: 2020 2020 2020 2020 2020 2822 222c 2022            ("", "
+0000df60: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+0000df70: 2822 5c6e 222c 2022 5c6e 2229 2c0a 2020  ("\n", "\n"),.  
+0000df80: 2020 2020 2020 2020 2020 2822 5c72 5c6e            ("\r\n
+0000df90: 222c 2022 5c72 5c6e 2229 2c0a 2020 2020  ", "\r\n"),.    
+0000dfa0: 2020 2020 2020 2020 2822 205c 7422 2c20          (" \t", 
+0000dfb0: 2222 292c 0a20 2020 2020 2020 2020 2020  ""),.           
+0000dfc0: 2028 2220 5c74 5c6e 5c74 2022 2c20 225c   (" \t\n\t ", "\
+0000dfd0: 6e22 292c 0a20 2020 2020 2020 2020 2020  n"),.           
+0000dfe0: 2028 2220 5c74 5c72 5c6e 5c74 2022 2c20   (" \t\r\n\t ", 
+0000dff0: 225c 725c 6e22 292c 0a20 2020 2020 2020  "\r\n"),.       
+0000e000: 205d 0a0a 2020 2020 2020 2020 6465 6620   ]..        def 
+0000e010: 5f6e 6577 5f77 7261 7070 6572 280a 2020  _new_wrapper(.  
+0000e020: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+0000e030: 3a20 696f 2e53 7472 696e 6749 4f2c 2069  : io.StringIO, i
+0000e040: 6f5f 5465 7874 494f 5772 6170 7065 723a  o_TextIOWrapper:
+0000e050: 2054 7970 655b 696f 2e54 6578 7449 4f57   Type[io.TextIOW
+0000e060: 7261 7070 6572 5d0a 2020 2020 2020 2020  rapper].        
+0000e070: 2920 2d3e 2043 616c 6c61 626c 655b 5b41  ) -> Callable[[A
+0000e080: 6e79 2c20 416e 795d 2c20 696f 2e54 6578  ny, Any], io.Tex
+0000e090: 7449 4f57 7261 7070 6572 5d3a 0a20 2020  tIOWrapper]:.   
+0000e0a0: 2020 2020 2020 2020 2064 6566 2067 6574           def get
+0000e0b0: 5f6f 7574 7075 7428 2a61 7267 733a 2041  _output(*args: A
+0000e0c0: 6e79 2c20 2a2a 6b77 6172 6773 3a20 416e  ny, **kwargs: An
+0000e0d0: 7929 202d 3e20 696f 2e54 6578 7449 4f57  y) -> io.TextIOW
+0000e0e0: 7261 7070 6572 3a0a 2020 2020 2020 2020  rapper:.        
+0000e0f0: 2020 2020 2020 2020 6966 2061 7267 7320          if args 
+0000e100: 3d3d 2028 7379 732e 7374 646f 7574 2e62  == (sys.stdout.b
+0000e110: 7566 6665 722c 293a 0a20 2020 2020 2020  uffer,):.       
+0000e120: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+0000e130: 7427 7320 6066 6f72 6d61 745f 7374 6469  t's `format_stdi
+0000e140: 6e5f 746f 5f73 7464 6f75 7428 2960 2063  n_to_stdout()` c
+0000e150: 616c 6c69 6e67 2060 696f 2e54 6578 7449  alling `io.TextI
+0000e160: 4f57 7261 7070 6572 2829 602c 0a20 2020  OWrapper()`,.   
+0000e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e180: 2023 2072 6574 7572 6e20 6f75 7220 6d6f   # return our mo
+0000e190: 636b 206f 626a 6563 742e 0a20 2020 2020  ck object..     
+0000e1a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000e1b0: 6574 7572 6e20 6f75 7470 7574 0a20 2020  eturn output.   
+0000e1c0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+0000e1d0: 7427 7320 736f 6d65 7468 696e 6720 656c  t's something el
+0000e1e0: 7365 2028 692e 652e 2060 6465 636f 6465  se (i.e. `decode
+0000e1f0: 5f62 7974 6573 2829 6029 2063 616c 6c69  _bytes()`) calli
+0000e200: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
+0000e210: 2020 2023 2060 696f 2e54 6578 7449 4f57     # `io.TextIOW
+0000e220: 7261 7070 6572 2829 602c 2070 6173 7320  rapper()`, pass 
+0000e230: 7468 726f 7567 6820 746f 2074 6865 206f  through to the o
+0000e240: 7269 6769 6e61 6c20 696d 706c 656d 656e  riginal implemen
+0000e250: 7461 7469 6f6e 2e0a 2020 2020 2020 2020  tation..        
+0000e260: 2020 2020 2020 2020 2320 5365 6520 6469          # See di
+0000e270: 7363 7573 7369 6f6e 2069 6e20 6874 7470  scussion in http
+0000e280: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f70  s://github.com/p
+0000e290: 7366 2f62 6c61 636b 2f70 756c 6c2f 3234  sf/black/pull/24
+0000e2a0: 3839 0a20 2020 2020 2020 2020 2020 2020  89.             
+0000e2b0: 2020 2072 6574 7572 6e20 696f 5f54 6578     return io_Tex
+0000e2c0: 7449 4f57 7261 7070 6572 282a 6172 6773  tIOWrapper(*args
+0000e2d0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+0000e2e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000e2f0: 6765 745f 6f75 7470 7574 0a0a 2020 2020  get_output..    
+0000e300: 2020 2020 6d6f 6465 203d 2062 6c61 636b      mode = black
+0000e310: 2e4d 6f64 6528 7072 6576 6965 773d 5472  .Mode(preview=Tr
+0000e320: 7565 290a 2020 2020 2020 2020 666f 7220  ue).        for 
+0000e330: 636f 6e74 656e 742c 2065 7870 6563 7465  content, expecte
+0000e340: 6420 696e 2063 6173 6573 3a0a 2020 2020  d in cases:.    
+0000e350: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
+0000e360: 2069 6f2e 5374 7269 6e67 494f 2829 0a20   io.StringIO(). 
+0000e370: 2020 2020 2020 2020 2020 2069 6f5f 5465             io_Te
+0000e380: 7874 494f 5772 6170 7065 7220 3d20 696f  xtIOWrapper = io
+0000e390: 2e54 6578 7449 4f57 7261 7070 6572 0a0a  .TextIOWrapper..
+0000e3a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0000e3b0: 2070 6174 6368 2822 696f 2e54 6578 7449   patch("io.TextI
+0000e3c0: 4f57 7261 7070 6572 222c 205f 6e65 775f  OWrapper", _new_
+0000e3d0: 7772 6170 7065 7228 6f75 7470 7574 2c20  wrapper(output, 
+0000e3e0: 696f 5f54 6578 7449 4f57 7261 7070 6572  io_TextIOWrapper
+0000e3f0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0000e400: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000e410: 2020 2020 2020 2020 2020 2020 2062 6c61               bla
+0000e420: 636b 2e66 6f72 6d61 745f 7374 6469 6e5f  ck.format_stdin_
+0000e430: 746f 5f73 7464 6f75 7428 0a20 2020 2020  to_stdout(.     
+0000e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e450: 2020 2066 6173 743d 5472 7565 2c0a 2020     fast=True,.  
+0000e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e470: 2020 2020 2020 636f 6e74 656e 743d 636f        content=co
+0000e480: 6e74 656e 742c 0a20 2020 2020 2020 2020  ntent,.         
+0000e490: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000e4a0: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
+0000e4b0: 5772 6974 6542 6163 6b2e 5945 532c 0a20  WriteBack.YES,. 
+0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4d0: 2020 2020 2020 206d 6f64 653d 6d6f 6465         mode=mode
+0000e4e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e4f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000e500: 2020 2020 2020 2020 6578 6365 7074 2069          except i
+0000e510: 6f2e 556e 7375 7070 6f72 7465 644f 7065  o.UnsupportedOpe
+0000e520: 7261 7469 6f6e 3a0a 2020 2020 2020 2020  ration:.        
+0000e530: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+0000e540: 2020 2320 5374 7269 6e67 494f 2064 6f65    # StringIO doe
+0000e550: 7320 6e6f 7420 7375 7070 6f72 7420 6465  s not support de
+0000e560: 7461 6368 0a20 2020 2020 2020 2020 2020  tach.           
+0000e570: 2020 2020 2061 7373 6572 7420 6f75 7470       assert outp
+0000e580: 7574 2e67 6574 7661 6c75 6528 2920 3d3d  ut.getvalue() ==
+0000e590: 2065 7870 6563 7465 640a 0a20 2020 2020   expected..     
+0000e5a0: 2020 2023 2041 6e20 656d 7074 7920 7374     # An empty st
+0000e5b0: 7269 6e67 2069 7320 7468 6520 6f6e 6c79  ring is the only
+0000e5c0: 2074 6573 7420 6361 7365 2066 6f72 2060   test case for `
+0000e5d0: 7072 6576 6965 773d 4661 6c73 6560 0a20  preview=False`. 
+0000e5e0: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
+0000e5f0: 696f 2e53 7472 696e 6749 4f28 290a 2020  io.StringIO().  
+0000e600: 2020 2020 2020 696f 5f54 6578 7449 4f57        io_TextIOW
+0000e610: 7261 7070 6572 203d 2069 6f2e 5465 7874  rapper = io.Text
+0000e620: 494f 5772 6170 7065 720a 2020 2020 2020  IOWrapper.      
+0000e630: 2020 7769 7468 2070 6174 6368 2822 696f    with patch("io
+0000e640: 2e54 6578 7449 4f57 7261 7070 6572 222c  .TextIOWrapper",
+0000e650: 205f 6e65 775f 7772 6170 7065 7228 6f75   _new_wrapper(ou
+0000e660: 7470 7574 2c20 696f 5f54 6578 7449 4f57  tput, io_TextIOW
+0000e670: 7261 7070 6572 2929 3a0a 2020 2020 2020  rapper)):.      
+0000e680: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000e690: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0000e6a0: 2e66 6f72 6d61 745f 7374 6469 6e5f 746f  .format_stdin_to
+0000e6b0: 5f73 7464 6f75 7428 0a20 2020 2020 2020  _stdout(.       
+0000e6c0: 2020 2020 2020 2020 2020 2020 2066 6173               fas
+0000e6d0: 743d 5472 7565 2c0a 2020 2020 2020 2020  t=True,.        
+0000e6e0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0000e6f0: 656e 743d 2222 2c0a 2020 2020 2020 2020  ent="",.        
+0000e700: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+0000e710: 655f 6261 636b 3d62 6c61 636b 2e57 7269  e_back=black.Wri
+0000e720: 7465 4261 636b 2e59 4553 2c0a 2020 2020  teBack.YES,.    
+0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e740: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
+0000e750: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
+0000e760: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000e770: 2065 7863 6570 7420 696f 2e55 6e73 7570   except io.Unsup
+0000e780: 706f 7274 6564 4f70 6572 6174 696f 6e3a  portedOperation:
+0000e790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e7a0: 2070 6173 7320 2023 2053 7472 696e 6749   pass  # StringI
+0000e7b0: 4f20 646f 6573 206e 6f74 2073 7570 706f  O does not suppo
+0000e7c0: 7274 2064 6574 6163 680a 2020 2020 2020  rt detach.      
+0000e7d0: 2020 2020 2020 6173 7365 7274 206f 7574        assert out
+0000e7e0: 7075 742e 6765 7476 616c 7565 2829 203d  put.getvalue() =
+0000e7f0: 3d20 2222 0a0a 2020 2020 6465 6620 7465  = ""..    def te
+0000e800: 7374 5f69 6e76 616c 6964 5f63 6c69 5f72  st_invalid_cli_r
+0000e810: 6567 6578 2873 656c 6629 202d 3e20 4e6f  egex(self) -> No
+0000e820: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
+0000e830: 6f70 7469 6f6e 2069 6e20 5b22 2d2d 696e  option in ["--in
+0000e840: 636c 7564 6522 2c20 222d 2d65 7863 6c75  clude", "--exclu
+0000e850: 6465 222c 2022 2d2d 6578 7465 6e64 2d65  de", "--extend-e
+0000e860: 7863 6c75 6465 222c 2022 2d2d 666f 7263  xclude", "--forc
+0000e870: 652d 6578 636c 7564 6522 5d3a 0a20 2020  e-exclude"]:.   
+0000e880: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
+0000e890: 766f 6b65 426c 6163 6b28 5b22 2d22 2c20  vokeBlack(["-", 
+0000e8a0: 6f70 7469 6f6e 2c20 222a 2a28 2928 2121  option, "**()(!!
+0000e8b0: 2a29 225d 2c20 6578 6974 5f63 6f64 653d  *)"], exit_code=
+0000e8c0: 3229 0a0a 2020 2020 6465 6620 7465 7374  2)..    def test
+0000e8d0: 5f72 6571 7569 7265 645f 7665 7273 696f  _required_versio
+0000e8e0: 6e5f 6d61 7463 6865 735f 7665 7273 696f  n_matches_versio
+0000e8f0: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
+0000e900: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+0000e910: 766f 6b65 426c 6163 6b28 0a20 2020 2020  vokeBlack(.     
+0000e920: 2020 2020 2020 205b 222d 2d72 6571 7569         ["--requi
+0000e930: 7265 642d 7665 7273 696f 6e22 2c20 626c  red-version", bl
+0000e940: 6163 6b2e 5f5f 7665 7273 696f 6e5f 5f2c  ack.__version__,
+0000e950: 2022 2d63 222c 2022 3022 5d2c 0a20 2020   "-c", "0"],.   
+0000e960: 2020 2020 2020 2020 2065 7869 745f 636f           exit_co
+0000e970: 6465 3d30 2c0a 2020 2020 2020 2020 2020  de=0,.          
+0000e980: 2020 6967 6e6f 7265 5f63 6f6e 6669 673d    ignore_config=
+0000e990: 5472 7565 2c0a 2020 2020 2020 2020 290a  True,.        ).
+0000e9a0: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
+0000e9b0: 7175 6972 6564 5f76 6572 7369 6f6e 5f6d  quired_version_m
+0000e9c0: 6174 6368 6573 5f70 6172 7469 616c 5f76  atches_partial_v
+0000e9d0: 6572 7369 6f6e 2873 656c 6629 202d 3e20  ersion(self) -> 
+0000e9e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7365  None:.        se
+0000e9f0: 6c66 2e69 6e76 6f6b 6542 6c61 636b 280a  lf.invokeBlack(.
+0000ea00: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
+0000ea10: 7265 7175 6972 6564 2d76 6572 7369 6f6e  required-version
+0000ea20: 222c 2062 6c61 636b 2e5f 5f76 6572 7369  ", black.__versi
+0000ea30: 6f6e 5f5f 2e73 706c 6974 2822 2e22 295b  on__.split(".")[
+0000ea40: 305d 2c20 222d 6322 2c20 2230 225d 2c0a  0], "-c", "0"],.
+0000ea50: 2020 2020 2020 2020 2020 2020 6578 6974              exit
+0000ea60: 5f63 6f64 653d 302c 0a20 2020 2020 2020  _code=0,.       
+0000ea70: 2020 2020 2069 676e 6f72 655f 636f 6e66       ignore_conf
+0000ea80: 6967 3d54 7275 652c 0a20 2020 2020 2020  ig=True,.       
+0000ea90: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
+0000eaa0: 5f72 6571 7569 7265 645f 7665 7273 696f  _required_versio
+0000eab0: 6e5f 646f 6573 5f6e 6f74 5f6d 6174 6368  n_does_not_match
+0000eac0: 5f6f 6e5f 6d69 6e6f 725f 7665 7273 696f  _on_minor_versio
+0000ead0: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
+0000eae0: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+0000eaf0: 766f 6b65 426c 6163 6b28 0a20 2020 2020  vokeBlack(.     
+0000eb00: 2020 2020 2020 205b 222d 2d72 6571 7569         ["--requi
+0000eb10: 7265 642d 7665 7273 696f 6e22 2c20 626c  red-version", bl
+0000eb20: 6163 6b2e 5f5f 7665 7273 696f 6e5f 5f2e  ack.__version__.
+0000eb30: 7370 6c69 7428 222e 2229 5b30 5d20 2b20  split(".")[0] + 
+0000eb40: 222e 3939 3922 2c20 222d 6322 2c20 2230  ".999", "-c", "0
+0000eb50: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0000eb60: 6578 6974 5f63 6f64 653d 312c 0a20 2020  exit_code=1,.   
+0000eb70: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
+0000eb80: 636f 6e66 6967 3d54 7275 652c 0a20 2020  config=True,.   
+0000eb90: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+0000eba0: 7465 7374 5f72 6571 7569 7265 645f 7665  test_required_ve
+0000ebb0: 7273 696f 6e5f 646f 6573 5f6e 6f74 5f6d  rsion_does_not_m
+0000ebc0: 6174 6368 5f76 6572 7369 6f6e 2873 656c  atch_version(sel
+0000ebd0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0000ebe0: 2020 2020 7265 7375 6c74 203d 2042 6c61      result = Bla
+0000ebf0: 636b 5275 6e6e 6572 2829 2e69 6e76 6f6b  ckRunner().invok
+0000ec00: 6528 0a20 2020 2020 2020 2020 2020 2062  e(.            b
+0000ec10: 6c61 636b 2e6d 6169 6e2c 0a20 2020 2020  lack.main,.     
+0000ec20: 2020 2020 2020 205b 222d 2d72 6571 7569         ["--requi
+0000ec30: 7265 642d 7665 7273 696f 6e22 2c20 2232  red-version", "2
+0000ec40: 302e 3939 6222 2c20 222d 6322 2c20 2230  0.99b", "-c", "0
+0000ec50: 225d 2c0a 2020 2020 2020 2020 290a 2020  "],.        ).  
+0000ec60: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000ec70: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
+0000ec80: 6974 5f63 6f64 652c 2031 290a 2020 2020  it_code, 1).    
+0000ec90: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+0000eca0: 6e28 2272 6571 7569 7265 6420 7665 7273  n("required vers
+0000ecb0: 696f 6e22 2c20 7265 7375 6c74 2e73 7464  ion", result.std
+0000ecc0: 6572 7229 0a0a 2020 2020 6465 6620 7465  err)..    def te
+0000ecd0: 7374 5f70 7265 7365 7276 6573 5f6c 696e  st_preserves_lin
+0000ece0: 655f 656e 6469 6e67 7328 7365 6c66 2920  e_endings(self) 
+0000ecf0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000ed00: 2077 6974 6820 5465 6d70 6f72 6172 7944   with TemporaryD
+0000ed10: 6972 6563 746f 7279 2829 2061 7320 776f  irectory() as wo
+0000ed20: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
+0000ed30: 2020 2020 2074 6573 745f 6669 6c65 203d       test_file =
+0000ed40: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
+0000ed50: 202f 2022 7465 7374 2e70 7922 0a20 2020   / "test.py".   
+0000ed60: 2020 2020 2020 2020 2066 6f72 206e 6c20           for nl 
+0000ed70: 696e 205b 225c 6e22 2c20 225c 725c 6e22  in ["\n", "\r\n"
+0000ed80: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0000ed90: 2020 2063 6f6e 7465 6e74 7320 3d20 6e6c     contents = nl
+0000eda0: 2e6a 6f69 6e28 5b22 6465 6620 6628 2020  .join(["def f(  
+0000edb0: 293a 222c 2022 2020 2020 7061 7373 225d  ):", "    pass"]
+0000edc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000edd0: 2020 7465 7374 5f66 696c 652e 7772 6974    test_file.writ
+0000ede0: 655f 6279 7465 7328 636f 6e74 656e 7473  e_bytes(contents
+0000edf0: 2e65 6e63 6f64 6528 2929 0a20 2020 2020  .encode()).     
+0000ee00: 2020 2020 2020 2020 2020 2066 6628 7465             ff(te
+0000ee10: 7374 5f66 696c 652c 2077 7269 7465 5f62  st_file, write_b
+0000ee20: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
+0000ee30: 6163 6b2e 5945 5329 0a20 2020 2020 2020  ack.YES).       
+0000ee40: 2020 2020 2020 2020 2075 7064 6174 6564           updated
+0000ee50: 5f63 6f6e 7465 6e74 733a 2062 7974 6573  _contents: bytes
+0000ee60: 203d 2074 6573 745f 6669 6c65 2e72 6561   = test_file.rea
+0000ee70: 645f 6279 7465 7328 290a 2020 2020 2020  d_bytes().      
+0000ee80: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000ee90: 7373 6572 7449 6e28 6e6c 2e65 6e63 6f64  ssertIn(nl.encod
+0000eea0: 6528 292c 2075 7064 6174 6564 5f63 6f6e  e(), updated_con
+0000eeb0: 7465 6e74 7329 0a20 2020 2020 2020 2020  tents).         
+0000eec0: 2020 2020 2020 2069 6620 6e6c 203d 3d20         if nl == 
+0000eed0: 225c 6e22 3a0a 2020 2020 2020 2020 2020  "\n":.          
+0000eee0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000eef0: 7373 6572 744e 6f74 496e 2862 225c 725c  ssertNotIn(b"\r\
+0000ef00: 6e22 2c20 7570 6461 7465 645f 636f 6e74  n", updated_cont
+0000ef10: 656e 7473 290a 0a20 2020 2064 6566 2074  ents)..    def t
+0000ef20: 6573 745f 7072 6573 6572 7665 735f 6c69  est_preserves_li
+0000ef30: 6e65 5f65 6e64 696e 6773 5f76 6961 5f73  ne_endings_via_s
+0000ef40: 7464 696e 2873 656c 6629 202d 3e20 4e6f  tdin(self) -> No
+0000ef50: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
+0000ef60: 6e6c 2069 6e20 5b22 5c6e 222c 2022 5c72  nl in ["\n", "\r
+0000ef70: 5c6e 225d 3a0a 2020 2020 2020 2020 2020  \n"]:.          
+0000ef80: 2020 636f 6e74 656e 7473 203d 206e 6c2e    contents = nl.
+0000ef90: 6a6f 696e 285b 2264 6566 2066 2820 2029  join(["def f(  )
+0000efa0: 3a22 2c20 2220 2020 2070 6173 7322 5d29  :", "    pass"])
+0000efb0: 0a20 2020 2020 2020 2020 2020 2072 756e  .            run
+0000efc0: 6e65 7220 3d20 426c 6163 6b52 756e 6e65  ner = BlackRunne
+0000efd0: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+0000efe0: 7265 7375 6c74 203d 2072 756e 6e65 722e  result = runner.
+0000eff0: 696e 766f 6b65 280a 2020 2020 2020 2020  invoke(.        
+0000f000: 2020 2020 2020 2020 626c 6163 6b2e 6d61          black.ma
+0000f010: 696e 2c20 5b22 2d22 2c20 222d 2d66 6173  in, ["-", "--fas
+0000f020: 7422 5d2c 2069 6e70 7574 3d42 7974 6573  t"], input=Bytes
+0000f030: 494f 2863 6f6e 7465 6e74 732e 656e 636f  IO(contents.enco
+0000f040: 6465 2822 7574 6638 2229 290a 2020 2020  de("utf8")).    
+0000f050: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000f060: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000f070: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
+0000f080: 6974 5f63 6f64 652c 2030 290a 2020 2020  it_code, 0).    
+0000f090: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
+0000f0a0: 2072 6573 756c 742e 7374 646f 7574 5f62   result.stdout_b
+0000f0b0: 7974 6573 0a20 2020 2020 2020 2020 2020  ytes.           
+0000f0c0: 2073 656c 662e 6173 7365 7274 496e 286e   self.assertIn(n
+0000f0d0: 6c2e 656e 636f 6465 2822 7574 6638 2229  l.encode("utf8")
+0000f0e0: 2c20 6f75 7470 7574 290a 2020 2020 2020  , output).      
+0000f0f0: 2020 2020 2020 6966 206e 6c20 3d3d 2022        if nl == "
+0000f100: 5c6e 223a 0a20 2020 2020 2020 2020 2020  \n":.           
+0000f110: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000f120: 4e6f 7449 6e28 6222 5c72 5c6e 222c 206f  NotIn(b"\r\n", o
+0000f130: 7574 7075 7429 0a0a 2020 2020 6465 6620  utput)..    def 
+0000f140: 7465 7374 5f6e 6f72 6d61 6c69 7a65 5f6c  test_normalize_l
+0000f150: 696e 655f 656e 6469 6e67 7328 7365 6c66  ine_endings(self
+0000f160: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000f170: 2020 2077 6974 6820 5465 6d70 6f72 6172     with Temporar
+0000f180: 7944 6972 6563 746f 7279 2829 2061 7320  yDirectory() as 
+0000f190: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
+0000f1a0: 2020 2020 2020 2074 6573 745f 6669 6c65         test_file
+0000f1b0: 203d 2050 6174 6828 776f 726b 7370 6163   = Path(workspac
+0000f1c0: 6529 202f 2022 7465 7374 2e70 7922 0a20  e) / "test.py". 
+0000f1d0: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
+0000f1e0: 6174 612c 2065 7870 6563 7465 6420 696e  ata, expected in
+0000f1f0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000f200: 2020 2028 6222 635c 725c 6e63 5c6e 2022     (b"c\r\nc\n "
+0000f210: 2c20 6222 635c 725c 6e63 5c72 5c6e 2229  , b"c\r\nc\r\n")
+0000f220: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f230: 2020 2862 226c 5c6e 6c5c 725c 6e20 222c    (b"l\nl\r\n ",
+0000f240: 2062 226c 5c6e 6c5c 6e22 292c 0a20 2020   b"l\nl\n"),.   
+0000f250: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+0000f260: 2020 2020 2020 2020 2020 2020 7465 7374              test
+0000f270: 5f66 696c 652e 7772 6974 655f 6279 7465  _file.write_byte
+0000f280: 7328 6461 7461 290a 2020 2020 2020 2020  s(data).        
+0000f290: 2020 2020 2020 2020 6666 2874 6573 745f          ff(test_
+0000f2a0: 6669 6c65 2c20 7772 6974 655f 6261 636b  file, write_back
+0000f2b0: 3d62 6c61 636b 2e57 7269 7465 4261 636b  =black.WriteBack
+0000f2c0: 2e59 4553 290a 2020 2020 2020 2020 2020  .YES).          
+0000f2d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000f2e0: 7445 7175 616c 2874 6573 745f 6669 6c65  tEqual(test_file
+0000f2f0: 2e72 6561 645f 6279 7465 7328 292c 2065  .read_bytes(), e
+0000f300: 7870 6563 7465 6429 0a0a 2020 2020 6465  xpected)..    de
+0000f310: 6620 7465 7374 5f61 7373 6572 745f 6571  f test_assert_eq
+0000f320: 7569 7661 6c65 6e74 5f64 6966 6665 7265  uivalent_differe
+0000f330: 6e74 5f61 7374 7328 7365 6c66 2920 2d3e  nt_asts(self) ->
+0000f340: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
+0000f350: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+0000f360: 6169 7365 7328 4173 7365 7274 696f 6e45  aises(AssertionE
+0000f370: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+0000f380: 2020 2062 6c61 636b 2e61 7373 6572 745f     black.assert_
+0000f390: 6571 7569 7661 6c65 6e74 2822 7b7d 222c  equivalent("{}",
+0000f3a0: 2022 4e6f 6e65 2229 0a0a 2020 2020 6465   "None")..    de
+0000f3b0: 6620 7465 7374 5f73 6868 685f 636c 6963  f test_shhh_clic
+0000f3c0: 6b28 7365 6c66 2920 2d3e 204e 6f6e 653a  k(self) -> None:
+0000f3d0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0000f3e0: 2020 2020 2020 2020 2020 6672 6f6d 2063            from c
+0000f3f0: 6c69 636b 2069 6d70 6f72 7420 5f75 6e69  lick import _uni
+0000f400: 636f 6465 6675 6e20 2023 2074 7970 653a  codefun  # type:
+0000f410: 2069 676e 6f72 650a 2020 2020 2020 2020   ignore.        
+0000f420: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
+0000f430: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0000f440: 7365 6c66 2e73 6b69 7054 6573 7428 2249  self.skipTest("I
+0000f450: 6e63 6f6d 7061 7469 626c 6520 436c 6963  ncompatible Clic
+0000f460: 6b20 7665 7273 696f 6e22 290a 0a20 2020  k version")..   
+0000f470: 2020 2020 2069 6620 6e6f 7420 6861 7361       if not hasa
+0000f480: 7474 7228 5f75 6e69 636f 6465 6675 6e2c  ttr(_unicodefun,
+0000f490: 2022 5f76 6572 6966 795f 7079 7468 6f6e   "_verify_python
+0000f4a0: 5f65 6e76 2229 3a0a 2020 2020 2020 2020  _env"):.        
+0000f4b0: 2020 2020 7365 6c66 2e73 6b69 7054 6573      self.skipTes
+0000f4c0: 7428 2249 6e63 6f6d 7061 7469 626c 6520  t("Incompatible 
+0000f4d0: 436c 6963 6b20 7665 7273 696f 6e22 290a  Click version").
+0000f4e0: 0a20 2020 2020 2020 2023 2046 6972 7374  .        # First
+0000f4f0: 2c20 6c65 7427 7320 7365 6520 6966 2043  , let's see if C
+0000f500: 6c69 636b 2069 7320 6372 6173 6869 6e67  lick is crashing
+0000f510: 2077 6974 6820 6120 7072 6566 6572 7265   with a preferre
+0000f520: 6420 4153 4349 4920 6368 6172 7365 742e  d ASCII charset.
+0000f530: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
+0000f540: 7463 6828 226c 6f63 616c 652e 6765 7470  tch("locale.getp
+0000f550: 7265 6665 7272 6564 656e 636f 6469 6e67  referredencoding
+0000f560: 2229 2061 7320 6770 653a 0a20 2020 2020  ") as gpe:.     
+0000f570: 2020 2020 2020 2067 7065 2e72 6574 7572         gpe.retur
+0000f580: 6e5f 7661 6c75 6520 3d20 2241 5343 4949  n_value = "ASCII
+0000f590: 220a 2020 2020 2020 2020 2020 2020 7769  ".            wi
+0000f5a0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+0000f5b0: 6973 6573 2852 756e 7469 6d65 4572 726f  ises(RuntimeErro
+0000f5c0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0000f5d0: 2020 2020 5f75 6e69 636f 6465 6675 6e2e      _unicodefun.
+0000f5e0: 5f76 6572 6966 795f 7079 7468 6f6e 5f65  _verify_python_e
+0000f5f0: 6e76 2829 0a20 2020 2020 2020 2023 204e  nv().        # N
+0000f600: 6f77 2c20 6c65 7427 7320 7369 6c65 6e63  ow, let's silenc
+0000f610: 6520 436c 6963 6b2e 2e2e 0a20 2020 2020  e Click....     
+0000f620: 2020 2062 6c61 636b 2e70 6174 6368 5f63     black.patch_c
+0000f630: 6c69 636b 2829 0a20 2020 2020 2020 2023  lick().        #
+0000f640: 202e 2e2e 616e 6420 636f 6e66 6972 6d20   ...and confirm 
+0000f650: 6974 2773 2073 696c 656e 742e 0a20 2020  it's silent..   
+0000f660: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
+0000f670: 226c 6f63 616c 652e 6765 7470 7265 6665  "locale.getprefe
+0000f680: 7272 6564 656e 636f 6469 6e67 2229 2061  rredencoding") a
+0000f690: 7320 6770 653a 0a20 2020 2020 2020 2020  s gpe:.         
+0000f6a0: 2020 2067 7065 2e72 6574 7572 6e5f 7661     gpe.return_va
+0000f6b0: 6c75 6520 3d20 2241 5343 4949 220a 2020  lue = "ASCII".  
+0000f6c0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0000f6d0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0000f6e0: 756e 6963 6f64 6566 756e 2e5f 7665 7269  unicodefun._veri
+0000f6f0: 6679 5f70 7974 686f 6e5f 656e 7628 290a  fy_python_env().
+0000f700: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000f710: 7074 2052 756e 7469 6d65 4572 726f 7220  pt RuntimeError 
+0000f720: 6173 2072 653a 0a20 2020 2020 2020 2020  as re:.         
+0000f730: 2020 2020 2020 2073 656c 662e 6661 696c         self.fail
+0000f740: 2866 2260 7061 7463 685f 636c 6963 6b28  (f"`patch_click(
+0000f750: 2960 2066 6169 6c65 642c 2065 7863 6570  )` failed, excep
+0000f760: 7469 6f6e 2073 7469 6c6c 2072 6169 7365  tion still raise
+0000f770: 643a 207b 7265 7d22 290a 0a20 2020 2064  d: {re}")..    d
+0000f780: 6566 2074 6573 745f 726f 6f74 5f6c 6f67  ef test_root_log
+0000f790: 6765 725f 6e6f 745f 7573 6564 5f64 6972  ger_not_used_dir
+0000f7a0: 6563 746c 7928 7365 6c66 2920 2d3e 204e  ectly(self) -> N
+0000f7b0: 6f6e 653a 0a20 2020 2020 2020 2064 6566  one:.        def
+0000f7c0: 2066 6169 6c28 2a61 7267 733a 2041 6e79   fail(*args: Any
+0000f7d0: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
+0000f7e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000f7f0: 2020 2020 2020 7365 6c66 2e66 6169 6c28        self.fail(
+0000f800: 2252 6563 6f72 6420 6372 6561 7465 6420  "Record created 
+0000f810: 7769 7468 2072 6f6f 7420 6c6f 6767 6572  with root logger
+0000f820: 2229 0a0a 2020 2020 2020 2020 7769 7468  ")..        with
+0000f830: 2070 6174 6368 2e6d 756c 7469 706c 6528   patch.multiple(
+0000f840: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+0000f850: 6769 6e67 2e72 6f6f 742c 0a20 2020 2020  ging.root,.     
+0000f860: 2020 2020 2020 2064 6562 7567 3d66 6169         debug=fai
+0000f870: 6c2c 0a20 2020 2020 2020 2020 2020 2069  l,.            i
+0000f880: 6e66 6f3d 6661 696c 2c0a 2020 2020 2020  nfo=fail,.      
+0000f890: 2020 2020 2020 7761 726e 696e 673d 6661        warning=fa
+0000f8a0: 696c 2c0a 2020 2020 2020 2020 2020 2020  il,.            
+0000f8b0: 6572 726f 723d 6661 696c 2c0a 2020 2020  error=fail,.    
+0000f8c0: 2020 2020 2020 2020 6372 6974 6963 616c          critical
+0000f8d0: 3d66 6169 6c2c 0a20 2020 2020 2020 2020  =fail,.         
+0000f8e0: 2020 206c 6f67 3d66 6169 6c2c 0a20 2020     log=fail,.   
+0000f8f0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+0000f900: 2020 2020 6666 2854 4849 535f 4449 5220      ff(THIS_DIR 
+0000f910: 2f20 2275 7469 6c2e 7079 2229 0a0a 2020  / "util.py")..  
+0000f920: 2020 6465 6620 7465 7374 5f69 6e76 616c    def test_inval
+0000f930: 6964 5f63 6f6e 6669 675f 7265 7475 726e  id_config_return
+0000f940: 5f63 6f64 6528 7365 6c66 2920 2d3e 204e  _code(self) -> N
+0000f950: 6f6e 653a 0a20 2020 2020 2020 2074 6d70  one:.        tmp
+0000f960: 5f66 696c 6520 3d20 5061 7468 2862 6c61  _file = Path(bla
+0000f970: 636b 2e64 756d 705f 746f 5f66 696c 6528  ck.dump_to_file(
+0000f980: 2929 0a20 2020 2020 2020 2074 7279 3a0a  )).        try:.
+0000f990: 2020 2020 2020 2020 2020 2020 746d 705f              tmp_
+0000f9a0: 636f 6e66 6967 203d 2050 6174 6828 626c  config = Path(bl
+0000f9b0: 6163 6b2e 6475 6d70 5f74 6f5f 6669 6c65  ack.dump_to_file
+0000f9c0: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+0000f9d0: 746d 705f 636f 6e66 6967 2e75 6e6c 696e  tmp_config.unlin
+0000f9e0: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
+0000f9f0: 6172 6773 203d 205b 222d 2d63 6f6e 6669  args = ["--confi
+0000fa00: 6722 2c20 7374 7228 746d 705f 636f 6e66  g", str(tmp_conf
+0000fa10: 6967 292c 2073 7472 2874 6d70 5f66 696c  ig), str(tmp_fil
+0000fa20: 6529 5d0a 2020 2020 2020 2020 2020 2020  e)].            
+0000fa30: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
+0000fa40: 2861 7267 732c 2065 7869 745f 636f 6465  (args, exit_code
+0000fa50: 3d32 2c20 6967 6e6f 7265 5f63 6f6e 6669  =2, ignore_confi
+0000fa60: 673d 4661 6c73 6529 0a20 2020 2020 2020  g=False).       
+0000fa70: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
+0000fa80: 2020 2020 2020 746d 705f 6669 6c65 2e75        tmp_file.u
+0000fa90: 6e6c 696e 6b28 290a 0a20 2020 2064 6566  nlink()..    def
+0000faa0: 2074 6573 745f 7061 7273 655f 7079 7072   test_parse_pypr
+0000fab0: 6f6a 6563 745f 746f 6d6c 2873 656c 6629  oject_toml(self)
+0000fac0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000fad0: 2020 7465 7374 5f74 6f6d 6c5f 6669 6c65    test_toml_file
+0000fae0: 203d 2054 4849 535f 4449 5220 2f20 2274   = THIS_DIR / "t
+0000faf0: 6573 742e 746f 6d6c 220a 2020 2020 2020  est.toml".      
+0000fb00: 2020 636f 6e66 6967 203d 2062 6c61 636b    config = black
+0000fb10: 2e70 6172 7365 5f70 7970 726f 6a65 6374  .parse_pyproject
+0000fb20: 5f74 6f6d 6c28 7374 7228 7465 7374 5f74  _toml(str(test_t
+0000fb30: 6f6d 6c5f 6669 6c65 2929 0a20 2020 2020  oml_file)).     
+0000fb40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000fb50: 7561 6c28 636f 6e66 6967 5b22 7665 7262  ual(config["verb
+0000fb60: 6f73 6522 5d2c 2031 290a 2020 2020 2020  ose"], 1).      
+0000fb70: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000fb80: 616c 2863 6f6e 6669 675b 2263 6865 636b  al(config["check
+0000fb90: 225d 2c20 226e 6f22 290a 2020 2020 2020  "], "no").      
+0000fba0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000fbb0: 616c 2863 6f6e 6669 675b 2264 6966 6622  al(config["diff"
+0000fbc0: 5d2c 2022 7922 290a 2020 2020 2020 2020  ], "y").        
+0000fbd0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000fbe0: 2863 6f6e 6669 675b 2263 6f6c 6f72 225d  (config["color"]
+0000fbf0: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
+0000fc00: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000fc10: 2863 6f6e 6669 675b 226c 696e 655f 6c65  (config["line_le
+0000fc20: 6e67 7468 225d 2c20 3739 290a 2020 2020  ngth"], 79).    
+0000fc30: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000fc40: 7175 616c 2863 6f6e 6669 675b 2274 6172  qual(config["tar
+0000fc50: 6765 745f 7665 7273 696f 6e22 5d2c 205b  get_version"], [
+0000fc60: 2270 7933 3622 2c20 2270 7933 3722 2c20  "py36", "py37", 
+0000fc70: 2270 7933 3822 5d29 0a20 2020 2020 2020  "py38"]).       
+0000fc80: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000fc90: 6c28 636f 6e66 6967 5b22 7079 7468 6f6e  l(config["python
+0000fca0: 5f63 656c 6c5f 6d61 6769 6373 225d 2c20  _cell_magics"], 
+0000fcb0: 5b22 6375 7374 6f6d 3122 2c20 2263 7573  ["custom1", "cus
+0000fcc0: 746f 6d32 225d 290a 2020 2020 2020 2020  tom2"]).        
+0000fcd0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000fce0: 2863 6f6e 6669 675b 2265 7863 6c75 6465  (config["exclude
+0000fcf0: 225d 2c20 7222 5c2e 7079 693f 2422 290a  "], r"\.pyi?$").
+0000fd00: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000fd10: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+0000fd20: 2269 6e63 6c75 6465 225d 2c20 7222 5c2e  "include"], r"\.
+0000fd30: 7079 3f24 2229 0a0a 2020 2020 6465 6620  py?$")..    def 
+0000fd40: 7465 7374 5f70 6172 7365 5f70 7970 726f  test_parse_pypro
+0000fd50: 6a65 6374 5f74 6f6d 6c5f 7072 6f6a 6563  ject_toml_projec
+0000fd60: 745f 6d65 7461 6461 7461 2873 656c 6629  t_metadata(self)
+0000fd70: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000fd80: 2020 666f 7220 7465 7374 5f74 6f6d 6c2c    for test_toml,
+0000fd90: 2065 7870 6563 7465 6420 696e 205b 0a20   expected in [. 
+0000fda0: 2020 2020 2020 2020 2020 2028 226f 6e6c             ("onl
+0000fdb0: 795f 626c 6163 6b5f 7079 7072 6f6a 6563  y_black_pyprojec
+0000fdc0: 742e 746f 6d6c 222c 205b 2270 7933 3130  t.toml", ["py310
+0000fdd0: 225d 292c 0a20 2020 2020 2020 2020 2020  "]),.           
+0000fde0: 2028 226f 6e6c 795f 6d65 7461 6461 7461   ("only_metadata
+0000fdf0: 5f70 7970 726f 6a65 6374 2e74 6f6d 6c22  _pyproject.toml"
+0000fe00: 2c20 5b22 7079 3337 222c 2022 7079 3338  , ["py37", "py38
+0000fe10: 222c 2022 7079 3339 222c 2022 7079 3331  ", "py39", "py31
+0000fe20: 3022 5d29 2c0a 2020 2020 2020 2020 2020  0"]),.          
+0000fe30: 2020 2822 6e65 6974 6865 725f 7079 7072    ("neither_pypr
+0000fe40: 6f6a 6563 742e 746f 6d6c 222c 204e 6f6e  oject.toml", Non
+0000fe50: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+0000fe60: 2822 626f 7468 5f70 7970 726f 6a65 6374  ("both_pyproject
+0000fe70: 2e74 6f6d 6c22 2c20 5b22 7079 3331 3022  .toml", ["py310"
+0000fe80: 5d29 2c0a 2020 2020 2020 2020 5d3a 0a20  ]),.        ]:. 
+0000fe90: 2020 2020 2020 2020 2020 2074 6573 745f             test_
+0000fea0: 746f 6d6c 5f66 696c 6520 3d20 5448 4953  toml_file = THIS
+0000feb0: 5f44 4952 202f 2022 6461 7461 2220 2f20  _DIR / "data" / 
+0000fec0: 2270 726f 6a65 6374 5f6d 6574 6164 6174  "project_metadat
+0000fed0: 6122 202f 2074 6573 745f 746f 6d6c 0a20  a" / test_toml. 
+0000fee0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+0000fef0: 6720 3d20 626c 6163 6b2e 7061 7273 655f  g = black.parse_
+0000ff00: 7079 7072 6f6a 6563 745f 746f 6d6c 2873  pyproject_toml(s
+0000ff10: 7472 2874 6573 745f 746f 6d6c 5f66 696c  tr(test_toml_fil
+0000ff20: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+0000ff30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000ff40: 2863 6f6e 6669 672e 6765 7428 2274 6172  (config.get("tar
+0000ff50: 6765 745f 7665 7273 696f 6e22 292c 2065  get_version"), e
+0000ff60: 7870 6563 7465 6429 0a0a 2020 2020 6465  xpected)..    de
+0000ff70: 6620 7465 7374 5f69 6e66 6572 5f74 6172  f test_infer_tar
+0000ff80: 6765 745f 7665 7273 696f 6e28 7365 6c66  get_version(self
+0000ff90: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000ffa0: 2020 2066 6f72 2076 6572 7369 6f6e 2c20     for version, 
+0000ffb0: 6578 7065 6374 6564 2069 6e20 5b0a 2020  expected in [.  
+0000ffc0: 2020 2020 2020 2020 2020 2822 332e 3622            ("3.6"
+0000ffd0: 2c20 5b54 6172 6765 7456 6572 7369 6f6e  , [TargetVersion
+0000ffe0: 2e50 5933 365d 292c 0a20 2020 2020 2020  .PY36]),.       
+0000fff0: 2020 2020 2028 2233 2e31 312e 3072 6331       ("3.11.0rc1
+00010000: 222c 205b 5461 7267 6574 5665 7273 696f  ", [TargetVersio
+00010010: 6e2e 5059 3331 315d 292c 0a20 2020 2020  n.PY311]),.     
+00010020: 2020 2020 2020 2028 223e 3d33 2e31 3022         (">=3.10"
+00010030: 2c20 5b54 6172 6765 7456 6572 7369 6f6e  , [TargetVersion
+00010040: 2e50 5933 3130 2c20 5461 7267 6574 5665  .PY310, TargetVe
+00010050: 7273 696f 6e2e 5059 3331 315d 292c 0a20  rsion.PY311]),. 
+00010060: 2020 2020 2020 2020 2020 2028 223e 3d33             (">=3
+00010070: 2e31 302e 3622 2c20 5b54 6172 6765 7456  .10.6", [TargetV
+00010080: 6572 7369 6f6e 2e50 5933 3130 2c20 5461  ersion.PY310, Ta
+00010090: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
+000100a0: 315d 292c 0a20 2020 2020 2020 2020 2020  1]),.           
+000100b0: 2028 223c 332e 3622 2c20 5b54 6172 6765   ("<3.6", [Targe
+000100c0: 7456 6572 7369 6f6e 2e50 5933 332c 2054  tVersion.PY33, T
+000100d0: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+000100e0: 342c 2054 6172 6765 7456 6572 7369 6f6e  4, TargetVersion
+000100f0: 2e50 5933 355d 292c 0a20 2020 2020 2020  .PY35]),.       
+00010100: 2020 2020 2028 223e 332e 372c 3c33 2e31       (">3.7,<3.1
+00010110: 3022 2c20 5b54 6172 6765 7456 6572 7369  0", [TargetVersi
+00010120: 6f6e 2e50 5933 382c 2054 6172 6765 7456  on.PY38, TargetV
+00010130: 6572 7369 6f6e 2e50 5933 395d 292c 0a20  ersion.PY39]),. 
+00010140: 2020 2020 2020 2020 2020 2028 223e 332e             (">3.
+00010150: 372c 213d 332e 382c 213d 332e 3922 2c20  7,!=3.8,!=3.9", 
+00010160: 5b54 6172 6765 7456 6572 7369 6f6e 2e50  [TargetVersion.P
+00010170: 5933 3130 2c20 5461 7267 6574 5665 7273  Y310, TargetVers
+00010180: 696f 6e2e 5059 3331 315d 292c 0a20 2020  ion.PY311]),.   
+00010190: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
+000101a0: 2020 2020 2020 2020 2020 2022 3e20 332e             "> 3.
+000101b0: 392e 342c 2021 3d20 332e 3130 2e33 222c  9.4, != 3.10.3",
+000101c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000101d0: 205b 5461 7267 6574 5665 7273 696f 6e2e   [TargetVersion.
+000101e0: 5059 3339 2c20 5461 7267 6574 5665 7273  PY39, TargetVers
+000101f0: 696f 6e2e 5059 3331 302c 2054 6172 6765  ion.PY310, Targe
+00010200: 7456 6572 7369 6f6e 2e50 5933 3131 5d2c  tVersion.PY311],
+00010210: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00010220: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
+00010230: 2020 2020 2020 2020 2020 2020 2020 2221                "!
+00010240: 3d33 2e33 2c21 3d33 2e34 222c 0a20 2020  =3.3,!=3.4",.   
+00010250: 2020 2020 2020 2020 2020 2020 205b 0a20               [. 
+00010260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010270: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+00010280: 2e50 5933 352c 0a20 2020 2020 2020 2020  .PY35,.         
+00010290: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
+000102a0: 7456 6572 7369 6f6e 2e50 5933 362c 0a20  tVersion.PY36,. 
+000102b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102c0: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+000102d0: 2e50 5933 372c 0a20 2020 2020 2020 2020  .PY37,.         
+000102e0: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
+000102f0: 7456 6572 7369 6f6e 2e50 5933 382c 0a20  tVersion.PY38,. 
+00010300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010310: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+00010320: 2e50 5933 392c 0a20 2020 2020 2020 2020  .PY39,.         
+00010330: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
+00010340: 7456 6572 7369 6f6e 2e50 5933 3130 2c0a  tVersion.PY310,.
+00010350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010360: 2020 2020 5461 7267 6574 5665 7273 696f      TargetVersio
+00010370: 6e2e 5059 3331 312c 0a20 2020 2020 2020  n.PY311,.       
+00010380: 2020 2020 2020 2020 205d 2c0a 2020 2020           ],.    
+00010390: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+000103a0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+000103b0: 2020 2020 2020 2020 2022 3d3d 332e 2a22           "==3.*"
+000103c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000103d0: 2020 5b0a 2020 2020 2020 2020 2020 2020    [.            
+000103e0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+000103f0: 7273 696f 6e2e 5059 3333 2c0a 2020 2020  rsion.PY33,.    
+00010400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010410: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+00010420: 3334 2c0a 2020 2020 2020 2020 2020 2020  34,.            
+00010430: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+00010440: 7273 696f 6e2e 5059 3335 2c0a 2020 2020  rsion.PY35,.    
+00010450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010460: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+00010470: 3336 2c0a 2020 2020 2020 2020 2020 2020  36,.            
+00010480: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+00010490: 7273 696f 6e2e 5059 3337 2c0a 2020 2020  rsion.PY37,.    
+000104a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104b0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+000104c0: 3338 2c0a 2020 2020 2020 2020 2020 2020  38,.            
+000104d0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+000104e0: 7273 696f 6e2e 5059 3339 2c0a 2020 2020  rsion.PY39,.    
+000104f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010500: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+00010510: 3331 302c 0a20 2020 2020 2020 2020 2020  310,.           
+00010520: 2020 2020 2020 2020 2054 6172 6765 7456           TargetV
+00010530: 6572 7369 6f6e 2e50 5933 3131 2c0a 2020  ersion.PY311,.  
+00010540: 2020 2020 2020 2020 2020 2020 2020 5d2c                ],
+00010550: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00010560: 2020 2020 2020 2020 2020 2020 2822 3d3d              ("==
+00010570: 332e 382e 2a22 2c20 5b54 6172 6765 7456  3.8.*", [TargetV
+00010580: 6572 7369 6f6e 2e50 5933 385d 292c 0a20  ersion.PY38]),. 
+00010590: 2020 2020 2020 2020 2020 2028 4e6f 6e65             (None
+000105a0: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
+000105b0: 2020 2020 2028 2222 2c20 4e6f 6e65 292c       ("", None),
+000105c0: 0a20 2020 2020 2020 2020 2020 2028 2269  .            ("i
+000105d0: 6e76 616c 6964 222c 204e 6f6e 6529 2c0a  nvalid", None),.
+000105e0: 2020 2020 2020 2020 2020 2020 2822 3d3d              ("==
+000105f0: 696e 7661 6c69 6422 2c20 4e6f 6e65 292c  invalid", None),
+00010600: 0a20 2020 2020 2020 2020 2020 2028 223e  .            (">
+00010610: 332e 392c 213d 696e 7661 6c69 6422 2c20  3.9,!=invalid", 
+00010620: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
+00010630: 2020 2028 2233 222c 204e 6f6e 6529 2c0a     ("3", None),.
+00010640: 2020 2020 2020 2020 2020 2020 2822 332e              ("3.
+00010650: 3222 2c20 4e6f 6e65 292c 0a20 2020 2020  2", None),.     
+00010660: 2020 2020 2020 2028 2232 2e37 2e31 3822         ("2.7.18"
+00010670: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
+00010680: 2020 2020 2028 223d 3d32 2e37 222c 204e       ("==2.7", N
+00010690: 6f6e 6529 2c0a 2020 2020 2020 2020 2020  one),.          
+000106a0: 2020 2822 3e33 2e31 302c 3c33 2e31 3122    (">3.10,<3.11"
+000106b0: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
+000106c0: 205d 3a0a 2020 2020 2020 2020 2020 2020   ]:.            
+000106d0: 7465 7374 5f74 6f6d 6c20 3d20 7b22 7072  test_toml = {"pr
+000106e0: 6f6a 6563 7422 3a20 7b22 7265 7175 6972  oject": {"requir
+000106f0: 6573 2d70 7974 686f 6e22 3a20 7665 7273  es-python": vers
+00010700: 696f 6e7d 7d0a 2020 2020 2020 2020 2020  ion}}.          
+00010710: 2020 7265 7375 6c74 203d 2062 6c61 636b    result = black
+00010720: 2e66 696c 6573 2e69 6e66 6572 5f74 6172  .files.infer_tar
+00010730: 6765 745f 7665 7273 696f 6e28 7465 7374  get_version(test
+00010740: 5f74 6f6d 6c29 0a20 2020 2020 2020 2020  _toml).         
+00010750: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00010760: 7561 6c28 7265 7375 6c74 2c20 6578 7065  ual(result, expe
+00010770: 6374 6564 290a 0a20 2020 2064 6566 2074  cted)..    def t
+00010780: 6573 745f 7265 6164 5f70 7970 726f 6a65  est_read_pyproje
+00010790: 6374 5f74 6f6d 6c28 7365 6c66 2920 2d3e  ct_toml(self) ->
+000107a0: 204e 6f6e 653a 0a20 2020 2020 2020 2074   None:.        t
+000107b0: 6573 745f 746f 6d6c 5f66 696c 6520 3d20  est_toml_file = 
+000107c0: 5448 4953 5f44 4952 202f 2022 7465 7374  THIS_DIR / "test
+000107d0: 2e74 6f6d 6c22 0a20 2020 2020 2020 2066  .toml".        f
+000107e0: 616b 655f 6374 7820 3d20 4661 6b65 436f  ake_ctx = FakeCo
+000107f0: 6e74 6578 7428 290a 2020 2020 2020 2020  ntext().        
+00010800: 626c 6163 6b2e 7265 6164 5f70 7970 726f  black.read_pypro
+00010810: 6a65 6374 5f74 6f6d 6c28 6661 6b65 5f63  ject_toml(fake_c
+00010820: 7478 2c20 4661 6b65 5061 7261 6d65 7465  tx, FakeParamete
+00010830: 7228 292c 2073 7472 2874 6573 745f 746f  r(), str(test_to
+00010840: 6d6c 5f66 696c 6529 290a 2020 2020 2020  ml_file)).      
+00010850: 2020 636f 6e66 6967 203d 2066 616b 655f    config = fake_
+00010860: 6374 782e 6465 6661 756c 745f 6d61 700a  ctx.default_map.
+00010870: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00010880: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+00010890: 2276 6572 626f 7365 225d 2c20 2231 2229  "verbose"], "1")
+000108a0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000108b0: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
+000108c0: 5b22 6368 6563 6b22 5d2c 2022 6e6f 2229  ["check"], "no")
+000108d0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000108e0: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
+000108f0: 5b22 6469 6666 225d 2c20 2279 2229 0a20  ["diff"], "y"). 
+00010900: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00010910: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
+00010920: 636f 6c6f 7222 5d2c 2022 5472 7565 2229  color"], "True")
+00010930: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00010940: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
+00010950: 5b22 6c69 6e65 5f6c 656e 6774 6822 5d2c  ["line_length"],
+00010960: 2022 3739 2229 0a20 2020 2020 2020 2073   "79").        s
+00010970: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00010980: 636f 6e66 6967 5b22 7461 7267 6574 5f76  config["target_v
+00010990: 6572 7369 6f6e 225d 2c20 5b22 7079 3336  ersion"], ["py36
+000109a0: 222c 2022 7079 3337 222c 2022 7079 3338  ", "py37", "py38
+000109b0: 225d 290a 2020 2020 2020 2020 7365 6c66  "]).        self
+000109c0: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
+000109d0: 6669 675b 2265 7863 6c75 6465 225d 2c20  fig["exclude"], 
+000109e0: 7222 5c2e 7079 693f 2422 290a 2020 2020  r"\.pyi?$").    
+000109f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00010a00: 7175 616c 2863 6f6e 6669 675b 2269 6e63  qual(config["inc
+00010a10: 6c75 6465 225d 2c20 7222 5c2e 7079 3f24  lude"], r"\.py?$
+00010a20: 2229 0a0a 2020 2020 4070 7974 6573 742e  ")..    @pytest.
+00010a30: 6d61 726b 2e69 6e63 6f6d 7061 7469 626c  mark.incompatibl
+00010a40: 655f 7769 7468 5f6d 7970 7963 0a20 2020  e_with_mypyc.   
+00010a50: 2064 6566 2074 6573 745f 6669 6e64 5f70   def test_find_p
+00010a60: 726f 6a65 6374 5f72 6f6f 7428 7365 6c66  roject_root(self
+00010a70: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00010a80: 2020 2077 6974 6820 5465 6d70 6f72 6172     with Temporar
+00010a90: 7944 6972 6563 746f 7279 2829 2061 7320  yDirectory() as 
+00010aa0: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
+00010ab0: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
+00010ac0: 7468 2877 6f72 6b73 7061 6365 290a 2020  th(workspace).  
+00010ad0: 2020 2020 2020 2020 2020 7465 7374 5f64            test_d
+00010ae0: 6972 203d 2072 6f6f 7420 2f20 2274 6573  ir = root / "tes
+00010af0: 7422 0a20 2020 2020 2020 2020 2020 2074  t".            t
+00010b00: 6573 745f 6469 722e 6d6b 6469 7228 290a  est_dir.mkdir().
+00010b10: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+00010b20: 5f64 6972 203d 2072 6f6f 7420 2f20 2273  _dir = root / "s
+00010b30: 7263 220a 2020 2020 2020 2020 2020 2020  rc".            
+00010b40: 7372 635f 6469 722e 6d6b 6469 7228 290a  src_dir.mkdir().
+00010b50: 0a20 2020 2020 2020 2020 2020 2072 6f6f  .            roo
+00010b60: 745f 7079 7072 6f6a 6563 7420 3d20 726f  t_pyproject = ro
+00010b70: 6f74 202f 2022 7079 7072 6f6a 6563 742e  ot / "pyproject.
+00010b80: 746f 6d6c 220a 2020 2020 2020 2020 2020  toml".          
+00010b90: 2020 726f 6f74 5f70 7970 726f 6a65 6374    root_pyproject
+00010ba0: 2e74 6f75 6368 2829 0a20 2020 2020 2020  .touch().       
+00010bb0: 2020 2020 2073 7263 5f70 7970 726f 6a65       src_pyproje
+00010bc0: 6374 203d 2073 7263 5f64 6972 202f 2022  ct = src_dir / "
+00010bd0: 7079 7072 6f6a 6563 742e 746f 6d6c 220a  pyproject.toml".
+00010be0: 2020 2020 2020 2020 2020 2020 7372 635f              src_
+00010bf0: 7079 7072 6f6a 6563 742e 746f 7563 6828  pyproject.touch(
+00010c00: 290a 2020 2020 2020 2020 2020 2020 7372  ).            sr
+00010c10: 635f 7079 7468 6f6e 203d 2073 7263 5f64  c_python = src_d
+00010c20: 6972 202f 2022 666f 6f2e 7079 220a 2020  ir / "foo.py".  
+00010c30: 2020 2020 2020 2020 2020 7372 635f 7079            src_py
+00010c40: 7468 6f6e 2e74 6f75 6368 2829 0a0a 2020  thon.touch()..  
+00010c50: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00010c60: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00010c70: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+00010c80: 6b2e 6669 6e64 5f70 726f 6a65 6374 5f72  k.find_project_r
+00010c90: 6f6f 7428 2873 7263 5f64 6972 2c20 7465  oot((src_dir, te
+00010ca0: 7374 5f64 6972 2929 2c0a 2020 2020 2020  st_dir)),.      
+00010cb0: 2020 2020 2020 2020 2020 2872 6f6f 742e            (root.
+00010cc0: 7265 736f 6c76 6528 292c 2022 7079 7072  resolve(), "pypr
+00010cd0: 6f6a 6563 742e 746f 6d6c 2229 2c0a 2020  oject.toml"),.  
+00010ce0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00010cf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00010d00: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00010d10: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+00010d20: 6669 6e64 5f70 726f 6a65 6374 5f72 6f6f  find_project_roo
+00010d30: 7428 2873 7263 5f64 6972 2c29 292c 0a20  t((src_dir,)),. 
+00010d40: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00010d50: 7372 635f 6469 722e 7265 736f 6c76 6528  src_dir.resolve(
+00010d60: 292c 2022 7079 7072 6f6a 6563 742e 746f  ), "pyproject.to
+00010d70: 6d6c 2229 2c0a 2020 2020 2020 2020 2020  ml"),.          
+00010d80: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00010d90: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00010da0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010db0: 2020 626c 6163 6b2e 6669 6e64 5f70 726f    black.find_pro
+00010dc0: 6a65 6374 5f72 6f6f 7428 2873 7263 5f70  ject_root((src_p
+00010dd0: 7974 686f 6e2c 2929 2c0a 2020 2020 2020  ython,)),.      
+00010de0: 2020 2020 2020 2020 2020 2873 7263 5f64            (src_d
+00010df0: 6972 2e72 6573 6f6c 7665 2829 2c20 2270  ir.resolve(), "p
+00010e00: 7970 726f 6a65 6374 2e74 6f6d 6c22 292c  yproject.toml"),
+00010e10: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00010e20: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00010e30: 2063 6861 6e67 655f 6469 7265 6374 6f72   change_director
+00010e40: 7928 7465 7374 5f64 6972 293a 0a20 2020  y(test_dir):.   
+00010e50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00010e60: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00010e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e80: 2020 2062 6c61 636b 2e66 696e 645f 7072     black.find_pr
+00010e90: 6f6a 6563 745f 726f 6f74 2828 222d 222c  oject_root(("-",
+00010ea0: 292c 2073 7464 696e 5f66 696c 656e 616d  ), stdin_filenam
+00010eb0: 653d 222e 2e2f 7372 632f 612e 7079 2229  e="../src/a.py")
+00010ec0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010ed0: 2020 2020 2020 2873 7263 5f64 6972 2e72        (src_dir.r
+00010ee0: 6573 6f6c 7665 2829 2c20 2270 7970 726f  esolve(), "pypro
+00010ef0: 6a65 6374 2e74 6f6d 6c22 292c 0a20 2020  ject.toml"),.   
+00010f00: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00010f10: 2020 2020 4070 6174 6368 280a 2020 2020      @patch(.    
+00010f20: 2020 2020 2262 6c61 636b 2e66 696c 6573      "black.files
+00010f30: 2e66 696e 645f 7573 6572 5f70 7970 726f  .find_user_pypro
+00010f40: 6a65 6374 5f74 6f6d 6c22 2c0a 2020 2020  ject_toml",.    
+00010f50: 290a 2020 2020 6465 6620 7465 7374 5f66  ).    def test_f
+00010f60: 696e 645f 7079 7072 6f6a 6563 745f 746f  ind_pyproject_to
+00010f70: 6d6c 2873 656c 662c 2066 696e 645f 7573  ml(self, find_us
+00010f80: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
+00010f90: 6c3a 204d 6167 6963 4d6f 636b 2920 2d3e  l: MagicMock) ->
+00010fa0: 204e 6f6e 653a 0a20 2020 2020 2020 2066   None:.        f
+00010fb0: 696e 645f 7573 6572 5f70 7970 726f 6a65  ind_user_pyproje
+00010fc0: 6374 5f74 6f6d 6c2e 7369 6465 5f65 6666  ct_toml.side_eff
+00010fd0: 6563 7420 3d20 5275 6e74 696d 6545 7272  ect = RuntimeErr
+00010fe0: 6f72 2829 0a0a 2020 2020 2020 2020 7769  or()..        wi
+00010ff0: 7468 2072 6564 6972 6563 745f 7374 6465  th redirect_stde
+00011000: 7272 2869 6f2e 5374 7269 6e67 494f 2829  rr(io.StringIO()
+00011010: 2920 6173 2073 7464 6572 723a 0a20 2020  ) as stderr:.   
+00011020: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00011030: 3d20 626c 6163 6b2e 6669 6c65 732e 6669  = black.files.fi
+00011040: 6e64 5f70 7970 726f 6a65 6374 5f74 6f6d  nd_pyproject_tom
+00011050: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00011060: 2020 2070 6174 685f 7365 6172 6368 5f73     path_search_s
+00011070: 7461 7274 3d28 7374 7228 5061 7468 2e63  tart=(str(Path.c
+00011080: 7764 2829 2e72 6f6f 7429 2c29 0a20 2020  wd().root),).   
+00011090: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000110a0: 2020 2020 6173 7365 7274 2072 6573 756c      assert resul
+000110b0: 7420 6973 204e 6f6e 650a 2020 2020 2020  t is None.      
+000110c0: 2020 6572 7220 3d20 7374 6465 7272 2e67    err = stderr.g
+000110d0: 6574 7661 6c75 6528 290a 2020 2020 2020  etvalue().      
+000110e0: 2020 6173 7365 7274 2022 4967 6e6f 7269    assert "Ignori
+000110f0: 6e67 2075 7365 7220 636f 6e66 6967 7572  ng user configur
+00011100: 6174 696f 6e22 2069 6e20 6572 720a 0a20  ation" in err.. 
+00011110: 2020 2040 7061 7463 6828 0a20 2020 2020     @patch(.     
+00011120: 2020 2022 626c 6163 6b2e 6669 6c65 732e     "black.files.
+00011130: 6669 6e64 5f75 7365 725f 7079 7072 6f6a  find_user_pyproj
+00011140: 6563 745f 746f 6d6c 222c 0a20 2020 2020  ect_toml",.     
+00011150: 2020 2062 6c61 636b 2e66 696c 6573 2e66     black.files.f
+00011160: 696e 645f 7573 6572 5f70 7970 726f 6a65  ind_user_pyproje
+00011170: 6374 5f74 6f6d 6c2e 5f5f 7772 6170 7065  ct_toml.__wrappe
+00011180: 645f 5f2c 0a20 2020 2029 0a20 2020 2064  d__,.    ).    d
+00011190: 6566 2074 6573 745f 6669 6e64 5f75 7365  ef test_find_use
+000111a0: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
+000111b0: 5f6c 696e 7578 2873 656c 6629 202d 3e20  _linux(self) -> 
+000111c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
+000111d0: 2073 7973 7465 6d28 2920 3d3d 2022 5769   system() == "Wi
+000111e0: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
+000111f0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00011200: 2020 2020 2320 5465 7374 2069 6620 5844      # Test if XD
+00011210: 475f 434f 4e46 4947 5f48 4f4d 4520 6973  G_CONFIG_HOME is
+00011220: 2063 6865 636b 6564 0a20 2020 2020 2020   checked.       
+00011230: 2077 6974 6820 5465 6d70 6f72 6172 7944   with TemporaryD
+00011240: 6972 6563 746f 7279 2829 2061 7320 776f  irectory() as wo
+00011250: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
+00011260: 2020 2020 2074 6d70 5f75 7365 725f 636f       tmp_user_co
+00011270: 6e66 6967 203d 2050 6174 6828 776f 726b  nfig = Path(work
+00011280: 7370 6163 6529 202f 2022 626c 6163 6b22  space) / "black"
+00011290: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+000112a0: 6820 7061 7463 682e 6469 6374 2822 6f73  h patch.dict("os
+000112b0: 2e65 6e76 6972 6f6e 222c 207b 2258 4447  .environ", {"XDG
+000112c0: 5f43 4f4e 4649 475f 484f 4d45 223a 2077  _CONFIG_HOME": w
+000112d0: 6f72 6b73 7061 6365 7d29 3a0a 2020 2020  orkspace}):.    
+000112e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000112f0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+00011300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011310: 2020 626c 6163 6b2e 6669 6c65 732e 6669    black.files.fi
+00011320: 6e64 5f75 7365 725f 7079 7072 6f6a 6563  nd_user_pyprojec
+00011330: 745f 746f 6d6c 2829 2c20 746d 705f 7573  t_toml(), tmp_us
+00011340: 6572 5f63 6f6e 6669 672e 7265 736f 6c76  er_config.resolv
+00011350: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00011360: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+00011370: 2054 6573 7420 6661 6c6c 6261 636b 2066   Test fallback f
+00011380: 6f72 2058 4447 5f43 4f4e 4649 475f 484f  or XDG_CONFIG_HO
+00011390: 4d45 0a20 2020 2020 2020 2077 6974 6820  ME.        with 
+000113a0: 7061 7463 682e 6469 6374 2822 6f73 2e65  patch.dict("os.e
+000113b0: 6e76 6972 6f6e 2229 3a0a 2020 2020 2020  nviron"):.      
+000113c0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+000113d0: 2e70 6f70 2822 5844 475f 434f 4e46 4947  .pop("XDG_CONFIG
+000113e0: 5f48 4f4d 4522 2c20 4e6f 6e65 290a 2020  _HOME", None).  
+000113f0: 2020 2020 2020 2020 2020 6661 6c6c 6261            fallba
+00011400: 636b 5f75 7365 725f 636f 6e66 6967 203d  ck_user_config =
+00011410: 2050 6174 6828 227e 2f2e 636f 6e66 6967   Path("~/.config
+00011420: 2229 2e65 7870 616e 6475 7365 7228 2920  ").expanduser() 
+00011430: 2f20 2262 6c61 636b 220a 2020 2020 2020  / "black".      
+00011440: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011450: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00011460: 2020 2020 2020 2020 626c 6163 6b2e 6669          black.fi
+00011470: 6c65 732e 6669 6e64 5f75 7365 725f 7079  les.find_user_py
+00011480: 7072 6f6a 6563 745f 746f 6d6c 2829 2c20  project_toml(), 
+00011490: 6661 6c6c 6261 636b 5f75 7365 725f 636f  fallback_user_co
+000114a0: 6e66 6967 2e72 6573 6f6c 7665 2829 0a20  nfig.resolve(). 
+000114b0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000114c0: 2020 6465 6620 7465 7374 5f66 696e 645f    def test_find_
+000114d0: 7573 6572 5f70 7970 726f 6a65 6374 5f74  user_pyproject_t
+000114e0: 6f6d 6c5f 7769 6e64 6f77 7328 7365 6c66  oml_windows(self
+000114f0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00011500: 2020 2069 6620 7379 7374 656d 2829 2021     if system() !
+00011510: 3d20 2257 696e 646f 7773 223a 0a20 2020  = "Windows":.   
+00011520: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00011530: 0a20 2020 2020 2020 2075 7365 725f 636f  .        user_co
+00011540: 6e66 6967 5f70 6174 6820 3d20 5061 7468  nfig_path = Path
+00011550: 2e68 6f6d 6528 2920 2f20 222e 626c 6163  .home() / ".blac
+00011560: 6b22 0a20 2020 2020 2020 2073 656c 662e  k".        self.
+00011570: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00011580: 2020 2020 2020 2020 2062 6c61 636b 2e66           black.f
+00011590: 696c 6573 2e66 696e 645f 7573 6572 5f70  iles.find_user_p
+000115a0: 7970 726f 6a65 6374 5f74 6f6d 6c28 292c  yproject_toml(),
+000115b0: 2075 7365 725f 636f 6e66 6967 5f70 6174   user_config_pat
+000115c0: 682e 7265 736f 6c76 6528 290a 2020 2020  h.resolve().    
+000115d0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+000115e0: 6573 745f 6270 6f5f 3333 3636 305f 776f  est_bpo_33660_wo
+000115f0: 726b 6172 6f75 6e64 2873 656c 6629 202d  rkaround(self) -
+00011600: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00011610: 6966 2073 7973 7465 6d28 2920 3d3d 2022  if system() == "
+00011620: 5769 6e64 6f77 7322 3a0a 2020 2020 2020  Windows":.      
+00011630: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00011640: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+00011650: 6275 6773 2e70 7974 686f 6e2e 6f72 672f  bugs.python.org/
+00011660: 6973 7375 6533 3336 3630 0a20 2020 2020  issue33660.     
+00011670: 2020 2072 6f6f 7420 3d20 5061 7468 2822     root = Path("
+00011680: 2f22 290a 2020 2020 2020 2020 7769 7468  /").        with
+00011690: 2063 6861 6e67 655f 6469 7265 6374 6f72   change_director
+000116a0: 7928 726f 6f74 293a 0a20 2020 2020 2020  y(root):.       
+000116b0: 2020 2020 2070 6174 6820 3d20 5061 7468       path = Path
+000116c0: 2822 776f 726b 7370 6163 6522 2920 2f20  ("workspace") / 
+000116d0: 2270 726f 6a65 6374 220a 2020 2020 2020  "project".      
+000116e0: 2020 2020 2020 7265 706f 7274 203d 2062        report = b
+000116f0: 6c61 636b 2e52 6570 6f72 7428 7665 7262  lack.Report(verb
+00011700: 6f73 653d 5472 7565 290a 2020 2020 2020  ose=True).      
+00011710: 2020 2020 2020 6e6f 726d 616c 697a 6564        normalized
+00011720: 5f70 6174 6820 3d20 626c 6163 6b2e 6e6f  _path = black.no
+00011730: 726d 616c 697a 655f 7061 7468 5f6d 6179  rmalize_path_may
+00011740: 6265 5f69 676e 6f72 6528 7061 7468 2c20  be_ignore(path, 
+00011750: 726f 6f74 2c20 7265 706f 7274 290a 2020  root, report).  
+00011760: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00011770: 7373 6572 7445 7175 616c 286e 6f72 6d61  ssertEqual(norma
+00011780: 6c69 7a65 645f 7061 7468 2c20 2277 6f72  lized_path, "wor
+00011790: 6b73 7061 6365 2f70 726f 6a65 6374 2229  kspace/project")
+000117a0: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
+000117b0: 6f72 6d61 6c69 7a65 5f70 6174 685f 6967  ormalize_path_ig
+000117c0: 6e6f 7265 5f77 696e 646f 7773 5f6a 756e  nore_windows_jun
+000117d0: 6374 696f 6e73 5f6f 7574 7369 6465 5f6f  ctions_outside_o
+000117e0: 665f 726f 6f74 2873 656c 6629 202d 3e20  f_root(self) -> 
+000117f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
+00011800: 2073 7973 7465 6d28 2920 213d 2022 5769   system() != "Wi
+00011810: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
+00011820: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00011830: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
+00011840: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
+00011850: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
+00011860: 2020 2020 2020 2020 726f 6f74 203d 2050          root = P
+00011870: 6174 6828 776f 726b 7370 6163 6529 0a20  ath(workspace). 
+00011880: 2020 2020 2020 2020 2020 206a 756e 6374             junct
+00011890: 696f 6e5f 6469 7220 3d20 726f 6f74 202f  ion_dir = root /
+000118a0: 2022 6a75 6e63 7469 6f6e 220a 2020 2020   "junction".    
+000118b0: 2020 2020 2020 2020 6a75 6e63 7469 6f6e          junction
+000118c0: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
+000118d0: 6f66 5f72 6f6f 7420 3d20 726f 6f74 202f  of_root = root /
+000118e0: 2022 2e2e 220a 2020 2020 2020 2020 2020   "..".          
+000118f0: 2020 6f73 2e73 7973 7465 6d28 6622 6d6b    os.system(f"mk
+00011900: 6c69 6e6b 202f 4a20 7b6a 756e 6374 696f  link /J {junctio
+00011910: 6e5f 6469 727d 207b 6a75 6e63 7469 6f6e  n_dir} {junction
+00011920: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
+00011930: 6f66 5f72 6f6f 747d 2229 0a0a 2020 2020  of_root}")..    
+00011940: 2020 2020 2020 2020 7265 706f 7274 203d          report =
+00011950: 2062 6c61 636b 2e52 6570 6f72 7428 7665   black.Report(ve
+00011960: 7262 6f73 653d 5472 7565 290a 2020 2020  rbose=True).    
+00011970: 2020 2020 2020 2020 6e6f 726d 616c 697a          normaliz
+00011980: 6564 5f70 6174 6820 3d20 626c 6163 6b2e  ed_path = black.
+00011990: 6e6f 726d 616c 697a 655f 7061 7468 5f6d  normalize_path_m
+000119a0: 6179 6265 5f69 676e 6f72 6528 0a20 2020  aybe_ignore(.   
+000119b0: 2020 2020 2020 2020 2020 2020 206a 756e               jun
+000119c0: 6374 696f 6e5f 6469 722c 2072 6f6f 742c  ction_dir, root,
+000119d0: 2072 6570 6f72 740a 2020 2020 2020 2020   report.        
+000119e0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000119f0: 2020 2320 4d61 6e75 616c 6c79 2064 656c    # Manually del
+00011a00: 6574 6520 666f 7220 5079 7468 6f6e 203c  ete for Python <
+00011a10: 2033 2e38 0a20 2020 2020 2020 2020 2020   3.8.           
+00011a20: 206f 732e 7379 7374 656d 2866 2272 6d64   os.system(f"rmd
+00011a30: 6972 207b 6a75 6e63 7469 6f6e 5f64 6972  ir {junction_dir
+00011a40: 7d22 290a 0a20 2020 2020 2020 2020 2020  }")..           
+00011a50: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00011a60: 6c28 6e6f 726d 616c 697a 6564 5f70 6174  l(normalized_pat
+00011a70: 682c 204e 6f6e 6529 0a0a 2020 2020 6465  h, None)..    de
+00011a80: 6620 7465 7374 5f6e 6577 6c69 6e65 5f63  f test_newline_c
+00011a90: 6f6d 6d65 6e74 5f69 6e74 6572 6163 7469  omment_interacti
+00011aa0: 6f6e 2873 656c 6629 202d 3e20 4e6f 6e65  on(self) -> None
+00011ab0: 3a0a 2020 2020 2020 2020 736f 7572 6365  :.        source
+00011ac0: 203d 2022 636c 6173 7320 413a 5c5c 5c72   = "class A:\\\r
+00011ad0: 5c6e 2320 7479 7065 3a20 6967 6e6f 7265  \n# type: ignore
+00011ae0: 5c6e 2070 6173 735c 6e22 0a20 2020 2020  \n pass\n".     
+00011af0: 2020 206f 7574 7075 7420 3d20 626c 6163     output = blac
+00011b00: 6b2e 666f 726d 6174 5f73 7472 2873 6f75  k.format_str(sou
+00011b10: 7263 652c 206d 6f64 653d 4445 4641 554c  rce, mode=DEFAUL
+00011b20: 545f 4d4f 4445 290a 2020 2020 2020 2020  T_MODE).        
+00011b30: 626c 6163 6b2e 6173 7365 7274 5f73 7461  black.assert_sta
+00011b40: 626c 6528 736f 7572 6365 2c20 6f75 7470  ble(source, outp
+00011b50: 7574 2c20 6d6f 6465 3d44 4546 4155 4c54  ut, mode=DEFAULT
+00011b60: 5f4d 4f44 4529 0a0a 2020 2020 6465 6620  _MODE)..    def 
+00011b70: 7465 7374 5f62 706f 5f32 3134 325f 776f  test_bpo_2142_wo
+00011b80: 726b 6172 6f75 6e64 2873 656c 6629 202d  rkaround(self) -
+00011b90: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00011ba0: 2320 6874 7470 733a 2f2f 6275 6773 2e70  # https://bugs.p
+00011bb0: 7974 686f 6e2e 6f72 672f 6973 7375 6532  ython.org/issue2
+00011bc0: 3134 320a 0a20 2020 2020 2020 2073 6f75  142..        sou
+00011bd0: 7263 652c 205f 203d 2072 6561 645f 6461  rce, _ = read_da
+00011be0: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
+00011bf0: 7322 2c20 226d 6973 7369 6e67 5f66 696e  s", "missing_fin
+00011c00: 616c 5f6e 6577 6c69 6e65 2229 0a20 2020  al_newline").   
+00011c10: 2020 2020 2023 2072 6561 645f 6461 7461       # read_data
+00011c20: 2061 6464 7320 6120 7472 6169 6c69 6e67   adds a trailing
+00011c30: 206e 6577 6c69 6e65 0a20 2020 2020 2020   newline.       
+00011c40: 2073 6f75 7263 6520 3d20 736f 7572 6365   source = source
+00011c50: 2e72 7374 7269 7028 290a 2020 2020 2020  .rstrip().      
+00011c60: 2020 6578 7065 6374 6564 2c20 5f20 3d20    expected, _ = 
+00011c70: 7265 6164 5f64 6174 6128 226d 6973 6365  read_data("misce
+00011c80: 6c6c 616e 656f 7573 222c 2022 6d69 7373  llaneous", "miss
+00011c90: 696e 675f 6669 6e61 6c5f 6e65 776c 696e  ing_final_newlin
+00011ca0: 652e 6469 6666 2229 0a20 2020 2020 2020  e.diff").       
+00011cb0: 2074 6d70 5f66 696c 6520 3d20 5061 7468   tmp_file = Path
+00011cc0: 2862 6c61 636b 2e64 756d 705f 746f 5f66  (black.dump_to_f
+00011cd0: 696c 6528 736f 7572 6365 2c20 656e 7375  ile(source, ensu
+00011ce0: 7265 5f66 696e 616c 5f6e 6577 6c69 6e65  re_final_newline
+00011cf0: 3d46 616c 7365 2929 0a20 2020 2020 2020  =False)).       
+00011d00: 2064 6966 665f 6865 6164 6572 203d 2072   diff_header = r
+00011d10: 652e 636f 6d70 696c 6528 0a20 2020 2020  e.compile(.     
+00011d20: 2020 2020 2020 2072 6622 7b72 652e 6573         rf"{re.es
+00011d30: 6361 7065 2873 7472 2874 6d70 5f66 696c  cape(str(tmp_fil
+00011d40: 6529 297d 5c74 5c64 5c64 5c64 5c64 2d5c  e))}\t\d\d\d\d-\
+00011d50: 645c 642d 5c64 5c64 2022 0a20 2020 2020  d\d-\d\d ".     
+00011d60: 2020 2020 2020 2072 225c 645c 643a 5c64         r"\d\d:\d
+00011d70: 5c64 3a5c 645c 645c 2e5c 645c 645c 645c  \d:\d\d\.\d\d\d\
+00011d80: 645c 645c 6420 5c2b 5c64 5c64 5c64 5c64  d\d\d \+\d\d\d\d
+00011d90: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+00011da0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00011db0: 2020 2020 2072 6573 756c 7420 3d20 426c       result = Bl
+00011dc0: 6163 6b52 756e 6e65 7228 292e 696e 766f  ackRunner().invo
+00011dd0: 6b65 2862 6c61 636b 2e6d 6169 6e2c 205b  ke(black.main, [
+00011de0: 222d 2d64 6966 6622 2c20 7374 7228 746d  "--diff", str(tm
+00011df0: 705f 6669 6c65 295d 290a 2020 2020 2020  p_file)]).      
+00011e00: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011e10: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
+00011e20: 6974 5f63 6f64 652c 2030 290a 2020 2020  it_code, 0).    
+00011e30: 2020 2020 6669 6e61 6c6c 793a 0a20 2020      finally:.   
+00011e40: 2020 2020 2020 2020 206f 732e 756e 6c69           os.unli
+00011e50: 6e6b 2874 6d70 5f66 696c 6529 0a20 2020  nk(tmp_file).   
+00011e60: 2020 2020 2061 6374 7561 6c20 3d20 7265       actual = re
+00011e70: 7375 6c74 2e6f 7574 7075 740a 2020 2020  sult.output.    
+00011e80: 2020 2020 6163 7475 616c 203d 2064 6966      actual = dif
+00011e90: 665f 6865 6164 6572 2e73 7562 2844 4554  f_header.sub(DET
+00011ea0: 4552 4d49 4e49 5354 4943 5f48 4541 4445  ERMINISTIC_HEADE
+00011eb0: 522c 2061 6374 7561 6c29 0a20 2020 2020  R, actual).     
+00011ec0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00011ed0: 7561 6c28 6163 7475 616c 2c20 6578 7065  ual(actual, expe
+00011ee0: 6374 6564 290a 0a20 2020 2040 7374 6174  cted)..    @stat
+00011ef0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00011f00: 2063 6f6d 7061 7265 5f72 6573 756c 7473   compare_results
+00011f10: 280a 2020 2020 2020 2020 7265 7375 6c74  (.        result
+00011f20: 3a20 636c 6963 6b2e 7465 7374 696e 672e  : click.testing.
+00011f30: 5265 7375 6c74 2c20 6578 7065 6374 6564  Result, expected
+00011f40: 5f76 616c 7565 3a20 7374 722c 2065 7870  _value: str, exp
+00011f50: 6563 7465 645f 6578 6974 5f63 6f64 653a  ected_exit_code:
+00011f60: 2069 6e74 0a20 2020 2029 202d 3e20 4e6f   int.    ) -> No
+00011f70: 6e65 3a0a 2020 2020 2020 2020 2222 2248  ne:.        """H
+00011f80: 656c 7065 7220 6d65 7468 6f64 2074 6f20  elper method to 
+00011f90: 7465 7374 2074 6865 2076 616c 7565 2061  test the value a
+00011fa0: 6e64 2065 7869 7420 636f 6465 206f 6620  nd exit code of 
+00011fb0: 6120 636c 6963 6b20 5265 7375 6c74 2e22  a click Result."
+00011fc0: 2222 0a20 2020 2020 2020 2061 7373 6572  "".        asser
+00011fd0: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
+00011fe0: 7265 7375 6c74 2e6f 7574 7075 7420 3d3d  result.output ==
+00011ff0: 2065 7870 6563 7465 645f 7661 6c75 650a   expected_value.
+00012000: 2020 2020 2020 2020 292c 2022 5468 6520          ), "The 
+00012010: 6f75 7470 7574 2064 6964 206e 6f74 206d  output did not m
+00012020: 6174 6368 2074 6865 2065 7870 6563 7465  atch the expecte
+00012030: 6420 7661 6c75 652e 220a 2020 2020 2020  d value.".      
+00012040: 2020 6173 7365 7274 2072 6573 756c 742e    assert result.
+00012050: 6578 6974 5f63 6f64 6520 3d3d 2065 7870  exit_code == exp
+00012060: 6563 7465 645f 6578 6974 5f63 6f64 652c  ected_exit_code,
+00012070: 2022 5468 6520 6578 6974 2063 6f64 6520   "The exit code 
+00012080: 6973 2069 6e63 6f72 7265 6374 2e22 0a0a  is incorrect."..
+00012090: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
+000120a0: 655f 6f70 7469 6f6e 2873 656c 6629 202d  e_option(self) -
+000120b0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000120c0: 2222 2254 6573 7420 7468 6520 636f 6465  """Test the code
+000120d0: 206f 7074 696f 6e20 7769 7468 206e 6f20   option with no 
+000120e0: 6368 616e 6765 732e 2222 220a 2020 2020  changes.""".    
+000120f0: 2020 2020 636f 6465 203d 2027 7072 696e      code = 'prin
+00012100: 7428 2248 656c 6c6f 2077 6f72 6c64 2229  t("Hello world")
+00012110: 5c6e 270a 2020 2020 2020 2020 6172 6773  \n'.        args
+00012120: 203d 205b 222d 2d63 6f64 6522 2c20 636f   = ["--code", co
+00012130: 6465 5d0a 2020 2020 2020 2020 7265 7375  de].        resu
+00012140: 6c74 203d 2043 6c69 5275 6e6e 6572 2829  lt = CliRunner()
+00012150: 2e69 6e76 6f6b 6528 626c 6163 6b2e 6d61  .invoke(black.ma
+00012160: 696e 2c20 6172 6773 290a 0a20 2020 2020  in, args)..     
+00012170: 2020 2073 656c 662e 636f 6d70 6172 655f     self.compare_
+00012180: 7265 7375 6c74 7328 7265 7375 6c74 2c20  results(result, 
+00012190: 636f 6465 2c20 3029 0a0a 2020 2020 6465  code, 0)..    de
+000121a0: 6620 7465 7374 5f63 6f64 655f 6f70 7469  f test_code_opti
+000121b0: 6f6e 5f63 6861 6e67 6564 2873 656c 6629  on_changed(self)
+000121c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+000121d0: 2020 2222 2254 6573 7420 7468 6520 636f    """Test the co
+000121e0: 6465 206f 7074 696f 6e20 7768 656e 2063  de option when c
+000121f0: 6861 6e67 6573 2061 7265 2072 6571 7569  hanges are requi
+00012200: 7265 642e 2222 220a 2020 2020 2020 2020  red.""".        
+00012210: 636f 6465 203d 2022 7072 696e 7428 2768  code = "print('h
+00012220: 656c 6c6f 2077 6f72 6c64 2729 220a 2020  ello world')".  
+00012230: 2020 2020 2020 666f 726d 6174 7465 6420        formatted 
+00012240: 3d20 626c 6163 6b2e 666f 726d 6174 5f73  = black.format_s
+00012250: 7472 2863 6f64 652c 206d 6f64 653d 4445  tr(code, mode=DE
+00012260: 4641 554c 545f 4d4f 4445 290a 0a20 2020  FAULT_MODE)..   
+00012270: 2020 2020 2061 7267 7320 3d20 5b22 2d2d       args = ["--
+00012280: 636f 6465 222c 2063 6f64 655d 0a20 2020  code", code].   
+00012290: 2020 2020 2072 6573 756c 7420 3d20 436c       result = Cl
+000122a0: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
+000122b0: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
+000122c0: 7329 0a0a 2020 2020 2020 2020 7365 6c66  s)..        self
+000122d0: 2e63 6f6d 7061 7265 5f72 6573 756c 7473  .compare_results
+000122e0: 2872 6573 756c 742c 2066 6f72 6d61 7474  (result, formatt
+000122f0: 6564 2c20 3029 0a0a 2020 2020 6465 6620  ed, 0)..    def 
+00012300: 7465 7374 5f63 6f64 655f 6f70 7469 6f6e  test_code_option
+00012310: 5f63 6865 636b 2873 656c 6629 202d 3e20  _check(self) -> 
+00012320: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00012330: 2254 6573 7420 7468 6520 636f 6465 206f  "Test the code o
+00012340: 7074 696f 6e20 7768 656e 2063 6865 636b  ption when check
+00012350: 2069 7320 7061 7373 6564 2e22 2222 0a20   is passed.""". 
+00012360: 2020 2020 2020 2061 7267 7320 3d20 5b22         args = ["
+00012370: 2d2d 6368 6563 6b22 2c20 222d 2d63 6f64  --check", "--cod
+00012380: 6522 2c20 2770 7269 6e74 2822 4865 6c6c  e", 'print("Hell
+00012390: 6f20 776f 726c 6422 295c 6e27 5d0a 2020  o world")\n'].  
+000123a0: 2020 2020 2020 7265 7375 6c74 203d 2043        result = C
+000123b0: 6c69 5275 6e6e 6572 2829 2e69 6e76 6f6b  liRunner().invok
+000123c0: 6528 626c 6163 6b2e 6d61 696e 2c20 6172  e(black.main, ar
+000123d0: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
+000123e0: 2e63 6f6d 7061 7265 5f72 6573 756c 7473  .compare_results
+000123f0: 2872 6573 756c 742c 2022 222c 2030 290a  (result, "", 0).
+00012400: 0a20 2020 2064 6566 2074 6573 745f 636f  .    def test_co
+00012410: 6465 5f6f 7074 696f 6e5f 6368 6563 6b5f  de_option_check_
+00012420: 6368 616e 6765 6428 7365 6c66 2920 2d3e  changed(self) ->
+00012430: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00012440: 2222 5465 7374 2074 6865 2063 6f64 6520  ""Test the code 
+00012450: 6f70 7469 6f6e 2077 6865 6e20 6368 616e  option when chan
+00012460: 6765 7320 6172 6520 7265 7175 6972 6564  ges are required
+00012470: 2c20 616e 6420 6368 6563 6b20 6973 2070  , and check is p
+00012480: 6173 7365 642e 2222 220a 2020 2020 2020  assed.""".      
+00012490: 2020 6172 6773 203d 205b 222d 2d63 6865    args = ["--che
+000124a0: 636b 222c 2022 2d2d 636f 6465 222c 2022  ck", "--code", "
+000124b0: 7072 696e 7428 2768 656c 6c6f 2077 6f72  print('hello wor
+000124c0: 6c64 2729 225d 0a20 2020 2020 2020 2072  ld')"].        r
+000124d0: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
+000124e0: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
+000124f0: 2e6d 6169 6e2c 2061 7267 7329 0a20 2020  .main, args).   
+00012500: 2020 2020 2073 656c 662e 636f 6d70 6172       self.compar
+00012510: 655f 7265 7375 6c74 7328 7265 7375 6c74  e_results(result
+00012520: 2c20 2222 2c20 3129 0a0a 2020 2020 6465  , "", 1)..    de
+00012530: 6620 7465 7374 5f63 6f64 655f 6f70 7469  f test_code_opti
+00012540: 6f6e 5f64 6966 6628 7365 6c66 2920 2d3e  on_diff(self) ->
+00012550: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00012560: 2222 5465 7374 2074 6865 2063 6f64 6520  ""Test the code 
+00012570: 6f70 7469 6f6e 2077 6865 6e20 6469 6666  option when diff
+00012580: 2069 7320 7061 7373 6564 2e22 2222 0a20   is passed.""". 
+00012590: 2020 2020 2020 2063 6f64 6520 3d20 2270         code = "p
+000125a0: 7269 6e74 2827 6865 6c6c 6f20 776f 726c  rint('hello worl
+000125b0: 6427 2922 0a20 2020 2020 2020 2066 6f72  d')".        for
+000125c0: 6d61 7474 6564 203d 2062 6c61 636b 2e66  matted = black.f
+000125d0: 6f72 6d61 745f 7374 7228 636f 6465 2c20  ormat_str(code, 
+000125e0: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
+000125f0: 4529 0a20 2020 2020 2020 2072 6573 756c  E).        resul
+00012600: 745f 6469 6666 203d 2064 6966 6628 636f  t_diff = diff(co
+00012610: 6465 2c20 666f 726d 6174 7465 642c 2022  de, formatted, "
+00012620: 5354 4449 4e22 2c20 2253 5444 4f55 5422  STDIN", "STDOUT"
+00012630: 290a 0a20 2020 2020 2020 2061 7267 7320  )..        args 
+00012640: 3d20 5b22 2d2d 6469 6666 222c 2022 2d2d  = ["--diff", "--
+00012650: 636f 6465 222c 2063 6f64 655d 0a20 2020  code", code].   
+00012660: 2020 2020 2072 6573 756c 7420 3d20 436c       result = Cl
+00012670: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
+00012680: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
+00012690: 7329 0a0a 2020 2020 2020 2020 2320 5265  s)..        # Re
+000126a0: 6d6f 7665 2074 696d 6520 6672 6f6d 2064  move time from d
+000126b0: 6966 660a 2020 2020 2020 2020 6f75 7470  iff.        outp
+000126c0: 7574 203d 2044 4946 465f 5449 4d45 2e73  ut = DIFF_TIME.s
+000126d0: 7562 2822 222c 2072 6573 756c 742e 6f75  ub("", result.ou
+000126e0: 7470 7574 290a 0a20 2020 2020 2020 2061  tput)..        a
+000126f0: 7373 6572 7420 6f75 7470 7574 203d 3d20  ssert output == 
+00012700: 7265 7375 6c74 5f64 6966 662c 2022 5468  result_diff, "Th
+00012710: 6520 6f75 7470 7574 2064 6964 206e 6f74  e output did not
+00012720: 206d 6174 6368 2074 6865 2065 7870 6563   match the expec
+00012730: 7465 6420 7661 6c75 652e 220a 2020 2020  ted value.".    
+00012740: 2020 2020 6173 7365 7274 2072 6573 756c      assert resul
+00012750: 742e 6578 6974 5f63 6f64 6520 3d3d 2030  t.exit_code == 0
+00012760: 2c20 2254 6865 2065 7869 7420 636f 6465  , "The exit code
+00012770: 2069 7320 696e 636f 7272 6563 742e 220a   is incorrect.".
+00012780: 0a20 2020 2064 6566 2074 6573 745f 636f  .    def test_co
+00012790: 6465 5f6f 7074 696f 6e5f 636f 6c6f 725f  de_option_color_
+000127a0: 6469 6666 2873 656c 6629 202d 3e20 4e6f  diff(self) -> No
+000127b0: 6e65 3a0a 2020 2020 2020 2020 2222 2254  ne:.        """T
+000127c0: 6573 7420 7468 6520 636f 6465 206f 7074  est the code opt
+000127d0: 696f 6e20 7768 656e 2063 6f6c 6f72 2061  ion when color a
+000127e0: 6e64 2064 6966 6620 6172 6520 7061 7373  nd diff are pass
+000127f0: 6564 2e22 2222 0a20 2020 2020 2020 2063  ed.""".        c
+00012800: 6f64 6520 3d20 2270 7269 6e74 2827 6865  ode = "print('he
+00012810: 6c6c 6f20 776f 726c 6427 2922 0a20 2020  llo world')".   
+00012820: 2020 2020 2066 6f72 6d61 7474 6564 203d       formatted =
+00012830: 2062 6c61 636b 2e66 6f72 6d61 745f 7374   black.format_st
+00012840: 7228 636f 6465 2c20 6d6f 6465 3d44 4546  r(code, mode=DEF
+00012850: 4155 4c54 5f4d 4f44 4529 0a0a 2020 2020  AULT_MODE)..    
+00012860: 2020 2020 7265 7375 6c74 5f64 6966 6620      result_diff 
+00012870: 3d20 6469 6666 2863 6f64 652c 2066 6f72  = diff(code, for
+00012880: 6d61 7474 6564 2c20 2253 5444 494e 222c  matted, "STDIN",
+00012890: 2022 5354 444f 5554 2229 0a20 2020 2020   "STDOUT").     
+000128a0: 2020 2072 6573 756c 745f 6469 6666 203d     result_diff =
+000128b0: 2063 6f6c 6f72 5f64 6966 6628 7265 7375   color_diff(resu
+000128c0: 6c74 5f64 6966 6629 0a0a 2020 2020 2020  lt_diff)..      
+000128d0: 2020 6172 6773 203d 205b 222d 2d64 6966    args = ["--dif
+000128e0: 6622 2c20 222d 2d63 6f6c 6f72 222c 2022  f", "--color", "
+000128f0: 2d2d 636f 6465 222c 2063 6f64 655d 0a20  --code", code]. 
+00012900: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00012910: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
+00012920: 6b65 2862 6c61 636b 2e6d 6169 6e2c 2061  ke(black.main, a
+00012930: 7267 7329 0a0a 2020 2020 2020 2020 2320  rgs)..        # 
+00012940: 5265 6d6f 7665 2074 696d 6520 6672 6f6d  Remove time from
+00012950: 2064 6966 660a 2020 2020 2020 2020 6f75   diff.        ou
+00012960: 7470 7574 203d 2044 4946 465f 5449 4d45  tput = DIFF_TIME
+00012970: 2e73 7562 2822 222c 2072 6573 756c 742e  .sub("", result.
+00012980: 6f75 7470 7574 290a 0a20 2020 2020 2020  output)..       
+00012990: 2061 7373 6572 7420 6f75 7470 7574 203d   assert output =
+000129a0: 3d20 7265 7375 6c74 5f64 6966 662c 2022  = result_diff, "
+000129b0: 5468 6520 6f75 7470 7574 2064 6964 206e  The output did n
+000129c0: 6f74 206d 6174 6368 2074 6865 2065 7870  ot match the exp
+000129d0: 6563 7465 6420 7661 6c75 652e 220a 2020  ected value.".  
+000129e0: 2020 2020 2020 6173 7365 7274 2072 6573        assert res
+000129f0: 756c 742e 6578 6974 5f63 6f64 6520 3d3d  ult.exit_code ==
+00012a00: 2030 2c20 2254 6865 2065 7869 7420 636f   0, "The exit co
+00012a10: 6465 2069 7320 696e 636f 7272 6563 742e  de is incorrect.
+00012a20: 220a 0a20 2020 2040 7079 7465 7374 2e6d  "..    @pytest.m
+00012a30: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
+00012a40: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
+00012a50: 6465 6620 7465 7374 5f63 6f64 655f 6f70  def test_code_op
+00012a60: 7469 6f6e 5f73 6166 6528 7365 6c66 2920  tion_safe(self) 
+00012a70: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00012a80: 2022 2222 5465 7374 2074 6861 7420 7468   """Test that th
+00012a90: 6520 636f 6465 206f 7074 696f 6e20 7468  e code option th
+00012aa0: 726f 7773 2061 6e20 6572 726f 7220 7768  rows an error wh
+00012ab0: 656e 2074 6865 2073 616e 6974 7920 6368  en the sanity ch
+00012ac0: 6563 6b73 2066 6169 6c2e 2222 220a 2020  ecks fail.""".  
+00012ad0: 2020 2020 2020 2320 5061 7463 6820 626c        # Patch bl
+00012ae0: 6163 6b2e 6173 7365 7274 5f65 7175 6976  ack.assert_equiv
+00012af0: 616c 656e 7420 746f 2065 6e73 7572 6520  alent to ensure 
+00012b00: 7468 6520 7361 6e69 7479 2063 6865 636b  the sanity check
+00012b10: 7320 6661 696c 0a20 2020 2020 2020 2077  s fail.        w
+00012b20: 6974 6820 7061 7463 682e 6f62 6a65 6374  ith patch.object
+00012b30: 2862 6c61 636b 2c20 2261 7373 6572 745f  (black, "assert_
+00012b40: 6571 7569 7661 6c65 6e74 222c 2073 6964  equivalent", sid
+00012b50: 655f 6566 6665 6374 3d41 7373 6572 7469  e_effect=Asserti
+00012b60: 6f6e 4572 726f 7229 3a0a 2020 2020 2020  onError):.      
+00012b70: 2020 2020 2020 636f 6465 203d 2027 7072        code = 'pr
+00012b80: 696e 7428 2248 656c 6c6f 2077 6f72 6c64  int("Hello world
+00012b90: 2229 270a 2020 2020 2020 2020 2020 2020  ")'.            
+00012ba0: 6572 726f 725f 6d73 6720 3d20 6622 7b63  error_msg = f"{c
+00012bb0: 6f64 657d 5c6e 6572 726f 723a 2063 616e  ode}\nerror: can
+00012bc0: 6e6f 7420 666f 726d 6174 203c 7374 7269  not format <stri
+00012bd0: 6e67 3e3a 205c 6e22 0a0a 2020 2020 2020  ng>: \n"..      
+00012be0: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
+00012bf0: 2d73 6166 6522 2c20 222d 2d63 6f64 6522  -safe", "--code"
+00012c00: 2c20 636f 6465 5d0a 2020 2020 2020 2020  , code].        
+00012c10: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
+00012c20: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
+00012c30: 626c 6163 6b2e 6d61 696e 2c20 6172 6773  black.main, args
+00012c40: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00012c50: 656c 662e 636f 6d70 6172 655f 7265 7375  elf.compare_resu
+00012c60: 6c74 7328 7265 7375 6c74 2c20 6572 726f  lts(result, erro
+00012c70: 725f 6d73 672c 2031 3233 290a 0a20 2020  r_msg, 123)..   
+00012c80: 2064 6566 2074 6573 745f 636f 6465 5f6f   def test_code_o
+00012c90: 7074 696f 6e5f 6661 7374 2873 656c 6629  ption_fast(self)
+00012ca0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00012cb0: 2020 2222 2254 6573 7420 7468 6174 2074    """Test that t
+00012cc0: 6865 2063 6f64 6520 6f70 7469 6f6e 2069  he code option i
+00012cd0: 676e 6f72 6573 2065 7272 6f72 7320 7768  gnores errors wh
+00012ce0: 656e 2074 6865 2073 616e 6974 7920 6368  en the sanity ch
+00012cf0: 6563 6b73 2066 6169 6c2e 2222 220a 2020  ecks fail.""".  
+00012d00: 2020 2020 2020 2320 5061 7463 6820 626c        # Patch bl
+00012d10: 6163 6b2e 6173 7365 7274 5f65 7175 6976  ack.assert_equiv
+00012d20: 616c 656e 7420 746f 2065 6e73 7572 6520  alent to ensure 
+00012d30: 7468 6520 7361 6e69 7479 2063 6865 636b  the sanity check
+00012d40: 7320 6661 696c 0a20 2020 2020 2020 2077  s fail.        w
+00012d50: 6974 6820 7061 7463 682e 6f62 6a65 6374  ith patch.object
+00012d60: 2862 6c61 636b 2c20 2261 7373 6572 745f  (black, "assert_
+00012d70: 6571 7569 7661 6c65 6e74 222c 2073 6964  equivalent", sid
+00012d80: 655f 6566 6665 6374 3d41 7373 6572 7469  e_effect=Asserti
+00012d90: 6f6e 4572 726f 7229 3a0a 2020 2020 2020  onError):.      
+00012da0: 2020 2020 2020 636f 6465 203d 2027 7072        code = 'pr
+00012db0: 696e 7428 2248 656c 6c6f 2077 6f72 6c64  int("Hello world
+00012dc0: 2229 270a 2020 2020 2020 2020 2020 2020  ")'.            
+00012dd0: 666f 726d 6174 7465 6420 3d20 626c 6163  formatted = blac
+00012de0: 6b2e 666f 726d 6174 5f73 7472 2863 6f64  k.format_str(cod
+00012df0: 652c 206d 6f64 653d 4445 4641 554c 545f  e, mode=DEFAULT_
+00012e00: 4d4f 4445 290a 0a20 2020 2020 2020 2020  MODE)..         
+00012e10: 2020 2061 7267 7320 3d20 5b22 2d2d 6661     args = ["--fa
+00012e20: 7374 222c 2022 2d2d 636f 6465 222c 2063  st", "--code", c
+00012e30: 6f64 655d 0a20 2020 2020 2020 2020 2020  ode].           
+00012e40: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
+00012e50: 6e65 7228 292e 696e 766f 6b65 2862 6c61  ner().invoke(bla
+00012e60: 636b 2e6d 6169 6e2c 2061 7267 7329 0a0a  ck.main, args)..
+00012e70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00012e80: 2e63 6f6d 7061 7265 5f72 6573 756c 7473  .compare_results
+00012e90: 2872 6573 756c 742c 2066 6f72 6d61 7474  (result, formatt
+00012ea0: 6564 2c20 3029 0a0a 2020 2020 4070 7974  ed, 0)..    @pyt
+00012eb0: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
+00012ec0: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
+00012ed0: 0a20 2020 2064 6566 2074 6573 745f 636f  .    def test_co
+00012ee0: 6465 5f6f 7074 696f 6e5f 636f 6e66 6967  de_option_config
+00012ef0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00012f00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012f10: 2020 2020 5465 7374 2074 6861 7420 7468      Test that th
+00012f20: 6520 636f 6465 206f 7074 696f 6e20 6669  e code option fi
+00012f30: 6e64 7320 7468 6520 7079 7072 6f6a 6563  nds the pyprojec
+00012f40: 742e 746f 6d6c 2069 6e20 7468 6520 6375  t.toml in the cu
+00012f50: 7272 656e 7420 6469 7265 6374 6f72 792e  rrent directory.
+00012f60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00012f70: 2020 2020 2077 6974 6820 7061 7463 682e       with patch.
+00012f80: 6f62 6a65 6374 2862 6c61 636b 2c20 2270  object(black, "p
+00012f90: 6172 7365 5f70 7970 726f 6a65 6374 5f74  arse_pyproject_t
+00012fa0: 6f6d 6c22 2c20 7265 7475 726e 5f76 616c  oml", return_val
+00012fb0: 7565 3d7b 7d29 2061 7320 7061 7273 653a  ue={}) as parse:
+00012fc0: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
+00012fd0: 7320 3d20 5b22 2d2d 636f 6465 222c 2022  s = ["--code", "
+00012fe0: 7072 696e 7422 5d0a 2020 2020 2020 2020  print"].        
+00012ff0: 2020 2020 2320 5468 6973 2069 7320 7468      # This is th
+00013000: 6520 6f6e 6c79 2064 6972 6563 746f 7279  e only directory
+00013010: 206b 6e6f 776e 2074 6f20 636f 6e74 6169   known to contai
+00013020: 6e20 6120 7079 7072 6f6a 6563 742e 746f  n a pyproject.to
+00013030: 6d6c 0a20 2020 2020 2020 2020 2020 2077  ml.            w
+00013040: 6974 6820 6368 616e 6765 5f64 6972 6563  ith change_direc
+00013050: 746f 7279 2850 524f 4a45 4354 5f52 4f4f  tory(PROJECT_ROO
+00013060: 5429 3a0a 2020 2020 2020 2020 2020 2020  T):.            
+00013070: 2020 2020 436c 6952 756e 6e65 7228 292e      CliRunner().
+00013080: 696e 766f 6b65 2862 6c61 636b 2e6d 6169  invoke(black.mai
+00013090: 6e2c 2061 7267 7329 0a20 2020 2020 2020  n, args).       
+000130a0: 2020 2020 2020 2020 2070 7970 726f 6a65           pyproje
+000130b0: 6374 5f70 6174 6820 3d20 5061 7468 2850  ct_path = Path(P
+000130c0: 6174 682e 6377 6428 292c 2022 7079 7072  ath.cwd(), "pypr
+000130d0: 6f6a 6563 742e 746f 6d6c 2229 2e72 6573  oject.toml").res
+000130e0: 6f6c 7665 2829 0a0a 2020 2020 2020 2020  olve()..        
+000130f0: 2020 2020 6173 7365 7274 2028 0a20 2020      assert (.   
+00013100: 2020 2020 2020 2020 2020 2020 206c 656e               len
+00013110: 2870 6172 7365 2e6d 6f63 6b5f 6361 6c6c  (parse.mock_call
+00013120: 7329 203e 3d20 310a 2020 2020 2020 2020  s) >= 1.        
+00013130: 2020 2020 292c 2022 4578 7065 6374 6564      ), "Expected
+00013140: 2063 6f6e 6669 6720 7061 7273 6520 746f   config parse to
+00013150: 2062 6520 6361 6c6c 6564 2077 6974 6820   be called with 
+00013160: 7468 6520 6375 7272 656e 7420 6469 7265  the current dire
+00013170: 6374 6f72 792e 220a 0a20 2020 2020 2020  ctory."..       
+00013180: 2020 2020 205f 2c20 6361 6c6c 5f61 7267       _, call_arg
+00013190: 732c 205f 203d 2070 6172 7365 2e6d 6f63  s, _ = parse.moc
+000131a0: 6b5f 6361 6c6c 735b 305d 0a20 2020 2020  k_calls[0].     
+000131b0: 2020 2020 2020 2061 7373 6572 7420 280a         assert (.
+000131c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131d0: 6361 6c6c 5f61 7267 735b 305d 2e6c 6f77  call_args[0].low
+000131e0: 6572 2829 203d 3d20 7374 7228 7079 7072  er() == str(pypr
+000131f0: 6f6a 6563 745f 7061 7468 292e 6c6f 7765  oject_path).lowe
+00013200: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+00013210: 292c 2022 496e 636f 7272 6563 7420 636f  ), "Incorrect co
+00013220: 6e66 6967 206c 6f61 6465 642e 220a 0a20  nfig loaded.".. 
+00013230: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
+00013240: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
+00013250: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
+00013260: 7465 7374 5f63 6f64 655f 6f70 7469 6f6e  test_code_option
+00013270: 5f70 6172 656e 745f 636f 6e66 6967 2873  _parent_config(s
+00013280: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00013290: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000132a0: 2020 5465 7374 2074 6861 7420 7468 6520    Test that the 
+000132b0: 636f 6465 206f 7074 696f 6e20 6669 6e64  code option find
+000132c0: 7320 7468 6520 7079 7072 6f6a 6563 742e  s the pyproject.
+000132d0: 746f 6d6c 2069 6e20 7468 6520 7061 7265  toml in the pare
+000132e0: 6e74 2064 6972 6563 746f 7279 2e0a 2020  nt directory..  
+000132f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013300: 2020 7769 7468 2070 6174 6368 2e6f 626a    with patch.obj
+00013310: 6563 7428 626c 6163 6b2c 2022 7061 7273  ect(black, "pars
+00013320: 655f 7079 7072 6f6a 6563 745f 746f 6d6c  e_pyproject_toml
+00013330: 222c 2072 6574 7572 6e5f 7661 6c75 653d  ", return_value=
+00013340: 7b7d 2920 6173 2070 6172 7365 3a0a 2020  {}) as parse:.  
+00013350: 2020 2020 2020 2020 2020 7769 7468 2063            with c
+00013360: 6861 6e67 655f 6469 7265 6374 6f72 7928  hange_directory(
+00013370: 5448 4953 5f44 4952 293a 0a20 2020 2020  THIS_DIR):.     
+00013380: 2020 2020 2020 2020 2020 2061 7267 7320             args 
+00013390: 3d20 5b22 2d2d 636f 6465 222c 2022 7072  = ["--code", "pr
+000133a0: 696e 7422 5d0a 2020 2020 2020 2020 2020  int"].          
+000133b0: 2020 2020 2020 436c 6952 756e 6e65 7228        CliRunner(
+000133c0: 292e 696e 766f 6b65 2862 6c61 636b 2e6d  ).invoke(black.m
+000133d0: 6169 6e2c 2061 7267 7329 0a0a 2020 2020  ain, args)..    
+000133e0: 2020 2020 2020 2020 2020 2020 7079 7072              pypr
+000133f0: 6f6a 6563 745f 7061 7468 203d 2050 6174  oject_path = Pat
+00013400: 6828 5061 7468 2829 2e63 7764 2829 2e70  h(Path().cwd().p
+00013410: 6172 656e 742c 2022 7079 7072 6f6a 6563  arent, "pyprojec
+00013420: 742e 746f 6d6c 2229 2e72 6573 6f6c 7665  t.toml").resolve
+00013430: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00013440: 2020 2061 7373 6572 7420 280a 2020 2020     assert (.    
+00013450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013460: 6c65 6e28 7061 7273 652e 6d6f 636b 5f63  len(parse.mock_c
+00013470: 616c 6c73 2920 3e3d 2031 0a20 2020 2020  alls) >= 1.     
+00013480: 2020 2020 2020 2020 2020 2029 2c20 2245             ), "E
+00013490: 7870 6563 7465 6420 636f 6e66 6967 2070  xpected config p
+000134a0: 6172 7365 2074 6f20 6265 2063 616c 6c65  arse to be calle
+000134b0: 6420 7769 7468 2074 6865 2063 7572 7265  d with the curre
+000134c0: 6e74 2064 6972 6563 746f 7279 2e22 0a0a  nt directory."..
+000134d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134e0: 5f2c 2063 616c 6c5f 6172 6773 2c20 5f20  _, call_args, _ 
+000134f0: 3d20 7061 7273 652e 6d6f 636b 5f63 616c  = parse.mock_cal
+00013500: 6c73 5b30 5d0a 2020 2020 2020 2020 2020  ls[0].          
+00013510: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
+00013520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013530: 2020 2063 616c 6c5f 6172 6773 5b30 5d2e     call_args[0].
+00013540: 6c6f 7765 7228 2920 3d3d 2073 7472 2870  lower() == str(p
+00013550: 7970 726f 6a65 6374 5f70 6174 6829 2e6c  yproject_path).l
+00013560: 6f77 6572 2829 0a20 2020 2020 2020 2020  ower().         
+00013570: 2020 2020 2020 2029 2c20 2249 6e63 6f72         ), "Incor
+00013580: 7265 6374 2063 6f6e 6669 6720 6c6f 6164  rect config load
+00013590: 6564 2e22 0a0a 2020 2020 6465 6620 7465  ed."..    def te
+000135a0: 7374 5f66 6f72 5f68 616e 646c 6564 5f75  st_for_handled_u
+000135b0: 6e65 7870 6563 7465 645f 656f 665f 6572  nexpected_eof_er
+000135c0: 726f 7228 7365 6c66 2920 2d3e 204e 6f6e  ror(self) -> Non
+000135d0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+000135e0: 2020 2020 2020 2054 6573 7420 7468 6174         Test that
+000135f0: 2061 6e20 756e 6578 7065 6374 6564 2045   an unexpected E
+00013600: 4f46 2053 796e 7461 7845 7272 6f72 2069  OF SyntaxError i
+00013610: 7320 6e69 6365 6c79 2070 7265 7365 6e74  s nicely present
+00013620: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
+00013630: 2020 2020 2020 2020 7769 7468 2070 7974          with pyt
+00013640: 6573 742e 7261 6973 6573 2862 6c61 636b  est.raises(black
+00013650: 2e70 6172 7369 6e67 2e49 6e76 616c 6964  .parsing.Invalid
+00013660: 496e 7075 7429 2061 7320 6578 635f 696e  Input) as exc_in
+00013670: 666f 3a0a 2020 2020 2020 2020 2020 2020  fo:.            
+00013680: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+00013690: 7273 6528 2270 7269 6e74 2822 2c20 7b7d  rse("print(", {}
+000136a0: 290a 0a20 2020 2020 2020 2065 7863 5f69  )..        exc_i
+000136b0: 6e66 6f2e 6d61 7463 6828 2243 616e 6e6f  nfo.match("Canno
+000136c0: 7420 7061 7273 653a 2032 3a30 3a20 454f  t parse: 2:0: EO
+000136d0: 4620 696e 206d 756c 7469 2d6c 696e 6520  F in multi-line 
+000136e0: 7374 6174 656d 656e 7422 290a 0a20 2020  statement")..   
+000136f0: 2064 6566 2074 6573 745f 6571 7569 7661   def test_equiva
+00013700: 6c65 6e63 795f 6173 745f 7061 7273 655f  lency_ast_parse_
+00013710: 6661 696c 7572 655f 696e 636c 7564 6573  failure_includes
+00013720: 5f65 7272 6f72 2873 656c 6629 202d 3e20  _error(self) -> 
+00013730: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
+00013740: 7468 2070 7974 6573 742e 7261 6973 6573  th pytest.raises
+00013750: 2841 7373 6572 7469 6f6e 4572 726f 7229  (AssertionError)
+00013760: 2061 7320 6572 723a 0a20 2020 2020 2020   as err:.       
+00013770: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
+00013780: 745f 6571 7569 7661 6c65 6e74 2822 61c2  t_equivalent("a.
+00013790: abc2 bb61 2020 3d20 3122 2c20 2261 c2ab  ...a  = 1", "a..
+000137a0: c2bb 6120 203d 2031 2229 0a0a 2020 2020  ..a  = 1")..    
+000137b0: 2020 2020 6572 722e 6d61 7463 6828 222d      err.match("-
+000137c0: 2d73 6166 6522 290a 2020 2020 2020 2020  -safe").        
+000137d0: 2320 556e 666f 7274 756e 6174 656c 7920  # Unfortunately 
+000137e0: 7468 6520 5379 6e74 6178 4572 726f 7220  the SyntaxError 
+000137f0: 6d65 7373 6167 6520 6861 7320 6368 616e  message has chan
+00013800: 6765 6420 696e 206e 6577 6572 2076 6572  ged in newer ver
+00013810: 7369 6f6e 7320 736f 2077 650a 2020 2020  sions so we.    
+00013820: 2020 2020 2320 6361 6e27 7420 6d61 7463      # can't matc
+00013830: 6820 6974 2064 6972 6563 746c 792e 0a20  h it directly.. 
+00013840: 2020 2020 2020 2065 7272 2e6d 6174 6368         err.match
+00013850: 2822 696e 7661 6c69 6420 6368 6172 6163  ("invalid charac
+00013860: 7465 7222 290a 2020 2020 2020 2020 6572  ter").        er
+00013870: 722e 6d61 7463 6828 7222 5c28 3c75 6e6b  r.match(r"\(<unk
+00013880: 6e6f 776e 3e2c 206c 696e 6520 315c 2922  nown>, line 1\)"
+00013890: 290a 0a0a 636c 6173 7320 5465 7374 4361  )...class TestCa
+000138a0: 6368 696e 673a 0a20 2020 2064 6566 2074  ching:.    def t
+000138b0: 6573 745f 6765 745f 6361 6368 655f 6469  est_get_cache_di
+000138c0: 7228 0a20 2020 2020 2020 2073 656c 662c  r(.        self,
+000138d0: 0a20 2020 2020 2020 2074 6d70 5f70 6174  .        tmp_pat
+000138e0: 683a 2050 6174 682c 0a20 2020 2020 2020  h: Path,.       
+000138f0: 206d 6f6e 6b65 7970 6174 6368 3a20 7079   monkeypatch: py
+00013900: 7465 7374 2e4d 6f6e 6b65 7950 6174 6368  test.MonkeyPatch
+00013910: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
+00013920: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
+00013930: 6520 6d75 6c74 6970 6c65 2063 6163 6865  e multiple cache
+00013940: 2064 6972 6563 746f 7269 6573 0a20 2020   directories.   
+00013950: 2020 2020 2077 6f72 6b73 7061 6365 3120       workspace1 
+00013960: 3d20 746d 705f 7061 7468 202f 2022 7773  = tmp_path / "ws
+00013970: 3122 0a20 2020 2020 2020 2077 6f72 6b73  1".        works
+00013980: 7061 6365 312e 6d6b 6469 7228 290a 2020  pace1.mkdir().  
+00013990: 2020 2020 2020 776f 726b 7370 6163 6532        workspace2
+000139a0: 203d 2074 6d70 5f70 6174 6820 2f20 2277   = tmp_path / "w
+000139b0: 7332 220a 2020 2020 2020 2020 776f 726b  s2".        work
+000139c0: 7370 6163 6532 2e6d 6b64 6972 2829 0a0a  space2.mkdir()..
+000139d0: 2020 2020 2020 2020 2320 466f 7263 6520          # Force 
+000139e0: 7573 6572 5f63 6163 6865 5f64 6972 2074  user_cache_dir t
+000139f0: 6f20 7573 6520 7468 6520 7465 6d70 6f72  o use the tempor
+00013a00: 6172 7920 6469 7265 6374 6f72 7920 666f  ary directory fo
+00013a10: 7220 6561 7369 6572 2061 7373 6572 7469  r easier asserti
+00013a20: 6f6e 730a 2020 2020 2020 2020 7061 7463  ons.        patc
+00013a30: 685f 7573 6572 5f63 6163 6865 5f64 6972  h_user_cache_dir
+00013a40: 203d 2070 6174 6368 280a 2020 2020 2020   = patch(.      
+00013a50: 2020 2020 2020 7461 7267 6574 3d22 626c        target="bl
+00013a60: 6163 6b2e 6361 6368 652e 7573 6572 5f63  ack.cache.user_c
+00013a70: 6163 6865 5f64 6972 222c 0a20 2020 2020  ache_dir",.     
+00013a80: 2020 2020 2020 2061 7574 6f73 7065 633d         autospec=
+00013a90: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+00013aa0: 2020 7265 7475 726e 5f76 616c 7565 3d73    return_value=s
+00013ab0: 7472 2877 6f72 6b73 7061 6365 3129 2c0a  tr(workspace1),.
+00013ac0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00013ad0: 2020 2023 2049 6620 424c 4143 4b5f 4341     # If BLACK_CA
+00013ae0: 4348 455f 4449 5220 6973 206e 6f74 2073  CHE_DIR is not s
+00013af0: 6574 2c20 7573 6520 7573 6572 5f63 6163  et, use user_cac
+00013b00: 6865 5f64 6972 0a20 2020 2020 2020 206d  he_dir.        m
+00013b10: 6f6e 6b65 7970 6174 6368 2e64 656c 656e  onkeypatch.delen
+00013b20: 7628 2242 4c41 434b 5f43 4143 4845 5f44  v("BLACK_CACHE_D
+00013b30: 4952 222c 2072 6169 7369 6e67 3d46 616c  IR", raising=Fal
+00013b40: 7365 290a 2020 2020 2020 2020 7769 7468  se).        with
+00013b50: 2070 6174 6368 5f75 7365 725f 6361 6368   patch_user_cach
+00013b60: 655f 6469 723a 0a20 2020 2020 2020 2020  e_dir:.         
+00013b70: 2020 2061 7373 6572 7420 6765 745f 6361     assert get_ca
+00013b80: 6368 655f 6469 7228 2920 3d3d 2077 6f72  che_dir() == wor
+00013b90: 6b73 7061 6365 310a 0a20 2020 2020 2020  kspace1..       
+00013ba0: 2023 2049 6620 6974 2069 7320 7365 742c   # If it is set,
+00013bb0: 2075 7365 2074 6865 2070 6174 6820 7072   use the path pr
+00013bc0: 6f76 6964 6564 2069 6e20 7468 6520 656e  ovided in the en
+00013bd0: 7620 7661 722e 0a20 2020 2020 2020 206d  v var..        m
+00013be0: 6f6e 6b65 7970 6174 6368 2e73 6574 656e  onkeypatch.seten
+00013bf0: 7628 2242 4c41 434b 5f43 4143 4845 5f44  v("BLACK_CACHE_D
+00013c00: 4952 222c 2073 7472 2877 6f72 6b73 7061  IR", str(workspa
+00013c10: 6365 3229 290a 2020 2020 2020 2020 6173  ce2)).        as
+00013c20: 7365 7274 2067 6574 5f63 6163 6865 5f64  sert get_cache_d
+00013c30: 6972 2829 203d 3d20 776f 726b 7370 6163  ir() == workspac
+00013c40: 6532 0a0a 2020 2020 6465 6620 7465 7374  e2..    def test
+00013c50: 5f63 6163 6865 5f62 726f 6b65 6e5f 6669  _cache_broken_fi
+00013c60: 6c65 2873 656c 6629 202d 3e20 4e6f 6e65  le(self) -> None
+00013c70: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
+00013c80: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
+00013c90: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
+00013ca0: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
+00013cb0: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
+00013cc0: 2063 6163 6865 5f66 696c 6520 3d20 6765   cache_file = ge
+00013cd0: 745f 6361 6368 655f 6669 6c65 286d 6f64  t_cache_file(mod
+00013ce0: 6529 0a20 2020 2020 2020 2020 2020 2063  e).            c
+00013cf0: 6163 6865 5f66 696c 652e 7772 6974 655f  ache_file.write_
+00013d00: 7465 7874 2822 7468 6973 2069 7320 6e6f  text("this is no
+00013d10: 7420 6120 7069 636b 6c65 2229 0a20 2020  t a pickle").   
+00013d20: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00013d30: 626c 6163 6b2e 7265 6164 5f63 6163 6865  black.read_cache
+00013d40: 286d 6f64 6529 203d 3d20 7b7d 0a20 2020  (mode) == {}.   
+00013d50: 2020 2020 2020 2020 2073 7263 203d 2028           src = (
+00013d60: 776f 726b 7370 6163 6520 2f20 2274 6573  workspace / "tes
+00013d70: 742e 7079 2229 2e72 6573 6f6c 7665 2829  t.py").resolve()
+00013d80: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+00013d90: 2e77 7269 7465 5f74 6578 7428 2270 7269  .write_text("pri
+00013da0: 6e74 2827 6865 6c6c 6f27 2922 290a 2020  nt('hello')").  
+00013db0: 2020 2020 2020 2020 2020 696e 766f 6b65            invoke
+00013dc0: 426c 6163 6b28 5b73 7472 2873 7263 295d  Black([str(src)]
+00013dd0: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
+00013de0: 6368 6520 3d20 626c 6163 6b2e 7265 6164  che = black.read
+00013df0: 5f63 6163 6865 286d 6f64 6529 0a20 2020  _cache(mode).   
+00013e00: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00013e10: 7374 7228 7372 6329 2069 6e20 6361 6368  str(src) in cach
+00013e20: 650a 0a20 2020 2064 6566 2074 6573 745f  e..    def test_
+00013e30: 6361 6368 655f 7369 6e67 6c65 5f66 696c  cache_single_fil
+00013e40: 655f 616c 7265 6164 795f 6361 6368 6564  e_already_cached
+00013e50: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00013e60: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
+00013e70: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
+00013e80: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
+00013e90: 6972 2829 2061 7320 776f 726b 7370 6163  ir() as workspac
+00013ea0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00013eb0: 7263 203d 2028 776f 726b 7370 6163 6520  rc = (workspace 
+00013ec0: 2f20 2274 6573 742e 7079 2229 2e72 6573  / "test.py").res
+00013ed0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
+00013ee0: 2020 2073 7263 2e77 7269 7465 5f74 6578     src.write_tex
+00013ef0: 7428 2270 7269 6e74 2827 6865 6c6c 6f27  t("print('hello'
+00013f00: 2922 290a 2020 2020 2020 2020 2020 2020  )").            
+00013f10: 626c 6163 6b2e 7772 6974 655f 6361 6368  black.write_cach
+00013f20: 6528 7b7d 2c20 5b73 7263 5d2c 206d 6f64  e({}, [src], mod
+00013f30: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+00013f40: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
+00013f50: 7372 6329 5d29 0a20 2020 2020 2020 2020  src)]).         
+00013f60: 2020 2061 7373 6572 7420 7372 632e 7265     assert src.re
+00013f70: 6164 5f74 6578 7428 2920 3d3d 2022 7072  ad_text() == "pr
+00013f80: 696e 7428 2768 656c 6c6f 2729 220a 0a20  int('hello')".. 
+00013f90: 2020 2040 6576 656e 745f 6c6f 6f70 2829     @event_loop()
+00013fa0: 0a20 2020 2064 6566 2074 6573 745f 6361  .    def test_ca
+00013fb0: 6368 655f 6d75 6c74 6970 6c65 5f66 696c  che_multiple_fil
+00013fc0: 6573 2873 656c 6629 202d 3e20 4e6f 6e65  es(self) -> None
+00013fd0: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
+00013fe0: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
+00013ff0: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
+00014000: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
+00014010: 6163 652c 2070 6174 6368 280a 2020 2020  ace, patch(.    
+00014020: 2020 2020 2020 2020 2263 6f6e 6375 7272          "concurr
+00014030: 656e 742e 6675 7475 7265 732e 5072 6f63  ent.futures.Proc
+00014040: 6573 7350 6f6f 6c45 7865 6375 746f 7222  essPoolExecutor"
+00014050: 2c20 6e65 773d 5468 7265 6164 506f 6f6c  , new=ThreadPool
+00014060: 4578 6563 7574 6f72 0a20 2020 2020 2020  Executor.       
+00014070: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00014080: 6f6e 6520 3d20 2877 6f72 6b73 7061 6365  one = (workspace
+00014090: 202f 2022 6f6e 652e 7079 2229 2e72 6573   / "one.py").res
+000140a0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
+000140b0: 2020 2077 6974 6820 6f6e 652e 6f70 656e     with one.open
+000140c0: 2822 7722 2920 6173 2066 6f62 6a3a 0a20  ("w") as fobj:. 
+000140d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000140e0: 6f62 6a2e 7772 6974 6528 2270 7269 6e74  obj.write("print
+000140f0: 2827 6865 6c6c 6f27 2922 290a 2020 2020  ('hello')").    
+00014100: 2020 2020 2020 2020 7477 6f20 3d20 2877          two = (w
+00014110: 6f72 6b73 7061 6365 202f 2022 7477 6f2e  orkspace / "two.
+00014120: 7079 2229 2e72 6573 6f6c 7665 2829 0a20  py").resolve(). 
+00014130: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00014140: 7477 6f2e 6f70 656e 2822 7722 2920 6173  two.open("w") as
+00014150: 2066 6f62 6a3a 0a20 2020 2020 2020 2020   fobj:.         
+00014160: 2020 2020 2020 2066 6f62 6a2e 7772 6974         fobj.writ
+00014170: 6528 2270 7269 6e74 2827 6865 6c6c 6f27  e("print('hello'
+00014180: 2922 290a 2020 2020 2020 2020 2020 2020  )").            
+00014190: 626c 6163 6b2e 7772 6974 655f 6361 6368  black.write_cach
+000141a0: 6528 7b7d 2c20 5b6f 6e65 5d2c 206d 6f64  e({}, [one], mod
+000141b0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+000141c0: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
+000141d0: 776f 726b 7370 6163 6529 5d29 0a20 2020  workspace)]).   
+000141e0: 2020 2020 2020 2020 2077 6974 6820 6f6e           with on
+000141f0: 652e 6f70 656e 2822 7222 2920 6173 2066  e.open("r") as f
+00014200: 6f62 6a3a 0a20 2020 2020 2020 2020 2020  obj:.           
+00014210: 2020 2020 2061 7373 6572 7420 666f 626a       assert fobj
+00014220: 2e72 6561 6428 2920 3d3d 2022 7072 696e  .read() == "prin
+00014230: 7428 2768 656c 6c6f 2729 220a 2020 2020  t('hello')".    
+00014240: 2020 2020 2020 2020 7769 7468 2074 776f          with two
+00014250: 2e6f 7065 6e28 2272 2229 2061 7320 666f  .open("r") as fo
+00014260: 626a 3a0a 2020 2020 2020 2020 2020 2020  bj:.            
+00014270: 2020 2020 6173 7365 7274 2066 6f62 6a2e      assert fobj.
+00014280: 7265 6164 2829 203d 3d20 2770 7269 6e74  read() == 'print
+00014290: 2822 6865 6c6c 6f22 295c 6e27 0a20 2020  ("hello")\n'.   
+000142a0: 2020 2020 2020 2020 2063 6163 6865 203d           cache =
+000142b0: 2062 6c61 636b 2e72 6561 645f 6361 6368   black.read_cach
+000142c0: 6528 6d6f 6465 290a 2020 2020 2020 2020  e(mode).        
+000142d0: 2020 2020 6173 7365 7274 2073 7472 286f      assert str(o
+000142e0: 6e65 2920 696e 2063 6163 6865 0a20 2020  ne) in cache.   
+000142f0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00014300: 7374 7228 7477 6f29 2069 6e20 6361 6368  str(two) in cach
+00014310: 650a 0a20 2020 2040 7079 7465 7374 2e6d  e..    @pytest.m
+00014320: 6172 6b2e 7061 7261 6d65 7472 697a 6528  ark.parametrize(
+00014330: 2263 6f6c 6f72 222c 205b 4661 6c73 652c  "color", [False,
+00014340: 2054 7275 655d 2c20 6964 733d 5b22 6e6f   True], ids=["no
+00014350: 2d63 6f6c 6f72 222c 2022 7769 7468 2d63  -color", "with-c
+00014360: 6f6c 6f72 225d 290a 2020 2020 6465 6620  olor"]).    def 
+00014370: 7465 7374 5f6e 6f5f 6361 6368 655f 7768  test_no_cache_wh
+00014380: 656e 5f77 7269 7465 6261 636b 5f64 6966  en_writeback_dif
+00014390: 6628 7365 6c66 2c20 636f 6c6f 723a 2062  f(self, color: b
+000143a0: 6f6f 6c29 202d 3e20 4e6f 6e65 3a0a 2020  ool) -> None:.  
+000143b0: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
+000143c0: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
+000143d0: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
+000143e0: 2829 2061 7320 776f 726b 7370 6163 653a  () as workspace:
+000143f0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+00014400: 203d 2028 776f 726b 7370 6163 6520 2f20   = (workspace / 
+00014410: 2274 6573 742e 7079 2229 2e72 6573 6f6c  "test.py").resol
+00014420: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
+00014430: 2077 6974 6820 7372 632e 6f70 656e 2822   with src.open("
+00014440: 7722 2920 6173 2066 6f62 6a3a 0a20 2020  w") as fobj:.   
+00014450: 2020 2020 2020 2020 2020 2020 2066 6f62               fob
+00014460: 6a2e 7772 6974 6528 2270 7269 6e74 2827  j.write("print('
+00014470: 6865 6c6c 6f27 2922 290a 2020 2020 2020  hello')").      
+00014480: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
+00014490: 2822 626c 6163 6b2e 7265 6164 5f63 6163  ("black.read_cac
+000144a0: 6865 2229 2061 7320 7265 6164 5f63 6163  he") as read_cac
+000144b0: 6865 2c20 7061 7463 6828 0a20 2020 2020  he, patch(.     
+000144c0: 2020 2020 2020 2020 2020 2022 626c 6163             "blac
+000144d0: 6b2e 7772 6974 655f 6361 6368 6522 0a20  k.write_cache". 
+000144e0: 2020 2020 2020 2020 2020 2029 2061 7320             ) as 
+000144f0: 7772 6974 655f 6361 6368 653a 0a20 2020  write_cache:.   
+00014500: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
+00014510: 203d 205b 7374 7228 7372 6329 2c20 222d   = [str(src), "-
+00014520: 2d64 6966 6622 5d0a 2020 2020 2020 2020  -diff"].        
+00014530: 2020 2020 2020 2020 6966 2063 6f6c 6f72          if color
+00014540: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014550: 2020 2020 2020 636d 642e 6170 7065 6e64        cmd.append
+00014560: 2822 2d2d 636f 6c6f 7222 290a 2020 2020  ("--color").    
+00014570: 2020 2020 2020 2020 2020 2020 696e 766f              invo
+00014580: 6b65 426c 6163 6b28 636d 6429 0a20 2020  keBlack(cmd).   
+00014590: 2020 2020 2020 2020 2020 2020 2063 6163               cac
+000145a0: 6865 5f66 696c 6520 3d20 6765 745f 6361  he_file = get_ca
+000145b0: 6368 655f 6669 6c65 286d 6f64 6529 0a20  che_file(mode). 
+000145c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000145d0: 7373 6572 7420 6361 6368 655f 6669 6c65  ssert cache_file
+000145e0: 2e65 7869 7374 7328 2920 6973 2046 616c  .exists() is Fal
+000145f0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+00014600: 2020 2077 7269 7465 5f63 6163 6865 2e61     write_cache.a
+00014610: 7373 6572 745f 6e6f 745f 6361 6c6c 6564  ssert_not_called
+00014620: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00014630: 2020 2072 6561 645f 6361 6368 652e 6173     read_cache.as
+00014640: 7365 7274 5f6e 6f74 5f63 616c 6c65 6428  sert_not_called(
+00014650: 290a 0a20 2020 2040 7079 7465 7374 2e6d  )..    @pytest.m
+00014660: 6172 6b2e 7061 7261 6d65 7472 697a 6528  ark.parametrize(
+00014670: 2263 6f6c 6f72 222c 205b 4661 6c73 652c  "color", [False,
+00014680: 2054 7275 655d 2c20 6964 733d 5b22 6e6f   True], ids=["no
+00014690: 2d63 6f6c 6f72 222c 2022 7769 7468 2d63  -color", "with-c
+000146a0: 6f6c 6f72 225d 290a 2020 2020 4065 7665  olor"]).    @eve
+000146b0: 6e74 5f6c 6f6f 7028 290a 2020 2020 6465  nt_loop().    de
+000146c0: 6620 7465 7374 5f6f 7574 7075 745f 6c6f  f test_output_lo
+000146d0: 636b 696e 675f 7768 656e 5f77 7269 7465  cking_when_write
+000146e0: 6261 636b 5f64 6966 6628 7365 6c66 2c20  back_diff(self, 
+000146f0: 636f 6c6f 723a 2062 6f6f 6c29 202d 3e20  color: bool) -> 
+00014700: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
+00014710: 7468 2063 6163 6865 5f64 6972 2829 2061  th cache_dir() a
+00014720: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
+00014730: 2020 2020 2020 2020 2066 6f72 2074 6167           for tag
+00014740: 2069 6e20 7261 6e67 6528 302c 2034 293a   in range(0, 4):
+00014750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014760: 2073 7263 203d 2028 776f 726b 7370 6163   src = (workspac
+00014770: 6520 2f20 6622 7465 7374 7b74 6167 7d2e  e / f"test{tag}.
+00014780: 7079 2229 2e72 6573 6f6c 7665 2829 0a20  py").resolve(). 
+00014790: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+000147a0: 6974 6820 7372 632e 6f70 656e 2822 7722  ith src.open("w"
+000147b0: 2920 6173 2066 6f62 6a3a 0a20 2020 2020  ) as fobj:.     
+000147c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000147d0: 6f62 6a2e 7772 6974 6528 2270 7269 6e74  obj.write("print
+000147e0: 2827 6865 6c6c 6f27 2922 290a 2020 2020  ('hello')").    
+000147f0: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
+00014800: 6368 280a 2020 2020 2020 2020 2020 2020  ch(.            
+00014810: 2020 2020 2262 6c61 636b 2e63 6f6e 6375      "black.concu
+00014820: 7272 656e 6379 2e4d 616e 6167 6572 222c  rrency.Manager",
+00014830: 2077 7261 7073 3d6d 756c 7469 7072 6f63   wraps=multiproc
+00014840: 6573 7369 6e67 2e4d 616e 6167 6572 0a20  essing.Manager. 
+00014850: 2020 2020 2020 2020 2020 2029 2061 7320             ) as 
+00014860: 6d67 723a 0a20 2020 2020 2020 2020 2020  mgr:.           
+00014870: 2020 2020 2063 6d64 203d 205b 222d 2d64       cmd = ["--d
+00014880: 6966 6622 2c20 7374 7228 776f 726b 7370  iff", str(worksp
+00014890: 6163 6529 5d0a 2020 2020 2020 2020 2020  ace)].          
+000148a0: 2020 2020 2020 6966 2063 6f6c 6f72 3a0a        if color:.
+000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148c0: 2020 2020 636d 642e 6170 7065 6e64 2822      cmd.append("
+000148d0: 2d2d 636f 6c6f 7222 290a 2020 2020 2020  --color").      
+000148e0: 2020 2020 2020 2020 2020 696e 766f 6b65            invoke
+000148f0: 426c 6163 6b28 636d 642c 2065 7869 745f  Black(cmd, exit_
+00014900: 636f 6465 3d30 290a 2020 2020 2020 2020  code=0).        
+00014910: 2020 2020 2020 2020 2320 7468 6973 2069          # this i
+00014920: 736e 2774 2071 7569 7465 2064 6f69 6e67  sn't quite doing
+00014930: 2077 6861 7420 7765 2077 616e 742c 2062   what we want, b
+00014940: 7574 2069 6620 6974 205f 6973 6e27 745f  ut if it _isn't_
+00014950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014960: 2023 2063 616c 6c65 6420 7468 656e 2077   # called then w
+00014970: 6520 6361 6e6e 6f74 2062 6520 7573 696e  e cannot be usin
+00014980: 6720 7468 6520 6c6f 636b 2069 7420 7072  g the lock it pr
+00014990: 6f76 6964 6573 0a20 2020 2020 2020 2020  ovides.         
+000149a0: 2020 2020 2020 206d 6772 2e61 7373 6572         mgr.asser
+000149b0: 745f 6361 6c6c 6564 2829 0a0a 2020 2020  t_called()..    
+000149c0: 6465 6620 7465 7374 5f6e 6f5f 6361 6368  def test_no_cach
+000149d0: 655f 7768 656e 5f73 7464 696e 2873 656c  e_when_stdin(sel
+000149e0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+000149f0: 2020 2020 6d6f 6465 203d 2044 4546 4155      mode = DEFAU
+00014a00: 4c54 5f4d 4f44 450a 2020 2020 2020 2020  LT_MODE.        
+00014a10: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
+00014a20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00014a30: 7375 6c74 203d 2043 6c69 5275 6e6e 6572  sult = CliRunner
+00014a40: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
+00014a50: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+00014a60: 2e6d 6169 6e2c 205b 222d 225d 2c20 696e  .main, ["-"], in
+00014a70: 7075 743d 4279 7465 7349 4f28 6222 7072  put=BytesIO(b"pr
+00014a80: 696e 7428 2768 656c 6c6f 2729 2229 0a20  int('hello')"). 
+00014a90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00014aa0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00014ab0: 6e6f 7420 7265 7375 6c74 2e65 7869 745f  not result.exit_
+00014ac0: 636f 6465 0a20 2020 2020 2020 2020 2020  code.           
+00014ad0: 2063 6163 6865 5f66 696c 6520 3d20 6765   cache_file = ge
+00014ae0: 745f 6361 6368 655f 6669 6c65 286d 6f64  t_cache_file(mod
+00014af0: 6529 0a20 2020 2020 2020 2020 2020 2061  e).            a
+00014b00: 7373 6572 7420 6e6f 7420 6361 6368 655f  ssert not cache_
+00014b10: 6669 6c65 2e65 7869 7374 7328 290a 0a20  file.exists().. 
+00014b20: 2020 2064 6566 2074 6573 745f 7265 6164     def test_read
+00014b30: 5f63 6163 6865 5f6e 6f5f 6361 6368 6566  _cache_no_cachef
+00014b40: 696c 6528 7365 6c66 2920 2d3e 204e 6f6e  ile(self) -> Non
+00014b50: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
+00014b60: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
+00014b70: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
+00014b80: 655f 6469 7228 293a 0a20 2020 2020 2020  e_dir():.       
+00014b90: 2020 2020 2061 7373 6572 7420 626c 6163       assert blac
+00014ba0: 6b2e 7265 6164 5f63 6163 6865 286d 6f64  k.read_cache(mod
+00014bb0: 6529 203d 3d20 7b7d 0a0a 2020 2020 6465  e) == {}..    de
+00014bc0: 6620 7465 7374 5f77 7269 7465 5f63 6163  f test_write_cac
+00014bd0: 6865 5f72 6561 645f 6361 6368 6528 7365  he_read_cache(se
+00014be0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00014bf0: 2020 2020 206d 6f64 6520 3d20 4445 4641       mode = DEFA
+00014c00: 554c 545f 4d4f 4445 0a20 2020 2020 2020  ULT_MODE.       
+00014c10: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
+00014c20: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+00014c30: 2020 2020 2020 2020 2020 2020 7372 6320              src 
+00014c40: 3d20 2877 6f72 6b73 7061 6365 202f 2022  = (workspace / "
+00014c50: 7465 7374 2e70 7922 292e 7265 736f 6c76  test.py").resolv
+00014c60: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00014c70: 7372 632e 746f 7563 6828 290a 2020 2020  src.touch().    
+00014c80: 2020 2020 2020 2020 626c 6163 6b2e 7772          black.wr
+00014c90: 6974 655f 6361 6368 6528 7b7d 2c20 5b73  ite_cache({}, [s
+00014ca0: 7263 5d2c 206d 6f64 6529 0a20 2020 2020  rc], mode).     
+00014cb0: 2020 2020 2020 2063 6163 6865 203d 2062         cache = b
+00014cc0: 6c61 636b 2e72 6561 645f 6361 6368 6528  lack.read_cache(
+00014cd0: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
+00014ce0: 2020 6173 7365 7274 2073 7472 2873 7263    assert str(src
+00014cf0: 2920 696e 2063 6163 6865 0a20 2020 2020  ) in cache.     
+00014d00: 2020 2020 2020 2061 7373 6572 7420 6361         assert ca
+00014d10: 6368 655b 7374 7228 7372 6329 5d20 3d3d  che[str(src)] ==
+00014d20: 2062 6c61 636b 2e67 6574 5f63 6163 6865   black.get_cache
+00014d30: 5f69 6e66 6f28 7372 6329 0a0a 2020 2020  _info(src)..    
+00014d40: 6465 6620 7465 7374 5f66 696c 7465 725f  def test_filter_
+00014d50: 6361 6368 6564 2873 656c 6629 202d 3e20  cached(self) -> 
+00014d60: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
+00014d70: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
+00014d80: 6374 6f72 7928 2920 6173 2077 6f72 6b73  ctory() as works
+00014d90: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
+00014da0: 2020 7061 7468 203d 2050 6174 6828 776f    path = Path(wo
+00014db0: 726b 7370 6163 6529 0a20 2020 2020 2020  rkspace).       
+00014dc0: 2020 2020 2075 6e63 6163 6865 6420 3d20       uncached = 
+00014dd0: 2870 6174 6820 2f20 2275 6e63 6163 6865  (path / "uncache
+00014de0: 6422 292e 7265 736f 6c76 6528 290a 2020  d").resolve().  
+00014df0: 2020 2020 2020 2020 2020 6361 6368 6564            cached
+00014e00: 203d 2028 7061 7468 202f 2022 6361 6368   = (path / "cach
+00014e10: 6564 2229 2e72 6573 6f6c 7665 2829 0a20  ed").resolve(). 
+00014e20: 2020 2020 2020 2020 2020 2063 6163 6865             cache
+00014e30: 645f 6275 745f 6368 616e 6765 6420 3d20  d_but_changed = 
+00014e40: 2870 6174 6820 2f20 2263 6861 6e67 6564  (path / "changed
+00014e50: 2229 2e72 6573 6f6c 7665 2829 0a20 2020  ").resolve().   
+00014e60: 2020 2020 2020 2020 2075 6e63 6163 6865           uncache
+00014e70: 642e 746f 7563 6828 290a 2020 2020 2020  d.touch().      
+00014e80: 2020 2020 2020 6361 6368 6564 2e74 6f75        cached.tou
+00014e90: 6368 2829 0a20 2020 2020 2020 2020 2020  ch().           
+00014ea0: 2063 6163 6865 645f 6275 745f 6368 616e   cached_but_chan
+00014eb0: 6765 642e 746f 7563 6828 290a 2020 2020  ged.touch().    
+00014ec0: 2020 2020 2020 2020 6361 6368 6520 3d20          cache = 
+00014ed0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00014ee0: 2020 7374 7228 6361 6368 6564 293a 2062    str(cached): b
+00014ef0: 6c61 636b 2e67 6574 5f63 6163 6865 5f69  lack.get_cache_i
+00014f00: 6e66 6f28 6361 6368 6564 292c 0a20 2020  nfo(cached),.   
+00014f10: 2020 2020 2020 2020 2020 2020 2073 7472               str
+00014f20: 2863 6163 6865 645f 6275 745f 6368 616e  (cached_but_chan
+00014f30: 6765 6429 3a20 2830 2e30 2c20 3029 2c0a  ged): (0.0, 0),.
+00014f40: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+00014f50: 2020 2020 2020 2020 2020 746f 646f 2c20            todo, 
+00014f60: 646f 6e65 203d 2062 6c61 636b 2e63 6163  done = black.cac
+00014f70: 6865 2e66 696c 7465 725f 6361 6368 6564  he.filter_cached
+00014f80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00014f90: 2020 6361 6368 652c 207b 756e 6361 6368    cache, {uncach
+00014fa0: 6564 2c20 6361 6368 6564 2c20 6361 6368  ed, cached, cach
+00014fb0: 6564 5f62 7574 5f63 6861 6e67 6564 7d0a  ed_but_changed}.
+00014fc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00014fd0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00014fe0: 2074 6f64 6f20 3d3d 207b 756e 6361 6368   todo == {uncach
+00014ff0: 6564 2c20 6361 6368 6564 5f62 7574 5f63  ed, cached_but_c
+00015000: 6861 6e67 6564 7d0a 2020 2020 2020 2020  hanged}.        
+00015010: 2020 2020 6173 7365 7274 2064 6f6e 6520      assert done 
+00015020: 3d3d 207b 6361 6368 6564 7d0a 0a20 2020  == {cached}..   
+00015030: 2064 6566 2074 6573 745f 7772 6974 655f   def test_write_
+00015040: 6361 6368 655f 6372 6561 7465 735f 6469  cache_creates_di
+00015050: 7265 6374 6f72 795f 6966 5f6e 6565 6465  rectory_if_neede
+00015060: 6428 7365 6c66 2920 2d3e 204e 6f6e 653a  d(self) -> None:
+00015070: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
+00015080: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
+00015090: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+000150a0: 6469 7228 6578 6973 7473 3d46 616c 7365  dir(exists=False
+000150b0: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+000150c0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+000150d0: 7274 206e 6f74 2077 6f72 6b73 7061 6365  rt not workspace
+000150e0: 2e65 7869 7374 7328 290a 2020 2020 2020  .exists().      
+000150f0: 2020 2020 2020 626c 6163 6b2e 7772 6974        black.writ
+00015100: 655f 6361 6368 6528 7b7d 2c20 5b5d 2c20  e_cache({}, [], 
+00015110: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
+00015120: 2020 6173 7365 7274 2077 6f72 6b73 7061    assert workspa
+00015130: 6365 2e65 7869 7374 7328 290a 0a20 2020  ce.exists()..   
+00015140: 2040 6576 656e 745f 6c6f 6f70 2829 0a20   @event_loop(). 
+00015150: 2020 2064 6566 2074 6573 745f 6661 696c     def test_fail
+00015160: 6564 5f66 6f72 6d61 7474 696e 675f 646f  ed_formatting_do
+00015170: 6573 5f6e 6f74 5f67 6574 5f63 6163 6865  es_not_get_cache
+00015180: 6428 7365 6c66 2920 2d3e 204e 6f6e 653a  d(self) -> None:
+00015190: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
+000151a0: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
+000151b0: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+000151c0: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
+000151d0: 6365 2c20 7061 7463 6828 0a20 2020 2020  ce, patch(.     
+000151e0: 2020 2020 2020 2022 636f 6e63 7572 7265         "concurre
+000151f0: 6e74 2e66 7574 7572 6573 2e50 726f 6365  nt.futures.Proce
+00015200: 7373 506f 6f6c 4578 6563 7574 6f72 222c  ssPoolExecutor",
+00015210: 206e 6577 3d54 6872 6561 6450 6f6f 6c45   new=ThreadPoolE
+00015220: 7865 6375 746f 720a 2020 2020 2020 2020  xecutor.        
+00015230: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+00015240: 6169 6c69 6e67 203d 2028 776f 726b 7370  ailing = (worksp
+00015250: 6163 6520 2f20 2266 6169 6c69 6e67 2e70  ace / "failing.p
+00015260: 7922 292e 7265 736f 6c76 6528 290a 2020  y").resolve().  
+00015270: 2020 2020 2020 2020 2020 7769 7468 2066            with f
+00015280: 6169 6c69 6e67 2e6f 7065 6e28 2277 2229  ailing.open("w")
+00015290: 2061 7320 666f 626a 3a0a 2020 2020 2020   as fobj:.      
+000152a0: 2020 2020 2020 2020 2020 666f 626a 2e77            fobj.w
+000152b0: 7269 7465 2822 6e6f 7420 6163 7475 616c  rite("not actual
+000152c0: 6c79 2070 7974 686f 6e22 290a 2020 2020  ly python").    
+000152d0: 2020 2020 2020 2020 636c 6561 6e20 3d20          clean = 
+000152e0: 2877 6f72 6b73 7061 6365 202f 2022 636c  (workspace / "cl
+000152f0: 6561 6e2e 7079 2229 2e72 6573 6f6c 7665  ean.py").resolve
+00015300: 2829 0a20 2020 2020 2020 2020 2020 2077  ().            w
+00015310: 6974 6820 636c 6561 6e2e 6f70 656e 2822  ith clean.open("
+00015320: 7722 2920 6173 2066 6f62 6a3a 0a20 2020  w") as fobj:.   
+00015330: 2020 2020 2020 2020 2020 2020 2066 6f62               fob
+00015340: 6a2e 7772 6974 6528 2770 7269 6e74 2822  j.write('print("
+00015350: 6865 6c6c 6f22 295c 6e27 290a 2020 2020  hello")\n').    
+00015360: 2020 2020 2020 2020 696e 766f 6b65 426c          invokeBl
+00015370: 6163 6b28 5b73 7472 2877 6f72 6b73 7061  ack([str(workspa
+00015380: 6365 295d 2c20 6578 6974 5f63 6f64 653d  ce)], exit_code=
+00015390: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
+000153a0: 2063 6163 6865 203d 2062 6c61 636b 2e72   cache = black.r
+000153b0: 6561 645f 6361 6368 6528 6d6f 6465 290a  ead_cache(mode).
+000153c0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+000153d0: 7274 2073 7472 2866 6169 6c69 6e67 2920  rt str(failing) 
+000153e0: 6e6f 7420 696e 2063 6163 6865 0a20 2020  not in cache.   
+000153f0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00015400: 7374 7228 636c 6561 6e29 2069 6e20 6361  str(clean) in ca
+00015410: 6368 650a 0a20 2020 2064 6566 2074 6573  che..    def tes
+00015420: 745f 7772 6974 655f 6361 6368 655f 7772  t_write_cache_wr
+00015430: 6974 655f 6661 696c 2873 656c 6629 202d  ite_fail(self) -
+00015440: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00015450: 6d6f 6465 203d 2044 4546 4155 4c54 5f4d  mode = DEFAULT_M
+00015460: 4f44 450a 2020 2020 2020 2020 7769 7468  ODE.        with
+00015470: 2063 6163 6865 5f64 6972 2829 2c20 7061   cache_dir(), pa
+00015480: 7463 682e 6f62 6a65 6374 2850 6174 682c  tch.object(Path,
+00015490: 2022 6f70 656e 2229 2061 7320 6d6f 636b   "open") as mock
+000154a0: 3a0a 2020 2020 2020 2020 2020 2020 6d6f  :.            mo
+000154b0: 636b 2e73 6964 655f 6566 6665 6374 203d  ck.side_effect =
+000154c0: 204f 5345 7272 6f72 0a20 2020 2020 2020   OSError.       
+000154d0: 2020 2020 2062 6c61 636b 2e77 7269 7465       black.write
+000154e0: 5f63 6163 6865 287b 7d2c 205b 5d2c 206d  _cache({}, [], m
+000154f0: 6f64 6529 0a0a 2020 2020 6465 6620 7465  ode)..    def te
+00015500: 7374 5f72 6561 645f 6361 6368 655f 6c69  st_read_cache_li
+00015510: 6e65 5f6c 656e 6774 6873 2873 656c 6629  ne_lengths(self)
+00015520: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00015530: 2020 6d6f 6465 203d 2044 4546 4155 4c54    mode = DEFAULT
+00015540: 5f4d 4f44 450a 2020 2020 2020 2020 7368  _MODE.        sh
+00015550: 6f72 745f 6d6f 6465 203d 2072 6570 6c61  ort_mode = repla
+00015560: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
+00015570: 206c 696e 655f 6c65 6e67 7468 3d31 290a   line_length=1).
+00015580: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
+00015590: 6865 5f64 6972 2829 2061 7320 776f 726b  he_dir() as work
+000155a0: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
+000155b0: 2020 2070 6174 6820 3d20 2877 6f72 6b73     path = (works
+000155c0: 7061 6365 202f 2022 6669 6c65 2e70 7922  pace / "file.py"
+000155d0: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
+000155e0: 2020 2020 2020 2020 7061 7468 2e74 6f75          path.tou
+000155f0: 6368 2829 0a20 2020 2020 2020 2020 2020  ch().           
+00015600: 2062 6c61 636b 2e77 7269 7465 5f63 6163   black.write_cac
+00015610: 6865 287b 7d2c 205b 7061 7468 5d2c 206d  he({}, [path], m
+00015620: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
+00015630: 206f 6e65 203d 2062 6c61 636b 2e72 6561   one = black.rea
+00015640: 645f 6361 6368 6528 6d6f 6465 290a 2020  d_cache(mode).  
+00015650: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00015660: 2073 7472 2870 6174 6829 2069 6e20 6f6e   str(path) in on
+00015670: 650a 2020 2020 2020 2020 2020 2020 7477  e.            tw
+00015680: 6f20 3d20 626c 6163 6b2e 7265 6164 5f63  o = black.read_c
+00015690: 6163 6865 2873 686f 7274 5f6d 6f64 6529  ache(short_mode)
+000156a0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+000156b0: 6572 7420 7374 7228 7061 7468 2920 6e6f  ert str(path) no
+000156c0: 7420 696e 2074 776f 0a0a 0a64 6566 2061  t in two...def a
+000156d0: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
+000156e0: 736f 7572 6365 7328 0a20 2020 2073 7263  sources(.    src
+000156f0: 3a20 5365 7175 656e 6365 5b55 6e69 6f6e  : Sequence[Union
+00015700: 5b73 7472 2c20 5061 7468 5d5d 2c0a 2020  [str, Path]],.  
+00015710: 2020 6578 7065 6374 6564 3a20 5365 7175    expected: Sequ
+00015720: 656e 6365 5b55 6e69 6f6e 5b73 7472 2c20  ence[Union[str, 
+00015730: 5061 7468 5d5d 2c0a 2020 2020 2a2c 0a20  Path]],.    *,. 
+00015740: 2020 2063 7478 3a20 4f70 7469 6f6e 616c     ctx: Optional
+00015750: 5b46 616b 6543 6f6e 7465 7874 5d20 3d20  [FakeContext] = 
+00015760: 4e6f 6e65 2c0a 2020 2020 6578 636c 7564  None,.    exclud
+00015770: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
+00015780: 203d 204e 6f6e 652c 0a20 2020 2069 6e63   = None,.    inc
+00015790: 6c75 6465 3a20 4f70 7469 6f6e 616c 5b73  lude: Optional[s
+000157a0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+000157b0: 6578 7465 6e64 5f65 7863 6c75 6465 3a20  extend_exclude: 
+000157c0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+000157d0: 4e6f 6e65 2c0a 2020 2020 666f 7263 655f  None,.    force_
+000157e0: 6578 636c 7564 653a 204f 7074 696f 6e61  exclude: Optiona
+000157f0: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
+00015800: 2020 2073 7464 696e 5f66 696c 656e 616d     stdin_filenam
+00015810: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
+00015820: 203d 204e 6f6e 652c 0a29 202d 3e20 4e6f   = None,.) -> No
+00015830: 6e65 3a0a 2020 2020 6773 5f73 7263 203d  ne:.    gs_src =
+00015840: 2074 7570 6c65 2873 7472 2850 6174 6828   tuple(str(Path(
+00015850: 7329 2920 666f 7220 7320 696e 2073 7263  s)) for s in src
+00015860: 290a 2020 2020 6773 5f65 7870 6563 7465  ).    gs_expecte
+00015870: 6420 3d20 5b50 6174 6828 7329 2066 6f72  d = [Path(s) for
+00015880: 2073 2069 6e20 6578 7065 6374 6564 5d0a   s in expected].
+00015890: 2020 2020 6773 5f65 7863 6c75 6465 203d      gs_exclude =
+000158a0: 204e 6f6e 6520 6966 2065 7863 6c75 6465   None if exclude
+000158b0: 2069 7320 4e6f 6e65 2065 6c73 6520 636f   is None else co
+000158c0: 6d70 696c 655f 7061 7474 6572 6e28 6578  mpile_pattern(ex
+000158d0: 636c 7564 6529 0a20 2020 2067 735f 696e  clude).    gs_in
+000158e0: 636c 7564 6520 3d20 4445 4641 554c 545f  clude = DEFAULT_
+000158f0: 494e 434c 5544 4520 6966 2069 6e63 6c75  INCLUDE if inclu
+00015900: 6465 2069 7320 4e6f 6e65 2065 6c73 6520  de is None else 
+00015910: 636f 6d70 696c 655f 7061 7474 6572 6e28  compile_pattern(
+00015920: 696e 636c 7564 6529 0a20 2020 2067 735f  include).    gs_
+00015930: 6578 7465 6e64 5f65 7863 6c75 6465 203d  extend_exclude =
+00015940: 2028 0a20 2020 2020 2020 204e 6f6e 6520   (.        None 
+00015950: 6966 2065 7874 656e 645f 6578 636c 7564  if extend_exclud
+00015960: 6520 6973 204e 6f6e 6520 656c 7365 2063  e is None else c
+00015970: 6f6d 7069 6c65 5f70 6174 7465 726e 2865  ompile_pattern(e
+00015980: 7874 656e 645f 6578 636c 7564 6529 0a20  xtend_exclude). 
+00015990: 2020 2029 0a20 2020 2067 735f 666f 7263     ).    gs_forc
+000159a0: 655f 6578 636c 7564 6520 3d20 4e6f 6e65  e_exclude = None
+000159b0: 2069 6620 666f 7263 655f 6578 636c 7564   if force_exclud
+000159c0: 6520 6973 204e 6f6e 6520 656c 7365 2063  e is None else c
+000159d0: 6f6d 7069 6c65 5f70 6174 7465 726e 2866  ompile_pattern(f
+000159e0: 6f72 6365 5f65 7863 6c75 6465 290a 2020  orce_exclude).  
+000159f0: 2020 636f 6c6c 6563 7465 6420 3d20 626c    collected = bl
+00015a00: 6163 6b2e 6765 745f 736f 7572 6365 7328  ack.get_sources(
+00015a10: 0a20 2020 2020 2020 2063 7478 3d63 7478  .        ctx=ctx
+00015a20: 206f 7220 4661 6b65 436f 6e74 6578 7428   or FakeContext(
+00015a30: 292c 0a20 2020 2020 2020 2073 7263 3d67  ),.        src=g
+00015a40: 735f 7372 632c 0a20 2020 2020 2020 2071  s_src,.        q
+00015a50: 7569 6574 3d46 616c 7365 2c0a 2020 2020  uiet=False,.    
+00015a60: 2020 2020 7665 7262 6f73 653d 4661 6c73      verbose=Fals
+00015a70: 652c 0a20 2020 2020 2020 2069 6e63 6c75  e,.        inclu
+00015a80: 6465 3d67 735f 696e 636c 7564 652c 0a20  de=gs_include,. 
+00015a90: 2020 2020 2020 2065 7863 6c75 6465 3d67         exclude=g
+00015aa0: 735f 6578 636c 7564 652c 0a20 2020 2020  s_exclude,.     
+00015ab0: 2020 2065 7874 656e 645f 6578 636c 7564     extend_exclud
+00015ac0: 653d 6773 5f65 7874 656e 645f 6578 636c  e=gs_extend_excl
+00015ad0: 7564 652c 0a20 2020 2020 2020 2066 6f72  ude,.        for
+00015ae0: 6365 5f65 7863 6c75 6465 3d67 735f 666f  ce_exclude=gs_fo
+00015af0: 7263 655f 6578 636c 7564 652c 0a20 2020  rce_exclude,.   
+00015b00: 2020 2020 2072 6570 6f72 743d 626c 6163       report=blac
+00015b10: 6b2e 5265 706f 7274 2829 2c0a 2020 2020  k.Report(),.    
+00015b20: 2020 2020 7374 6469 6e5f 6669 6c65 6e61      stdin_filena
+00015b30: 6d65 3d73 7464 696e 5f66 696c 656e 616d  me=stdin_filenam
+00015b40: 652c 0a20 2020 2029 0a20 2020 2061 7373  e,.    ).    ass
+00015b50: 6572 7420 736f 7274 6564 2863 6f6c 6c65  ert sorted(colle
+00015b60: 6374 6564 2920 3d3d 2073 6f72 7465 6428  cted) == sorted(
+00015b70: 6773 5f65 7870 6563 7465 6429 0a0a 0a63  gs_expected)...c
+00015b80: 6c61 7373 2054 6573 7446 696c 6543 6f6c  lass TestFileCol
+00015b90: 6c65 6374 696f 6e3a 0a20 2020 2064 6566  lection:.    def
+00015ba0: 2074 6573 745f 696e 636c 7564 655f 6578   test_include_ex
+00015bb0: 636c 7564 6528 7365 6c66 2920 2d3e 204e  clude(self) -> N
+00015bc0: 6f6e 653a 0a20 2020 2020 2020 2070 6174  one:.        pat
+00015bd0: 6820 3d20 5448 4953 5f44 4952 202f 2022  h = THIS_DIR / "
+00015be0: 6461 7461 2220 2f20 2269 6e63 6c75 6465  data" / "include
+00015bf0: 5f65 7863 6c75 6465 5f74 6573 7473 220a  _exclude_tests".
+00015c00: 2020 2020 2020 2020 7372 6320 3d20 5b70          src = [p
+00015c10: 6174 685d 0a20 2020 2020 2020 2065 7870  ath].        exp
+00015c20: 6563 7465 6420 3d20 5b0a 2020 2020 2020  ected = [.      
+00015c30: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
+00015c40: 2f20 2262 2f64 6f6e 745f 6578 636c 7564  / "b/dont_exclud
+00015c50: 652f 612e 7079 2229 2c0a 2020 2020 2020  e/a.py"),.      
+00015c60: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
+00015c70: 2f20 2262 2f64 6f6e 745f 6578 636c 7564  / "b/dont_exclud
+00015c80: 652f 612e 7079 6922 292c 0a20 2020 2020  e/a.pyi"),.     
+00015c90: 2020 205d 0a20 2020 2020 2020 2061 7373     ].        ass
+00015ca0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+00015cb0: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
+00015cc0: 2020 2073 7263 2c0a 2020 2020 2020 2020     src,.        
+00015cd0: 2020 2020 6578 7065 6374 6564 2c0a 2020      expected,.  
+00015ce0: 2020 2020 2020 2020 2020 696e 636c 7564            includ
+00015cf0: 653d 7222 5c2e 7079 693f 2422 2c0a 2020  e=r"\.pyi?$",.  
+00015d00: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00015d10: 653d 7222 2f65 7863 6c75 6465 2f7c 2f5c  e=r"/exclude/|/\
+00015d20: 2e64 6566 696e 6974 656c 795f 6578 636c  .definitely_excl
+00015d30: 7564 652f 222c 0a20 2020 2020 2020 2029  ude/",.        )
+00015d40: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
+00015d50: 6974 6967 6e6f 7265 5f75 7365 645f 6173  itignore_used_as
+00015d60: 5f64 6566 6175 6c74 2873 656c 6629 202d  _default(self) -
+00015d70: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00015d80: 6261 7365 203d 2050 6174 6828 4441 5441  base = Path(DATA
+00015d90: 5f44 4952 202f 2022 696e 636c 7564 655f  _DIR / "include_
+00015da0: 6578 636c 7564 655f 7465 7374 7322 290a  exclude_tests").
+00015db0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+00015dc0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00015dd0: 2062 6173 6520 2f20 2262 2f2e 6465 6669   base / "b/.defi
+00015de0: 6e69 7465 6c79 5f65 7863 6c75 6465 2f61  nitely_exclude/a
+00015df0: 2e70 7922 2c0a 2020 2020 2020 2020 2020  .py",.          
+00015e00: 2020 6261 7365 202f 2022 622f 2e64 6566    base / "b/.def
+00015e10: 696e 6974 656c 795f 6578 636c 7564 652f  initely_exclude/
+00015e20: 612e 7079 6922 2c0a 2020 2020 2020 2020  a.pyi",.        
+00015e30: 5d0a 2020 2020 2020 2020 7372 6320 3d20  ].        src = 
+00015e40: 5b62 6173 6520 2f20 2262 2f22 5d0a 2020  [base / "b/"].  
+00015e50: 2020 2020 2020 6374 7820 3d20 4661 6b65        ctx = Fake
+00015e60: 436f 6e74 6578 7428 290a 2020 2020 2020  Context().      
+00015e70: 2020 6374 782e 6f62 6a5b 2272 6f6f 7422    ctx.obj["root"
+00015e80: 5d20 3d20 6261 7365 0a20 2020 2020 2020  ] = base.       
+00015e90: 2061 7373 6572 745f 636f 6c6c 6563 7465   assert_collecte
+00015ea0: 645f 736f 7572 6365 7328 7372 632c 2065  d_sources(src, e
+00015eb0: 7870 6563 7465 642c 2063 7478 3d63 7478  xpected, ctx=ctx
+00015ec0: 2c20 6578 7465 6e64 5f65 7863 6c75 6465  , extend_exclude
+00015ed0: 3d72 222f 6578 636c 7564 652f 2229 0a0a  =r"/exclude/")..
+00015ee0: 2020 2020 6465 6620 7465 7374 5f67 6974      def test_git
+00015ef0: 6967 6e6f 7265 5f75 7365 645f 6f6e 5f6d  ignore_used_on_m
+00015f00: 756c 7469 706c 655f 736f 7572 6365 7328  ultiple_sources(
+00015f10: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00015f20: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
+00015f30: 7468 2844 4154 415f 4449 5220 2f20 2267  th(DATA_DIR / "g
+00015f40: 6974 6967 6e6f 7265 5f75 7365 645f 6f6e  itignore_used_on
+00015f50: 5f6d 756c 7469 706c 655f 736f 7572 6365  _multiple_source
+00015f60: 7322 290a 2020 2020 2020 2020 6578 7065  s").        expe
+00015f70: 6374 6564 203d 205b 0a20 2020 2020 2020  cted = [.       
+00015f80: 2020 2020 2072 6f6f 7420 2f20 2264 6972       root / "dir
+00015f90: 3122 202f 2022 622e 7079 222c 0a20 2020  1" / "b.py",.   
+00015fa0: 2020 2020 2020 2020 2072 6f6f 7420 2f20           root / 
+00015fb0: 2264 6972 3222 202f 2022 622e 7079 222c  "dir2" / "b.py",
+00015fc0: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+00015fd0: 2020 2063 7478 203d 2046 616b 6543 6f6e     ctx = FakeCon
+00015fe0: 7465 7874 2829 0a20 2020 2020 2020 2063  text().        c
+00015ff0: 7478 2e6f 626a 5b22 726f 6f74 225d 203d  tx.obj["root"] =
+00016000: 2072 6f6f 740a 2020 2020 2020 2020 7372   root.        sr
+00016010: 6320 3d20 5b72 6f6f 7420 2f20 2264 6972  c = [root / "dir
+00016020: 3122 2c20 726f 6f74 202f 2022 6469 7232  1", root / "dir2
+00016030: 225d 0a20 2020 2020 2020 2061 7373 6572  "].        asser
+00016040: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
+00016050: 6365 7328 7372 632c 2065 7870 6563 7465  ces(src, expecte
+00016060: 642c 2063 7478 3d63 7478 290a 0a20 2020  d, ctx=ctx)..   
+00016070: 2040 7061 7463 6828 2262 6c61 636b 2e66   @patch("black.f
+00016080: 696e 645f 7072 6f6a 6563 745f 726f 6f74  ind_project_root
+00016090: 222c 206c 616d 6264 6120 2a61 7267 733a  ", lambda *args:
+000160a0: 2028 5448 4953 5f44 4952 2e72 6573 6f6c   (THIS_DIR.resol
+000160b0: 7665 2829 2c20 4e6f 6e65 2929 0a20 2020  ve(), None)).   
+000160c0: 2064 6566 2074 6573 745f 6578 636c 7564   def test_exclud
+000160d0: 655f 666f 725f 6973 7375 655f 3135 3732  e_for_issue_1572
+000160e0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000160f0: 2020 2020 2020 2020 2320 4578 636c 7564          # Exclud
+00016100: 6520 7368 6f75 6c64 6e27 7420 746f 7563  e shouldn't touc
+00016110: 6820 6669 6c65 7320 7468 6174 2077 6572  h files that wer
+00016120: 6520 6578 706c 6963 6974 6c79 2067 6976  e explicitly giv
+00016130: 656e 2074 6f20 426c 6163 6b20 7468 726f  en to Black thro
+00016140: 7567 6820 7468 650a 2020 2020 2020 2020  ugh the.        
+00016150: 2320 434c 492e 2045 7863 6c75 6465 2069  # CLI. Exclude i
+00016160: 7320 7375 7070 6f73 6564 2074 6f20 6f6e  s supposed to on
+00016170: 6c79 2061 7070 6c79 2074 6f20 7468 6520  ly apply to the 
+00016180: 7265 6375 7273 6976 6520 6469 7363 6f76  recursive discov
+00016190: 6572 7920 6f66 2066 696c 6573 2e0a 2020  ery of files..  
+000161a0: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+000161b0: 6769 7468 7562 2e63 6f6d 2f70 7366 2f62  github.com/psf/b
+000161c0: 6c61 636b 2f69 7373 7565 732f 3135 3732  lack/issues/1572
+000161d0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+000161e0: 4441 5441 5f44 4952 202f 2022 696e 636c  DATA_DIR / "incl
+000161f0: 7564 655f 6578 636c 7564 655f 7465 7374  ude_exclude_test
+00016200: 7322 0a20 2020 2020 2020 2073 7263 203d  s".        src =
+00016210: 205b 7061 7468 202f 2022 622f 6578 636c   [path / "b/excl
+00016220: 7564 652f 612e 7079 225d 0a20 2020 2020  ude/a.py"].     
+00016230: 2020 2065 7870 6563 7465 6420 3d20 5b70     expected = [p
+00016240: 6174 6820 2f20 2262 2f65 7863 6c75 6465  ath / "b/exclude
+00016250: 2f61 2e70 7922 5d0a 2020 2020 2020 2020  /a.py"].        
+00016260: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
+00016270: 5f73 6f75 7263 6573 2873 7263 2c20 6578  _sources(src, ex
+00016280: 7065 6374 6564 2c20 696e 636c 7564 653d  pected, include=
+00016290: 2222 2c20 6578 636c 7564 653d 7222 2f65  "", exclude=r"/e
+000162a0: 7863 6c75 6465 2f7c 615c 2e70 7922 290a  xclude/|a\.py").
+000162b0: 0a20 2020 2064 6566 2074 6573 745f 6769  .    def test_gi
+000162c0: 7469 676e 6f72 655f 6578 636c 7564 6528  tignore_exclude(
+000162d0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000162e0: 2020 2020 2020 2070 6174 6820 3d20 5448         path = TH
+000162f0: 4953 5f44 4952 202f 2022 6461 7461 2220  IS_DIR / "data" 
+00016300: 2f20 2269 6e63 6c75 6465 5f65 7863 6c75  / "include_exclu
+00016310: 6465 5f74 6573 7473 220a 2020 2020 2020  de_tests".      
+00016320: 2020 696e 636c 7564 6520 3d20 7265 2e63    include = re.c
+00016330: 6f6d 7069 6c65 2872 225c 2e70 7969 3f24  ompile(r"\.pyi?$
+00016340: 2229 0a20 2020 2020 2020 2065 7863 6c75  ").        exclu
+00016350: 6465 203d 2072 652e 636f 6d70 696c 6528  de = re.compile(
+00016360: 7222 2229 0a20 2020 2020 2020 2072 6570  r"").        rep
+00016370: 6f72 7420 3d20 626c 6163 6b2e 5265 706f  ort = black.Repo
+00016380: 7274 2829 0a20 2020 2020 2020 2067 6974  rt().        git
+00016390: 6967 6e6f 7265 203d 2050 6174 6853 7065  ignore = PathSpe
+000163a0: 632e 6672 6f6d 5f6c 696e 6573 280a 2020  c.from_lines(.  
+000163b0: 2020 2020 2020 2020 2020 2267 6974 7769            "gitwi
+000163c0: 6c64 6d61 7463 6822 2c20 5b22 6578 636c  ldmatch", ["excl
+000163d0: 7564 652f 222c 2022 2e64 6566 696e 6974  ude/", ".definit
+000163e0: 656c 795f 6578 636c 7564 6522 5d0a 2020  ely_exclude"].  
+000163f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00016400: 736f 7572 6365 733a 204c 6973 745b 5061  sources: List[Pa
+00016410: 7468 5d20 3d20 5b5d 0a20 2020 2020 2020  th] = [].       
+00016420: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
+00016430: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
+00016440: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
+00016450: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
+00016460: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
+00016470: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
+00016480: 636c 7564 652f 612e 7079 6922 292c 0a20  clude/a.pyi"),. 
+00016490: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+000164a0: 2074 6869 735f 6162 7320 3d20 5448 4953   this_abs = THIS
+000164b0: 5f44 4952 2e72 6573 6f6c 7665 2829 0a20  _DIR.resolve(). 
+000164c0: 2020 2020 2020 2073 6f75 7263 6573 2e65         sources.e
+000164d0: 7874 656e 6428 0a20 2020 2020 2020 2020  xtend(.         
+000164e0: 2020 2062 6c61 636b 2e67 656e 5f70 7974     black.gen_pyt
+000164f0: 686f 6e5f 6669 6c65 7328 0a20 2020 2020  hon_files(.     
+00016500: 2020 2020 2020 2020 2020 2070 6174 682e             path.
+00016510: 6974 6572 6469 7228 292c 0a20 2020 2020  iterdir(),.     
+00016520: 2020 2020 2020 2020 2020 2074 6869 735f             this_
+00016530: 6162 732c 0a20 2020 2020 2020 2020 2020  abs,.           
+00016540: 2020 2020 2069 6e63 6c75 6465 2c0a 2020       include,.  
+00016550: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00016560: 636c 7564 652c 0a20 2020 2020 2020 2020  clude,.         
+00016570: 2020 2020 2020 204e 6f6e 652c 0a20 2020         None,.   
+00016580: 2020 2020 2020 2020 2020 2020 204e 6f6e               Non
+00016590: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+000165a0: 2020 2072 6570 6f72 742c 0a20 2020 2020     report,.     
+000165b0: 2020 2020 2020 2020 2020 207b 7061 7468             {path
+000165c0: 3a20 6769 7469 676e 6f72 657d 2c0a 2020  : gitignore},.  
+000165d0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+000165e0: 7262 6f73 653d 4661 6c73 652c 0a20 2020  rbose=False,.   
+000165f0: 2020 2020 2020 2020 2020 2020 2071 7569               qui
+00016600: 6574 3d46 616c 7365 2c0a 2020 2020 2020  et=False,.      
+00016610: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00016620: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+00016630: 2073 6f72 7465 6428 6578 7065 6374 6564   sorted(expected
+00016640: 2920 3d3d 2073 6f72 7465 6428 736f 7572  ) == sorted(sour
+00016650: 6365 7329 0a0a 2020 2020 6465 6620 7465  ces)..    def te
+00016660: 7374 5f6e 6573 7465 645f 6769 7469 676e  st_nested_gitign
+00016670: 6f72 6528 7365 6c66 2920 2d3e 204e 6f6e  ore(self) -> Non
+00016680: 653a 0a20 2020 2020 2020 2070 6174 6820  e:.        path 
+00016690: 3d20 5061 7468 2854 4849 535f 4449 5220  = Path(THIS_DIR 
+000166a0: 2f20 2264 6174 6122 202f 2022 6e65 7374  / "data" / "nest
+000166b0: 6564 5f67 6974 6967 6e6f 7265 5f74 6573  ed_gitignore_tes
+000166c0: 7473 2229 0a20 2020 2020 2020 2069 6e63  ts").        inc
+000166d0: 6c75 6465 203d 2072 652e 636f 6d70 696c  lude = re.compil
+000166e0: 6528 7222 5c2e 7079 693f 2422 290a 2020  e(r"\.pyi?$").  
+000166f0: 2020 2020 2020 6578 636c 7564 6520 3d20        exclude = 
+00016700: 7265 2e63 6f6d 7069 6c65 2872 2222 290a  re.compile(r"").
+00016710: 2020 2020 2020 2020 726f 6f74 5f67 6974          root_git
+00016720: 6967 6e6f 7265 203d 2062 6c61 636b 2e66  ignore = black.f
+00016730: 696c 6573 2e67 6574 5f67 6974 6967 6e6f  iles.get_gitigno
+00016740: 7265 2870 6174 6829 0a20 2020 2020 2020  re(path).       
+00016750: 2072 6570 6f72 7420 3d20 626c 6163 6b2e   report = black.
+00016760: 5265 706f 7274 2829 0a20 2020 2020 2020  Report().       
+00016770: 2065 7870 6563 7465 643a 204c 6973 745b   expected: List[
+00016780: 5061 7468 5d20 3d20 5b0a 2020 2020 2020  Path] = [.      
+00016790: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
+000167a0: 2f20 2278 2e70 7922 292c 0a20 2020 2020  / "x.py"),.     
+000167b0: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
+000167c0: 202f 2022 726f 6f74 2f62 2e70 7922 292c   / "root/b.py"),
+000167d0: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
+000167e0: 6828 7061 7468 202f 2022 726f 6f74 2f63  h(path / "root/c
+000167f0: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
+00016800: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
+00016810: 726f 6f74 2f63 6869 6c64 2f63 2e70 7922  root/child/c.py"
+00016820: 292c 0a20 2020 2020 2020 205d 0a20 2020  ),.        ].   
+00016830: 2020 2020 2074 6869 735f 6162 7320 3d20       this_abs = 
+00016840: 5448 4953 5f44 4952 2e72 6573 6f6c 7665  THIS_DIR.resolve
+00016850: 2829 0a20 2020 2020 2020 2073 6f75 7263  ().        sourc
+00016860: 6573 203d 206c 6973 7428 0a20 2020 2020  es = list(.     
+00016870: 2020 2020 2020 2062 6c61 636b 2e67 656e         black.gen
+00016880: 5f70 7974 686f 6e5f 6669 6c65 7328 0a20  _python_files(. 
+00016890: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000168a0: 6174 682e 6974 6572 6469 7228 292c 0a20  ath.iterdir(),. 
+000168b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000168c0: 6869 735f 6162 732c 0a20 2020 2020 2020  his_abs,.       
+000168d0: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+000168e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000168f0: 2020 6578 636c 7564 652c 0a20 2020 2020    exclude,.     
+00016900: 2020 2020 2020 2020 2020 204e 6f6e 652c             None,
+00016910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016920: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00016930: 2020 2020 2020 2072 6570 6f72 742c 0a20         report,. 
+00016940: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+00016950: 7061 7468 3a20 726f 6f74 5f67 6974 6967  path: root_gitig
+00016960: 6e6f 7265 7d2c 0a20 2020 2020 2020 2020  nore},.         
+00016970: 2020 2020 2020 2076 6572 626f 7365 3d46         verbose=F
+00016980: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00016990: 2020 2020 2020 7175 6965 743d 4661 6c73        quiet=Fals
+000169a0: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
+000169b0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+000169c0: 2020 2061 7373 6572 7420 736f 7274 6564     assert sorted
+000169d0: 2865 7870 6563 7465 6429 203d 3d20 736f  (expected) == so
+000169e0: 7274 6564 2873 6f75 7263 6573 290a 0a20  rted(sources).. 
+000169f0: 2020 2064 6566 2074 6573 745f 6e65 7374     def test_nest
+00016a00: 6564 5f67 6974 6967 6e6f 7265 5f64 6972  ed_gitignore_dir
+00016a10: 6563 746c 795f 696e 5f73 6f75 7263 655f  ectly_in_source_
+00016a20: 6469 7265 6374 6f72 7928 7365 6c66 2920  directory(self) 
+00016a30: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00016a40: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
+00016a50: 622e 636f 6d2f 7073 662f 626c 6163 6b2f  b.com/psf/black/
+00016a60: 6973 7375 6573 2f32 3539 380a 2020 2020  issues/2598.    
+00016a70: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
+00016a80: 4441 5441 5f44 4952 202f 2022 6e65 7374  DATA_DIR / "nest
+00016a90: 6564 5f67 6974 6967 6e6f 7265 5f74 6573  ed_gitignore_tes
+00016aa0: 7473 2229 0a20 2020 2020 2020 2073 7263  ts").        src
+00016ab0: 203d 2050 6174 6828 7061 7468 202f 2022   = Path(path / "
+00016ac0: 726f 6f74 2220 2f20 2263 6869 6c64 2229  root" / "child")
+00016ad0: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
+00016ae0: 6420 3d20 5b73 7263 202f 2022 612e 7079  d = [src / "a.py
+00016af0: 222c 2073 7263 202f 2022 632e 7079 225d  ", src / "c.py"]
+00016b00: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
+00016b10: 636f 6c6c 6563 7465 645f 736f 7572 6365  collected_source
+00016b20: 7328 5b73 7263 5d2c 2065 7870 6563 7465  s([src], expecte
+00016b30: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
+00016b40: 5f69 6e76 616c 6964 5f67 6974 6967 6e6f  _invalid_gitigno
+00016b50: 7265 2873 656c 6629 202d 3e20 4e6f 6e65  re(self) -> None
+00016b60: 3a0a 2020 2020 2020 2020 7061 7468 203d  :.        path =
+00016b70: 2054 4849 535f 4449 5220 2f20 2264 6174   THIS_DIR / "dat
+00016b80: 6122 202f 2022 696e 7661 6c69 645f 6769  a" / "invalid_gi
+00016b90: 7469 676e 6f72 655f 7465 7374 7322 0a20  tignore_tests". 
+00016ba0: 2020 2020 2020 2065 6d70 7479 5f63 6f6e         empty_con
+00016bb0: 6669 6720 3d20 7061 7468 202f 2022 7079  fig = path / "py
+00016bc0: 7072 6f6a 6563 742e 746f 6d6c 220a 2020  project.toml".  
+00016bd0: 2020 2020 2020 7265 7375 6c74 203d 2042        result = B
+00016be0: 6c61 636b 5275 6e6e 6572 2829 2e69 6e76  lackRunner().inv
+00016bf0: 6f6b 6528 0a20 2020 2020 2020 2020 2020  oke(.           
+00016c00: 2062 6c61 636b 2e6d 6169 6e2c 205b 222d   black.main, ["-
+00016c10: 2d76 6572 626f 7365 222c 2022 2d2d 636f  -verbose", "--co
+00016c20: 6e66 6967 222c 2073 7472 2865 6d70 7479  nfig", str(empty
+00016c30: 5f63 6f6e 6669 6729 2c20 7374 7228 7061  _config), str(pa
+00016c40: 7468 295d 0a20 2020 2020 2020 2029 0a20  th)].        ). 
+00016c50: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
+00016c60: 7375 6c74 2e65 7869 745f 636f 6465 203d  sult.exit_code =
+00016c70: 3d20 310a 2020 2020 2020 2020 6173 7365  = 1.        asse
+00016c80: 7274 2072 6573 756c 742e 7374 6465 7272  rt result.stderr
+00016c90: 5f62 7974 6573 2069 7320 6e6f 7420 4e6f  _bytes is not No
+00016ca0: 6e65 0a0a 2020 2020 2020 2020 6769 7469  ne..        giti
+00016cb0: 676e 6f72 6520 3d20 7061 7468 202f 2022  gnore = path / "
+00016cc0: 2e67 6974 6967 6e6f 7265 220a 2020 2020  .gitignore".    
+00016cd0: 2020 2020 6173 7365 7274 2066 2243 6f75      assert f"Cou
+00016ce0: 6c64 206e 6f74 2070 6172 7365 207b 6769  ld not parse {gi
+00016cf0: 7469 676e 6f72 657d 2220 696e 2072 6573  tignore}" in res
+00016d00: 756c 742e 7374 6465 7272 5f62 7974 6573  ult.stderr_bytes
+00016d10: 2e64 6563 6f64 6528 290a 0a20 2020 2064  .decode()..    d
+00016d20: 6566 2074 6573 745f 696e 7661 6c69 645f  ef test_invalid_
+00016d30: 6e65 7374 6564 5f67 6974 6967 6e6f 7265  nested_gitignore
+00016d40: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00016d50: 2020 2020 2020 2020 7061 7468 203d 2054          path = T
+00016d60: 4849 535f 4449 5220 2f20 2264 6174 6122  HIS_DIR / "data"
+00016d70: 202f 2022 696e 7661 6c69 645f 6e65 7374   / "invalid_nest
+00016d80: 6564 5f67 6974 6967 6e6f 7265 5f74 6573  ed_gitignore_tes
+00016d90: 7473 220a 2020 2020 2020 2020 656d 7074  ts".        empt
+00016da0: 795f 636f 6e66 6967 203d 2070 6174 6820  y_config = path 
+00016db0: 2f20 2270 7970 726f 6a65 6374 2e74 6f6d  / "pyproject.tom
+00016dc0: 6c22 0a20 2020 2020 2020 2072 6573 756c  l".        resul
+00016dd0: 7420 3d20 426c 6163 6b52 756e 6e65 7228  t = BlackRunner(
+00016de0: 292e 696e 766f 6b65 280a 2020 2020 2020  ).invoke(.      
+00016df0: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
+00016e00: 2c20 5b22 2d2d 7665 7262 6f73 6522 2c20  , ["--verbose", 
+00016e10: 222d 2d63 6f6e 6669 6722 2c20 7374 7228  "--config", str(
+00016e20: 656d 7074 795f 636f 6e66 6967 292c 2073  empty_config), s
+00016e30: 7472 2870 6174 6829 5d0a 2020 2020 2020  tr(path)].      
+00016e40: 2020 290a 2020 2020 2020 2020 6173 7365    ).        asse
+00016e50: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
+00016e60: 6f64 6520 3d3d 2031 0a20 2020 2020 2020  ode == 1.       
+00016e70: 2061 7373 6572 7420 7265 7375 6c74 2e73   assert result.s
+00016e80: 7464 6572 725f 6279 7465 7320 6973 206e  tderr_bytes is n
+00016e90: 6f74 204e 6f6e 650a 0a20 2020 2020 2020  ot None..       
+00016ea0: 2067 6974 6967 6e6f 7265 203d 2070 6174   gitignore = pat
+00016eb0: 6820 2f20 2261 2220 2f20 222e 6769 7469  h / "a" / ".giti
+00016ec0: 676e 6f72 6522 0a20 2020 2020 2020 2061  gnore".        a
+00016ed0: 7373 6572 7420 6622 436f 756c 6420 6e6f  ssert f"Could no
+00016ee0: 7420 7061 7273 6520 7b67 6974 6967 6e6f  t parse {gitigno
+00016ef0: 7265 7d22 2069 6e20 7265 7375 6c74 2e73  re}" in result.s
+00016f00: 7464 6572 725f 6279 7465 732e 6465 636f  tderr_bytes.deco
+00016f10: 6465 2829 0a0a 2020 2020 6465 6620 7465  de()..    def te
+00016f20: 7374 5f67 6974 6967 6e6f 7265 5f74 6861  st_gitignore_tha
+00016f30: 745f 6967 6e6f 7265 735f 7375 6266 6f6c  t_ignores_subfol
+00016f40: 6465 7273 2873 656c 6629 202d 3e20 4e6f  ders(self) -> No
+00016f50: 6e65 3a0a 2020 2020 2020 2020 2320 4966  ne:.        # If
+00016f60: 2067 6974 6967 6e6f 7265 2077 6974 6820   gitignore with 
+00016f70: 2a2f 2a20 6973 2069 6e20 726f 6f74 0a20  */* is in root. 
+00016f80: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
+00016f90: 7468 2844 4154 415f 4449 5220 2f20 2269  th(DATA_DIR / "i
+00016fa0: 676e 6f72 655f 7375 6266 6f6c 6465 7273  gnore_subfolders
+00016fb0: 5f67 6974 6967 6e6f 7265 5f74 6573 7473  _gitignore_tests
+00016fc0: 2220 2f20 2273 7562 6469 7222 290a 2020  " / "subdir").  
+00016fd0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+00016fe0: 205b 726f 6f74 202f 2022 622e 7079 225d   [root / "b.py"]
+00016ff0: 0a20 2020 2020 2020 2063 7478 203d 2046  .        ctx = F
+00017000: 616b 6543 6f6e 7465 7874 2829 0a20 2020  akeContext().   
+00017010: 2020 2020 2063 7478 2e6f 626a 5b22 726f       ctx.obj["ro
+00017020: 6f74 225d 203d 2072 6f6f 740a 2020 2020  ot"] = root.    
+00017030: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
+00017040: 6374 6564 5f73 6f75 7263 6573 285b 726f  cted_sources([ro
+00017050: 6f74 5d2c 2065 7870 6563 7465 642c 2063  ot], expected, c
+00017060: 7478 3d63 7478 290a 0a20 2020 2020 2020  tx=ctx)..       
+00017070: 2023 2049 6620 2e67 6974 6967 6e6f 7265   # If .gitignore
+00017080: 2077 6974 6820 2a2f 2a20 6973 206e 6573   with */* is nes
+00017090: 7465 640a 2020 2020 2020 2020 726f 6f74  ted.        root
+000170a0: 203d 2050 6174 6828 4441 5441 5f44 4952   = Path(DATA_DIR
+000170b0: 202f 2022 6967 6e6f 7265 5f73 7562 666f   / "ignore_subfo
+000170c0: 6c64 6572 735f 6769 7469 676e 6f72 655f  lders_gitignore_
+000170d0: 7465 7374 7322 290a 2020 2020 2020 2020  tests").        
+000170e0: 6578 7065 6374 6564 203d 205b 0a20 2020  expected = [.   
+000170f0: 2020 2020 2020 2020 2072 6f6f 7420 2f20           root / 
+00017100: 2261 2e70 7922 2c0a 2020 2020 2020 2020  "a.py",.        
+00017110: 2020 2020 726f 6f74 202f 2022 7375 6264      root / "subd
+00017120: 6972 2220 2f20 2262 2e70 7922 2c0a 2020  ir" / "b.py",.  
+00017130: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00017140: 6374 7820 3d20 4661 6b65 436f 6e74 6578  ctx = FakeContex
+00017150: 7428 290a 2020 2020 2020 2020 6374 782e  t().        ctx.
+00017160: 6f62 6a5b 2272 6f6f 7422 5d20 3d20 726f  obj["root"] = ro
+00017170: 6f74 0a20 2020 2020 2020 2061 7373 6572  ot.        asser
+00017180: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
+00017190: 6365 7328 5b72 6f6f 745d 2c20 6578 7065  ces([root], expe
+000171a0: 6374 6564 2c20 6374 783d 6374 7829 0a0a  cted, ctx=ctx)..
+000171b0: 2020 2020 2020 2020 2320 4966 2063 6f6d          # If com
+000171c0: 6d61 6e64 2069 7320 6578 6563 7574 6564  mand is executed
+000171d0: 2066 726f 6d20 6f75 7465 7220 6469 720a   from outer dir.
+000171e0: 2020 2020 2020 2020 726f 6f74 203d 2050          root = P
+000171f0: 6174 6828 4441 5441 5f44 4952 202f 2022  ath(DATA_DIR / "
+00017200: 6967 6e6f 7265 5f73 7562 666f 6c64 6572  ignore_subfolder
+00017210: 735f 6769 7469 676e 6f72 655f 7465 7374  s_gitignore_test
+00017220: 7322 290a 2020 2020 2020 2020 7461 7267  s").        targ
+00017230: 6574 203d 2072 6f6f 7420 2f20 2273 7562  et = root / "sub
+00017240: 6469 7222 0a20 2020 2020 2020 2065 7870  dir".        exp
+00017250: 6563 7465 6420 3d20 5b74 6172 6765 7420  ected = [target 
+00017260: 2f20 2262 2e70 7922 5d0a 2020 2020 2020  / "b.py"].      
+00017270: 2020 6374 7820 3d20 4661 6b65 436f 6e74    ctx = FakeCont
+00017280: 6578 7428 290a 2020 2020 2020 2020 6374  ext().        ct
+00017290: 782e 6f62 6a5b 2272 6f6f 7422 5d20 3d20  x.obj["root"] = 
+000172a0: 726f 6f74 0a20 2020 2020 2020 2061 7373  root.        ass
+000172b0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+000172c0: 7572 6365 7328 5b74 6172 6765 745d 2c20  urces([target], 
+000172d0: 6578 7065 6374 6564 2c20 6374 783d 6374  expected, ctx=ct
+000172e0: 7829 0a0a 2020 2020 6465 6620 7465 7374  x)..    def test
+000172f0: 5f65 6d70 7479 5f69 6e63 6c75 6465 2873  _empty_include(s
+00017300: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00017310: 2020 2020 2020 7061 7468 203d 2044 4154        path = DAT
+00017320: 415f 4449 5220 2f20 2269 6e63 6c75 6465  A_DIR / "include
+00017330: 5f65 7863 6c75 6465 5f74 6573 7473 220a  _exclude_tests".
+00017340: 2020 2020 2020 2020 7372 6320 3d20 5b70          src = [p
+00017350: 6174 685d 0a20 2020 2020 2020 2065 7870  ath].        exp
+00017360: 6563 7465 6420 3d20 5b0a 2020 2020 2020  ected = [.      
+00017370: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
+00017380: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
+00017390: 6965 2229 2c0a 2020 2020 2020 2020 2020  ie"),.          
+000173a0: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
+000173b0: 2f65 7863 6c75 6465 2f61 2e70 7922 292c  /exclude/a.py"),
+000173c0: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
+000173d0: 6828 7061 7468 202f 2022 622f 6578 636c  h(path / "b/excl
+000173e0: 7564 652f 612e 7079 6922 292c 0a20 2020  ude/a.pyi"),.   
+000173f0: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
+00017400: 7468 202f 2022 622f 646f 6e74 5f65 7863  th / "b/dont_exc
+00017410: 6c75 6465 2f61 2e70 6965 2229 2c0a 2020  lude/a.pie"),.  
+00017420: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
+00017430: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
+00017440: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
+00017450: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
+00017460: 6174 6820 2f20 2262 2f64 6f6e 745f 6578  ath / "b/dont_ex
+00017470: 636c 7564 652f 612e 7079 6922 292c 0a20  clude/a.pyi"),. 
+00017480: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
+00017490: 7061 7468 202f 2022 622f 2e64 6566 696e  path / "b/.defin
+000174a0: 6974 656c 795f 6578 636c 7564 652f 612e  itely_exclude/a.
+000174b0: 7069 6522 292c 0a20 2020 2020 2020 2020  pie"),.         
+000174c0: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
+000174d0: 622f 2e64 6566 696e 6974 656c 795f 6578  b/.definitely_ex
+000174e0: 636c 7564 652f 612e 7079 2229 2c0a 2020  clude/a.py"),.  
+000174f0: 2020 2020 2020 2020 2020 5061 7468 2870            Path(p
+00017500: 6174 6820 2f20 2262 2f2e 6465 6669 6e69  ath / "b/.defini
+00017510: 7465 6c79 5f65 7863 6c75 6465 2f61 2e70  tely_exclude/a.p
+00017520: 7969 2229 2c0a 2020 2020 2020 2020 2020  yi"),.          
+00017530: 2020 5061 7468 2870 6174 6820 2f20 222e    Path(path / ".
+00017540: 6769 7469 676e 6f72 6522 292c 0a20 2020  gitignore"),.   
+00017550: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
+00017560: 7468 202f 2022 7079 7072 6f6a 6563 742e  th / "pyproject.
+00017570: 746f 6d6c 2229 2c0a 2020 2020 2020 2020  toml"),.        
+00017580: 5d0a 2020 2020 2020 2020 2320 5365 7474  ].        # Sett
+00017590: 696e 6720 6578 636c 7564 6520 6578 706c  ing exclude expl
+000175a0: 6963 6974 6c79 2074 6f20 616e 2065 6d70  icitly to an emp
+000175b0: 7479 2073 7472 696e 6720 746f 2062 6c6f  ty string to blo
+000175c0: 636b 202e 6769 7469 676e 6f72 6520 7573  ck .gitignore us
+000175d0: 6167 652e 0a20 2020 2020 2020 2061 7373  age..        ass
+000175e0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+000175f0: 7572 6365 7328 7372 632c 2065 7870 6563  urces(src, expec
+00017600: 7465 642c 2069 6e63 6c75 6465 3d22 222c  ted, include="",
+00017610: 2065 7863 6c75 6465 3d22 2229 0a0a 2020   exclude="")..  
+00017620: 2020 6465 6620 7465 7374 5f65 7874 656e    def test_exten
+00017630: 645f 6578 636c 7564 6528 7365 6c66 2920  d_exclude(self) 
+00017640: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00017650: 2070 6174 6820 3d20 4441 5441 5f44 4952   path = DATA_DIR
+00017660: 202f 2022 696e 636c 7564 655f 6578 636c   / "include_excl
+00017670: 7564 655f 7465 7374 7322 0a20 2020 2020  ude_tests".     
+00017680: 2020 2073 7263 203d 205b 7061 7468 5d0a     src = [path].
+00017690: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+000176a0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+000176b0: 2050 6174 6828 7061 7468 202f 2022 622f   Path(path / "b/
+000176c0: 6578 636c 7564 652f 612e 7079 2229 2c0a  exclude/a.py"),.
+000176d0: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+000176e0: 2870 6174 6820 2f20 2262 2f64 6f6e 745f  (path / "b/dont_
+000176f0: 6578 636c 7564 652f 612e 7079 2229 2c0a  exclude/a.py"),.
+00017700: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+00017710: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
+00017720: 6564 5f73 6f75 7263 6573 280a 2020 2020  ed_sources(.    
+00017730: 2020 2020 2020 2020 7372 632c 2065 7870          src, exp
+00017740: 6563 7465 642c 2065 7863 6c75 6465 3d72  ected, exclude=r
+00017750: 225c 2e70 7969 2422 2c20 6578 7465 6e64  "\.pyi$", extend
+00017760: 5f65 7863 6c75 6465 3d72 225c 2e64 6566  _exclude=r"\.def
+00017770: 696e 6974 656c 795f 6578 636c 7564 6522  initely_exclude"
+00017780: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00017790: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
+000177a0: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
+000177b0: 7970 7963 0a20 2020 2064 6566 2074 6573  ypyc.    def tes
+000177c0: 745f 7379 6d6c 696e 6b5f 6f75 745f 6f66  t_symlink_out_of
+000177d0: 5f72 6f6f 745f 6469 7265 6374 6f72 7928  _root_directory(
+000177e0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000177f0: 2020 2020 2020 2070 6174 6820 3d20 4d61         path = Ma
+00017800: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
+00017810: 2020 726f 6f74 203d 2054 4849 535f 4449    root = THIS_DI
+00017820: 522e 7265 736f 6c76 6528 290a 2020 2020  R.resolve().    
+00017830: 2020 2020 6368 696c 6420 3d20 4d61 6769      child = Magi
+00017840: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
+00017850: 696e 636c 7564 6520 3d20 7265 2e63 6f6d  include = re.com
+00017860: 7069 6c65 2862 6c61 636b 2e44 4546 4155  pile(black.DEFAU
+00017870: 4c54 5f49 4e43 4c55 4445 5329 0a20 2020  LT_INCLUDES).   
+00017880: 2020 2020 2065 7863 6c75 6465 203d 2072       exclude = r
+00017890: 652e 636f 6d70 696c 6528 626c 6163 6b2e  e.compile(black.
+000178a0: 4445 4641 554c 545f 4558 434c 5544 4553  DEFAULT_EXCLUDES
+000178b0: 290a 2020 2020 2020 2020 7265 706f 7274  ).        report
+000178c0: 203d 2062 6c61 636b 2e52 6570 6f72 7428   = black.Report(
+000178d0: 290a 2020 2020 2020 2020 6769 7469 676e  ).        gitign
+000178e0: 6f72 6520 3d20 5061 7468 5370 6563 2e66  ore = PathSpec.f
+000178f0: 726f 6d5f 6c69 6e65 7328 2267 6974 7769  rom_lines("gitwi
+00017900: 6c64 6d61 7463 6822 2c20 5b5d 290a 2020  ldmatch", []).  
+00017910: 2020 2020 2020 2320 6063 6869 6c64 6020        # `child` 
+00017920: 7368 6f75 6c64 2062 6568 6176 6520 6c69  should behave li
+00017930: 6b65 2061 2073 796d 6c69 6e6b 2077 6869  ke a symlink whi
+00017940: 6368 2072 6573 6f6c 7665 6420 7061 7468  ch resolved path
+00017950: 2069 7320 636c 6561 726c 790a 2020 2020   is clearly.    
+00017960: 2020 2020 2320 6f75 7473 6964 6520 6f66      # outside of
+00017970: 2074 6865 2060 726f 6f74 6020 6469 7265   the `root` dire
+00017980: 6374 6f72 792e 0a20 2020 2020 2020 2070  ctory..        p
+00017990: 6174 682e 6974 6572 6469 722e 7265 7475  ath.iterdir.retu
+000179a0: 726e 5f76 616c 7565 203d 205b 6368 696c  rn_value = [chil
+000179b0: 645d 0a20 2020 2020 2020 2063 6869 6c64  d].        child
+000179c0: 2e72 6573 6f6c 7665 2e72 6574 7572 6e5f  .resolve.return_
+000179d0: 7661 6c75 6520 3d20 5061 7468 2822 2f61  value = Path("/a
+000179e0: 2f62 2f63 2229 0a20 2020 2020 2020 2063  /b/c").        c
+000179f0: 6869 6c64 2e61 735f 706f 7369 782e 7265  hild.as_posix.re
+00017a00: 7475 726e 5f76 616c 7565 203d 2022 2f61  turn_value = "/a
+00017a10: 2f62 2f63 220a 2020 2020 2020 2020 7472  /b/c".        tr
+00017a20: 793a 0a20 2020 2020 2020 2020 2020 206c  y:.            l
+00017a30: 6973 7428 0a20 2020 2020 2020 2020 2020  ist(.           
+00017a40: 2020 2020 2062 6c61 636b 2e67 656e 5f70       black.gen_p
+00017a50: 7974 686f 6e5f 6669 6c65 7328 0a20 2020  ython_files(.   
+00017a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a70: 2070 6174 682e 6974 6572 6469 7228 292c   path.iterdir(),
+00017a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017a90: 2020 2020 2072 6f6f 742c 0a20 2020 2020       root,.     
+00017aa0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017ab0: 6e63 6c75 6465 2c0a 2020 2020 2020 2020  nclude,.        
+00017ac0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
+00017ad0: 7564 652c 0a20 2020 2020 2020 2020 2020  ude,.           
+00017ae0: 2020 2020 2020 2020 204e 6f6e 652c 0a20           None,. 
+00017af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b00: 2020 204e 6f6e 652c 0a20 2020 2020 2020     None,.       
+00017b10: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+00017b20: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
+00017b30: 2020 2020 2020 2020 207b 7061 7468 3a20           {path: 
+00017b40: 6769 7469 676e 6f72 657d 2c0a 2020 2020  gitignore},.    
+00017b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b60: 7665 7262 6f73 653d 4661 6c73 652c 0a20  verbose=False,. 
+00017b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b80: 2020 2071 7569 6574 3d46 616c 7365 2c0a     quiet=False,.
+00017b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ba0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+00017bb0: 2020 2020 2020 2020 6578 6365 7074 2056          except V
+00017bc0: 616c 7565 4572 726f 7220 6173 2076 653a  alueError as ve:
+00017bd0: 0a20 2020 2020 2020 2020 2020 2070 7974  .            pyt
+00017be0: 6573 742e 6661 696c 2866 2260 6765 745f  est.fail(f"`get_
+00017bf0: 7079 7468 6f6e 5f66 696c 6573 5f69 6e5f  python_files_in_
+00017c00: 6469 7228 2960 2066 6169 6c65 643a 207b  dir()` failed: {
+00017c10: 7665 7d22 290a 2020 2020 2020 2020 7061  ve}").        pa
+00017c20: 7468 2e69 7465 7264 6972 2e61 7373 6572  th.iterdir.asser
+00017c30: 745f 6361 6c6c 6564 5f6f 6e63 6528 290a  t_called_once().
+00017c40: 2020 2020 2020 2020 6368 696c 642e 7265          child.re
+00017c50: 736f 6c76 652e 6173 7365 7274 5f63 616c  solve.assert_cal
+00017c60: 6c65 645f 6f6e 6365 2829 0a0a 2020 2020  led_once()..    
+00017c70: 4070 6174 6368 2822 626c 6163 6b2e 6669  @patch("black.fi
+00017c80: 6e64 5f70 726f 6a65 6374 5f72 6f6f 7422  nd_project_root"
+00017c90: 2c20 6c61 6d62 6461 202a 6172 6773 3a20  , lambda *args: 
+00017ca0: 2854 4849 535f 4449 522e 7265 736f 6c76  (THIS_DIR.resolv
+00017cb0: 6528 292c 204e 6f6e 6529 290a 2020 2020  e(), None)).    
+00017cc0: 6465 6620 7465 7374 5f67 6574 5f73 6f75  def test_get_sou
+00017cd0: 7263 6573 5f77 6974 685f 7374 6469 6e28  rces_with_stdin(
+00017ce0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00017cf0: 2020 2020 2020 2073 7263 203d 205b 222d         src = ["-
+00017d00: 225d 0a20 2020 2020 2020 2065 7870 6563  "].        expec
+00017d10: 7465 6420 3d20 5b22 2d22 5d0a 2020 2020  ted = ["-"].    
+00017d20: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
+00017d30: 6374 6564 5f73 6f75 7263 6573 2873 7263  cted_sources(src
+00017d40: 2c20 6578 7065 6374 6564 2c20 696e 636c  , expected, incl
+00017d50: 7564 653d 2222 2c20 6578 636c 7564 653d  ude="", exclude=
+00017d60: 7222 2f65 7863 6c75 6465 2f7c 615c 2e70  r"/exclude/|a\.p
+00017d70: 7922 290a 0a20 2020 2040 7061 7463 6828  y")..    @patch(
+00017d80: 2262 6c61 636b 2e66 696e 645f 7072 6f6a  "black.find_proj
+00017d90: 6563 745f 726f 6f74 222c 206c 616d 6264  ect_root", lambd
+00017da0: 6120 2a61 7267 733a 2028 5448 4953 5f44  a *args: (THIS_D
+00017db0: 4952 2e72 6573 6f6c 7665 2829 2c20 4e6f  IR.resolve(), No
+00017dc0: 6e65 2929 0a20 2020 2064 6566 2074 6573  ne)).    def tes
+00017dd0: 745f 6765 745f 736f 7572 6365 735f 7769  t_get_sources_wi
+00017de0: 7468 5f73 7464 696e 5f66 696c 656e 616d  th_stdin_filenam
+00017df0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
+00017e00: 0a20 2020 2020 2020 2073 7263 203d 205b  .        src = [
+00017e10: 222d 225d 0a20 2020 2020 2020 2073 7464  "-"].        std
+00017e20: 696e 5f66 696c 656e 616d 6520 3d20 7374  in_filename = st
+00017e30: 7228 5448 4953 5f44 4952 202f 2022 6461  r(THIS_DIR / "da
+00017e40: 7461 2f63 6f6c 6c65 6374 696f 6e73 2e70  ta/collections.p
+00017e50: 7922 290a 2020 2020 2020 2020 6578 7065  y").        expe
+00017e60: 6374 6564 203d 205b 6622 5f5f 424c 4143  cted = [f"__BLAC
+00017e70: 4b5f 5354 4449 4e5f 4649 4c45 4e41 4d45  K_STDIN_FILENAME
+00017e80: 5f5f 7b73 7464 696e 5f66 696c 656e 616d  __{stdin_filenam
+00017e90: 657d 225d 0a20 2020 2020 2020 2061 7373  e}"].        ass
+00017ea0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+00017eb0: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
+00017ec0: 2020 2073 7263 2c0a 2020 2020 2020 2020     src,.        
+00017ed0: 2020 2020 6578 7065 6374 6564 2c0a 2020      expected,.  
+00017ee0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00017ef0: 653d 7222 2f65 7863 6c75 6465 2f61 5c2e  e=r"/exclude/a\.
+00017f00: 7079 222c 0a20 2020 2020 2020 2020 2020  py",.           
+00017f10: 2073 7464 696e 5f66 696c 656e 616d 653d   stdin_filename=
+00017f20: 7374 6469 6e5f 6669 6c65 6e61 6d65 2c0a  stdin_filename,.
+00017f30: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
+00017f40: 7061 7463 6828 2262 6c61 636b 2e66 696e  patch("black.fin
+00017f50: 645f 7072 6f6a 6563 745f 726f 6f74 222c  d_project_root",
+00017f60: 206c 616d 6264 6120 2a61 7267 733a 2028   lambda *args: (
+00017f70: 5448 4953 5f44 4952 2e72 6573 6f6c 7665  THIS_DIR.resolve
+00017f80: 2829 2c20 4e6f 6e65 2929 0a20 2020 2064  (), None)).    d
+00017f90: 6566 2074 6573 745f 6765 745f 736f 7572  ef test_get_sour
+00017fa0: 6365 735f 7769 7468 5f73 7464 696e 5f66  ces_with_stdin_f
+00017fb0: 696c 656e 616d 655f 616e 645f 6578 636c  ilename_and_excl
+00017fc0: 7564 6528 7365 6c66 2920 2d3e 204e 6f6e  ude(self) -> Non
+00017fd0: 653a 0a20 2020 2020 2020 2023 2045 7863  e:.        # Exc
+00017fe0: 6c75 6465 2073 686f 756c 646e 2774 2065  lude shouldn't e
+00017ff0: 7863 6c75 6465 2073 7464 696e 5f66 696c  xclude stdin_fil
+00018000: 656e 616d 6520 7369 6e63 6520 6974 2069  ename since it i
+00018010: 7320 6d69 6d69 636b 696e 6720 7468 650a  s mimicking the.
+00018020: 2020 2020 2020 2020 2320 6669 6c65 2062          # file b
+00018030: 6569 6e67 2070 6173 7365 6420 6469 7265  eing passed dire
+00018040: 6374 6c79 2e20 5468 6973 2069 7320 7468  ctly. This is th
+00018050: 6520 7361 6d65 2061 730a 2020 2020 2020  e same as.      
+00018060: 2020 2320 7465 7374 5f65 7863 6c75 6465    # test_exclude
+00018070: 5f66 6f72 5f69 7373 7565 5f31 3537 320a  _for_issue_1572.
+00018080: 2020 2020 2020 2020 7061 7468 203d 2044          path = D
+00018090: 4154 415f 4449 5220 2f20 2269 6e63 6c75  ATA_DIR / "inclu
+000180a0: 6465 5f65 7863 6c75 6465 5f74 6573 7473  de_exclude_tests
+000180b0: 220a 2020 2020 2020 2020 7372 6320 3d20  ".        src = 
+000180c0: 5b22 2d22 5d0a 2020 2020 2020 2020 7374  ["-"].        st
+000180d0: 6469 6e5f 6669 6c65 6e61 6d65 203d 2073  din_filename = s
+000180e0: 7472 2870 6174 6820 2f20 2262 2f65 7863  tr(path / "b/exc
+000180f0: 6c75 6465 2f61 2e70 7922 290a 2020 2020  lude/a.py").    
+00018100: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
+00018110: 6622 5f5f 424c 4143 4b5f 5354 4449 4e5f  f"__BLACK_STDIN_
+00018120: 4649 4c45 4e41 4d45 5f5f 7b73 7464 696e  FILENAME__{stdin
+00018130: 5f66 696c 656e 616d 657d 225d 0a20 2020  _filename}"].   
+00018140: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
+00018150: 6563 7465 645f 736f 7572 6365 7328 0a20  ected_sources(. 
+00018160: 2020 2020 2020 2020 2020 2073 7263 2c0a             src,.
+00018170: 2020 2020 2020 2020 2020 2020 6578 7065              expe
+00018180: 6374 6564 2c0a 2020 2020 2020 2020 2020  cted,.          
+00018190: 2020 6578 636c 7564 653d 7222 2f65 7863    exclude=r"/exc
+000181a0: 6c75 6465 2f7c 615c 2e70 7922 2c0a 2020  lude/|a\.py",.  
+000181b0: 2020 2020 2020 2020 2020 7374 6469 6e5f            stdin_
+000181c0: 6669 6c65 6e61 6d65 3d73 7464 696e 5f66  filename=stdin_f
+000181d0: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
+000181e0: 2029 0a0a 2020 2020 4070 6174 6368 2822   )..    @patch("
+000181f0: 626c 6163 6b2e 6669 6e64 5f70 726f 6a65  black.find_proje
+00018200: 6374 5f72 6f6f 7422 2c20 6c61 6d62 6461  ct_root", lambda
+00018210: 202a 6172 6773 3a20 2854 4849 535f 4449   *args: (THIS_DI
+00018220: 522e 7265 736f 6c76 6528 292c 204e 6f6e  R.resolve(), Non
+00018230: 6529 290a 2020 2020 6465 6620 7465 7374  e)).    def test
+00018240: 5f67 6574 5f73 6f75 7263 6573 5f77 6974  _get_sources_wit
+00018250: 685f 7374 6469 6e5f 6669 6c65 6e61 6d65  h_stdin_filename
+00018260: 5f61 6e64 5f65 7874 656e 645f 6578 636c  _and_extend_excl
+00018270: 7564 6528 7365 6c66 2920 2d3e 204e 6f6e  ude(self) -> Non
+00018280: 653a 0a20 2020 2020 2020 2023 2045 7874  e:.        # Ext
+00018290: 656e 6420 6578 636c 7564 6520 7368 6f75  end exclude shou
+000182a0: 6c64 6e27 7420 6578 636c 7564 6520 7374  ldn't exclude st
+000182b0: 6469 6e5f 6669 6c65 6e61 6d65 2073 696e  din_filename sin
+000182c0: 6365 2069 7420 6973 206d 696d 6963 6b69  ce it is mimicki
+000182d0: 6e67 2074 6865 0a20 2020 2020 2020 2023  ng the.        #
+000182e0: 2066 696c 6520 6265 696e 6720 7061 7373   file being pass
+000182f0: 6564 2064 6972 6563 746c 792e 2054 6869  ed directly. Thi
+00018300: 7320 6973 2074 6865 2073 616d 6520 6173  s is the same as
+00018310: 0a20 2020 2020 2020 2023 2074 6573 745f  .        # test_
+00018320: 6578 636c 7564 655f 666f 725f 6973 7375  exclude_for_issu
+00018330: 655f 3135 3732 0a20 2020 2020 2020 2073  e_1572.        s
+00018340: 7263 203d 205b 222d 225d 0a20 2020 2020  rc = ["-"].     
+00018350: 2020 2070 6174 6820 3d20 5448 4953 5f44     path = THIS_D
+00018360: 4952 202f 2022 6461 7461 2220 2f20 2269  IR / "data" / "i
+00018370: 6e63 6c75 6465 5f65 7863 6c75 6465 5f74  nclude_exclude_t
+00018380: 6573 7473 220a 2020 2020 2020 2020 7374  ests".        st
+00018390: 6469 6e5f 6669 6c65 6e61 6d65 203d 2073  din_filename = s
+000183a0: 7472 2870 6174 6820 2f20 2262 2f65 7863  tr(path / "b/exc
+000183b0: 6c75 6465 2f61 2e70 7922 290a 2020 2020  lude/a.py").    
+000183c0: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
+000183d0: 6622 5f5f 424c 4143 4b5f 5354 4449 4e5f  f"__BLACK_STDIN_
+000183e0: 4649 4c45 4e41 4d45 5f5f 7b73 7464 696e  FILENAME__{stdin
+000183f0: 5f66 696c 656e 616d 657d 225d 0a20 2020  _filename}"].   
+00018400: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
+00018410: 6563 7465 645f 736f 7572 6365 7328 0a20  ected_sources(. 
+00018420: 2020 2020 2020 2020 2020 2073 7263 2c0a             src,.
+00018430: 2020 2020 2020 2020 2020 2020 6578 7065              expe
+00018440: 6374 6564 2c0a 2020 2020 2020 2020 2020  cted,.          
+00018450: 2020 6578 7465 6e64 5f65 7863 6c75 6465    extend_exclude
+00018460: 3d72 222f 6578 636c 7564 652f 7c61 5c2e  =r"/exclude/|a\.
+00018470: 7079 222c 0a20 2020 2020 2020 2020 2020  py",.           
+00018480: 2073 7464 696e 5f66 696c 656e 616d 653d   stdin_filename=
+00018490: 7374 6469 6e5f 6669 6c65 6e61 6d65 2c0a  stdin_filename,.
+000184a0: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
+000184b0: 7061 7463 6828 2262 6c61 636b 2e66 696e  patch("black.fin
+000184c0: 645f 7072 6f6a 6563 745f 726f 6f74 222c  d_project_root",
+000184d0: 206c 616d 6264 6120 2a61 7267 733a 2028   lambda *args: (
+000184e0: 5448 4953 5f44 4952 2e72 6573 6f6c 7665  THIS_DIR.resolve
+000184f0: 2829 2c20 4e6f 6e65 2929 0a20 2020 2064  (), None)).    d
+00018500: 6566 2074 6573 745f 6765 745f 736f 7572  ef test_get_sour
+00018510: 6365 735f 7769 7468 5f73 7464 696e 5f66  ces_with_stdin_f
+00018520: 696c 656e 616d 655f 616e 645f 666f 7263  ilename_and_forc
+00018530: 655f 6578 636c 7564 6528 7365 6c66 2920  e_exclude(self) 
+00018540: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00018550: 2023 2046 6f72 6365 2065 7863 6c75 6465   # Force exclude
+00018560: 2073 686f 756c 6420 6578 636c 7564 6520   should exclude 
+00018570: 7468 6520 6669 6c65 2077 6865 6e20 7061  the file when pa
+00018580: 7373 696e 6720 6974 2074 6872 6f75 6768  ssing it through
+00018590: 0a20 2020 2020 2020 2023 2073 7464 696e  .        # stdin
+000185a0: 5f66 696c 656e 616d 650a 2020 2020 2020  _filename.      
+000185b0: 2020 7061 7468 203d 2054 4849 535f 4449    path = THIS_DI
+000185c0: 5220 2f20 2264 6174 6122 202f 2022 696e  R / "data" / "in
+000185d0: 636c 7564 655f 6578 636c 7564 655f 7465  clude_exclude_te
+000185e0: 7374 7322 0a20 2020 2020 2020 2073 7464  sts".        std
+000185f0: 696e 5f66 696c 656e 616d 6520 3d20 7374  in_filename = st
+00018600: 7228 7061 7468 202f 2022 622f 6578 636c  r(path / "b/excl
+00018610: 7564 652f 612e 7079 2229 0a20 2020 2020  ude/a.py").     
+00018620: 2020 2061 7373 6572 745f 636f 6c6c 6563     assert_collec
+00018630: 7465 645f 736f 7572 6365 7328 0a20 2020  ted_sources(.   
+00018640: 2020 2020 2020 2020 2073 7263 3d5b 222d           src=["-
+00018650: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+00018660: 6578 7065 6374 6564 3d5b 5d2c 0a20 2020  expected=[],.   
+00018670: 2020 2020 2020 2020 2066 6f72 6365 5f65           force_e
+00018680: 7863 6c75 6465 3d72 222f 6578 636c 7564  xclude=r"/exclud
+00018690: 652f 7c61 5c2e 7079 222c 0a20 2020 2020  e/|a\.py",.     
+000186a0: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
+000186b0: 656e 616d 653d 7374 6469 6e5f 6669 6c65  ename=stdin_file
+000186c0: 6e61 6d65 2c0a 2020 2020 2020 2020 290a  name,.        ).
+000186d0: 0a0a 7472 793a 0a20 2020 2077 6974 6820  ..try:.    with 
+000186e0: 6f70 656e 2862 6c61 636b 2e5f 5f66 696c  open(black.__fil
+000186f0: 655f 5f2c 2022 7222 2c20 656e 636f 6469  e__, "r", encodi
+00018700: 6e67 3d22 7574 662d 3822 2920 6173 205f  ng="utf-8") as _
+00018710: 6266 3a0a 2020 2020 2020 2020 626c 6163  bf:.        blac
+00018720: 6b5f 736f 7572 6365 5f6c 696e 6573 203d  k_source_lines =
+00018730: 205f 6266 2e72 6561 646c 696e 6573 2829   _bf.readlines()
+00018740: 0a65 7863 6570 7420 556e 6963 6f64 6544  .except UnicodeD
+00018750: 6563 6f64 6545 7272 6f72 3a0a 2020 2020  ecodeError:.    
+00018760: 6966 206e 6f74 2062 6c61 636b 2e43 4f4d  if not black.COM
+00018770: 5049 4c45 443a 0a20 2020 2020 2020 2072  PILED:.        r
+00018780: 6169 7365 0a0a 0a64 6566 2074 7261 6365  aise...def trace
+00018790: 6675 6e63 280a 2020 2020 6672 616d 653a  func(.    frame:
+000187a0: 2074 7970 6573 2e46 7261 6d65 5479 7065   types.FrameType
+000187b0: 2c20 6576 656e 743a 2073 7472 2c20 6172  , event: str, ar
+000187c0: 673a 2041 6e79 0a29 202d 3e20 4361 6c6c  g: Any.) -> Call
+000187d0: 6162 6c65 5b5b 7479 7065 732e 4672 616d  able[[types.Fram
+000187e0: 6554 7970 652c 2073 7472 2c20 416e 795d  eType, str, Any]
+000187f0: 2c20 416e 795d 3a0a 2020 2020 2222 2253  , Any]:.    """S
+00018800: 686f 7720 6675 6e63 7469 6f6e 2063 616c  how function cal
+00018810: 6c73 2060 6672 6f6d 2062 6c61 636b 2f5f  ls `from black/_
+00018820: 5f69 6e69 745f 5f2e 7079 6020 6173 2074  _init__.py` as t
+00018830: 6865 7920 6861 7070 656e 2e0a 0a20 2020  hey happen...   
+00018840: 2052 6567 6973 7465 7220 7468 6973 2077   Register this w
+00018850: 6974 6820 6073 7973 2e73 6574 7472 6163  ith `sys.settrac
+00018860: 6528 2960 2069 6e20 6120 7465 7374 2079  e()` in a test y
+00018870: 6f75 2772 6520 6465 6275 6767 696e 672e  ou're debugging.
+00018880: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+00018890: 6576 656e 7420 213d 2022 6361 6c6c 223a  event != "call":
+000188a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000188b0: 7472 6163 6566 756e 630a 0a20 2020 2073  tracefunc..    s
+000188c0: 7461 636b 203d 206c 656e 2869 6e73 7065  tack = len(inspe
+000188d0: 6374 2e73 7461 636b 2829 2920 2d20 3139  ct.stack()) - 19
+000188e0: 0a20 2020 2073 7461 636b 202a 3d20 320a  .    stack *= 2.
+000188f0: 2020 2020 6669 6c65 6e61 6d65 203d 2066      filename = f
+00018900: 7261 6d65 2e66 5f63 6f64 652e 636f 5f66  rame.f_code.co_f
+00018910: 696c 656e 616d 650a 2020 2020 6c69 6e65  ilename.    line
+00018920: 6e6f 203d 2066 7261 6d65 2e66 5f6c 696e  no = frame.f_lin
+00018930: 656e 6f0a 2020 2020 6675 6e63 5f73 6967  eno.    func_sig
+00018940: 5f6c 696e 656e 6f20 3d20 6c69 6e65 6e6f  _lineno = lineno
+00018950: 202d 2031 0a20 2020 2066 756e 636e 616d   - 1.    funcnam
+00018960: 6520 3d20 626c 6163 6b5f 736f 7572 6365  e = black_source
+00018970: 5f6c 696e 6573 5b66 756e 635f 7369 675f  _lines[func_sig_
+00018980: 6c69 6e65 6e6f 5d2e 7374 7269 7028 290a  lineno].strip().
+00018990: 2020 2020 7768 696c 6520 6675 6e63 6e61      while funcna
+000189a0: 6d65 2e73 7461 7274 7377 6974 6828 2240  me.startswith("@
+000189b0: 2229 3a0a 2020 2020 2020 2020 6675 6e63  "):.        func
+000189c0: 5f73 6967 5f6c 696e 656e 6f20 2b3d 2031  _sig_lineno += 1
+000189d0: 0a20 2020 2020 2020 2066 756e 636e 616d  .        funcnam
+000189e0: 6520 3d20 626c 6163 6b5f 736f 7572 6365  e = black_source
+000189f0: 5f6c 696e 6573 5b66 756e 635f 7369 675f  _lines[func_sig_
+00018a00: 6c69 6e65 6e6f 5d2e 7374 7269 7028 290a  lineno].strip().
+00018a10: 2020 2020 6966 2022 626c 6163 6b2f 5f5f      if "black/__
+00018a20: 696e 6974 5f5f 2e70 7922 2069 6e20 6669  init__.py" in fi
+00018a30: 6c65 6e61 6d65 3a0a 2020 2020 2020 2020  lename:.        
+00018a40: 7072 696e 7428 6622 7b27 2027 202a 2073  print(f"{' ' * s
+00018a50: 7461 636b 7d7b 6c69 6e65 6e6f 7d3a 7b66  tack}{lineno}:{f
+00018a60: 756e 636e 616d 657d 2229 0a20 2020 2072  uncname}").    r
+00018a70: 6574 7572 6e20 7472 6163 6566 756e 630a  eturn tracefunc.
```

### Comparing `tan-22.8.0/tests/test_blackd.py` & `tan-23.3.0/tests/test_blackd.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,214 +1,242 @@
 import re
-import sys
 from typing import TYPE_CHECKING, Any, Callable, TypeVar
 from unittest.mock import patch
 
 import pytest
 from click.testing import CliRunner
 
 from tests.util import DETERMINISTIC_HEADER, read_data
 
-LESS_THAN_311 = sys.version_info < (3, 11)
+try:
+    from aiohttp import web
+    from aiohttp.test_utils import AioHTTPTestCase
+
+    import blackd
+except ImportError as e:
+    raise RuntimeError("Please install Black with the 'd' extra") from e
 
-if LESS_THAN_311:  # noqa: C901
-    try:
-        from aiohttp import web
-        from aiohttp.test_utils import AioHTTPTestCase
-
-        import blackd
-    except ImportError as e:
-        raise RuntimeError("Please install Black with the 'd' extra") from e
-
-    if TYPE_CHECKING:
-        F = TypeVar("F", bound=Callable[..., Any])
-
-        unittest_run_loop: Callable[[F], F] = lambda x: x
-    else:
-        try:
-            from aiohttp.test_utils import unittest_run_loop
-        except ImportError:
-            # unittest_run_loop is unnecessary and a no-op since aiohttp 3.8, and
-            # aiohttp 4 removed it. To maintain compatibility we can make our own
-            # no-op decorator.
-            def unittest_run_loop(func, *args, **kwargs):
-                return func
-
-    @pytest.mark.blackd
-    class BlackDTestCase(AioHTTPTestCase):  # type: ignore[misc]
-        def test_blackd_main(self) -> None:
-            with patch("blackd.web.run_app"):
-                result = CliRunner().invoke(blackd.main, [])
-                if result.exception is not None:
-                    raise result.exception
-                self.assertEqual(result.exit_code, 0)
-
-        async def get_application(self) -> web.Application:
-            return blackd.make_app()
-
-        @unittest_run_loop
-        async def test_blackd_request_needs_formatting(self) -> None:
-            response = await self.client.post("/", data=b"print('hello world')")
-            self.assertEqual(response.status, 200)
-            self.assertEqual(response.charset, "utf8")
-            self.assertEqual(await response.read(), b'print("hello world")\n')
-
-        @unittest_run_loop
-        async def test_blackd_request_no_change(self) -> None:
-            response = await self.client.post("/", data=b'print("hello world")\n')
-            self.assertEqual(response.status, 204)
-            self.assertEqual(await response.read(), b"")
-
-        @unittest_run_loop
-        async def test_blackd_request_syntax_error(self) -> None:
-            response = await self.client.post("/", data=b"what even ( is")
-            self.assertEqual(response.status, 400)
-            content = await response.text()
-            self.assertTrue(
-                content.startswith("Cannot parse"),
-                msg=f"Expected error to start with 'Cannot parse', got {repr(content)}",
-            )
-
-        @unittest_run_loop
-        async def test_blackd_unsupported_version(self) -> None:
-            response = await self.client.post(
-                "/", data=b"what", headers={blackd.PROTOCOL_VERSION_HEADER: "2"}
-            )
-            self.assertEqual(response.status, 501)
+if TYPE_CHECKING:
+    F = TypeVar("F", bound=Callable[..., Any])
 
-        @unittest_run_loop
-        async def test_blackd_supported_version(self) -> None:
-            response = await self.client.post(
-                "/", data=b"what", headers={blackd.PROTOCOL_VERSION_HEADER: "1"}
-            )
-            self.assertEqual(response.status, 200)
-
-        @unittest_run_loop
-        async def test_blackd_invalid_python_variant(self) -> None:
-            async def check(header_value: str, expected_status: int = 400) -> None:
-                response = await self.client.post(
-                    "/",
-                    data=b"what",
-                    headers={blackd.PYTHON_VARIANT_HEADER: header_value},
-                )
-                self.assertEqual(response.status, expected_status)
-
-            await check("lol")
-            await check("ruby3.5")
-            await check("pyi3.6")
-            await check("py1.5")
-            await check("2")
-            await check("2.7")
-            await check("py2.7")
-            await check("2.8")
-            await check("py2.8")
-            await check("3.0")
-            await check("pypy3.0")
-            await check("jython3.4")
-
-        @unittest_run_loop
-        async def test_blackd_pyi(self) -> None:
-            source, expected = read_data("miscellaneous", "stub.pyi")
-            response = await self.client.post(
-                "/", data=source, headers={blackd.PYTHON_VARIANT_HEADER: "pyi"}
-            )
-            self.assertEqual(response.status, 200)
-            self.assertEqual(await response.text(), expected)
-
-        @unittest_run_loop
-        async def test_blackd_diff(self) -> None:
-            diff_header = re.compile(
-                r"(In|Out)\t\d\d\d\d-\d\d-\d\d \d\d:\d\d:\d\d\.\d\d\d\d\d\d \+\d\d\d\d"
-            )
-
-            source, _ = read_data("miscellaneous", "blackd_diff")
-            expected, _ = read_data("miscellaneous", "blackd_diff.diff")
-
-            response = await self.client.post(
-                "/", data=source, headers={blackd.DIFF_HEADER: "true"}
-            )
-            self.assertEqual(response.status, 200)
-
-            actual = await response.text()
-            actual = diff_header.sub(DETERMINISTIC_HEADER, actual)
-            self.assertEqual(actual, expected)
-
-        @unittest_run_loop
-        async def test_blackd_python_variant(self) -> None:
-            code = (
-                "def f(\n"
-                "    and_has_a_bunch_of,\n"
-                "    very_long_arguments_too,\n"
-                "    and_lots_of_them_as_well_lol,\n"
-                "    **and_very_long_keyword_arguments\n"
-                "):\n"
-                "    pass\n"
-            )
-
-            async def check(header_value: str, expected_status: int) -> None:
-                response = await self.client.post(
-                    "/", data=code, headers={blackd.PYTHON_VARIANT_HEADER: header_value}
-                )
-                self.assertEqual(
-                    response.status, expected_status, msg=await response.text()
-                )
-
-            await check("3.6", 200)
-            await check("py3.6", 200)
-            await check("3.6,3.7", 200)
-            await check("3.6,py3.7", 200)
-            await check("py36,py37", 200)
-            await check("36", 200)
-            await check("3.6.4", 200)
-            await check("3.4", 204)
-            await check("py3.4", 204)
-            await check("py34,py36", 204)
-            await check("34", 204)
-
-        @unittest_run_loop
-        async def test_blackd_line_length(self) -> None:
-            response = await self.client.post(
-                "/", data=b'print("hello")\n', headers={blackd.LINE_LENGTH_HEADER: "7"}
-            )
-            self.assertEqual(response.status, 200)
-
-        @unittest_run_loop
-        async def test_blackd_invalid_line_length(self) -> None:
+    unittest_run_loop: Callable[[F], F] = lambda x: x
+else:
+    try:
+        from aiohttp.test_utils import unittest_run_loop
+    except ImportError:
+        # unittest_run_loop is unnecessary and a no-op since aiohttp 3.8, and
+        # aiohttp 4 removed it. To maintain compatibility we can make our own
+        # no-op decorator.
+        def unittest_run_loop(func, *args, **kwargs):
+            return func
+
+
+@pytest.mark.blackd
+class BlackDTestCase(AioHTTPTestCase):  # type: ignore[misc]
+    def test_blackd_main(self) -> None:
+        with patch("blackd.web.run_app"):
+            result = CliRunner().invoke(blackd.main, [])
+            if result.exception is not None:
+                raise result.exception
+            self.assertEqual(result.exit_code, 0)
+
+    async def get_application(self) -> web.Application:
+        return blackd.make_app()
+
+    @unittest_run_loop
+    async def test_blackd_request_needs_formatting(self) -> None:
+        response = await self.client.post("/", data=b"print('hello world')")
+        self.assertEqual(response.status, 200)
+        self.assertEqual(response.charset, "utf8")
+        self.assertEqual(await response.read(), b'print("hello world")\n')
+
+    @unittest_run_loop
+    async def test_blackd_request_no_change(self) -> None:
+        response = await self.client.post("/", data=b'print("hello world")\n')
+        self.assertEqual(response.status, 204)
+        self.assertEqual(await response.read(), b"")
+
+    @unittest_run_loop
+    async def test_blackd_request_syntax_error(self) -> None:
+        response = await self.client.post("/", data=b"what even ( is")
+        self.assertEqual(response.status, 400)
+        content = await response.text()
+        self.assertTrue(
+            content.startswith("Cannot parse"),
+            msg=f"Expected error to start with 'Cannot parse', got {repr(content)}",
+        )
+
+    @unittest_run_loop
+    async def test_blackd_unsupported_version(self) -> None:
+        response = await self.client.post(
+            "/", data=b"what", headers={blackd.PROTOCOL_VERSION_HEADER: "2"}
+        )
+        self.assertEqual(response.status, 501)
+
+    @unittest_run_loop
+    async def test_blackd_supported_version(self) -> None:
+        response = await self.client.post(
+            "/", data=b"what", headers={blackd.PROTOCOL_VERSION_HEADER: "1"}
+        )
+        self.assertEqual(response.status, 200)
+
+    @unittest_run_loop
+    async def test_blackd_invalid_python_variant(self) -> None:
+        async def check(header_value: str, expected_status: int = 400) -> None:
             response = await self.client.post(
                 "/",
-                data=b'print("hello")\n',
-                headers={blackd.LINE_LENGTH_HEADER: "NaN"},
+                data=b"what",
+                headers={blackd.PYTHON_VARIANT_HEADER: header_value},
             )
-            self.assertEqual(response.status, 400)
+            self.assertEqual(response.status, expected_status)
 
-        @unittest_run_loop
-        async def test_blackd_preview(self) -> None:
-            response = await self.client.post(
-                "/", data=b'print("hello")\n', headers={blackd.PREVIEW: "true"}
-            )
+        await check("lol")
+        await check("ruby3.5")
+        await check("pyi3.6")
+        await check("py1.5")
+        await check("2")
+        await check("2.7")
+        await check("py2.7")
+        await check("2.8")
+        await check("py2.8")
+        await check("3.0")
+        await check("pypy3.0")
+        await check("jython3.4")
+
+    @unittest_run_loop
+    async def test_blackd_pyi(self) -> None:
+        source, expected = read_data("miscellaneous", "stub.pyi")
+        response = await self.client.post(
+            "/", data=source, headers={blackd.PYTHON_VARIANT_HEADER: "pyi"}
+        )
+        self.assertEqual(response.status, 200)
+        self.assertEqual(await response.text(), expected)
+
+    @unittest_run_loop
+    async def test_blackd_diff(self) -> None:
+        diff_header = re.compile(
+            r"(In|Out)\t\d\d\d\d-\d\d-\d\d \d\d:\d\d:\d\d\.\d\d\d\d\d\d \+\d\d\d\d"
+        )
+
+        source, _ = read_data("miscellaneous", "blackd_diff")
+        expected, _ = read_data("miscellaneous", "blackd_diff.diff")
+
+        response = await self.client.post(
+            "/", data=source, headers={blackd.DIFF_HEADER: "true"}
+        )
+        self.assertEqual(response.status, 200)
+
+        actual = await response.text()
+        actual = diff_header.sub(DETERMINISTIC_HEADER, actual)
+        self.assertEqual(actual, expected)
+
+    @unittest_run_loop
+    async def test_blackd_python_variant(self) -> None:
+        code = (
+            "def f(\n"
+            "    and_has_a_bunch_of,\n"
+            "    very_long_arguments_too,\n"
+            "    and_lots_of_them_as_well_lol,\n"
+            "    **and_very_long_keyword_arguments\n"
+            "):\n"
+            "    pass\n"
+        )
+
+        async def check(header_value: str, expected_status: int) -> None:
+            response = await self.client.post(
+                "/", data=code, headers={blackd.PYTHON_VARIANT_HEADER: header_value}
+            )
+            self.assertEqual(
+                response.status, expected_status, msg=await response.text()
+            )
+
+        await check("3.6", 200)
+        await check("py3.6", 200)
+        await check("3.6,3.7", 200)
+        await check("3.6,py3.7", 200)
+        await check("py36,py37", 200)
+        await check("36", 200)
+        await check("3.6.4", 200)
+        await check("3.4", 204)
+        await check("py3.4", 204)
+        await check("py34,py36", 204)
+        await check("34", 204)
+
+    @unittest_run_loop
+    async def test_blackd_line_length(self) -> None:
+        response = await self.client.post(
+            "/", data=b'print("hello")\n', headers={blackd.LINE_LENGTH_HEADER: "7"}
+        )
+        self.assertEqual(response.status, 200)
+
+    @unittest_run_loop
+    async def test_blackd_invalid_line_length(self) -> None:
+        response = await self.client.post(
+            "/",
+            data=b'print("hello")\n',
+            headers={blackd.LINE_LENGTH_HEADER: "NaN"},
+        )
+        self.assertEqual(response.status, 400)
+
+    @unittest_run_loop
+    async def test_blackd_skip_first_source_line(self) -> None:
+        invalid_first_line = b"Header will be skipped\r\ni = [1,2,3]\nj = [1,2,3]\n"
+        expected_result = b"Header will be skipped\r\ni = [1, 2, 3]\nj = [1, 2, 3]\n"
+        response = await self.client.post("/", data=invalid_first_line)
+        self.assertEqual(response.status, 400)
+        response = await self.client.post(
+            "/",
+            data=invalid_first_line,
+            headers={blackd.SKIP_SOURCE_FIRST_LINE: "true"},
+        )
+        self.assertEqual(response.status, 200)
+        self.assertEqual(await response.read(), expected_result)
+
+    @unittest_run_loop
+    async def test_blackd_preview(self) -> None:
+        response = await self.client.post(
+            "/", data=b'print("hello")\n', headers={blackd.PREVIEW: "true"}
+        )
+        self.assertEqual(response.status, 204)
+
+    @unittest_run_loop
+    async def test_blackd_response_black_version_header(self) -> None:
+        response = await self.client.post("/")
+        self.assertIsNotNone(response.headers.get(blackd.BLACK_VERSION_HEADER))
+
+    @unittest_run_loop
+    async def test_cors_preflight(self) -> None:
+        response = await self.client.options(
+            "/",
+            headers={
+                "Access-Control-Request-Method": "POST",
+                "Origin": "*",
+                "Access-Control-Request-Headers": "Content-Type",
+            },
+        )
+        self.assertEqual(response.status, 200)
+        self.assertIsNotNone(response.headers.get("Access-Control-Allow-Origin"))
+        self.assertIsNotNone(response.headers.get("Access-Control-Allow-Headers"))
+        self.assertIsNotNone(response.headers.get("Access-Control-Allow-Methods"))
+
+    @unittest_run_loop
+    async def test_cors_headers_present(self) -> None:
+        response = await self.client.post("/", headers={"Origin": "*"})
+        self.assertIsNotNone(response.headers.get("Access-Control-Allow-Origin"))
+        self.assertIsNotNone(response.headers.get("Access-Control-Expose-Headers"))
+
+    @unittest_run_loop
+    async def test_preserves_line_endings(self) -> None:
+        for data in (b"c\r\nc\r\n", b"l\nl\n"):
+            # test preserved newlines when reformatted
+            response = await self.client.post("/", data=data + b" ")
+            self.assertEqual(await response.text(), data.decode())
+            # test 204 when no change
+            response = await self.client.post("/", data=data)
             self.assertEqual(response.status, 204)
 
-        @unittest_run_loop
-        async def test_blackd_response_black_version_header(self) -> None:
-            response = await self.client.post("/")
-            self.assertIsNotNone(response.headers.get(blackd.BLACK_VERSION_HEADER))
-
-        @unittest_run_loop
-        async def test_cors_preflight(self) -> None:
-            response = await self.client.options(
-                "/",
-                headers={
-                    "Access-Control-Request-Method": "POST",
-                    "Origin": "*",
-                    "Access-Control-Request-Headers": "Content-Type",
-                },
-            )
+    @unittest_run_loop
+    async def test_normalizes_line_endings(self) -> None:
+        for data, expected in ((b"c\r\nc\n", "c\r\nc\r\n"), (b"l\nl\r\n", "l\nl\n")):
+            response = await self.client.post("/", data=data)
+            self.assertEqual(await response.text(), expected)
             self.assertEqual(response.status, 200)
-            self.assertIsNotNone(response.headers.get("Access-Control-Allow-Origin"))
-            self.assertIsNotNone(response.headers.get("Access-Control-Allow-Headers"))
-            self.assertIsNotNone(response.headers.get("Access-Control-Allow-Methods"))
-
-        @unittest_run_loop
-        async def test_cors_headers_present(self) -> None:
-            response = await self.client.post("/", headers={"Origin": "*"})
-            self.assertIsNotNone(response.headers.get("Access-Control-Allow-Origin"))
-            self.assertIsNotNone(response.headers.get("Access-Control-Expose-Headers"))
```

### Comparing `tan-22.8.0/tests/test_format.py` & `tan-23.3.0/tests/test_format.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+import re
 from dataclasses import replace
 from typing import Any, Iterator
 from unittest.mock import patch
 
 import pytest
 
 import black
@@ -27,39 +28,46 @@
     source, expected = read_data(subdir, filename, data=data)
     assert_format(source, expected, mode, fast=False)
 
 
 @pytest.mark.filterwarnings("ignore:invalid escape sequence.*:DeprecationWarning")
 @pytest.mark.parametrize("filename", all_data_cases("simple_cases"))
 def test_simple_format(filename: str) -> None:
-    check_file("simple_cases", filename, DEFAULT_MODE)
+    magic_trailing_comma = filename != "skip_magic_trailing_comma"
+    check_file(
+        "simple_cases", filename, black.Mode(magic_trailing_comma=magic_trailing_comma)
+    )
 
 
 @pytest.mark.parametrize("filename", all_data_cases("preview"))
 def test_preview_format(filename: str) -> None:
-    magic_trailing_comma = filename != "skip_magic_trailing_comma"
-    check_file(
-        "preview",
-        filename,
-        black.Mode(preview=True, magic_trailing_comma=magic_trailing_comma),
-    )
+    check_file("preview", filename, black.Mode(preview=True))
 
 
-@pytest.mark.parametrize("filename", all_data_cases("preview_39"))
-def test_preview_minimum_python_39_format(filename: str) -> None:
-    source, expected = read_data("preview_39", filename)
-    mode = black.Mode(preview=True)
+def test_preview_context_managers_targeting_py38() -> None:
+    source, expected = read_data("preview_context_managers", "targeting_py38.py")
+    mode = black.Mode(preview=True, target_versions={black.TargetVersion.PY38})
+    assert_format(source, expected, mode, minimum_version=(3, 8))
+
+
+def test_preview_context_managers_targeting_py39() -> None:
+    source, expected = read_data("preview_context_managers", "targeting_py39.py")
+    mode = black.Mode(preview=True, target_versions={black.TargetVersion.PY39})
     assert_format(source, expected, mode, minimum_version=(3, 9))
 
 
-@pytest.mark.parametrize("filename", all_data_cases("preview_310"))
-def test_preview_minimum_python_310_format(filename: str) -> None:
-    source, expected = read_data("preview_310", filename)
+@pytest.mark.parametrize(
+    "filename", all_data_cases("preview_context_managers/auto_detect")
+)
+def test_preview_context_managers_auto_detect(filename: str) -> None:
+    match = re.match(r"features_3_(\d+)", filename)
+    assert match is not None, "Unexpected filename format: %s" % filename
+    source, expected = read_data("preview_context_managers/auto_detect", filename)
     mode = black.Mode(preview=True)
-    assert_format(source, expected, mode, minimum_version=(3, 10))
+    assert_format(source, expected, mode, minimum_version=(3, int(match.group(1))))
 
 
 # =============== #
 # Complex cases
 # ============= #
 
 
@@ -142,14 +150,21 @@
 def test_docstring_no_string_normalization() -> None:
     """Like test_docstring but with string normalization off."""
     source, expected = read_data("miscellaneous", "docstring_no_string_normalization")
     mode = replace(DEFAULT_MODE, string_normalization=False)
     assert_format(source, expected, mode)
 
 
+def test_docstring_line_length_6() -> None:
+    """Like test_docstring but with line length set to 6."""
+    source, expected = read_data("miscellaneous", "linelength6")
+    mode = black.Mode(line_length=6)
+    assert_format(source, expected, mode)
+
+
 def test_preview_docstring_no_string_normalization() -> None:
     """
     Like test_docstring but with string normalization off *and* the preview style
     enabled.
     """
     source, expected = read_data(
         "miscellaneous", "docstring_preview_no_string_normalization"
@@ -167,20 +182,33 @@
 
 def test_stub() -> None:
     mode = replace(DEFAULT_MODE, is_pyi=True)
     source, expected = read_data("miscellaneous", "stub.pyi")
     assert_format(source, expected, mode)
 
 
+def test_nested_class_stub() -> None:
+    mode = replace(DEFAULT_MODE, is_pyi=True, preview=True)
+    source, expected = read_data("miscellaneous", "nested_class_stub.pyi")
+    assert_format(source, expected, mode)
+
+
 def test_power_op_newline() -> None:
     # requires line_length=0
     source, expected = read_data("miscellaneous", "power_op_newline")
     assert_format(source, expected, mode=black.Mode(line_length=0))
 
 
+def test_type_comment_syntax_error() -> None:
+    """Test that black is able to format python code with type comment syntax errors."""
+    source, expected = read_data("type_comments", "type_comment_syntax_error")
+    assert_format(source, expected)
+    black.assert_equivalent(source, expected)
+
+
 @pytest.mark.parametrize("filename", ["long_first_line", "docstring_tabs"])
 def test_tabs(filename: str) -> None:
     source, expected = read_data("tabs", filename)
     mode = black.Mode(use_tabs=True)
     assert_format(source, expected, mode)
```

### Comparing `tan-22.8.0/tests/test_ipynb.py` & `tan-23.3.0/tests/test_ipynb.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/test_no_ipynb.py` & `tan-23.3.0/tests/test_no_ipynb.py`

 * *Files 11% similar despite different names*

```diff
@@ -13,25 +13,25 @@
 
 def test_ipynb_diff_with_no_change_single() -> None:
     jupyter_dependencies_are_installed.cache_clear()
     path = get_case_path("jupyter", "notebook_trailing_newline.ipynb")
     result = runner.invoke(main, [str(path)])
     expected_output = (
         "Skipping .ipynb files as Jupyter dependencies are not installed.\n"
-        "You can fix this by running ``pip install black[jupyter]``\n"
+        'You can fix this by running ``pip install "black[jupyter]"``\n'
     )
     assert expected_output in result.output
 
 
 def test_ipynb_diff_with_no_change_dir(tmp_path: pathlib.Path) -> None:
     jupyter_dependencies_are_installed.cache_clear()
     runner = CliRunner()
     nb = get_case_path("jupyter", "notebook_trailing_newline.ipynb")
     tmp_nb = tmp_path / "notebook.ipynb"
     with open(nb) as src, open(tmp_nb, "w") as dst:
         dst.write(src.read())
     result = runner.invoke(main, [str(tmp_path)])
     expected_output = (
         "Skipping .ipynb files as Jupyter dependencies are not installed.\n"
-        "You can fix this by running ``pip install black[jupyter]``\n"
+        'You can fix this by running ``pip install "black[jupyter]"``\n'
     )
     assert expected_output in result.output
```

### Comparing `tan-22.8.0/tests/test_trans.py` & `tan-23.3.0/tests/test_trans.py`

 * *Files identical despite different names*

### Comparing `tan-22.8.0/tests/util.py` & `tan-23.3.0/tests/util.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,11 +1,12 @@
 import os
 import sys
 import unittest
 from contextlib import contextmanager
+from dataclasses import replace
 from functools import partial
 from pathlib import Path
 from typing import Any, Iterator, List, Optional, Tuple
 
 import black
 from black.debug import DebugVisitor
 from black.mode import TargetVersion
@@ -52,34 +53,83 @@
 
     if actual != expected:
         out(diff(expected, actual, "expected", "actual"))
 
     assert actual == expected
 
 
+class FormatFailure(Exception):
+    """Used to wrap failures when assert_format() runs in an extra mode."""
+
+
 def assert_format(
     source: str,
     expected: str,
     mode: black.Mode = DEFAULT_MODE,
     *,
     fast: bool = False,
     minimum_version: Optional[Tuple[int, int]] = None,
 ) -> None:
     """Convenience function to check that Black formats as expected.
 
     You can pass @minimum_version if you're passing code with newer syntax to guard
     safety guards so they don't just crash with a SyntaxError. Please note this is
     separate from TargetVerson Mode configuration.
     """
+    _assert_format_inner(
+        source, expected, mode, fast=fast, minimum_version=minimum_version
+    )
+
+    # For both preview and non-preview tests, ensure that Black doesn't crash on
+    # this code, but don't pass "expected" because the precise output may differ.
+    try:
+        _assert_format_inner(
+            source,
+            None,
+            replace(mode, preview=not mode.preview),
+            fast=fast,
+            minimum_version=minimum_version,
+        )
+    except Exception as e:
+        text = "non-preview" if mode.preview else "preview"
+        raise FormatFailure(
+            f"Black crashed formatting this case in {text} mode."
+        ) from e
+    # Similarly, setting line length to 1 is a good way to catch
+    # stability bugs. But only in non-preview mode because preview mode
+    # currently has a lot of line length 1 bugs.
+    try:
+        _assert_format_inner(
+            source,
+            None,
+            replace(mode, preview=False, line_length=1),
+            fast=fast,
+            minimum_version=minimum_version,
+        )
+    except Exception as e:
+        raise FormatFailure(
+            "Black crashed formatting this case with line-length set to 1."
+        ) from e
+
+
+def _assert_format_inner(
+    source: str,
+    expected: Optional[str] = None,
+    mode: black.Mode = DEFAULT_MODE,
+    *,
+    fast: bool = False,
+    minimum_version: Optional[Tuple[int, int]] = None,
+) -> None:
     actual = black.format_str(source, mode=mode)
-    _assert_format_equal(expected, actual)
+    if expected is not None:
+        _assert_format_equal(expected, actual)
     # It's not useful to run safety checks if we're expecting no changes anyway. The
     # assertion right above will raise if reality does actually make changes. This just
     # avoids wasted CPU cycles.
-    if not fast and source != expected:
+    if not fast and source != actual:
         # Unfortunately the AST equivalence check relies on the built-in ast module
         # being able to parse the code being formatted. This doesn't always work out
         # when checking modern code on older versions.
         if minimum_version is None or sys.version_info >= minimum_version:
             black.assert_equivalent(source, actual)
         black.assert_stable(source, actual, mode=mode)
```

### Comparing `tan-22.8.0/tox.ini` & `tan-23.3.0/tox.ini`

 * *Files 12% similar despite different names*

```diff
@@ -1,9 +1,10 @@
 [tox]
-envlist = {,ci-}py{36,37,38,39,310,311,py3},fuzz,run_self
+isolated_build = true
+envlist = {,ci-}py{37,38,39,310,311,py3},fuzz,run_self
 
 [testenv]
 setenv = PYTHONPATH = {toxinidir}/src
 skip_install = True
 # We use `recreate=True` because otherwise, on the second run of `tox -e py`,
 # the `no_jupyter` tests would run with the jupyter extra dependencies installed.
 # See https://github.com/psf/black/issues/2367.
@@ -47,24 +48,28 @@
         -m jupyter \
         !ci: --numprocesses auto \
         ci: --numprocesses 1 \
         --cov --cov-append {posargs}
     coverage report
 
 [testenv:{,ci-}311]
-setenv = PYTHONPATH = {toxinidir}/src
+setenv =
+  PYTHONPATH = {toxinidir}/src
+  AIOHTTP_NO_EXTENSIONS = 1
 skip_install = True
 recreate = True
 deps =
+; We currently need > aiohttp 3.8.1 that is on PyPI for 3.11
+    git+https://github.com/aio-libs/aiohttp
     -r{toxinidir}/test_requirements.txt
 ; a separate worker is required in ci due to https://foss.heptapod.net/pypy/pypy/-/issues/3317
 ; this seems to cause tox to wait forever
 ; remove this when pypy releases the bugfix
 commands =
-    pip install -e .
+    pip install -e .[d]
     coverage erase
     pytest tests \
         --run-optional no_jupyter \
         !ci: --numprocesses auto \
         ci: --numprocesses 1 \
         --cov {posargs}
     pip install -e .[jupyter]
@@ -88,8 +93,8 @@
     coverage report
 
 [testenv:run_self]
 setenv = PYTHONPATH = {toxinidir}/src
 skip_install = True
 commands =
     pip install -e .[d]
-    tan --check {toxinidir}/src {toxinidir}/tests {toxinidir}/setup.py
+    tan --check {toxinidir}/src {toxinidir}/tests
```

